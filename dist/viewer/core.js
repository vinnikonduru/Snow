import * as __SNOWPACK_ENV__ from '../_snowpack/env.js';

var Xg=Object.create,ar=Object.defineProperty,Zg=Object.getPrototypeOf,Jg=Object.prototype.hasOwnProperty,Yg=Object.getOwnPropertyNames,Qg=Object.getOwnPropertyDescriptor;var ev=u=>ar(u,"__esModule",{value:!0});var we=(u,t)=>()=>(t||(t={exports:{}},u(t.exports,t)),t.exports),fe=(u,t)=>{for(var e in t)ar(u,e,{get:t[e],enumerable:!0})},tv=(u,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Yg(t))!Jg.call(u,n)&&n!=="default"&&ar(u,n,{get:()=>t[n],enumerable:!(e=Qg(t,n))||e.enumerable});return u},Kt=u=>tv(ev(ar(u!=null?Xg(Zg(u)):{},"default",u&&u.__esModule&&"default"in u?{get:()=>u.default,enumerable:!0}:{value:u,enumerable:!0})),u);var Ln=we((hr,jl)=>{(function(u,t){typeof hr=="object"?jl.exports=hr=t():typeof define=="function"&&define.amd?define([],t):u.CryptoJS=t()})(hr,function(){var u=u||function(t,e){var n;if(typeof window!="undefined"&&window.crypto&&(n=window.crypto),!n&&typeof window!="undefined"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof window!="undefined"&&window.crypto&&(n=window.crypto),!n)try{n=require("crypto")}catch(b){}var r=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch(b){}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch(b){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function b(){}return function(g){var T;return b.prototype=g,T=new b,b.prototype=null,T}}(),a={},s=a.lib={},o=s.Base=function(){return{extend:function(b){var g=i(this);return b&&g.mixIn(b),(!g.hasOwnProperty("init")||this.init===g.init)&&(g.init=function(){g.$super.init.apply(this,arguments)}),g.init.prototype=g,g.$super=this,g},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var g in b)b.hasOwnProperty(g)&&(this[g]=b[g]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),l=s.WordArray=o.extend({init:function(b,g){b=this.words=b||[],g!=e?this.sigBytes=g:this.sigBytes=b.length*4},toString:function(b){return(b||d).stringify(this)},concat:function(b){var g=this.words,T=b.words,N=this.sigBytes,v=b.sigBytes;if(this.clamp(),N%4)for(var C=0;C<v;C++){var x=T[C>>>2]>>>24-C%4*8&255;g[N+C>>>2]|=x<<24-(N+C)%4*8}else for(var C=0;C<v;C+=4)g[N+C>>>2]=T[C>>>2];return this.sigBytes+=v,this},clamp:function(){var b=this.words,g=this.sigBytes;b[g>>>2]&=4294967295<<32-g%4*8,b.length=t.ceil(g/4)},clone:function(){var b=o.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var g=[],T=0;T<b;T+=4)g.push(r());return new l.init(g,b)}}),c=a.enc={},d=c.Hex={stringify:function(b){for(var g=b.words,T=b.sigBytes,N=[],v=0;v<T;v++){var C=g[v>>>2]>>>24-v%4*8&255;N.push((C>>>4).toString(16)),N.push((C&15).toString(16))}return N.join("")},parse:function(b){for(var g=b.length,T=[],N=0;N<g;N+=2)T[N>>>3]|=parseInt(b.substr(N,2),16)<<24-N%8*4;return new l.init(T,g/2)}},p=c.Latin1={stringify:function(b){for(var g=b.words,T=b.sigBytes,N=[],v=0;v<T;v++){var C=g[v>>>2]>>>24-v%4*8&255;N.push(String.fromCharCode(C))}return N.join("")},parse:function(b){for(var g=b.length,T=[],N=0;N<g;N++)T[N>>>2]|=(b.charCodeAt(N)&255)<<24-N%4*8;return new l.init(T,g)}},m=c.Utf8={stringify:function(b){try{return decodeURIComponent(escape(p.stringify(b)))}catch(g){throw new Error("Malformed UTF-8 data")}},parse:function(b){return p.parse(unescape(encodeURIComponent(b)))}},f=s.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(b){typeof b=="string"&&(b=m.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var g,T=this._data,N=T.words,v=T.sigBytes,C=this.blockSize,x=C*4,V=v/x;b?V=t.ceil(V):V=t.max((V|0)-this._minBufferSize,0);var w=V*C,D=t.min(w*4,v);if(w){for(var I=0;I<w;I+=C)this._doProcessBlock(N,I);g=N.splice(0,w),T.sigBytes-=D}return new l.init(g,D)},clone:function(){var b=o.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0}),h=s.Hasher=f.extend({cfg:o.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){b&&this._append(b);var g=this._doFinalize();return g},blockSize:512/32,_createHelper:function(b){return function(g,T){return new b.init(T).finalize(g)}},_createHmacHelper:function(b){return function(g,T){return new y.HMAC.init(b,T).finalize(g)}}}),y=a.algo={};return a}(Math);return u})});var ql=we((yr,Hl)=>{(function(u,t){typeof yr=="object"?Hl.exports=yr=t(Ln()):typeof define=="function"&&define.amd?define(["./core"],t):t(u.CryptoJS)})(yr,function(u){return function(){var t=u,e=t.lib,n=e.WordArray,r=e.Hasher,i=t.algo,a=[],s=i.SHA1=r.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(o,l){for(var c=this._hash.words,d=c[0],p=c[1],m=c[2],f=c[3],h=c[4],y=0;y<80;y++){if(y<16)a[y]=o[l+y]|0;else{var b=a[y-3]^a[y-8]^a[y-14]^a[y-16];a[y]=b<<1|b>>>31}var g=(d<<5|d>>>27)+h+a[y];y<20?g+=(p&m|~p&f)+1518500249:y<40?g+=(p^m^f)+1859775393:y<60?g+=(p&m|p&f|m&f)-1894007588:g+=(p^m^f)-899497514,h=f,f=m,m=p<<30|p>>>2,p=d,d=g}c[0]=c[0]+d|0,c[1]=c[1]+p|0,c[2]=c[2]+m|0,c[3]=c[3]+f|0,c[4]=c[4]+h|0},_doFinalize:function(){var o=this._data,l=o.words,c=this._nDataBytes*8,d=o.sigBytes*8;return l[d>>>5]|=128<<24-d%32,l[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),l[(d+64>>>9<<4)+15]=c,o.sigBytes=l.length*4,this._process(),this._hash},clone:function(){var o=r.clone.call(this);return o._hash=this._hash.clone(),o}});t.SHA1=r._createHelper(s),t.HmacSHA1=r._createHmacHelper(s)}(),u.SHA1})});var Wl=we((br,Kl)=>{(function(u,t){typeof br=="object"?Kl.exports=br=t(Ln()):typeof define=="function"&&define.amd?define(["./core"],t):t(u.CryptoJS)})(br,function(u){return function(){var t=u,e=t.lib,n=e.WordArray,r=t.enc,i=r.Base64={stringify:function(s){var o=s.words,l=s.sigBytes,c=this._map;s.clamp();for(var d=[],p=0;p<l;p+=3)for(var m=o[p>>>2]>>>24-p%4*8&255,f=o[p+1>>>2]>>>24-(p+1)%4*8&255,h=o[p+2>>>2]>>>24-(p+2)%4*8&255,y=m<<16|f<<8|h,b=0;b<4&&p+b*.75<l;b++)d.push(c.charAt(y>>>6*(3-b)&63));var g=c.charAt(64);if(g)for(;d.length%4;)d.push(g);return d.join("")},parse:function(s){var o=s.length,l=this._map,c=this._reverseMap;if(!c){c=this._reverseMap=[];for(var d=0;d<l.length;d++)c[l.charCodeAt(d)]=d}var p=l.charAt(64);if(p){var m=s.indexOf(p);m!==-1&&(o=m)}return a(s,o,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(s,o,l){for(var c=[],d=0,p=0;p<o;p++)if(p%4){var m=l[s.charCodeAt(p-1)]<<p%4*2,f=l[s.charCodeAt(p)]>>>6-p%4*2,h=m|f;c[d>>>2]|=h<<24-d%4*8,d++}return n.create(c,d)}}(),u.enc.Base64})});var Ph=we(J=>{"use strict";var ve=typeof Symbol=="function"&&Symbol.for,lo=ve?Symbol.for("react.element"):60103,uo=ve?Symbol.for("react.portal"):60106,Sr=ve?Symbol.for("react.fragment"):60107,Ir=ve?Symbol.for("react.strict_mode"):60108,Pr=ve?Symbol.for("react.profiler"):60114,Or=ve?Symbol.for("react.provider"):60109,Lr=ve?Symbol.for("react.context"):60110,co=ve?Symbol.for("react.async_mode"):60111,Rr=ve?Symbol.for("react.concurrent_mode"):60111,Fr=ve?Symbol.for("react.forward_ref"):60112,kr=ve?Symbol.for("react.suspense"):60113,qv=ve?Symbol.for("react.suspense_list"):60120,Mr=ve?Symbol.for("react.memo"):60115,_r=ve?Symbol.for("react.lazy"):60116,Kv=ve?Symbol.for("react.block"):60121,Wv=ve?Symbol.for("react.fundamental"):60117,Uv=ve?Symbol.for("react.responder"):60118,Gv=ve?Symbol.for("react.scope"):60119;function Me(u){if(typeof u=="object"&&u!==null){var t=u.$$typeof;switch(t){case lo:switch(u=u.type,u){case co:case Rr:case Sr:case Pr:case Ir:case kr:return u;default:switch(u=u&&u.$$typeof,u){case Lr:case Fr:case _r:case Mr:case Or:return u;default:return t}}case uo:return t}}}function Ih(u){return Me(u)===Rr}J.AsyncMode=co;J.ConcurrentMode=Rr;J.ContextConsumer=Lr;J.ContextProvider=Or;J.Element=lo;J.ForwardRef=Fr;J.Fragment=Sr;J.Lazy=_r;J.Memo=Mr;J.Portal=uo;J.Profiler=Pr;J.StrictMode=Ir;J.Suspense=kr;J.isAsyncMode=function(u){return Ih(u)||Me(u)===co};J.isConcurrentMode=Ih;J.isContextConsumer=function(u){return Me(u)===Lr};J.isContextProvider=function(u){return Me(u)===Or};J.isElement=function(u){return typeof u=="object"&&u!==null&&u.$$typeof===lo};J.isForwardRef=function(u){return Me(u)===Fr};J.isFragment=function(u){return Me(u)===Sr};J.isLazy=function(u){return Me(u)===_r};J.isMemo=function(u){return Me(u)===Mr};J.isPortal=function(u){return Me(u)===uo};J.isProfiler=function(u){return Me(u)===Pr};J.isStrictMode=function(u){return Me(u)===Ir};J.isSuspense=function(u){return Me(u)===kr};J.isValidElementType=function(u){return typeof u=="string"||typeof u=="function"||u===Sr||u===Rr||u===Pr||u===Ir||u===kr||u===qv||typeof u=="object"&&u!==null&&(u.$$typeof===_r||u.$$typeof===Mr||u.$$typeof===Or||u.$$typeof===Lr||u.$$typeof===Fr||u.$$typeof===Wv||u.$$typeof===Uv||u.$$typeof===Gv||u.$$typeof===Kv)};J.typeOf=Me});var Oh=we(Y=>{"use strict";__SNOWPACK_ENV__.NODE_ENV!=="production"&&function(){"use strict";var u=typeof Symbol=="function"&&Symbol.for,t=u?Symbol.for("react.element"):60103,e=u?Symbol.for("react.portal"):60106,n=u?Symbol.for("react.fragment"):60107,r=u?Symbol.for("react.strict_mode"):60108,i=u?Symbol.for("react.profiler"):60114,a=u?Symbol.for("react.provider"):60109,s=u?Symbol.for("react.context"):60110,o=u?Symbol.for("react.async_mode"):60111,l=u?Symbol.for("react.concurrent_mode"):60111,c=u?Symbol.for("react.forward_ref"):60112,d=u?Symbol.for("react.suspense"):60113,p=u?Symbol.for("react.suspense_list"):60120,m=u?Symbol.for("react.memo"):60115,f=u?Symbol.for("react.lazy"):60116,h=u?Symbol.for("react.block"):60121,y=u?Symbol.for("react.fundamental"):60117,b=u?Symbol.for("react.responder"):60118,g=u?Symbol.for("react.scope"):60119;function T(E){return typeof E=="string"||typeof E=="function"||E===n||E===l||E===i||E===r||E===d||E===p||typeof E=="object"&&E!==null&&(E.$$typeof===f||E.$$typeof===m||E.$$typeof===a||E.$$typeof===s||E.$$typeof===c||E.$$typeof===y||E.$$typeof===b||E.$$typeof===g||E.$$typeof===h)}function N(E){if(typeof E=="object"&&E!==null){var Ni=E.$$typeof;switch(Ni){case t:var ir=E.type;switch(ir){case o:case l:case n:case i:case r:case d:return ir;default:var Sl=ir&&ir.$$typeof;switch(Sl){case s:case c:case f:case m:case a:return Sl;default:return Ni}}case e:return Ni}}}var v=o,C=l,x=s,V=a,w=t,D=c,I=n,A=f,S=m,O=e,P=i,L=r,F=d,M=!1;function _(E){return M||(M=!0,console.warn("The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),j(E)||N(E)===o}function j(E){return N(E)===l}function q(E){return N(E)===s}function W(E){return N(E)===a}function Ue(E){return typeof E=="object"&&E!==null&&E.$$typeof===t}function je(E){return N(E)===c}function qt(E){return N(E)===n}function Hg(E){return N(E)===f}function qg(E){return N(E)===m}function Kg(E){return N(E)===e}function Wg(E){return N(E)===i}function Ug(E){return N(E)===r}function Gg(E){return N(E)===d}Y.AsyncMode=v,Y.ConcurrentMode=C,Y.ContextConsumer=x,Y.ContextProvider=V,Y.Element=w,Y.ForwardRef=D,Y.Fragment=I,Y.Lazy=A,Y.Memo=S,Y.Portal=O,Y.Profiler=P,Y.StrictMode=L,Y.Suspense=F,Y.isAsyncMode=_,Y.isConcurrentMode=j,Y.isContextConsumer=q,Y.isContextProvider=W,Y.isElement=Ue,Y.isForwardRef=je,Y.isFragment=qt,Y.isLazy=Hg,Y.isMemo=qg,Y.isPortal=Kg,Y.isProfiler=Wg,Y.isStrictMode=Ug,Y.isSuspense=Gg,Y.isValidElementType=T,Y.typeOf=N}()});var mo=we((V2,po)=>{"use strict";__SNOWPACK_ENV__.NODE_ENV==="production"?po.exports=Ph():po.exports=Oh()});var Fh=we((w2,Lh)=>{"use strict";var Rh=Object.getOwnPropertySymbols,Xv=Object.prototype.hasOwnProperty,Zv=Object.prototype.propertyIsEnumerable;function Jv(u){if(u==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(u)}function Yv(){try{if(!Object.assign)return!1;var u=new String("abc");if(u[5]="de",Object.getOwnPropertyNames(u)[0]==="5")return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;var n=Object.getOwnPropertyNames(t).map(function(i){return t[i]});if(n.join("")!=="0123456789")return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(i){r[i]=i}),Object.keys(Object.assign({},r)).join("")==="abcdefghijklmnopqrst"}catch(i){return!1}}Lh.exports=Yv()?Object.assign:function(u,t){for(var e,n=Jv(u),r,i=1;i<arguments.length;i++){e=Object(arguments[i]);for(var a in e)Xv.call(e,a)&&(n[a]=e[a]);if(Rh){r=Rh(e);for(var s=0;s<r.length;s++)Zv.call(e,r[s])&&(n[r[s]]=e[r[s]])}}return n}});var Br=we((D2,kh)=>{"use strict";var Qv="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";kh.exports=Qv});var $h=we((A2,Mh)=>{"use strict";var fo=function(){};__SNOWPACK_ENV__.NODE_ENV!=="production"&&(_h=Br(),Er={},Bh=Function.call.bind(Object.prototype.hasOwnProperty),fo=function(u){var t="Warning: "+u;typeof console!="undefined"&&console.error(t);try{throw new Error(t)}catch(e){}});var _h,Er,Bh;function Eh(u,t,e,n,r){if(__SNOWPACK_ENV__.NODE_ENV!=="production"){for(var i in u)if(Bh(u,i)){var a;try{if(typeof u[i]!="function"){var s=Error((n||"React class")+": "+e+" type `"+i+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof u[i]+"`.");throw s.name="Invariant Violation",s}a=u[i](t,i,n,e,null,_h)}catch(l){a=l}if(a&&!(a instanceof Error)&&fo((n||"React class")+": type specification of "+e+" `"+i+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof a+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),a instanceof Error&&!(a.message in Er)){Er[a.message]=!0;var o=r?r():"";fo("Failed "+e+" type: "+a.message+(o??""))}}}}Eh.resetWarningCache=function(){__SNOWPACK_ENV__.NODE_ENV!=="production"&&(Er={})};Mh.exports=Eh});var Hh=we((S2,zh)=>{"use strict";var eC=mo(),tC=Fh(),hn=Br(),jh=$h(),nC=Function.call.bind(Object.prototype.hasOwnProperty),yn=function(){};__SNOWPACK_ENV__.NODE_ENV!=="production"&&(yn=function(u){var t="Warning: "+u;typeof console!="undefined"&&console.error(t);try{throw new Error(t)}catch(e){}});function $r(){return null}zh.exports=function(u,t){var e=typeof Symbol=="function"&&Symbol.iterator,n="@@iterator";function r(A){var S=A&&(e&&A[e]||A[n]);if(typeof S=="function")return S}var i="<<anonymous>>",a={array:c("array"),bool:c("boolean"),func:c("function"),number:c("number"),object:c("object"),string:c("string"),symbol:c("symbol"),any:d(),arrayOf:p,element:m(),elementType:f(),instanceOf:h,node:T(),objectOf:b,oneOf:y,oneOfType:g,shape:N,exact:v};function s(A,S){return A===S?A!==0||1/A==1/S:A!==A&&S!==S}function o(A){this.message=A,this.stack=""}o.prototype=Error.prototype;function l(A){if(__SNOWPACK_ENV__.NODE_ENV!=="production")var S={},O=0;function P(F,M,_,j,q,W,Ue){if(j=j||i,W=W||_,Ue!==hn){if(t){var je=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw je.name="Invariant Violation",je}else if(__SNOWPACK_ENV__.NODE_ENV!=="production"&&typeof console!="undefined"){var qt=j+":"+_;!S[qt]&&O<3&&(yn("You are manually calling a React.PropTypes validation function for the `"+W+"` prop on `"+j+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),S[qt]=!0,O++)}}return M[_]==null?F?M[_]===null?new o("The "+q+" `"+W+"` is marked as required "+("in `"+j+"`, but its value is `null`.")):new o("The "+q+" `"+W+"` is marked as required in "+("`"+j+"`, but its value is `undefined`.")):null:A(M,_,j,q,W)}var L=P.bind(null,!1);return L.isRequired=P.bind(null,!0),L}function c(A){function S(O,P,L,F,M,_){var j=O[P],q=V(j);if(q!==A){var W=w(j);return new o("Invalid "+F+" `"+M+"` of type "+("`"+W+"` supplied to `"+L+"`, expected ")+("`"+A+"`."))}return null}return l(S)}function d(){return l($r)}function p(A){function S(O,P,L,F,M){if(typeof A!="function")return new o("Property `"+M+"` of component `"+L+"` has invalid PropType notation inside arrayOf.");var _=O[P];if(!Array.isArray(_)){var j=V(_);return new o("Invalid "+F+" `"+M+"` of type "+("`"+j+"` supplied to `"+L+"`, expected an array."))}for(var q=0;q<_.length;q++){var W=A(_,q,L,F,M+"["+q+"]",hn);if(W instanceof Error)return W}return null}return l(S)}function m(){function A(S,O,P,L,F){var M=S[O];if(!u(M)){var _=V(M);return new o("Invalid "+L+" `"+F+"` of type "+("`"+_+"` supplied to `"+P+"`, expected a single ReactElement."))}return null}return l(A)}function f(){function A(S,O,P,L,F){var M=S[O];if(!eC.isValidElementType(M)){var _=V(M);return new o("Invalid "+L+" `"+F+"` of type "+("`"+_+"` supplied to `"+P+"`, expected a single ReactElement type."))}return null}return l(A)}function h(A){function S(O,P,L,F,M){if(!(O[P]instanceof A)){var _=A.name||i,j=I(O[P]);return new o("Invalid "+F+" `"+M+"` of type "+("`"+j+"` supplied to `"+L+"`, expected ")+("instance of `"+_+"`."))}return null}return l(S)}function y(A){if(!Array.isArray(A))return __SNOWPACK_ENV__.NODE_ENV!=="production"&&(arguments.length>1?yn("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):yn("Invalid argument supplied to oneOf, expected an array.")),$r;function S(O,P,L,F,M){for(var _=O[P],j=0;j<A.length;j++)if(s(_,A[j]))return null;var q=JSON.stringify(A,function(Ue,je){var qt=w(je);return qt==="symbol"?String(je):je});return new o("Invalid "+F+" `"+M+"` of value `"+String(_)+"` "+("supplied to `"+L+"`, expected one of "+q+"."))}return l(S)}function b(A){function S(O,P,L,F,M){if(typeof A!="function")return new o("Property `"+M+"` of component `"+L+"` has invalid PropType notation inside objectOf.");var _=O[P],j=V(_);if(j!=="object")return new o("Invalid "+F+" `"+M+"` of type "+("`"+j+"` supplied to `"+L+"`, expected an object."));for(var q in _)if(nC(_,q)){var W=A(_,q,L,F,M+"."+q,hn);if(W instanceof Error)return W}return null}return l(S)}function g(A){if(!Array.isArray(A))return __SNOWPACK_ENV__.NODE_ENV!=="production"&&yn("Invalid argument supplied to oneOfType, expected an instance of array."),$r;for(var S=0;S<A.length;S++){var O=A[S];if(typeof O!="function")return yn("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+D(O)+" at index "+S+"."),$r}function P(L,F,M,_,j){for(var q=0;q<A.length;q++){var W=A[q];if(W(L,F,M,_,j,hn)==null)return null}return new o("Invalid "+_+" `"+j+"` supplied to "+("`"+M+"`."))}return l(P)}function T(){function A(S,O,P,L,F){return C(S[O])?null:new o("Invalid "+L+" `"+F+"` supplied to "+("`"+P+"`, expected a ReactNode."))}return l(A)}function N(A){function S(O,P,L,F,M){var _=O[P],j=V(_);if(j!=="object")return new o("Invalid "+F+" `"+M+"` of type `"+j+"` "+("supplied to `"+L+"`, expected `object`."));for(var q in A){var W=A[q];if(!!W){var Ue=W(_,q,L,F,M+"."+q,hn);if(Ue)return Ue}}return null}return l(S)}function v(A){function S(O,P,L,F,M){var _=O[P],j=V(_);if(j!=="object")return new o("Invalid "+F+" `"+M+"` of type `"+j+"` "+("supplied to `"+L+"`, expected `object`."));var q=tC({},O[P],A);for(var W in q){var Ue=A[W];if(!Ue)return new o("Invalid "+F+" `"+M+"` key `"+W+"` supplied to `"+L+"`.\nBad object: "+JSON.stringify(O[P],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(A),null,"  "));var je=Ue(_,W,L,F,M+"."+W,hn);if(je)return je}return null}return l(S)}function C(A){switch(typeof A){case"number":case"string":case"undefined":return!0;case"boolean":return!A;case"object":if(Array.isArray(A))return A.every(C);if(A===null||u(A))return!0;var S=r(A);if(S){var O=S.call(A),P;if(S!==A.entries){for(;!(P=O.next()).done;)if(!C(P.value))return!1}else for(;!(P=O.next()).done;){var L=P.value;if(L&&!C(L[1]))return!1}}else return!1;return!0;default:return!1}}function x(A,S){return A==="symbol"?!0:S?S["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&S instanceof Symbol:!1}function V(A){var S=typeof A;return Array.isArray(A)?"array":A instanceof RegExp?"object":x(S,A)?"symbol":S}function w(A){if(typeof A=="undefined"||A===null)return""+A;var S=V(A);if(S==="object"){if(A instanceof Date)return"date";if(A instanceof RegExp)return"regexp"}return S}function D(A){var S=w(A);switch(S){case"array":case"object":return"an "+S;case"boolean":case"date":case"regexp":return"a "+S;default:return S}}function I(A){return!A.constructor||!A.constructor.name?i:A.constructor.name}return a.checkPropTypes=jh,a.resetWarningCache=jh.resetWarningCache,a.PropTypes=a,a}});var Uh=we((I2,qh)=>{"use strict";var rC=Br();function Kh(){}function Wh(){}Wh.resetWarningCache=Kh;qh.exports=function(){function u(n,r,i,a,s,o){if(o!==rC){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}u.isRequired=u;function t(){return u}var e={array:u,bool:u,func:u,number:u,object:u,string:u,symbol:u,any:u,arrayOf:t,element:u,elementType:u,instanceOf:t,node:u,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Wh,resetWarningCache:Kh};return e.PropTypes=e,e}});var Zh=we((P2,ho)=>{__SNOWPACK_ENV__.NODE_ENV!=="production"?(Gh=mo(),Xh=!0,ho.exports=Hh()(Gh.isElement,Xh)):ho.exports=Uh()();var Gh,Xh});var Cg=we((wE,vg)=>{var bt=function(u){u==null&&(u=new Date().getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,u.constructor==Array?this.init_by_array(u,u.length):this.init_seed(u)};bt.prototype.init_seed=function(u){for(this.mt[0]=u>>>0,this.mti=1;this.mti<this.N;this.mti++){var u=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(((u&4294901760)>>>16)*1812433253<<16)+(u&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}};bt.prototype.init_by_array=function(u,t){var e,n,r;for(this.init_seed(19650218),e=1,n=0,r=this.N>t?this.N:t;r;r--){var i=this.mt[e-1]^this.mt[e-1]>>>30;this.mt[e]=(this.mt[e]^(((i&4294901760)>>>16)*1664525<<16)+(i&65535)*1664525)+u[n]+n,this.mt[e]>>>=0,e++,n++,e>=this.N&&(this.mt[0]=this.mt[this.N-1],e=1),n>=t&&(n=0)}for(r=this.N-1;r;r--){var i=this.mt[e-1]^this.mt[e-1]>>>30;this.mt[e]=(this.mt[e]^(((i&4294901760)>>>16)*1566083941<<16)+(i&65535)*1566083941)-e,this.mt[e]>>>=0,e++,e>=this.N&&(this.mt[0]=this.mt[this.N-1],e=1)}this.mt[0]=2147483648};bt.prototype.random_int=function(){var u,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var e;for(this.mti==this.N+1&&this.init_seed(5489),e=0;e<this.N-this.M;e++)u=this.mt[e]&this.UPPER_MASK|this.mt[e+1]&this.LOWER_MASK,this.mt[e]=this.mt[e+this.M]^u>>>1^t[u&1];for(;e<this.N-1;e++)u=this.mt[e]&this.UPPER_MASK|this.mt[e+1]&this.LOWER_MASK,this.mt[e]=this.mt[e+(this.M-this.N)]^u>>>1^t[u&1];u=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^u>>>1^t[u&1],this.mti=0}return u=this.mt[this.mti++],u^=u>>>11,u^=u<<7&2636928640,u^=u<<15&4022730752,u^=u>>>18,u>>>0};bt.prototype.random_int31=function(){return this.random_int()>>>1};bt.prototype.random_incl=function(){return this.random_int()*(1/4294967295)};bt.prototype.random=function(){return this.random_int()*(1/4294967296)};bt.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)};bt.prototype.random_long=function(){var u=this.random_int()>>>5,t=this.random_int()>>>6;return(u*67108864+t)*(1/9007199254740992)};vg.exports=bt});var Bg=we((vi,_g)=>{(function(u,t){typeof vi=="object"?_g.exports=vi=t(Ln()):typeof define=="function"&&define.amd?define(["./core"],t):t(u.CryptoJS)})(vi,function(u){return function(t){var e=u,n=e.lib,r=n.WordArray,i=n.Hasher,a=e.algo,s=[],o=[];(function(){function d(h){for(var y=t.sqrt(h),b=2;b<=y;b++)if(!(h%b))return!1;return!0}function p(h){return(h-(h|0))*4294967296|0}for(var m=2,f=0;f<64;)d(m)&&(f<8&&(s[f]=p(t.pow(m,1/2))),o[f]=p(t.pow(m,1/3)),f++),m++})();var l=[],c=a.SHA256=i.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(d,p){for(var m=this._hash.words,f=m[0],h=m[1],y=m[2],b=m[3],g=m[4],T=m[5],N=m[6],v=m[7],C=0;C<64;C++){if(C<16)l[C]=d[p+C]|0;else{var x=l[C-15],V=(x<<25|x>>>7)^(x<<14|x>>>18)^x>>>3,w=l[C-2],D=(w<<15|w>>>17)^(w<<13|w>>>19)^w>>>10;l[C]=V+l[C-7]+D+l[C-16]}var I=g&T^~g&N,A=f&h^f&y^h&y,S=(f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22),O=(g<<26|g>>>6)^(g<<21|g>>>11)^(g<<7|g>>>25),P=v+O+I+o[C]+l[C],L=S+A;v=N,N=T,T=g,g=b+P|0,b=y,y=h,h=f,f=P+L|0}m[0]=m[0]+f|0,m[1]=m[1]+h|0,m[2]=m[2]+y|0,m[3]=m[3]+b|0,m[4]=m[4]+g|0,m[5]=m[5]+T|0,m[6]=m[6]+N|0,m[7]=m[7]+v|0},_doFinalize:function(){var d=this._data,p=d.words,m=this._nDataBytes*8,f=d.sigBytes*8;return p[f>>>5]|=128<<24-f%32,p[(f+64>>>9<<4)+14]=t.floor(m/4294967296),p[(f+64>>>9<<4)+15]=m,d.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var d=i.clone.call(this);return d._hash=this._hash.clone(),d}});e.SHA256=i._createHelper(c),e.HmacSHA256=i._createHmacHelper(c)}(Math),u.SHA256})});var $g=we((Ci,Eg)=>{(function(u,t){typeof Ci=="object"?Eg.exports=Ci=t(Ln()):typeof define=="function"&&define.amd?define(["./core"],t):t(u.CryptoJS)})(Ci,function(u){return u.enc.Hex})});var la={};fe(la,{AggregateScores:()=>Oc,AllowedErrorInNumbers:()=>Yd,AllowedErrorIsAbsolute:()=>ep,Angles:()=>bc,AnimationInterval:()=>Qc,AnimationMode:()=>Yc,AnimationOn:()=>Jc,AssignPartialCredit:()=>kd,AttractThreshold:()=>bp,AuthorProp:()=>Ic,BasedOnNumber:()=>dp,Behavior:()=>rc,BetweenLines:()=>Hp,BranchId:()=>sp,CaseSensitive:()=>Vd,Center:()=>Au,ChildNumber:()=>mu,ChunkSize:()=>Zc,ColNum:()=>tc,Columns:()=>sc,ComponentIndex:()=>Bp,ComponentTypes:()=>Od,Condition:()=>Sp,ContentId:()=>op,Credit:()=>bu,DefaultType:()=>nc,Degrees:()=>zp,Depth:()=>oc,Description:()=>Rd,Direction:()=>vc,Disabled:()=>lu,Displacement:()=>Du,DisplayDecimals:()=>Hc,DisplayDigits:()=>jc,DisplaySmallAsZero:()=>pp,DisplayXAxis:()=>pd,DisplayYAxis:()=>md,Draggable:()=>uu,Dx:()=>Ru,Dy:()=>Fu,Dz:()=>ku,Else:()=>Mp,EncodedGeogebraContent:()=>Ip,Endpoints:()=>Nu,Exclude:()=>Gu,ExcludeCombination:()=>Xu,ExcludeCombinations:()=>Zu,Expand:()=>Hd,ExpandOnCompare:()=>qd,ExtrapolateBackward:()=>Vc,ExtrapolateForward:()=>wc,FeedbackCode:()=>np,FeedbackCodes:()=>ip,FeedbackText:()=>rp,Fixed:()=>du,FixedOrder:()=>_d,FlipFunction:()=>fc,ForceFullCheckWorkButton:()=>Tp,ForceNumeric:()=>rd,ForceSymbolic:()=>id,Format:()=>yu,Formula:()=>mc,From:()=>Wu,FromMathInsight:()=>Pp,Geogebra:()=>$d,Head:()=>Vu,HeadDraggable:()=>Op,Height:()=>ac,Hide:()=>ou,InDegrees:()=>jp,IncludeErrorInNumberExponents:()=>Qd,IncludeGridlines:()=>Hu,IndependentVariable:()=>Kc,Index:()=>Pc,InitialIndependentVariableValue:()=>Wc,InitialNumber:()=>lc,InitialSelectedIndex:()=>ed,InitialText:()=>uc,Inline:()=>Md,Input:()=>ad,IsResponse:()=>wp,Keyword:()=>zd,Label:()=>pu,Layer:()=>cd,Level:()=>Rc,Location:()=>Cc,LowerValue:()=>gd,MatchPartial:()=>Ud,MatchWholeWord:()=>xd,MaxIndex:()=>Sd,MaxIterations:()=>Cd,MaximumNumber:()=>mp,MaximumNumberToSelect:()=>fp,MergeMathLists:()=>yp,MinIndex:()=>Ad,MinNumColumns:()=>Qu,MinNumRows:()=>Yu,ModifyIndirectly:()=>cu,NDiscretizationPoints:()=>xp,NPoints:()=>gp,NSignErrorsMatched:()=>tp,NVariants:()=>Mc,NumberDecimals:()=>Id,NumberDigits:()=>Pd,NumberOfSamples:()=>Nd,NumberToSelect:()=>Ec,Numeric:()=>td,Offset:()=>wd,ParMax:()=>pc,ParMin:()=>dc,Parameter:()=>cc,Period:()=>Dd,Periodic:()=>Vp,PluralForm:()=>cp,PointNumber:()=>gc,Population:()=>Td,PossibleNumberOfGroups:()=>Np,PossiblePoints:()=>vu,Prefill:()=>hu,PropIndex:()=>Ep,Radians:()=>$p,Radius:()=>Su,RenderAsAcuteAngle:()=>dd,RenderAsMath:()=>Xc,RenderMode:()=>Gc,Rendered:()=>kp,Result:()=>_p,RightHandSide:()=>Uc,RowNum:()=>ec,SectionWideCheckWork:()=>Dp,Seed:()=>Bc,SelectForVariants:()=>kc,SelectIndices:()=>Fp,SelectMultiple:()=>Fd,SelectWeight:()=>qc,ShowControls:()=>qu,ShowCorrectness:()=>Xd,ShowLabel:()=>hp,ShowNavigation:()=>Rp,ShowTicks:()=>Ku,Simplify:()=>Dc,SimplifyOnCompare:()=>Ac,Size:()=>jd,Slope:()=>Cp,SortResults:()=>vp,Source:()=>Ld,SplineForm:()=>yc,SplineTension:()=>hc,Step:()=>Ju,Symbolic:()=>nd,SymbolicEquality:()=>Gd,Tail:()=>wu,TailDraggable:()=>Lp,Target:()=>lp,TextType:()=>ap,Threshold:()=>ju,Through:()=>Cu,ThroughSlopes:()=>Tu,Title:()=>Lc,To:()=>Uu,Tolerance:()=>vd,UniqueVariants:()=>_c,Unordered:()=>Kd,UnorderedCompare:()=>Wd,UpperValue:()=>bd,Uri:()=>Bd,Value:()=>Tc,VariableName:()=>Sc,Variant:()=>Fc,Vertices:()=>xu,Weight:()=>gu,Width:()=>ic,WithReplacement:()=>$c,X:()=>sd,Xlabel:()=>fd,Xmax:()=>Pu,Xmin:()=>Iu,Xoffset:()=>Mu,Xs:()=>ud,Xscale:()=>Nc,Xthreshold:()=>Eu,Y:()=>od,Ylabel:()=>hd,Ymax:()=>Lu,Ymin:()=>Ou,Yoffset:()=>_u,Youtube:()=>Ed,Yscale:()=>xc,Ythreshold:()=>$u,Z:()=>ld,Zlabel:()=>yd,Zoffset:()=>Bu,Zthreshold:()=>zu,createIntervals:()=>Zd,createVectors:()=>Jd,delegateCheckWorkToAnswerNumber:()=>Ap,includeUndefinedObjects:()=>fu,length:()=>zc,targetPropertiesToIgnore:()=>up});function ne(u){return u.reduce((t,e)=>Array.isArray(e)?t.concat(ne(e)):t.concat(e),[])}function xi(u,t){return console.log(`levels: ${t}`),u.reduce((e,n)=>Array.isArray(n)&&t>1?e.concat(xi(n,t-1)):e.concat(n),[])}var Vi=class{constructor({properties:t,parentComponentType:e,allComponentClasses:n,standardComponentClasses:r,components:i}){this.logicComponents={},this.parentComponentType=e,this.allComponentClasses=n,this.standardComponentClasses=r,this.components=i,this.setProperties(t)}setParentComponentType(t){this.parentComponentType=t.toLowerCase()}setProperties(t){this.properties=t;let e=Object.keys(t),n=e.length,r=[];for(let i of e){let a="_property_"+i,s;s=new wi({name:a,componentType:i,comparison:"atMost",number:1,allowSpillover:!1,excludeCompositeReplacements:!0,takePropertyChildren:!0,parentComponentType:this.parentComponentType,allComponentClasses:this.allComponentClasses,standardComponentClasses:this.standardComponentClasses,components:this.components}),this.properties[i].name=a,this.logicComponents[a]=s,r.push(s)}if(this.propertyLogic=void 0,n>=1){let i="_properties";this.propertyLogic=new sr({name:i,operator:"and",propositions:r,parentComponentType:this.parentComponentType,allComponentClasses:this.allComponentClasses,standardComponentClasses:this.standardComponentClasses,components:this.components}),this.logicComponents[i]=this.propertyLogic}this.combinePropertyAndBase()}combinePropertyAndBase(){if(this.baseLogic!==void 0)if(this.propertyLogic!==void 0){let t="_propertyAndBase";this.propertyAndBaseLogic=new sr({name:t,operator:"and",propositions:[this.propertyLogic,this.baseLogic],parentComponentType:this.parentComponentType,allComponentClasses:this.allComponentClasses,standardComponentClasses:this.standardComponentClasses,components:this.components}),this.logicComponents[t]=this.propertyAndBaseLogic}else this.propertyAndBaseLogic=this.baseLogic;else this.propertyAndBaseLogic=this.propertyLogic}deleteAllLogic(){for(let t in this.logicComponents)t.substring(0,1)!=="_"&&delete this.logicComponents[t];delete this.baseLogic,this.combinePropertyAndBase()}newLeaf({name:t,componentType:e,getComponentType:n,comparison:r,number:i,requireConsecutive:a,condition:s,allowSpillover:o,excludeComponentTypes:l,excludeCompositeReplacements:c,takePropertyChildren:d,setAsBase:p=!1,...m}){if(t===void 0)throw Error("Error in child logic of "+this.parentComponentType+": child logic leaf must be named");if(t.substring(0,1)==="_")throw Error("Error in child logic of "+this.parentComponentType+": child logic leaf name cannot begin with _");if(t in this.logicComponents)throw Error("Error in child logic of "+this.parentComponentType+": name "+t+" duplicated");if(Object.keys(m).length>0)throw Error("Error in child logic of "+this.parentComponentType+": unexpected arguments to child logic leaf named "+t);let f=new wi({name:t,componentType:e,getComponentType:n,excludeComponentTypes:l,excludeCompositeReplacements:c,takePropertyChildren:d,comparison:r,number:i,requireConsecutive:a,condition:s,allowSpillover:o,parentComponentType:this.parentComponentType,allComponentClasses:this.allComponentClasses,standardComponentClasses:this.standardComponentClasses,components:this.components});return this.logicComponents[t]=f,p&&(this.baseLogic=f,this.combinePropertyAndBase()),f}newOperator({name:t,operator:e,propositions:n,sequenceMatters:r,requireConsecutive:i,allowSpillover:a,setAsBase:s=!1,...o}){if(t===void 0)throw Error("Error in child logic of "+this.parentComponentType+": child logic operator must be named");if(t.substring(0,1)==="_")throw Error("Error in child logic of "+this.parentComponentType+": child logic operator name cannot begin with _");if(t in this.logicComponents)throw Error("Error in child logic of "+this.parentComponentType+": name "+t+" duplicated");if(Object.keys(o).length>0)throw Error("Error in child logic of "+this.parentComponentType+": unexpected arguments to child logic operator named "+t);let l=new sr({name:t,operator:e,propositions:n,sequenceMatters:r,requireConsecutive:i,allowSpillover:a,parentComponentType:this.parentComponentType,allComponentClasses:this.allComponentClasses,standardComponentClasses:this.standardComponentClasses,components:this.components});return this.logicComponents[t]=l,s&&(this.baseLogic=l,this.combinePropertyAndBase()),l}getLogicComponent(t){return this.logicComponents[t]}applyLogic({activeChildren:t,maxAdapterNumber:e=0}){if(this.propertyAndBaseLogic===void 0)return t.length===0?this.logicResult={success:!0,childMatches:[]}:this.logicResult={success:!1,message:t.length+" extra children."},this.logicResult;try{this.logicResult=this.propertyAndBaseLogic.applyLogic({activeChildren:t,maxAdapterNumber:e})}catch(n){return console.warn("error encountered when evaluating child logic"),console.warn(n),this.logicResult={success:!1,message:n.message},this.logicResult}if(this.logicResult.success===!0){let n=ne(this.logicResult.childMatches);n.length!==t.length&&(this.logicResult={success:!1,message:t.length-n.length+" extra children."})}return this.logicResult}checkIfChildInLogic(t,e=!1){return this.propertyAndBaseLogic===void 0?!1:this.propertyAndBaseLogic.checkIfChildInLogic(t,e)}returnMatches(t){if(this.propertyAndBaseLogic===void 0)return;if(this.logicResult.success!==!0)return t in this.logicComponents?[]:void 0;let e=this.propertyAndBaseLogic.indicesFromNames[t];if(e===void 0)return;let n=this.logicResult.childMatches;for(let r of e)if(n=n[r],n===void 0)return[];return n=ne(n),n.sort((r,i)=>r-i),n}},Il=Vi,or=class{constructor({name:t,parentComponentType:e,allComponentClasses:n,standardComponentClasses:r,components:i}){this.name=t,this.parentComponentType=e.toLowerCase(),this.allComponentClasses=n,this.standardComponentClasses=r,this.components=i}applyLogic(){}checkIfChildInLogic(){}setIndicesFromNames(){this.indicesFromNames={}}},wi=class extends or{constructor({name:t,componentType:e,getComponentType:n,excludeComponentTypes:r,excludeCompositeReplacements:i=!1,takePropertyChildren:a=!1,comparison:s="exactly",number:o=1,requireConsecutive:l=!1,condition:c,allowSpillover:d=!0,parentComponentType:p,allComponentClasses:m,standardComponentClasses:f,components:h}){super({name:t,parentComponentType:p,allComponentClasses:m,standardComponentClasses:f,components:h});if(n!==void 0?Object.defineProperty(this,"componentType",{get:()=>n().toLowerCase()}):this.componentType=e.toLowerCase(),this.excludeComponentTypes=r,this.excludeCompositeReplacements=i,this.takePropertyChildren=a,this.comparison=s,this.number=o,this.requireConsecutive=l,this.condition=c,this.allowSpillover=d,!["atLeast","atMost","exactly"].includes(s))throw Error("Error in leaf "+t+" from child logic of "+this.parentComponentType+": comparision must be 'atLeast', 'atMost', or 'exactly'");if(!(Number.isInteger(o)&&o>=0))throw Error("Error in leaf "+t+" from child logic of "+this.parentComponentType+": number must be a non-negative integer");this.maxMatches=Infinity,this.allowSpillover&&(this.comparison==="atMost"||this.comparison==="exactly")&&(this.maxMatches=this.number),this.setIndicesFromNames()}setIndicesFromNames(){this.indicesFromNames={},this.indicesFromNames[this.name]=[]}applyLogic({activeChildren:t,previouslyMatched:e=[],maxAdapterNumber:n}){this.componentClass=this.allComponentClasses[this.componentType];let r=[],i={};if(this.componentClass!==void 0)for(let s=0;s<t.length;s++){if(e.includes(s))continue;let o=t[s],l=!1;if(o instanceof this.componentClass){if(l=!0,this.condition&&!this.condition(o))l=!1;else if(this.excludeComponentTypes){for(let c of this.excludeComponentTypes)if(o instanceof this.allComponentClasses[c]){l=!1;break}}l&&this.excludeCompositeReplacements&&o.replacementOf&&(l=!1),l&&(l=this.takePropertyChildren&&o.doenetAttributes.isPropertyChild||!this.takePropertyChildren&&!o.doenetAttributes.isPropertyChild)}if(l)r.push(s);else if(this.takePropertyChildren&&o.doenetAttributes.isPropertyChild||!this.takePropertyChildren&&!o.doenetAttributes.isPropertyChild){let c=Math.min(n,o.nAdapters);for(let d=0;d<c;d++){let p=o.getAdapter(d),m=this.allComponentClasses[p.componentType.toLowerCase()];if(m!==void 0&&(m===this.componentClass||this.componentClass.isPrototypeOf(m))){if(l=!0,this.condition&&!this.condition(o))l=!1;else if(this.excludeComponentTypes)for(let f of this.excludeComponentTypes){let h=this.allComponentClasses[f];if(m===h||h.isPrototypeOf(m)){l=!1;break}}if(l){r.push(s),i[s]=p;break}}}}if(r.length===this.maxMatches)break}let a=r.length;if(this.comparison==="atLeast"){if(a<this.number)return{success:!1,message:"Need at least "+this.number+" "+this.componentType+" children, but found "+a+"."}}else if(this.comparison==="exactly"){if(a!==this.number)return{success:!1,message:"Need "+this.number+" "+this.componentType+" children, but found "+a+"."}}else if(this.comparison==="atMost"&&a>this.number)return{success:!1,message:"Need at most "+this.number+" "+this.componentType+" children, but found "+a+"."};if(this.requireConsecutive===!0){for(let s=1;s<a;s++)if(r[s]!==r[s-1]+1)return{success:!1,message:this.componentType+" children must be consecutive."}}return{success:!0,childMatches:r,adapterResults:i}}checkIfChildInLogic(t,e){return this.componentClass=this.allComponentClasses[this.componentType],!!(t.constructor===this.componentClass||e&&t instanceof this.componentClass)}},sr=class extends or{constructor({name:t,operator:e,propositions:n=[],sequenceMatters:r=!1,requireConsecutive:i=!1,allowSpillover:a=!0,parentComponentType:s,allComponentClasses:o,standardComponentClasses:l,components:c}){super({name:t,parentComponentType:s,allComponentClasses:o,standardComponentClasses:l,components:c});this.operator=e,this.propositions=n,this.sequenceMatters=r,this.requireConsecutive=i,this.allowSpillover=a;for(let d of n){if(!(d instanceof or))throw Error("Error in operator "+t+" from child logic of "+this.parentComponentType+": each proposition must be a child logic leaf or operator");if(!["and","or","xor"].includes(e))throw Error("Error in operator "+t+" from child logic of "+this.parentComponentType+": operator must be 'and', 'or', or 'xor'")}this.setIndicesFromNames()}setIndicesFromNames(){this.indicesFromNames={},this.indicesFromNames[this.name]=[];for(let t in this.propositions){let e=this.propositions[t];for(let n in e.indicesFromNames){if(n in this.indicesFromNames)throw Error("Child logic name used multiple times: "+n);let r=e.indicesFromNames[n];this.indicesFromNames[n]=[t,...r]}}}applyLogic({activeChildren:t,previouslyMatched:e=[],maxAdapterNumber:n}){let r=[],i={},a=0,s=[],o=e.slice(0);for(let l of this.propositions){let c=l.applyLogic({activeChildren:t,previouslyMatched:o,maxAdapterNumber:n});if(c.name=l.name,s.push(c),c.success===!0)a++,r.push(c.childMatches),i=Object.assign(i,c.adapterResults),this.operator!=="xor"&&(o=[...o,...ne(c.childMatches)]);else{if(this.operator==="and")return{success:!1,message:c.message};r.push([])}}if(this.operator==="or"){if(a===0){let l="Or criterion not matched. (";for(let c of s)l+=c.message+" ";return l+=")",{success:!1,message:l}}}else if(this.operator==="xor"){if(a===0||!this.allowSpillover&&a>1){let l="Xor criterion not matched. (";if(a===0)for(let c of s)l+=c.message+" ";else l+=a+" criteria matched and spillover not allowed.";return l+=")",{success:!1,message:l}}if(a>1){let l=Infinity,c;for(let d in r){let p=r[d],m=ne(p);if(m.length>0){let f=Math.min(...m);f<l&&(l=f,c=d)}}for(let d in r)d!==c&&(r[d]=[]);c!==void 0&&(i=s[c].adapterResults)}}if(a>1&&this.sequenceMatters===!0){let l=-1;for(let c of r){let d=ne(c);if(d.length>0){if(Math.min(...d)<=l)return{success:!1,message:"Active children were in wrong order."};l=Math.max(...d)}}}if(this.requireConsecutive===!0){let l=ne(r);l.sort((d,p)=>d-p);let c=l.length;for(let d=1;d<c;d++)if(l[d]!==l[d-1]+1)return{success:!1,message:"Active children must be consecutive."}}return{success:!0,childMatches:r,adapterResults:i}}checkIfChildInLogic(t,e){return this.propositions.some(n=>n.checkIfChildInLogic(t,e))}};var Pl={get:function(u,t){if(t==="__isReadOnlyProxy")return!0;let e=u[t];return e!==null&&typeof e=="object"&&e.__isReadOnlyProxy!==!0?new Proxy(e,Pl):e},set:function(u,t,e){throw Error("Property "+t+" is read-only")},deleteProperty:function(u,t){throw Error("Property "+t+" is read-only")}},K=Pl;function wn(){return{get:function(u,t){let e=u[t];return e!==void 0&&(e.isArray&&(e.public||e.trackChanges)?e=new Proxy(e.value,Ol({variable:t,nDimensions:e.nDimensions})):(e=e.value,e!==null&&typeof e=="object"&&e.__isReadOnlyProxy!==!0&&(e=new Proxy(e,K)))),e},set:function(u,t,e){throw Error("Property "+t+" is read-only")},deleteProperty:function(u,t){throw Error("Property "+t+" is read-only")}}}function Ol({variable:u,nDimensions:t,indicesSoFar:e=[]}){return{variable:u,nDimensions:t,indicesSoFar:e,get:function(n,r){let i=n[r];return i!==null&&typeof i=="object"&&t>1&&(i=new Proxy(i,Ol({variable:this.variable,nDimensions:this.nDimensions-1,indicesSoFar:[...this.indicesSoFar,r]}))),i},set:function(n,r,i){throw Error("Property "+r+" is read-only")},deleteProperty:function(n,r){throw Error("Property "+r+" is read-only")}}}import Di from"../_snowpack/pkg/math-expressions.js";function Z(u,t,e){if(Object(u)!==u||u instanceof Function||t!==void 0&&u instanceof t)return u;if(u instanceof Di.class)return u.copy();if(e===void 0&&(e=new WeakMap),Array.isArray(u))return[...u.map(r=>Z(r,t,e))];if(u.constructor===Object&&Object.entries(u).length===0)return{};if(e.has(u))return e.get(u);try{var n=new u.constructor}catch(r){n=Object.create(Object.getPrototypeOf(u))}return u instanceof Map?Array.from(u,([r,i])=>n.set(Z(r,t,e),Z(i,t,e))):u instanceof Set&&Array.from(u,r=>n.add(Z(r,t,e))),e.set(u,n),Object.assign(n,...Object.keys(u).map(r=>({[r]:Z(u[r],t,e)})))}function Wt(u,t,e){var n,r;function i(a,s){var o;if(Number.isNaN(a)&&Number.isNaN(s)||a===s)return!0;if(e!==void 0&&a instanceof e&&s instanceof e)return a.componentName===s.componentName;if(a instanceof Di.class&&s instanceof Di.class)return a.equalsViaSyntax(s);if(typeof a=="function"&&typeof s=="function"||a instanceof Date&&s instanceof Date||a instanceof RegExp&&s instanceof RegExp||a instanceof String&&s instanceof String||a instanceof Number&&s instanceof Number)return a.toString()===s.toString();if(!(a instanceof Object&&s instanceof Object)||a.isPrototypeOf(s)||s.isPrototypeOf(a)||a.constructor!==s.constructor||a.prototype!==s.prototype||n.indexOf(a)>-1||r.indexOf(s)>-1)return!1;for(o in s){if(s.hasOwnProperty(o)!==a.hasOwnProperty(o))return!1;if(typeof s[o]!=typeof a[o])return!1}for(o in a){if(s.hasOwnProperty(o)!==a.hasOwnProperty(o))return!1;if(typeof s[o]!=typeof a[o])return!1;switch(typeof a[o]){case"object":case"function":if(n.push(a),r.push(s),!i(a[o],s[o]))return!1;n.pop(),r.pop();break;default:if(a[o]!==s[o])return!1;break}}return!0}return n=[],r=[],i(u,t)}var Ai=class{constructor({componentName:t,ancestors:e,serializedComponent:n,definingChildren:r,serializedChildren:i,childLogic:a,stateVariableDefinitions:s,componentInfoObjects:o,coreFunctions:l,flags:c,shadow:d,numerics:p,parentSharedParameters:m,sharedParameters:f}){this.numerics=p,this.parentSharedParameters=m,this.sharedParameters=f,this.componentName=t,this.ancestors=e,this.componentInfoObjects=o,this.coreFunctions=l,this.flags=c,d===!0&&(this.isShadow=!0),this.definingChildren=r,this.definingChildren===void 0&&(this.definingChildren=[]),this.serializedChildren=i,this.childLogic=a,this.state={};for(let h in s)this.state[h]=Object.assign({},s[h]);this.stateValues=new Proxy(this.state,wn()),n.state&&(this.potentialEssentialState=new Proxy(n.state,K)),this.doenetAttributes={},n.doenetAttributes!==void 0&&Object.assign(this.doenetAttributes,n.doenetAttributes),n.variants!==void 0&&(this.variants=n.variants)}static componentType="_base";static get rendererType(){return this.componentType}get componentType(){return this.constructor.componentType.toLowerCase()}get rendererType(){return this.constructor.rendererType}get allPotentialRendererTypes(){if(!this.rendererType)return[];let t=[this.rendererType];for(let e in this.state){let n=this.state[e];if(n.public){let r=n.componentType;Array.isArray(r)||(r=[r]),n.wrappingComponents&&r.push(...ne(n.wrappingComponents).map(i=>typeof i=="object"?i.componentType:i));for(let i of r){let a=this.componentInfoObjects.allComponentClasses[i];if(a){let s=a.rendererType;s&&!t.includes(s)&&t.push(s)}}}}for(let e in this.allChildren){let n=this.allChildren[e].component;for(let r of n.allPotentialRendererTypes)t.includes(r)||t.push(r)}return t}readOnlyProxyHandler=K;potentialRendererTypesFromSerializedComponents(t){let e=[];for(let n of t){let i=this.componentInfoObjects.allComponentClasses[n.componentType].rendererType;if(i&&!e.includes(i)&&e.push(i),n.children){let a=this.potentialRendererTypesFromSerializedComponents(n.children);for(let s of a)e.includes(s)||e.push(s)}}return e}get childLogicSatisfied(){return this.childLogic.logicResult.success}static createPropertiesObject({flags:t={}}={}){return{hide:{default:!1},disabled:{default:!!t.readOnly,forRenderer:!0,propagateToDescendants:!0},modifyIndirectly:{default:!0,propagateToProps:!0},fixed:{default:!1},styleNumber:{default:1,propagateToDescendants:!0},isResponse:{default:!1}}}static returnSugarInstructions(){return[]}static returnChildLogic({standardComponentClasses:t,allComponentClasses:e,components:n,allPossibleProperties:r,flags:i}){return new Il({parentComponentType:this.componentType,properties:this.createPropertiesObject({standardComponentClasses:t,allPossibleProperties:r,flags:i}),allComponentClasses:e,standardComponentClasses:t,components:n})}static returnStateVariableDefinitions(){let t={};return t.childrenToRender={returnDependencies:()=>({}),definition:()=>({newValues:{childrenToRender:[]}})},t.hidden={public:!0,componentType:"boolean",forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide",variablesOptional:!0},parentHidden:{dependencyType:"parentStateVariable",variableName:"hidden"},parentOverrideChildHide:{dependencyType:"parentStateVariable",variableName:"overrideChildHide"},sourceCompositeHidden:{dependencyType:"sourceCompositeStateVariable",variableName:"hidden"}}),definition:({dependencyValues:e})=>({newValues:{hidden:e.parentHidden===!0||e.sourceCompositeHidden===!0||e.hide===!0&&!e.parentOverrideChildHide}})},t.isInactiveCompositeReplacement={defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{isInactiveCompositeReplacement:{variablesToCheck:["isInactiveCompositeReplacement"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:{variableName:"isInactiveCompositeReplacement",value:e.isInactiveCompositeReplacement}}]}}},t}static returnNormalizedStateVariableDefinitions({propertyNames:t,numerics:e}){let n=this.returnStateVariableDefinitions({propertyNames:t,numerics:e});if(!n)throw Error(`Error in state variable definitions of ${this.componentType}: returnStateVariableDefinitions did not return anything`);let r=function(s){for(let[o,l]of s.entries())typeof l=="object"&&(s[o]=l.variableName)},i=["returnDependencies","definition","inverseDefinition","stateVariablesDeterminingDependencies","isArray","nDimensions","returnArraySizeDependencies","returnArraySize","returnArrayDependenciesByKey","arrayDefinitionByKey","inverseArrayDefinitionByKey","basedOnArrayKeyStateVariables","entireArrayAtOnce","markStale","getPreviousDependencyValuesForMarkStale"],a={};for(let s in n){let o=n[s];if(a[s]=o,o.additionalStateVariablesDefined){for(let[l,c]of o.additionalStateVariablesDefined.entries()){let d={};for(let m of i)m in o&&(d[m]=o[m]);d.additionalStateVariablesDefined=[...o.additionalStateVariablesDefined],d.additionalStateVariablesDefined[l]=s,r(d.additionalStateVariablesDefined);let p=c;typeof c=="object"&&(p=c.variableName,c=Object.assign({},c),delete c.variableName,Object.assign(d,c)),a[p]=d}r(o.additionalStateVariablesDefined)}}return a}static returnStateVariableInfo({onlyPublic:t=!1,standardComponentClasses:e,allPossibleProperties:n}){let r=this.createPropertiesObject({standardComponentClasses:e,allPossibleProperties:n}),i={},a={},s={};for(let l in r){let c=r[l].componentType;if(i[l]={componentType:c||l,public:!0},r[l].entryPrefixes){let d=e[l].attributesForPropertyValue;if(d&&d.isArray){i[l].isArray=!0;for(let p of r[l].entryPrefixes)a[p]={arrayVariableName:l}}else console.warn(`entryPrefixes ignored for property ${l} of ${this.componentType}`)}}let o=this.returnNormalizedStateVariableDefinitions({propertyNames:Object.keys(i)});for(let l in o){let c=o[l];if(c.isAlias){s[l]=c.targetVariableName;continue}if((!t||c.public)&&(i[l]={componentType:c.componentType,public:c.public,containsComponentNamesToCopy:c.containsComponentNamesToCopy},c.isArray&&(i[l].isArray=!0,i[l].nDimensions=c.nDimensions===void 0?1:c.nDimensions,i[l].wrappingComponents=c.returnWrappingComponents?c.returnWrappingComponents():[],c.entryPrefixes)))for(let d of c.entryPrefixes)a[d]={arrayVariableName:l,nDimensions:c.returnEntryDimensions?c.returnEntryDimensions(d):1,wrappingComponents:c.returnWrappingComponents?c.returnWrappingComponents(d):[]}}return{stateVariableDescriptions:i,arrayEntryPrefixes:a,aliases:s}}get parentName(){if(!(this.ancestors===void 0||this.ancestors.length===0))return this.ancestors[0].componentName}getAllChildrenDownstreamComponentNames(t=!1){let e=Object.keys(this.allChildren),n=Object.keys(this.downstreamDependencies);return t!==!0&&(n=n.filter(r=>this.downstreamDependencies[r].inactive!==!0)),[...e,...n]}get allDescendants(){let t=[];for(let e in this.allChildren){let n=this.allChildren[e].component;t=[...t,e,...n.allDescendants]}return t}static useChildrenForReference=!0;static get stateVariablesShadowedForReference(){return[]}returnSerializeInstructions(){return{}}serialize(t={}){let e=!0,n=!0,r=[];if(t.forCopy)e=!1,n=!0;else{let s=this.returnSerializeInstructions();s.skipChildren&&(n=!1),s.stateVariables&&(r=s.stateVariables)}let i={componentType:this.componentType},a=[];if(e||n){for(let s of this.definingChildren)(e&&s.doenetAttributes.isPropertyChild||n&&!s.doenetAttributes.isPropertyChild)&&a.push(s.serialize(t));if(this.serializedChildren!==void 0)for(let s of this.serializedChildren)a.push(this.copySerializedComponent({serializedComponent:s,parameters:t}));a.length>0&&(i.children=a)}if(t.forCopy)i.originalName=this.componentName,i.originalDoenetAttributes=Z(this.doenetAttributes),i.doenetAttributes=Z(this.doenetAttributes),delete i.doenetAttributes.prescribedName,delete i.doenetAttributes.assignNames;else{console.warn("serializing a component without forCopy set is not yet converted!!!!");let s={};for(let l in this._state)if(this.state[l].essential||r.includes(l)){let c=this.state[l].value;this.state[l].usedDefault||(s[l]=c)}Object.keys(s).length>0&&(i.state=s);let o=Object.assign({},this.doenetAttributes);Object.keys(o).length>0&&(i.doenetAttributes=o)}return i}copySerializedComponent({serializedComponent:t,parameters:e}){let n=[];if(t.children!==void 0)for(let i of t.children)n.push(this.copySerializedComponent({serializedComponent:i,parameters:e}));let r={componentType:t.componentType,originalName:t.componentName,originalNameFromSerializedComponent:!0,children:n,state:{},doenetAttributes:{}};return t.doenetAttributes!==void 0&&(r.originalDoenetAttributes=Z(t.doenetAttributes),r.doenetAttributes=Z(t.doenetAttributes),delete r.doenetAttributes.prescribedName,delete r.doenetAttributes.assignNames),t.state!==void 0&&Object.assign(r.state,t.state),r}adapters=[];get nAdapters(){return this.adapters.length}getAdapter(t){if(t>=this.adapters.length)return;let e=this.adapters[t],n,r;typeof e=="string"?n=e:(n=e.stateVariable,r=e.componentType);let i=this.state[n];if(i===void 0||!i.public&&!r)throw Error("Invalid adapter "+n+" in "+this.componentType);r===void 0&&(r=i.componentType);let a={};return this.doenetAttributes.isPropertyChild&&(a.isPropertyChild=!0),{componentType:r,doenetAttributes:a,downstreamDependencies:{[this.componentName]:[{dependencyType:"adapter",adapterVariable:n,adapterTargetIdentity:{componentName:this.componentName,componentType:this.componentType}}]}}}},R=Ai;var Si=class extends R{static componentType="_inline"},B=Si;import Pi from"../_snowpack/pkg/math-expressions.js";import De from"../_snowpack/pkg/math-expressions.js";import ee from"../_snowpack/pkg/math-expressions.js";import Oe from"../_snowpack/pkg/math-expressions.js";function Ge({value:u,simplify:t,expand:e=!1,createVectors:n=!1,createIntervals:r=!1}){return n&&(u=u.tuples_to_vectors()),r&&(u=u.to_intervals()),e&&(u=u.expand()),t==="full"?u.simplify():t==="numbers"?u.evaluate_numbers():t==="numberspreserveorder"?u.evaluate_numbers({skip_ordering:!0}):u}function he(u){if(u!==void 0)return Number.isFinite(u)||u.evaluate_to_constant!==void 0&&(u=u.evaluate_to_constant(),Number.isFinite(u))?u:null}function re(u){return u==null?Oe.fromAst("\uFF3F"):u instanceof Oe.class?u:typeof u=="number"||typeof u=="string"?Oe.fromAst(u):Oe.fromAst("\uFF3F")}function Ll(u,t){if(!Number.isInteger(u)||u<1)return[];let e=t.length;if(e===0){if(u===1)return[Oe.fromAst("x")];if(u===2)return[Oe.fromAst("x"),Oe.fromAst("y")];if(u===3)return[Oe.fromAst("x"),Oe.fromAst("y"),Oe.fromAst("z")];{let i=[];for(let a=1;a<=u;a++)i.push(Oe.fromText(`x_${a}`));return i}}if(new Set(t.map(i=>i.toString())).size<e&&console.warn("Duplicate variables specified"),u<=e)return t.slice(0,u);let n=[...t.map(i=>i.toString())],r=[...t];for(let i=e+1;i<=u;i++){let a;i==1?u>3?a=["x_1"]:a=["x"]:i==2?u>3?a=["x_2","y_2"]:a=["y","x_2"]:i==3?u>3?a=["x_3","y_3","z_3"]:a=["z","x_3","z_3"]:a=["x","y","z","u","v","w","X","Y","Z"].map(o=>`${o}_${i}`);let s=!1;for(let o of a)if(!n.includes(o)){r.push(Oe.fromText(o)),n.push(o),s=!0;break}if(!s){let o=a[0];r.push(Oe.fromText(o)),n.push(o),console.warn("Variables added were not unique")}}return r}function Rl({desiredVector:u,currentVector:t,workspace:e,workspaceKey:n}){if(u.tree[0]==="vector"&&t.tree[0]==="vector"){let r;e[n]?r=e[n].slice(0):r=t.tree.slice(0);for(let[i,a]of u.tree.entries())a!==void 0&&(r[i]=a);u=Oe.fromAst(r),e[n]=r}return u}var Fl=["abs","exp","log","ln","log10","sign","sqrt","erf","acos","acosh","acot","acoth","acsc","acsch","asec","asech","asin","asinh","atan","atanh","cos","cosh","cot","coth","csc","csch","sec","sech","sin","sinh","tan","tanh","arcsin","arccos","arctan","arccsc","arcsec","arccot","cosec","arg","min","max","mean","median","floor","ceil","round","sum","prod","var","std","count","mod"],nv=new ee.converters.textToAstObj({appliedFunctionSymbols:Fl}),rv=new ee.converters.latexToAstObj({appliedFunctionSymbols:Fl}),Ii=class extends B{static componentType="math";static primaryStateVariableForDefinition="unnormalizedValue";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["unnormalizedValue"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.format={default:"text",validValues:["text","latex"]},e.simplify={default:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.expand={default:!1},e.displayDigits={default:10},e.displayDecimals={default:null},e.displaySmallAsZero={default:!1},e.renderMode={default:"inline",forRenderer:!0},e.unordered={default:!1},e.createVectors={default:!1},e.createIntervals={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0});return e.newOperator({name:"stringsAndMaths",operator:"and",propositions:[n,r],requireConsecutive:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.valueShadow={defaultValue:ee.fromAst("\uFF3F"),returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{valueShadow:{variablesToCheck:["value","valueShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"valueShadow",value:e.valueShadow}]}}},t.codePre={returnDependencies:()=>({stringChildren:{dependencyType:"child",childLogicName:"atLeastZeroStrings",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),definition:iv},t.expressionWithCodes={returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childLogicName:"stringsAndMaths",variableNames:["value"],requireChildLogicInitiallySatisfied:!0},format:{dependencyType:"stateVariable",variableName:"format"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},createVectors:{dependencyType:"stateVariable",variableName:"createVectors"},createIntervals:{dependencyType:"stateVariable",variableName:"createIntervals"}}),definition:av},t.unnormalizedValue={returnDependencies:()=>({mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["value","canBeModified"],requireChildLogicInitiallySatisfied:!0},stringChildren:{dependencyType:"child",childLogicName:"atLeastZeroStrings",variableNames:["value"],requireChildLogicInitiallySatisfied:!0},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},valueShadow:{dependencyType:"stateVariable",variableName:"valueShadow"}}),set:re,defaultValue:ee.fromAst("\uFF3F"),definition:sv,inverseDefinition:uv},t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({unnormalizedValue:{dependencyType:"stateVariable",variableName:"unnormalizedValue"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},createVectors:{dependencyType:"stateVariable",variableName:"createVectors"},createIntervals:{dependencyType:"stateVariable",variableName:"createIntervals"}}),definition:function({dependencyValues:e}){let n=e.unnormalizedValue,{simplify:r,expand:i,createVectors:a,createIntervals:s}=e;return n=Ge({value:n,simplify:r,expand:i,createVectors:a,createIntervals:s}),{newValues:{value:n}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"unnormalizedValue",desiredValue:e.value}]}}},t.number={public:!0,componentType:"number",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){let n=e.value.evaluate_to_constant();return n===null&&(n=NaN),{newValues:{number:n}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"value",desiredValue:ee.fromAst(e.number)}]}}},t.isNumber={public:!0,componentType:"boolean",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{isNumber:Number.isFinite(e.value.tree)}}}},t.isNumeric={public:!0,componentType:"boolean",returnDependencies:()=>({number:{dependencyType:"stateVariable",variableName:"number"}}),definition:function({dependencyValues:e}){return{newValues:{isNumeric:Number.isFinite(e.number)}}}},t.valueForDisplay={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displayDecimals:{dependencyType:"stateVariable",variableName:"displayDecimals"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"}}),definition:function({dependencyValues:e,usedDefault:n}){let r;return n.displayDigits&&!n.displayDecimals?r=e.value.round_numbers_to_decimals(e.displayDecimals):(r=e.value.round_numbers_to_precision(e.displayDigits),e.displaySmallAsZero&&(r=r.evaluate_numbers({skip_ordering:!0,set_small_zero:!0}))),{newValues:{valueForDisplay:Ge({value:r,simplify:e.simplify,expand:e.expand})}}}},t.latex={public:!0,componentType:"text",returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{newValues:{latex:e.valueForDisplay.toLatex()}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){return{newValues:{latexWithInputChildren:[e.latex]}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.valueForDisplay.toString()}}}},t.codesAdjacentToStrings={returnDependencies:()=>({stringMathChildren:{dependencyType:"child",childLogicName:"stringsAndMaths"},codePre:{dependencyType:"stateVariable",variableName:"codePre"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:ov},t.canBeModified={additionalStateVariablesDefined:["constantChildIndices","codeForExpression","inverseMaps","template","mathChildrenMapped"],returnDependencies:()=>({mathChildrenModifiable:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["canBeModified"],requireChildLogicInitiallySatisfied:!0},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition:lv},t.mathChildrenByArrayComponent={returnDependencies:()=>({codePre:{dependencyType:"stateVariable",variableName:"codePre"},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths"},expressionWithCodes:{dependencyType:"stateVariable",variableName:"expressionWithCodes"}}),definition:function({dependencyValues:e}){if(e.expressionWithCodes===null)return{newValues:{mathChildrenByArrayComponent:null}};let n=e.expressionWithCodes.tree,r=e.mathChildren.length;if(r===0||!Array.isArray(n)||!["tuple","vector"].includes(n[0]))return{newValues:{mathChildrenByArrayComponent:null}};let i={},a=0,s=e.codePre+a;for(let o=1;o<n.length;o++){let l=n[o],c=i[o]=[];if(Array.isArray(l)){let d=ne(l);for(;s in d;)c.push(a),a++,s=e.codePre+a}else l===s&&(c.push(a),a++,s=e.codePre+a);if(a>=r)break}return{newValues:{mathChildrenByArrayComponent:i}}}},t}returnSerializeInstructions(){let t=this.childLogic.returnMatches("atLeastZeroStrings").length===1&&this.childLogic.returnMatches("atLeastZeroMaths").length===0;return t?{skipChildren:t,stateVariables:["unnormalizedValue"]}:{}}adapters=["number","text"]},H=Ii;function iv({dependencyValues:u}){let t="math",e=!1;do{e=!1;for(let n of u.stringChildren)if(n.componentType==="string"&&n.stateValues.value.includes(t)===!0){e=!0,t+="m";break}}while(e);return{newValues:{codePre:t}}}function av({dependencyValues:u,changes:t}){if(!("stringMathChildren"in t&&t.stringMathChildren.componentIdentitiesChanged||"format"in t||"createIntervals"in t||"createVectors"in t))return{noChanges:["expressionWithCodes"]};if(u.stringMathChildren.length===0)return{newValues:{expressionWithCodes:null}};let e="",n=0,r,i="",a=0;for(let o of u.stringMathChildren){if(a>0&&o.compositeInd!==r){if(a>1){let l=e.trimEnd(),c=!1;if(l.length===0)c=!0;else{let d=l[l.length-1];if(!["{","[","(","|",","].includes(d))c=!0;else if(o.componentType!=="string")c=!0;else{let p=o.stateValues.value.trimStart();if(p.length===0)c=!0;else{let m=p[0];u.format==="latex"&&m==="\\"&&p.length>1&&(m=p[1]),["}","]",")","|",","].includes(m)||(c=!0)}}}c&&(i="("+i+")")}e+=i,i="",a=0}if(o.componentType==="string")e+=" "+o.stateValues.value+" ",i="",a=0;else{let l=u.codePre+n;n++;let c;u.format==="latex"?c="\\var{"+l+"}":c=" "+l+" ",o.compositeInd!==void 0?(o.compositeInd===r&&(i+=","),i+=c,a++):(e+=c,i="",a=0)}r=o.compositeInd}a>0&&(a>1&&(i="("+i+")"),e+=i);let s=null;if(e==="")s=ee.fromAst("\uFF3F");else{if(u.format==="text")try{s=ee.fromAst(nv.convert(e))}catch(o){s=ee.fromAst("\uFF3F"),console.log("Invalid value for a math of text format: "+e)}else if(u.format==="latex")try{s=ee.fromAst(rv.convert(e))}catch(o){s=ee.fromAst("\uFF3F"),console.log("Invalid value for a math of latex format: "+e)}u.createVectors&&(s=s.tuples_to_vectors()),u.createIntervals&&(s=s.to_intervals())}return{newValues:{expressionWithCodes:s},makeEssential:["expressionWithCodes"]}}function sv({dependencyValues:u}={}){if(u.expressionWithCodes===null)return{newValues:{unnormalizedValue:u.valueShadow},makeEssential:["unnormalizedValue"]};let t={};for(let[n,r]of u.mathChildren.entries())t[u.codePre+n]=r.stateValues.value;let e=u.expressionWithCodes;return u.mathChildren.length>0&&(e=e.substitute(t)),{newValues:{unnormalizedValue:e},makeEssential:["unnormalizedValue"]}}function ov({dependencyValues:u}){let t=[],e;for(let[n,r]of u.stringMathChildren.entries())if(r.componentType==="string"){let i=u.stringMathChildren[n+1];if(i!==void 0&&i.componentType==="string")continue;let a={};if(e!==void 0&&(u.format==="latex"?a.prevCode="\\var{"+u.codePre+e+"}":a.prevCode=u.codePre+e),i!==void 0){let s=0;e!==void 0&&(s=e+1),u.format==="latex"?a.nextCode="\\var{"+u.codePre+s+"}":a.nextCode=u.codePre+s}t.push(a)}else e===void 0?e=0:e++;return{newValues:{codesAdjacentToStrings:t}}}function lv({dependencyValues:u}){if(!u.modifyIndirectly||u.fixed)return{newValues:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};if(u.mathChildrenModifiable.length===0)return{newValues:{canBeModified:!0,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}};let t=[],e=[],n=[],r={};for(let[o,l]of u.mathChildrenModifiable.entries()){let c=u.codePre+o;l.stateValues.canBeModified===!0?(t.push(o),e.push(c)):(n.push(c),r[c]=o)}let i=u.codePre+"expr",a=ee.utils.unflattenLeft(u.expressionWithCodes.tree),s=kl(a,e,i,n);if(s.foundLinear){let o={},l=s.template,c=new Set;for(let d in s.mappings){o[d]=s.mappings[d];let p=o[d].mathChildSub;if(p){let m=t[e.indexOf(p)];o[d].mathChildInd=m,c.add(Number(m))}}return c.has=c.has.bind(c),{newValues:{canBeModified:!0,constantChildIndices:r,codeForExpression:i,inverseMaps:o,template:l,mathChildrenMapped:c}}}return{newValues:{canBeModified:!1,constantChildIndices:null,codeForExpression:null,inverseMaps:null,template:null,mathChildrenMapped:null}}}function kl(u,t,e,n=[],r=[]){let i=ee.variables(u);if(i.every(o=>!t.includes(o))&&i.every(o=>!n.includes(o))){let o={},l="x"+r.join("_");return o[l]={result:ee.fromAst(e).simplify(),components:r},{foundLinear:!0,mappings:o,template:l}}if(!Array.isArray(u))return vt(u,t,e,r);let a=u[0],s=u.slice(1);if(a==="tuple"||a==="vector"||a==="list"){let o={mappings:{},template:[a]},l=0;for(let c=0;c<s.length;c++){let d=[...r,c],p=kl(s[c],t,e,n,d);p.foundLinear?(l++,o.mappings=Object.assign(o.mappings,p.mappings),o.template.push(p.template)):o.template.push("x"+d.join("_"))}return l===0?{foundLinear:!1}:(o.foundLinear=!0,o)}else return vt(u,t,e,r)}function vt(u,t,e,n=[]){if(typeof u=="string"&&t.includes(u)){let a={},s="x"+n.join("_");return a[s]={result:ee.fromAst(e).simplify(),components:n,mathChildSub:u},{foundLinear:!0,mappings:a,template:s}}if(!Array.isArray(u))return{foundLinear:!1};let r=u[0],i=u.slice(1);return r==="-"?(e=["-",e],vt(i[0],t,e,n)):r==="+"?ee.variables(i[0]).every(a=>!t.includes(a))?(e=["+",e,["-",i[0]]],vt(i[1],t,e,n)):ee.variables(i[1]).every(a=>!t.includes(a))?(e=["+",e,["-",i[1]]],vt(i[0],t,e,n)):{foundLinear:!1}:r==="*"?ee.variables(i[0]).every(a=>!t.includes(a))?(e=["/",e,i[0]],vt(i[1],t,e,n)):ee.variables(i[1]).every(a=>!t.includes(a))?(e=["/",e,i[1]],vt(i[0],t,e,n)):{foundLinear:!1}:r==="/"?ee.variables(i[1]).every(a=>!t.includes(a))?(e=["*",e,i[1]],vt(i[0],t,e,n)):{foundLinear:!1}:{foundLinear:!1}}function uv({desiredStateVariableValues:u,dependencyValues:t,stateValues:e,workspace:n,overrideFixed:r}){if(!e.canBeModified&&!r)return{success:!1};let i=re(u.unnormalizedValue),a=e.value,s;if((i.tree[0]==="tuple"||i.tree[0]==="vector")&&a&&a.tree[0]===i.tree[0]){let m;n.desiredExpressionAst?m=n.desiredExpressionAst.slice(0):m=a.tree.slice(0);let f=[],h=!1;for(let[y,b]of i.tree.entries())b===void 0?(h=!0,f.push(y)):m[y]=b;i=ee.fromAst(m),n.desiredExpressionAst=m,h&&(s=f)}let o=t.mathChildren,l=t.stringChildren;if(o.length===0){let m=[];for(let h=0;h<l.length;h++)m.push({deferSettingDependency:"stringChildren",inverseDefinition:Ml,childIndex:h,variableIndex:0,dependencyValues:{mathChildren:t.mathChildren,stringChildren:t.stringChildren}});let f=i.simplify();return m.push({setStateVariable:"unnormalizedValue",value:f}),l.length===0&&m.push({setDependency:"valueShadow",desiredValue:f}),{success:!0,instructions:m}}let c=cv({expression:i,stateValues:e});if(!c)return{success:!1};let d=[],p=[];if(s&&e.mathChildrenByArrayComponent)for(let m of s)e.mathChildrenByArrayComponent[m]&&p.push(...e.mathChildrenByArrayComponent[m]);for(let[m,f]of o.entries())if(e.mathChildrenMapped.has(m)&&f.stateValues.canBeModified){if(!p.includes(m)){let h=c[m],y={},b=!1;for(let g in e.constantChildIndices){let T=e.constantChildIndices[g];y[g]=o[T].stateValues.value,b=!0}b&&(h=h.substitute(y)),h=h.simplify(),d.push({setDependency:"mathChildren",desiredValue:h,childIndex:m,variableIndex:0})}delete c[m]}if(l.length>0){let m=e.expressionWithCodes;for(let f in c){let h=e.inverseMaps[f];if(h.mathChildInd!==void 0)continue;let y=h.components;m=m.substitute_component(y,c[f])}d.push({setStateVariable:"expressionWithCodes",value:m});for(let f=0;f<l.length;f++)d.push({deferSettingDependency:"stringChildren",inverseDefinition:Ml,childIndex:f,variableIndex:0,dependencyValues:{mathChildren:t.mathChildren,stringChildren:t.stringChildren}})}return{success:!0,instructions:d}}function Ml({dependencyValues:u,stateValues:t}){console.log("finishInvertMathForStringChildren");let e=u.mathChildren,n=u.stringChildren;if(e.length===0){let i;t.format==="latex"?i=t.value.toLatex():i=t.value.toString();let a=[{setDependency:"stringChildren",desiredValue:i,childIndex:0,variableIndex:0}];for(let s=1;s<n.length;s++)a.push({setDependency:"stringChildren",desiredValue:"",childIndex:s,variableIndex:0});return{success:!0,instructions:a}}let r=[];if(n.length>0){let i;t.format==="latex"?i=t.expressionWithCodes.toLatex():i=t.expressionWithCodes.toString();for(let[a,s]of t.codesAdjacentToStrings.entries()){let o=i;Object.keys(s).length===0?r.push({setDependency:"stringChildren",desiredValue:"",childIndex:a,variableIndex:0}):(s.prevCode&&(o=o.split(s.prevCode)[1]),s.nextCode&&(o=o.split(s.nextCode)[0]),r.push({setDependency:"stringChildren",desiredValue:o,childIndex:a,variableIndex:0}))}}return{success:!0,instructions:r}}function cv({expression:u,stateValues:t}){let e=ee.utils.match(u.tree,t.template);if(!e&&(e=ee.utils.match(u.tuples_to_vectors().tree,ee.fromAst(t.template).tuples_to_vectors().tree),!e&&(e=ee.utils.match(u.to_intervals().tree,ee.fromAst(t.template).to_intervals().tree),!e&&(e=ee.utils.match(u.tuples_to_vectors().to_intervals().tree,ee.fromAst(t.template).tuples_to_vectors().to_intervals().tree),!e))))return!1;let n={};for(let r in e){let i={};i[t.codeForExpression]=e[r];let a=t.inverseMaps[r];if(a!==void 0){let s=r;a.mathChildInd!==void 0&&(s=a.mathChildInd),n[s]=a.result.substitute(i),n[s]=Ge({value:n[s],simplify:t.simplify,expand:t.expand,createvectors:t.createvectors,createintervals:t.createintervals})}}return n}function Re({object1:u,object2:t,isUnordered:e=!1,partialMatches:n=!1,matchExactLocations:r=!1,symbolicEquality:i=!1,simplify:a="none",expand:s=!1,allowedErrorInNumbers:o=0,includeErrorInNumberExponents:l=!1,allowedErrorIsAbsolute:c=!1,nSignErrorsMatched:d=0}){let p=!1;if(u instanceof De.class){if(p=!0,!(t instanceof De.class))if(typeof t=="number"||typeof t=="string")t=De.fromAst(t);else return{fraction_equal:0}}else if(t instanceof De.class)if(p=!0,typeof u=="number"||typeof u=="string")u=De.fromAst(u);else return{fraction_equal:0};let m=function(N){return N instanceof De.class||(N=De.fromAst(N)),N=N.normalize_function_names().normalize_applied_functions(),a==="none"?o>0&&(N=N.constants_to_floats()):a==="numberspreserveorder"?N=N.evaluate_numbers({max_digits:Infinity,skip_ordering:!0}):a==="number"?N=N.evaluate_numbers({max_digits:Infinity}):N=N.evaluate_numbers({max_digits:Infinity,evaluate_functions:!0}),Ge({value:N,simplify:a,expand:s})},f;if(p?i?f=function(N,v){let C=m(N),x=m(v);if(d>0){x=JSON.parse(JSON.stringify(x),De.reviver);let V=function(D,I){return D=m(D),D.equalsViaSyntax(I,{allowed_error_in_numbers:o,include_error_in_number_exponents:l,allowed_error_is_absolute:c})};return{fraction_equal:De.equalSpecifiedSignErrors(x,C,{equalityFunction:V,n_sign_errors:d})?1:0}}else return{fraction_equal:C.equalsViaSyntax(x,{allowed_error_in_numbers:o,include_error_in_number_exponents:l,allowed_error_is_absolute:c})?1:0}}:f=function(N,v){let C=N,x=v;N instanceof De.class||(C=De.fromAst(N)),v instanceof De.class||(x=De.fromAst(v));let V=Array.isArray(N)&&N[0]==="discrete_infinite_set",w=Array.isArray(v)&&v[0]==="discrete_infinite_set";if(V||w){let D=C,I=x;V||(D=x,I=C);let A=D.equalsDiscreteInfinite(I,{match_partial:n});return A===!0?{fraction_equal:1}:A===!1?{fraction_equal:0}:{fraction_equal:A}}if(d>0){x=JSON.parse(JSON.stringify(x),De.reviver);let D=function(A,S){return A.equals(S,{allowed_error_in_numbers:o,include_error_in_number_exponents:l,allowed_error_is_absolute:c})};return{fraction_equal:De.equalSpecifiedSignErrors(x,C,{equalityFunction:D,n_sign_errors:d})?1:0}}else return{fraction_equal:C.equals(x,{allowed_error_in_numbers:o,include_error_in_number_exponents:l,allowed_error_is_absolute:c})?1:0}}:f=(N,v)=>({fraction_equal:Wt(N,v)?1:0}),p){let N=u.tree[0],v=t.tree[0];if(N==="vector"){if(u=u.tree.slice(1),v==="list"||v==="interval"||v==="matrix"||v==="array"||v==="set")return{fraction_equal:0};v==="tuple"||v==="vector"?t=t.tree.slice(1):t=[t.tree]}else if(v==="vector"){if(t=t.tree.slice(1),N==="list"||N==="interval"||N==="matrix"||N==="array"||N==="set")return{fraction_equal:0};N==="tuple"?u=u.tree.slice(1):u=[u.tree]}else if(N==="interval"){r=!0;let C=u.tree[2],x=C[1],V=C[2];if(u=u.tree[1].slice(1),v==="list"||v==="matrix"||v==="set")return{fraction_equal:0};if(v==="tuple"){let w=t.tree.slice(1);if(w.length===2&&x===!1&&V===!1)t=w;else return{fraction_equal:0}}else if(v==="array"){let w=t.tree.slice(1);if(w.length===2&&x===!0&&V===!0)t=w;else return{fraction_equal:0}}else if(v==="interval"){let w=t.tree[2];if(w[1]!==x||w[2]!==V)return{fraction_equal:0};t=t.tree[1].slice(1)}else return{fraction_equal:0}}else if(v==="interval"){r=!0;let C=t.tree[2],x=C[1],V=C[2];if(t=t.tree[1].slice(1),N==="list"||N==="matrix"||N==="set")return{fraction_equal:0};if(N==="tuple"){let w=u.tree.slice(1);if(w.length===2&&x===!1&&V===!1)u=w;else return{fraction_equal:0}}else if(N==="array"){let w=u.tree.slice(1);if(w.length===2&&x===!0&&V===!0)u=w;else return{fraction_equal:0}}else return{fraction_equal:0}}else if(N==="matrix")if(v==="matrix")u=u.tree.slice(1),t=t.tree.slice(1);else return{fraction_equal:0};else{if(v==="matrix")return{fraction_equal:0};if(N==="set"){let C=[];for(let x of u.tree.slice(1))C.some(V=>f(V,x).fraction_equal===1)||C.push(x);if(u=C,e=!0,v==="tuple"||v==="array"||v==="list")return{fraction_equal:0};if(v==="set"){C=[];for(let x of t.tree.slice(1))C.some(V=>f(V,x).fraction_equal===1)||C.push(x);t=C}else t=[t.tree]}else if(v==="set"){let C=[];for(let x of t.tree.slice(1))C.some(V=>f(V,x).fraction_equal===1)||C.push(x);if(t=C,e=!0,N==="tuple"||N==="array"||N==="list")return{fraction_equal:0};u=[u.tree]}else if(N==="list"){if(u=u.tree.slice(1),v==="tuple"||v==="array")return{fraction_equal:0};v==="list"?t=t.tree.slice(1):t=[t.tree]}else if(v==="list"){if(t=t.tree.slice(1),N==="tuple"||N==="array")return{fraction_equal:0};u=[u.tree]}else if(N==="tuple"){if(u=u.tree.slice(1),v==="array")return{fraction_equal:0};v==="tuple"?t=t.tree.slice(1):t=[t.tree]}else if(v==="tuple"){if(t=t.tree.slice(1),N==="array")return{fraction_equal:0};u=[u.tree]}else if(N==="array")u=u.tree.slice(1),v==="array"?t=t.tree.slice(1):t=[t.tree];else if(v==="array")t=t.tree.slice(1),u=[u.tree];else return f(u.tree,t.tree)}}else if(Array.isArray(u))Array.isArray(t)||(t=[t]);else if(Array.isArray(t))u=[u];else return f(u,t);let h=u.length,y=t.length,b={fraction_equal:0};if(r&&(e=!1),!e){let N=0,v=Math.min(h,y);for(let V=0;V<v;V++)N+=f(u[V],t[V]).fraction_equal;if(h===y&&h===N)return b.fraction_equal=1,b;if(!n)return b;if(r)return b.fraction_equal=N/Math.max(h,y),b;let C=Array.from(Array(h+1),V=>Array(y+1).fill(0));for(let V=0;V<h;V++)for(let w=0;w<y;w++){let D=f(u[V],t[w]);C[V+1][w+1]=Math.max(C[V][w]+D.fraction_equal,C[V+1][w],C[V][w+1])}let x=C[h][y];return b.fraction_equal=x/Math.max(h,y),b}let g=new Set,T=0;for(let N of u){let v=-1,C=0;for(let[x,V]of t.entries()){if(g.has(x))continue;let w=f(N,V);w.fraction_equal>C&&(C=w.fraction_equal,v=x)}v!==-1&&(T+=C,g.add(v))}return h===y&&h===T&&(b.fraction_equal=1),n&&(b.fraction_equal=T/Math.max(h,y)),b}import Dn from"../_snowpack/pkg/math-expressions.js";function Rt({logicTree:u,unorderedCompare:t=!1,simplifyOnCompare:e=!1,expandOnCompare:n=!1,dependencyValues:r}){let i=m=>Rt({logicTree:m,unorderedCompare:t,simplifyOnCompare:e,expandOnCompare:n,dependencyValues:r});if(!Array.isArray(u)){if(typeof u=="string"){let m=r.booleanChildrenByCode[u];if(m)return m.stateValues.value?1:0;{let f=r.mathChildrenByCode[u];if(f){let h=f.stateValues.value.simplify().evaluate_to_constant();return Number.isFinite(h)&&h!==0?1:0}else{if(u.toLowerCase()==="true")return 1;if(u.toLowerCase()==="false")return 0}}}else if(typeof u=="number")return u===0?0:1;return console.warn("Invalid format for boolean condition"),0}let a=u[0],s=u.slice(1);if(a==="not")return s.length!==1?(console.warn("Invalid format for boolean condition"),0):i(s[0])===0?1:0;if(a==="and")return r.matchPartial?s.reduce((m,f)=>m+i(f),0)/s.length:s.every(m=>i(m)===1)?1:0;if(a==="or")return r.matchPartial?s.reduce((m,f)=>Math.max(i(f),m),0):s.some(m=>i(m)===1)?1:0;let o=!1,l=!1,c=!1;s.forEach(function(m){typeof m=="string"&&(m in r.mathChildrenByCode||m in r.mathlistChildrenByCode?o=!0:m in r.textChildrenByCode||m in r.textlistChildrenByCode?l=!0:(m in r.booleanChildrenByCode||m in r.booleanlistChildrenByCode)&&(c=!0))}.bind(this));let d=function(m){if(typeof m=="string"){let f=r.mathChildrenByCode[m];return f!==void 0?f.stateValues.value.tree:(f=r.mathlistChildrenByCode[m],f!==void 0?["list",...f.stateValues.maths.map(h=>h.tree)]:m)}return Array.isArray(m)?[m[0],...m.slice(1).map(d)]:m}.bind(this);if(!["=","ne","<",">","le","ge","lts","gts","in","notin"].includes(a)){if(l||c)return console.warn("Invalid format for boolean condition"),0;let f=Dn.fromAst(d(u)).simplify().evaluate_to_constant();return Number.isFinite(f)&&f!==0?1:0}if(c){if(o||l)return console.warn("Invalid format for boolean condition"),0;let m=!1;if(s=s.map(function(f){if(typeof f=="string"){let h=r.booleanChildrenByCode[f];return h!==void 0?h.stateValues.value:(h=r.booleanlistChildrenByCode[f],h!==void 0?h.stateValues.booleans:(f=f.toLowerCase().trim(),f==="true"||f==="t"?!0:f==="false"||f==="f"?!1:(console.warn("Invalid format for boolean condition"),m=!0,0)))}return console.warn("Invalid format for boolean condition"),m=!0,0}.bind(this)),m)return 0;if(a==="="){let f=s[0];if(r.matchPartial){let h=s.slice(1).map(b=>Re({object1:f,object2:b,isUnordered:t,partialMatches:r.matchPartial}));return h.reduce((b,g)=>b+g.fraction_equal,0)/h.length}else return s.slice(1).every(h=>Re({object1:f,object2:h,isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===1)?1:0}else return a==="ne"?s.length!==2?(console.warn("Invalid format for boolean condition"),0):Re({object1:s[0],object2:s[1],isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===0?1:0:(console.warn("Invalid format for boolean condition"),0)}else if(l){if(o)return console.warn("Invalid format for boolean condition"),0;let m=!1,f=function(h,y=!1){if(typeof h=="string"){let b=r.textChildrenByCode[h];return b!==void 0?b.stateValues.value.trim():(b=r.textlistChildrenByCode[h],b!==void 0?b.stateValues.texts.map(g=>g.trim()):h.trim())}return y&&Array.isArray(h)&&h[0]==="*"?h.slice(1).map(f).join(" "):(console.warn("Invalid format for boolean condition"),m=!0,"")}.bind(this);if(s=s.map(h=>f(h,!0)),m)return 0;if(a==="="){let h=s[0];if(r.matchPartial){let y=s.slice(1).map(g=>Re({object1:h,object2:g,isUnordered:t,partialMatches:r.matchPartial}));return y.reduce((g,T)=>g+T.fraction_equal,0)/y.length}else return s.slice(1).every(y=>Re({object1:h,object2:y,isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===1)?1:0}else return a==="ne"?s.length!==2?(console.warn("Invalid format for boolean condition"),0):Re({object1:s[0],object2:s[1],isUnordered:t,partialMatches:r.matchPartial}).fraction_equal===0?1:0:(console.warn("Invalid format for boolean condition"),0)}let p;if((a==="lts"||a==="gts")&&(p=s[1].slice(1),s=s[0].slice(1)),s=s.map(function(m){return Dn.fromAst(d(m))}),a==="="){let m=s[0];if(r.matchPartial){let f=s.slice(1).map(y=>Re({object1:m,object2:y,isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}));return f.reduce((y,b)=>y+b.fraction_equal,0)/f.length}else return s.slice(1).every(f=>Re({object1:m,object2:f,isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}).fraction_equal===1)?1:0}if(a==="ne")return Re({object1:s[0],object2:s[1],isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}).fraction_equal===0?1:0;if(a==="in"||a==="notin"){let m=s[0],h=s[1].tree;if(!(Array.isArray(h)&&h[0]==="set"))return console.warn("Invalid format for boolean condition"),0;if(r.matchPartial){let b=h.slice(1).map(g=>Re({object1:m,object2:Dn.fromAst(g),isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched})).reduce((g,T)=>Math.max(g,T.fraction_equal),0);return a==="in"?b:1-b}else{let y=h.slice(1).some(b=>Re({object1:m,object2:Dn.fromAst(b),isUnordered:t,partialMatches:r.matchPartial,symbolicEquality:r.symbolicEquality,simplify:e,expand:n,allowedErrorInNumbers:r.allowedErrorInNumbers,includeErrorInNumberExponents:r.includeErrorInNumberExponents,allowedErrorIsAbsolute:r.allowedErrorIsAbsolute,nSignErrorsMatched:r.nSignErrorsMatched}).fraction_equal===1);return a==="in"?y?1:0:y?0:1}}if(s=s.map(m=>m.simplify().evaluate_to_constant()),s.some(m=>m===null||Number.isNaN(m)))return 0;if(a==="<")return s[0]<s[1]?1:0;if(a===">")return s[0]>s[1]?1:0;if(a==="le")return s[0]<=s[1]?1:0;if(a==="ge")return s[0]>=s[1]?1:0;for(let m=0;m<p.length;m++)if(a==="lts"){if(p[m]===!0){if(!(s[m]<s[m+1]))return 0}else if(!(s[m]<=s[m+1]))return 0}else if(p[m]===!0){if(!(s[m]>s[m+1]))return 0}else if(!(s[m]>=s[m+1]))return 0;return 1}function lr({logicTree:u,nonMathCodes:t,foundNonMath:e=!1,init:n=!0}){if(!Array.isArray(u))return typeof u=="string"&&!e&&!n?Dn.fromText(u).tree:u;let r=u[0],i=u.slice(1);return["and","not","or"].includes(r)?[r,...i.map(a=>lr({logicTree:a,nonMathCodes:t,foundNonMath:e,init:n}))]:(i.some(a=>t.includes(a))&&(e=!0),[r,...i.map(a=>lr({logicTree:a,nonMathCodes:t,foundNonMath:e,init:!1}))])}var dv=new Pi.converters.textToAstObj({splitSymbols:!1}),Oi=class extends B{static componentType="boolean";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroMathLists",componentType:"mathlist",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),s=e.newLeaf({name:"atLeastZeroTextlists",componentType:"textlist",comparison:"atLeast",number:0}),o=e.newLeaf({name:"atLeastZeroBooleans",componentType:"boolean",comparison:"atLeast",number:0}),l=e.newLeaf({name:"atLeastZeroBooleanlists",componentType:"booleanlist",comparison:"atLeast",number:0});return e.newOperator({name:"stringsMathsTextsAndBooleans",operator:"and",propositions:[n,r,i,a,s,o,l],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.parsedExpression={additionalStateVariablesDefined:["codePre"],returnDependencies:()=>({stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans"},stringChildren:{dependencyType:"child",childLogicName:"atLeastZeroStrings",variableNames:["value"]}}),definition:pv},t.mathChildrenByCode={additionalStateVariablesDefined:["mathlistChildrenByCode","textChildrenByCode","textlistChildrenByCode","booleanChildrenByCode","booleanlistChildrenByCode"],returnDependencies:()=>({stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans",variableNames:["value","texts","maths","booleans"],variablesOptional:!0},codePre:{dependencyType:"stateVariable",variableName:"codePre"}}),definition({dependencyValues:e,componentInfoObjects:n}){let r={},i={},a={},s={},o={},l={},c=0,d=e.codePre;for(let p of e.stringMathTextBooleanChildren)if(p.componentType!=="string"){let m=d+c;n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"math"})?r[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"mathlist"})?i[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"text"})?a[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"textlist"})?s[m]=p:n.isInheritedComponentType({inheritedComponentType:p.componentType,baseComponentType:"boolean"})?o[m]=p:l[m]=p,c+=1}return{newValues:{mathChildrenByCode:r,mathlistChildrenByCode:i,textChildrenByCode:a,textlistChildrenByCode:s,booleanChildrenByCode:o,booleanlistChildrenByCode:l}}}},t.value={public:!0,componentType:this.componentType,forRenderer:!0,defaultValue:!1,set:Boolean,returnDependencies:()=>({parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans",variableNames:["value","texts","maths","unordered"],variablesOptional:!0},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["value","expand","simplify"]},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanlistChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanlistChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textlistChildrenByCode:{dependencyType:"stateVariable",variableName:"textlistChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathlistChildrenByCode:{dependencyType:"stateVariable",variableName:"mathlistChildrenByCode"}}),definition({dependencyValues:e}){if(e.stringMathTextBooleanChildren.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:["value","implicitValue"]}}};if(e.parsedExpression===null)return{newValues:{value:!1}};let n=!1;for(let i of e.stringMathTextBooleanChildren)i.stateValues.unordered&&(n=!0);return{newValues:{value:Rt({logicTree:e.parsedExpression.tree,unorderedCompare:n,dependencyValues:e})===1}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n,componentInfoObjects:r}){if(n.stringMathTextBooleanChildren.length===0)return{success:!0,instructions:[{setStateVariable:"value",value:Boolean(e.value)}]};if(n.stringMathTextBooleanChildren.length===1){let i=n.stringMathTextBooleanChildren[0];if(i.componentType==="string")return{success:!0,instructions:[{setDependency:"stringMathTextBooleanChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]};if(r.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"boolean"}))return{success:!0,instructions:[{setDependency:"stringMathTextBooleanChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]}}return{success:!1}}},t.text={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value?"true":"false"}}}},t}},k=Oi;function pv({dependencyValues:u,componentInfoObjects:t}){let e="comp",n=!0;for(;n;){n=!1;for(let l of u.stringChildren)if(l.stateValues.value.includes(e)){n=!0,e+="p";break}}let r="",i=0,a=[],s=0;for(let l of u.stringMathTextBooleanChildren)if(l.componentType==="string")r+=" "+u.stringChildren[s].stateValues.value+" ",s++;else{let c=e+i;r+=" "+c+" ",t.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"math"})||t.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"mathlist"})||a.push(c),i+=1}let o=null;try{o=Pi.fromAst(dv.convert(r))}catch(l){}return o&&(o=Pi.fromAst(lr({logicTree:o.tree,nonMathCodes:a}))),{newValues:{codePre:e,parsedExpression:o}}}import Ut from"../_snowpack/pkg/math-expressions.js";var Li=class extends B{static componentType="number";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.displayDigits={default:10},e.displaySmallAsZero={default:!1},e.renderAsMath={default:!1,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:/..+/,replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"math",children:e}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1}),r=e.newLeaf({name:"exactlyOneNumber",componentType:"number",number:1});return e.newOperator({name:"stringXorNumberXorSugar",operator:"xor",propositions:[r,n],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({numberChild:{dependencyType:"child",childLogicName:"exactlyOneNumber",variableNames:["value","canBeModified"],requireChildLogicInitiallySatisfied:!0},stringChild:{dependencyType:"child",childLogicName:"atMostOneString",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),defaultValue:NaN,definition:function({dependencyValues:e}){if(e.numberChild.length===0){if(e.stringChild.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:["value"]}}};let n=Number(e.stringChild[0].stateValues.value);if(Number.isNaN(n))try{n=Ut.fromText(e.stringChild[0].stateValues.value).evaluate_to_constant(),n===null&&(n=NaN)}catch(r){n=NaN}return{newValues:{value:n}}}else return{newValues:{value:e.numberChild[0].stateValues.value}}},set:function(e){let n=Number(e);if(Number.isNaN(n))try{n=Ut.fromText(e).evaluate_to_constant(),n===null&&(n=NaN)}catch(r){n=NaN}return n},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n,stateValues:r,overrideFixed:i}){if(!r.canBeModified&&!i)return{success:!1};let a=e.value;a instanceof Ut.class?(a=a.evaluate_to_constant(),Number.isFinite(a)||(a=NaN)):a=Number(a);let s;return n.numberChild.length===0?n.stringChild.length===0?s=[{setStateVariable:"value",value:a}]:s=[{setDependency:"stringChild",desiredValue:a.toString(),childIndex:0,variableIndex:0}]:s=[{setDependency:"numberChild",desiredValue:a,childIndex:0,variableIndex:0}],{success:!0,instructions:s}}},t.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"},displayDigits:{dependencyType:"stateVariable",variableName:"displayDigits"},displaySmallAsZero:{dependencyType:"stateVariable",variableName:"displaySmallAsZero"}}),definition:function({dependencyValues:e}){let n=Ut.round_numbers_to_precision(e.value,e.displayDigits).tree;return e.displaySmallAsZero&&Math.abs(n)<1e-14&&(n=0),{newValues:{valueForDisplay:n}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({valueForDisplay:{dependencyType:"stateVariable",variableName:"valueForDisplay"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.valueForDisplay.toString()}}}},t.math={public:!0,componentType:"math",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return Number.isNaN(e.value)?{newValues:{math:Ut.fromAst("\uFF3F")}}:{newValues:{math:Ut.fromAst(e.value)}}},inverseDefinition:function({desiredStateVariableValues:e}){let n=e.math.evaluate_to_constant();return n===null&&(n=NaN),{success:!0,instructions:[{setDependency:"value",desiredValue:n}]}}},t.canBeModified={returnDependencies:()=>({numberChildModifiable:{dependencyType:"child",childLogicName:"exactlyOneNumber",variableNames:["canBeModified"],requireChildLogicInitiallySatisfied:!0},modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"}}),definition:function({dependencyValues:e}){return!e.modifyIndirectly||e.fixed?{newValues:{canBeModified:!1}}:e.numberChildModifiable.length===1&&!e.numberChildModifiable[0].stateValues.canBeModified?{newValues:{canBeModified:!1}}:{newValues:{canBeModified:!0}}}},t}returnSerializeInstructions(){let t=this.childLogic.returnMatches("atMostOneString"),e=t&&t.length===1;return e?{skipChildren:e,stateVariables:["value"]}:{}}adapters=["math","text"]},$=Li;import _l from"../_snowpack/pkg/math-expressions.js";var Ri=class extends ${static componentType="integer";static rendererType="number";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value.definition=function({dependencyValues:e}){if(e.numberChild.length===0){if(e.stringChild.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:["value"]}}};let n=Number(e.stringChild[0].stateValues.value);if(Number.isNaN(n))try{n=_l.fromText(e.stringChild[0].stateValues.value).evaluate_to_constant(),n===null&&(n=NaN)}catch(r){n=NaN}return{newValues:{value:Math.round(n)}}}else return{newValues:{value:Math.round(e.numberChild[0].stateValues.value)}}},t.value.inverseDefinition=function({desiredStateVariableValues:e,dependencyValues:n,stateValues:r}){if(!r.canBeModified)return{success:!1};let i=e.value;i instanceof _l.class?i=i.evaluate_to_constant():i=Number(i),i=Math.round(i);let a;return n.numberChild.length===0?n.stringChild.length===0?a=[{setStateVariable:"value",value:i}]:a=[{setDependency:"stringChild",desiredValue:i.toString(),childIndex:0,variableIndex:0}]:a=[{setDependency:"numberChild",desiredValue:i,childIndex:0,variableIndex:0}],{success:!0,instructions:a}},t}},ye=Ri;var Fi=class extends B{static componentType="text";static includeBlankStringChildren=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0});return e.newOperator({name:"stringsAndTexts",operator:"and",propositions:[n,r],requireConsecutive:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({stringTextChildren:{dependencyType:"child",childLogicName:"stringsAndTexts",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),defaultValue:"",set:String,definition:function({dependencyValues:e}){if(e.stringTextChildren.length===0)return{useEssentialOrDefaultValue:{value:{variablesToCheck:"value"}}};let n="";for(let r of e.stringTextChildren)n+=r.stateValues.value;return{newValues:{value:n}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){let r=n.stringTextChildren.length;return r>1?{success:!1}:r===1?{success:!0,instructions:[{setDependency:"stringTextChildren",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:String(e.value)}]}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({newValues:{text:e.value}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setDependency:"value",desiredValue:e.text}]})},t}returnSerializeInstructions(){let t=this.childLogic.returnMatches("atLeastZeroStrings").length===1&&this.childLogic.returnMatches("atLeastZeroTexts").length===0;return t?{skipChildren:t,stateVariables:["value"]}:{}}},z=Fi;var ki=class extends z{static componentType="_textfromsinglestringchild";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1,excludeCompositeReplacements:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({stringChild:{dependencyType:"child",childLogicName:"atMostOneString",variableNames:["value"]}}),defaultValue:"",definition:function({dependencyValues:e}){return e.stringChild.length===0?{useEssentialOrDefaultValue:{value:{variablesToCheck:"value"}}}:{newValues:{value:e.stringChild[0].stateValues.value}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.stringChild.length===1?{success:!0,instructions:[{setDependency:"stringChild",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t}},An=ki;var Mi={};fe(Mi,{ComponentListOfListsWithSelectableType:()=>dr,ComponentListWithSelectableType:()=>Sn,ComponentWithSelectableType:()=>Ft});import Bl from"../_snowpack/pkg/math-expressions.js";function ur(u){return null}function Ct({childrenToComponentFunction:u,mustStripOffOuterParentheses:t=!1}){return function({matchedChildren:e}){let n=0,r=[],i=[],a=!1,s=e.length;if(t){let l=e[0];if(l.componentType!=="string"||l.state.value.trimLeft()[0]!=="(")return{success:!1}}for(let[l,c]of e.entries()){if(c.componentType!=="string"){i.push(c);continue}let d=c.state.value.trim();if(l===0&&t&&d[0]==="("){let m=e[s-1];if(m.componentType==="string"){let f=m.state.value.trimRight();f[f.length-1]===")"&&(a=!0,d=d.substring(1))}}let p=0;for(let m=0;m<d.length;m++){let f=d[m];if(f==="("&&n++,f===")"){if(n===0){if(a&&l===s-1&&m===d.length-1){d=d.substring(0,d.length-1);break}return{success:!1}}n--}f===","&&n===0&&(m>p&&i.push({componentType:"string",state:{value:d.substring(p,m)}}),r.push(i),i=[],p=m+1)}d.length>p&&i.push({componentType:"string",state:{value:d.substring(p,d.length)}})}if(n!==0)return{success:!1};r.push(i);let o=r.map(u);return{success:!0,newChildren:o}}}function Gt({childrenList:u}){let t=0,e=[],n=[];for(let r of u){if(r.componentType!=="string"){n.push(r);continue}let i=r.state.value.trim(),a=0;for(let s=0;s<i.length;s++){let o=i[s];if(o==="("&&t++,o===")"){if(t===0)return{success:!1};t--}if(o===","&&t===0){if(s>a){let l=i.substring(a,s).trim();n.push({componentType:"string",state:{value:l}})}e.push(n),n=[],a=s+1}}if(i.length>a){let s=i.substring(a,i.length).trim();n.push({componentType:"string",state:{value:s}})}}return t!==0?{success:!1}:(e.push(n),{success:!0,pieces:e})}function Xe({componentList:u,removeParens:t=!1}){let e=0,n=[],r=[];for(let i of u){if(i.componentType!=="string"){e===0?n.push([i]):r.push(i);continue}let a=i.state.value.trim(),s=0;for(let o=0;o<a.length;o++){let l=a[o];if(l==="(")e===0&&t&&(s=o+1),e++;else if(l===")"){if(e===0)return{success:!1};if(e===1){if(o+1>s){let c=t?o:o+1,d=a.substring(s,c).trim();d.length>0&&r.push({componentType:"string",state:{value:d}})}n.push(r),r=[],s=o+1}e--}else if(e===0&&!l.match(/\s/))return{success:!1}}if(a.length>s){let o=a.substring(s,a.length).trim();r.push({componentType:"string",state:{value:o}})}}return e!==0?{success:!1}:(r.length>0&&n.push(r),{success:!0,pieces:n})}function cr(u){if(u.length===0)return{foundVector:!1};if(u[0].componentType!=="string")return{foundVector:!1};let t=u[0].state.value;if(t.trim()[0]!=="(")return{foundVector:!1};if(u[u.length-1].componentType!=="string")return{foundVector:!1};let n=u[u.length-1].state.value;if(n.trim().slice(-1)!==")")return{foundVector:!1};let i=[];if(u.length===1){let l=t.trim().slice(1,-1).trim();l.length>0&&i.push({componentType:"string",state:{value:l}})}else{let l=t.trim().slice(1).trim();l.length>0&&i.push({componentType:"string",state:{value:l}}),i.push(...u.slice(1,-1)),l=n.trim().slice(0,-1).trim(),l.length>0&&i.push({componentType:"string",state:{value:l}})}let a=0,s=[],o=[];for(let l of i){if(l.componentType!=="string"){o.push(l);continue}let c=l.state.value.trim(),d=0,p=!1;for(let m=0;m<c.length;m++){let f=c[m];if(f==="("&&a++,f===")"){if(a===0)return{foundVector:!1};a--}if(f===","&&a===0){if(m>d){let h=c.substring(d,m).trim();o.push({componentType:"string",state:{value:h}})}s.push(o),o=[],d=m+1,p=!0}}if(p){if(c.length>d){let m=c.substring(d,c.length).trim();o.push({componentType:"string",state:{value:m}})}}else o.push(l)}return a!==0?{foundVector:!1}:(s.push(o),{foundVector:!0,vectorComponents:s})}var Ft=class extends R{static componentType="_componentwithselectabletype";static rendererType=void 0;static acceptType=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value","type"]}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneChild",componentType:"_base",excludeComponentTypes:["_composite"],comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.type={returnDependencies:()=>({type:{dependencyType:"doenetAttribute",attributeName:"type"},parentType:{dependencyType:"parentStateVariable",variableName:"type"}}),definition:function({dependencyValues:e,componentName:n}){let r=e.type;return r||(r=e.parentType),r?["number","letters","math","text","boolean"].includes(r)||(console.warn(`Invalid type ${r}, setting type to number`),r="number"):r="number",{newValues:{type:r}}}},t.value={public:!0,returnDependencies:()=>({type:{dependencyType:"stateVariable",variableName:"type"},atMostOneChild:{dependencyType:"child",childLogicName:"atMostOneChild",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),definition({dependencyValues:e}){let n;return e.atMostOneChild.length===1?n=_i(e.atMostOneChild[0].stateValues.value,e.type):n=null,{newValues:{value:n},setComponentType:{value:e.type}}}},t}},Sn=class extends Ft{static componentType="_componentlistwithselectabletype";static acceptType=!0;static returnSugarInstructions(){let t=[];function e({matchedChildren:n,componentProps:r,parentProps:i}){let a=r.type;return a||(a=i.type),a?["number","letters","math","text","boolean"].includes(a)||(console.warn(`Invalid type ${a}, setting type to number`),a="number"):a="number",n=n.reduce(function(s,o){return o.componentType==="string"?[...s,...o.state.value.split(/\s+/).filter(l=>l).map(l=>({componentType:"string",state:{value:l}}))]:[...s,o]},[]),{success:!0,newChildren:n}}return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"anythingForSelectedType",componentType:"_base",excludeComponentTypes:["_composite"],comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return delete t.value,t.nValues={additionalStateVariablesDefined:["childForValue"],returnDependencies:()=>({anythingForSelectedType:{dependencyType:"child",childLogicName:"anythingForSelectedType",variableNames:["nValues"],variablesOptional:!0}}),definition({dependencyValues:e}){let n=0,r=[];for(let[i,a]of e.anythingForSelectedType.entries()){let s=Number.isInteger(a.stateValues.nValues)?a.stateValues.nValues:1;n+=s;for(let o=0;o<s;o++)r.push({child:i,valueIndex:o})}return{newValues:{nValues:n,childForValue:r}}}},t.values={public:!0,isArray:!0,entryPrefixes:["value"],stateVariablesDeterminingDependencies:["childForValue"],returnArraySizeDependencies:()=>({nValues:{dependencyType:"stateVariable",variableName:"nValues"}}),returnArraySize({dependencyValues:e}){return[e.nValues]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={type:{dependencyType:"stateVariable",variableName:"type"}},i={};for(let a of e){let s=n.childForValue[a];i[a]={anythingForSelectedType:{dependencyType:"child",childLogicName:"anythingForSelectedType",variableNames:["value","values"],childIndices:[s.child],variablesOptional:!0},valueIndex:{dependencyType:"value",value:s.valueIndex}}}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r,componentName:i}){let a={};for(let s of r)if(n[s].anythingForSelectedType&&n[s].anythingForSelectedType.length===1){let o=n[s].anythingForSelectedType[0],l;o.stateValues.values?l=o.stateValues.values[n[s].valueIndex]:l=o.stateValues.value,a[s]=_i(l,e.type)}return{newValues:{values:a},setComponentType:{values:e.type}}}},t}},dr=class extends Ft{static componentType="_componentlistoflistswithselectabletype";static componentTypeSingular="_componentlistwithselectabletype";static acceptType=!0;static returnSugarInstructions(){let t=[],e=this,n=function({matchedChildren:r,componentProps:i,parentProps:a}){let s=Xe({componentList:r,removeParens:!0});if(s.success!==!0)return{success:!1};let o=i.type;return o||(o=a.type),o?["number","letters","math","text","boolean"].includes(o)||(console.warn(`Invalid type ${o}, setting type to number`),o="number"):o="number",{success:!0,newChildren:s.pieces.map(l=>({componentType:e.componentTypeSingular,props:{type:o},children:l}))}};return t.push({replacementFunction:n}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastZeroLists",componentType:this.componentTypeSingular,comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return delete t.value,t.nLists={returnDependencies:()=>({listChildren:{dependencyType:"child",childLogicName:"atLeastZeroLists"}}),definition({dependencyValues:e}){return{newValues:{nLists:e.listChildren.length}}}},t.lists={isArray:!0,entryPrefixes:["list"],returnArraySizeDependencies:()=>({nLists:{dependencyType:"stateVariable",variableName:"nLists"}}),returnArraySize({dependencyValues:e}){return[e.nLists]},returnArrayDependenciesByKey({arrayKeys:e}){let n={type:{dependencyType:"stateVariable",variableName:"type"}},r={};for(let i of e)r[i]={listChildren:{dependencyType:"child",childLogicName:"atLeastZeroLists",variableNames:["values","type"],childIndices:[i]}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r)if(n[a].listChildren&&n[a].listChildren.length===1){let s=n[a].listChildren[0];s.stateValues.type===e.type?i[a]=s.stateValues.values:i[a]=s.stateValues.values.map(o=>_i(o,e.type))}return{newValues:{lists:i}}}},t}};function _i(u,t){if(Array.isArray(u)&&(u=u[0]),t==="number"){if(u instanceof Bl.class){let e=u.evaluate_to_constant();return Number.isFinite(e)||(e=NaN),e}return Number(u)}else if(t==="math"){if(typeof u=="string")try{return Bl.fromText(u)}catch(e){}return re(u)}else return t==="boolean"?Boolean(u):String(u)}var Bi=class extends R{static componentType="_componentwithanychildren";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}},El=Bi;var Ei=class extends R{static componentType="_pointlistcomponent";static rendererType="container";static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=Xe({componentList:n});return r.success!==!0?{success:!1}:{success:!0,newChildren:r.pieces.map(function(i){return i.length>1||i[0].componentType==="string"?{componentType:"point",children:i}:i[0]})}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nPoints={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints"}}),definition:function({dependencyValues:e}){return{newValues:{nPoints:e.pointChildren.length},checkForActualChange:{nPoints:!0}}}},t.nDimensions={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){let n;if(e.pointChildren.length===0)n=2;else{n=1;for(let r of e.pointChildren)Number.isFinite(r.stateValues.nDimensions)&&(n=Math.max(n,r.stateValues.nDimensions))}return{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],returnWrappingComponents(e){return e==="pointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="pointX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},returnArraySizeDependencies:()=>({nPoints:{dependencyType:"stateVariable",variableName:"nPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nPoints,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[i,a]=r.split(",");n[r]={pointChild:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["x"+(Number(a)+1)],childIndices:[i]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=i.split(",")[1],s=e[i].pointChild[0];s&&(r[i]=s.stateValues["x"+(Number(a)+1)])}return{newValues:{points:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n}){let r=[];for(let i in e.points)r.push({setDependency:n[i].pointChild,desiredValue:e.points[i],childIndex:0,variableIndex:0});return{success:!0,instructions:r}}},t.childrenToRender={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints"}}),definition:({dependencyValues:e})=>({newValues:{childrenToRender:e.pointChildren.map(n=>n.componentName)}})},t}},Xt=Ei;var $i=class extends R{static componentType="_vectorlistcomponent";static rendererType="container";static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=Xe({componentList:n});return r.success!==!0?{success:!1}:{success:!0,newChildren:r.pieces.map(function(i){return i.length>1||i[0].componentType==="string"?{componentType:"vector",children:i}:i[0]})}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroVectors",componentType:"vector",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVectors={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childLogicName:"atLeastZeroVectors"}}),definition:({dependencyValues:e})=>({newValues:{nVectors:e.vectorChildren.length},checkForActualChange:{nVectors:!0}})},t.nDimensions={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childLogicName:"atLeastZeroVectors",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){let n;if(e.vectorChildren.length===0)n=2;else{n=1;for(let r of e.vectorChildren)Number.isFinite(r.stateValues.nDimensions)&&(n=Math.max(n,r.stateValues.nDimensions))}return{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.vectors={isArray:!0,nDimensions:2,entryPrefixes:["vectorX","vector"],returnWrappingComponents(e){return e==="vectorX"?[]:[["vector",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="vectorX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},returnArraySizeDependencies:()=>({nVectors:{dependencyType:"stateVariable",variableName:"nVectors"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nVectors,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[i,a]=r.split(",");n[r]={vectorChild:{dependencyType:"child",childLogicName:"atLeastZeroVectors",variableNames:["x"+(Number(a)+1)],childIndices:[i]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=i.split(",")[1],s=e[i].vectorChild[0];s&&(r[i]=s.stateValues["x"+(Number(a)+1)])}return{newValues:{vectors:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n}){let r=[];for(let i in e.vectors)r.push({setDependency:n[i].vectorChild,desiredValue:e.vectors[i],childIndex:0,variableIndex:0});return{success:!0,instructions:r}}},t.childrenToRender={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childLogicName:"atLeastZeroVectors"}}),definition:({dependencyValues:e})=>({newValues:{childrenToRender:e.vectorChildren.map(n=>n.componentName)}})},t}},pr=$i;var zi=class extends R{static componentType="_linelistcomponent";static rendererType="container";static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"line",children:[{componentType:"string",state:{value:s}}]}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroLines",componentType:"line",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nLines={returnDependencies:()=>({lineChildren:{dependencyType:"child",childLogicName:"atLeastZeroLines"}}),definition:function({dependencyValues:e}){return{newValues:{nLines:e.lineChildren.length},checkForActualChange:{nLines:!0}}}},t.lineNames={isArray:!0,entryPrefixes:["lineName"],returnArraySizeDependencies:()=>({nLines:{dependencyType:"stateVariable",variableName:"nLines"}}),returnArraySize({dependencyValues:e}){return[e.nLines]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={lineChild:{dependencyType:"child",childLogicName:"atLeastZeroLines",childIndices:[r]}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].lineChild[0];a&&(r[i]=a.componentName)}return{newValues:{lineNames:r}}}},t.childrenToRender={returnDependencies:()=>({lineChildren:{dependencyType:"child",childLogicName:"atLeastZeroLines"}}),definition:({dependencyValues:e})=>({newValues:{childrenToRender:e.lineChildren.map(n=>n.componentName)}})},t}},$l=zi;var ji=class extends R{static componentType="_anglelistcomponent";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.hide={default:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"AtLeastZeroAngles",componentType:"angle",comparison:"atLeast",number:0}),r=ur(o=>({componentType:"angle",children:[{componentType:"math",children:o}]})),i=e.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),a=e.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),s=e.newOperator({name:"StringsAndMaths",operator:"or",propositions:[i,a],requireConsecutive:!0,isSugar:!0,replacementFunction:r});return e.newOperator({name:"AnglesXorSugar",operator:"xor",propositions:[n,s],setAsBase:!0}),e}updateState(t={}){if(t.init&&(this._state.angles={trackChanges:!0}),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.nAngles=!0;return}if(this.currentTracker.trackChanges.childrenChanged(this.componentName)){delete this.unresolvedState.angles,delete this.unresolvedState.nAngles;let r=this.childLogic.returnMatches("AtLeastZeroAngles");this.state.nAngles=r.length,this.state.angles=r.map(i=>this.activeChildren[i])}}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.container({key:this.componentName}))}updateChildrenWhoRender(){this.childrenWhoRender=this.state.angles.map(t=>t.componentName)}},mr=ji;function Zt(){return[{styleNumber:1,lineColor:"blue",lineWidth:4,lineStyle:"solid",markerColor:"blue",markerStyle:"circle",markerSize:3},{styleNumber:2,lineColor:"green",lineWidth:2,lineStyle:"solid",markerColor:"green",markerStyle:"square",markerSize:4},{styleNumber:3,lineColor:"red",lineWidth:3,lineStyle:"solid",markerColor:"red",markerStyle:"triangle",markerSize:5},{styleNumber:4,lineColor:"purple",lineWidth:2,lineStyle:"solid",markerColor:"purple",markerStyle:"diamond",markerSize:4},{styleNumber:5,lineColor:"black",lineWidth:1,lineStyle:"solid",markerColor:"black",markerStyle:"circle",markerSize:2},{styleNumber:6,lineColor:"lightgray",lineWidth:1,lineStyle:"dotted",markerColor:"lightgray",markerStyle:"circle",markerSize:2}]}var Hi=class extends R{static componentType="_graphical";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.label={default:"",forRenderer:!0},e.showLabel={default:!0,forRenderer:!0},e.layer={default:0,forRenderer:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.selectedStyle={forRenderer:!0,willNeverBeEssential:!0,returnDependencies:()=>({styleNumber:{dependencyType:"stateVariable",variableName:"styleNumber"},ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]}}),definition:function({dependencyValues:e}){let n=e.ancestorWithStyle.stateValues.styleDefinitions;n||(n=Zt());let r;for(let i of n)e.styleNumber===i.styleNumber&&(r===void 0?r=i:r=Object.assign(Object.assign({},i),r));return r===void 0&&(r=n[0]),{newValues:{selectedStyle:r}}}},t}},le=Hi;import Tt from"../_snowpack/pkg/math-expressions.js";var qi=class extends le{static componentType="point";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["xs","nDimensions"]}static primaryStateVariableForDefinition="coordsShadow";static stateVariableForPropertyValue="coords";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let a=Ct({childrenToComponentFunction:s=>({componentType:"x",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});return!a.success&&n.length===1?{success:!0,newChildren:[{componentType:"x",doenetAttributes:{isPropertyChild:!0},children:n}]}:(a.success&&(a.newChildren=[{componentType:"xs",doenetAttributes:{isPropertyChild:!0},children:a.newChildren}]),a)};return t.push({childrenRegex:/s+(.*s)?/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneX",componentType:"x",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"exactlyOneY",componentType:"y",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"exactlyOneZ",componentType:"z",number:1,takePropertyChildren:!0}),a=e.newLeaf({name:"exactlyOneXs",componentType:"xs",number:1,takePropertyChildren:!0}),s=e.newOperator({name:"coordinatesViaComponents",operator:"or",propositions:[n,r,i]}),o=e.newLeaf({name:"exactlyOneCoords",componentType:"coords",number:1,takePropertyChildren:!0}),l=e.newLeaf({name:"exactlyOnePoint",componentType:"point",number:1}),c=e.newLeaf({name:"noCoords",componentType:"coords",number:0,allowSpillover:!1}),d=e.newOperator({name:"coordsCombinations",operator:"xor",propositions:[s,a,l,o,c]}),p=e.newLeaf({name:"atMostOneConstraints",componentType:"constraints",comparison:"atMost",number:1});return e.newOperator({name:"pointWithConstraints",operator:"and",propositions:[d,p],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){return{newValues:{styleDescription:e.selectedStyle.markerColor}}}},t.styleDescriptionWithNoun={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n=e.selectedStyle.markerColor;return e.selectedStyle.markerStyle==="circle"?n+=" point":n+=` ${e.selectedStyle.markerStyle}`,{newValues:{styleDescriptionWithNoun:n}}}},t.coordsShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{coordsShadow:{variablesToCheck:["coords","coordsShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e,stateValues:n,workspace:r}){let i=Rl({desiredVector:e.coordsShadow,currentVector:n.coordsShadow,workspace:r,workspaceKey:"desiredCoords"});return{success:!0,instructions:[{setStateVariable:"coordsShadow",value:i}]}}},t.nDimensions={public:!0,componentType:"number",returnDependencies:()=>({coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coordsChild:{dependencyType:"child",childLogicName:"exactlyOneCoords",variableNames:["value"]},xChild:{dependencyType:"child",childLogicName:"exactlyOneX"},yChild:{dependencyType:"child",childLogicName:"exactlyOneY"},zChild:{dependencyType:"child",childLogicName:"exactlyOneZ"},xsChild:{dependencyType:"child",childLogicName:"exactlyOneXs",variableNames:["nComponents"]},pointChild:{dependencyType:"child",childLogicName:"exactlyOnePoint",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e,changes:n}){let r=!1,i,a;if(e.xsChild.length===1)return{newValues:{nDimensions:e.xsChild[0].stateValues.nComponents}};if(e.pointChild.length===1)return{newValues:{nDimensions:e.pointChild[0].stateValues.nDimensions}};if(e.coordsChild.length===1?(r=!0,i=e.coordsChild[0].stateValues.value):e.coordsShadow&&(r=!0,i=e.coordsShadow),r){let s=i.tree;return Array.isArray(s)&&["tuple","vector"].includes(s[0])?a=s.length-1:a=1,{newValues:{nDimensions:a},checkForActualChange:{nDimensions:!0}}}else e.zChild.length===1?a=3:e.yChild.length===1?a=2:e.xChild.length===1?a=1:a=2;return{newValues:{nDimensions:a},checkForActualChange:{nDimensions:!0}}}},t.arrayVariableForConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{arrayVariableForConstraints:"unconstrainedXs"}})},t.arrayEntryPrefixForConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{arrayEntryPrefixForConstraints:"unconstrainedX"}})},t.nDimensionsForConstraints={isAlias:!0,targetVariableName:"nDimensions"},t.unconstrainedXs={isArray:!0,entryPrefixes:["unconstrainedX"],defaultEntryValue:Tt.fromAst(0),returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={coordsShadow:{dependencyType:"stateVariable",variableName:"coordsShadow"},coordsChild:{dependencyType:"child",childLogicName:"exactlyOneCoords",variableNames:["value"]}},r={};for(let i of e){let a=Number(i)+1;r[i]={xsChild:{dependencyType:"child",childLogicName:"exactlyOneXs",variableNames:["math"+a]},pointChild:{dependencyType:"child",childLogicName:"exactlyOnePoint",variableNames:["x"+a]}},i==="0"?r[i].componentChild={dependencyType:"child",childLogicName:"exactlyOneX",variableNames:["value"]}:i==="1"?r[i].componentChild={dependencyType:"child",childLogicName:"exactlyOneY",variableNames:["value"]}:i==="2"&&(r[i].componentChild={dependencyType:"child",childLogicName:"exactlyOneZ",variableNames:["value"]})}return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={},a={},s=!1,o;if(e.coordsChild.length===1?(s=!0,o=e.coordsChild[0].stateValues.value):e.coordsShadow&&(s=!0,o=e.coordsShadow),s){let c=o.tree;if(Array.isArray(c)&&["tuple","vector"].includes(c[0]))for(let d of r){let p=Number(d);(p>=0||p<c.length-1)&&(o.tree[p+1]===void 0?i[d]=Tt.fromAst("\uFF3F"):i[d]=o.get_component(p).simplify())}else r.includes("0")&&(i[0]=o.simplify())}else for(let c of r){let d=Number(c)+1,p=n[c].xsChild;if(p.length===1)i[c]=p[0].stateValues["math"+d].simplify();else{let m=n[c].pointChild;if(m.length===1)i[c]=m[0].stateValues["x"+d];else{let f=n[c].componentChild;f.length===1?i[c]=f[0].stateValues.value.simplify():a[c]={variablesToCheck:[{variableName:"xs",arrayIndex:c},{variableName:"coords",mathComponentIndex:c}]}}}}let l={};return Object.keys(i).length>0&&(l.newValues={unconstrainedXs:i}),Object.keys(a).length>0&&(l.useEssentialOrDefaultValue={unconstrainedXs:a}),l},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[],o=!1,l;if(n.coordsChild.length===1?(o=!0,l="coordsChild"):n.coordsShadow!==null&&(o=!0,l="coordsShadow"),o){let c;if(a[0]===1)c=re(e.unconstrainedXs[0]);else{let p=Array(a[0]+1);p[0]="vector";for(let m in e.unconstrainedXs){let f=e.unconstrainedXs[m];p[Number(m)+1]=f instanceof Tt.class?f.tree:f}c=Tt.fromAst(p)}let d={setDependency:l,desiredValue:c};return l==="coordsChild"&&(d.childIndex=0,d.variableIndex=0),s.push(d),{success:!0,instructions:s}}else{for(let c of Object.keys(e.unconstrainedXs).reverse()){if(!r[c])continue;r[c].xsChild.length===1?s.push({setDependency:i[c].xsChild,desiredValue:re(e.unconstrainedXs[c]),childIndex:0,variableIndex:0}):r[c].pointChild.length===1?s.push({setDependency:i[c].pointChild,desiredValue:re(e.unconstrainedXs[c]),childIndex:0,variableIndex:0}):r[c].componentChild.length===1?s.push({setDependency:i[c].componentChild,desiredValue:e.unconstrainedXs[c],childIndex:0,variableIndex:0}):s.push({setStateVariable:"unconstrainedXs",value:{[c]:re(e.unconstrainedXs[c])}})}return{success:!0,instructions:s}}}},t.xs={public:!0,componentType:"math",isArray:!0,entryPrefixes:["x"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let i=Number(r)+1,a={};a.unconstrainedX={dependencyType:"stateVariable",variableName:`unconstrainedX${i}`},a.constraintsChild={dependencyType:"child",childLogicName:"atMostOneConstraints",variableNames:[`constraintResult${i}`]},n[r]=a}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)if(e[i].constraintsChild.length===1){let a=Number(i)+1;r[i]=re(e[i].constraintsChild[0].stateValues["constraintResult"+a])}else r[i]=re(e[i].unconstrainedX);return n.length>0?{newValues:{xs:r}}:{}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:i,stateValues:a}){if(i&&!a.draggable)return{success:!1};let s=[];for(let o of Object.keys(e.xs).reverse())!n[o]||(n[o].constraintsChild.length===1?s.push({setDependency:r[o].constraintsChild,desiredValue:e.xs[o],childIndex:0,variableIndex:0}):s.push({setDependency:r[o].unconstrainedX,desiredValue:e.xs[o]}));return{success:!0,instructions:s}}},t.x={isAlias:!0,targetVariableName:"x1"},t.y={isAlias:!0,targetVariableName:"x2"},t.z={isAlias:!0,targetVariableName:"x3"},t.coords={public:!0,componentType:"coords",forRenderer:!0,returnDependencies:()=>({xs:{dependencyType:"stateVariable",variableName:"xs"}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.xs)r?n.push(r.tree):n.push("\uFF3F");return n.length>1?n=["vector",...n]:n.length===1?n=n[0]:n="\uFF3F",{newValues:{coords:Tt.fromAst(n)}}},inverseDefinition:function({desiredStateVariableValues:e,stateValues:n,initialChange:r}){if(r&&!n.draggable)return{success:!1};let i=[],a={},s=e.coords.tree;if(!(Array.isArray(s)&&["tuple","vector"].includes(s[0])))a[0]=e.coords;else for(let o=0;o<s.length-1;o++){let l=e.coords.get_component(o);l.tree!==void 0&&(a[o]=l)}return i.push({setDependency:"xs",desiredValue:a}),{success:!0,instructions:i}}},t.value={isAlias:!0,targetVariableName:"coords"},t.constraintUsed={public:!0,componentType:"boolean",returnDependencies:()=>({constraintsChild:{dependencyType:"child",childLogicName:"atMostOneConstraints",variableNames:["constraintUsed"]}}),definition:function({dependencyValues:e}){return e.constraintsChild.length===0?{newValues:{constraintUsed:!1}}:{newValues:{constraintUsed:e.constraintsChild[0].stateValues.constraintUsed}}}},t.numericalXs={public:!0,componentType:"number",isArray:!0,entryPrefixes:["numericalX"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let i=Number(r)+1;n[r]={x:{dependencyType:"stateVariable",variableName:`x${i}`}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].x;a?(a=e[i].x.evaluate_to_constant(),Number.isFinite(a)?r[i]=a:r[i]=NaN):r[i]=NaN}return{newValues:{numericalXs:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n,initialChange:r,stateValues:i}){if(r&&!i.draggable)return{success:!1};let a=[];for(let s in e.numericalXs)!dependencyValuesByKey[s]||a.push({setDependency:n[s].xs,desiredValue:e.numericalXs[s]});return{success:!0,instructions:a}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalXs:{dependencyType:"stateVariable",variableName:"numericalXs"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(){let n={};for(let r=1;r<=e.nDimensions;r++){let i=e.numericalXs[r-1];if(!Number.isFinite(i))return{};n["x"+r]=i}return n}}})},t}adapters=["coords"];movePoint({x:t,y:e,z:n,transient:r}){let i={};t!==void 0&&(i[0]=Tt.fromAst(t)),e!==void 0&&(i[1]=Tt.fromAst(e)),n!==void 0&&(i[2]=Tt.fromAst(n)),r?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:i}],transient:r}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"xs",value:i}],event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{x:t,y:e,z:n}}})}actions={movePoint:this.movePoint.bind(new Proxy(this,this.readOnlyProxyHandler))}},Nt=qi;import Fe from"../_snowpack/pkg/math-expressions.js";var Ki=class extends le{constructor(t){super(t);this.moveVector=this.moveVector.bind(new Proxy(this,this.readOnlyProxyHandler)),this.actions={moveVector:this.moveVector}}static componentType="vector";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["head","tail","displacement","basedOnHead","basedOnTail","basedOnDisplacement","nDimensions"]}static primaryStateVariableForDefinition="displacementShadow";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e.headDraggable={default:!0,forRenderer:!0},e.tailDraggable={default:!0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let a=Ct({childrenToComponentFunction:s=>({componentType:"x",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});return!a.success&&n.length===1?{success:!0,newChildren:[{componentType:"x",doenetAttributes:{isPropertyChild:!0},children:n}]}:(a.newChildren=[{componentType:"xs",doenetAttributes:{isPropertyChild:!0},children:a.newChildren}],a)};return t.push({childrenRegex:/s+(.*s)?/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneX",componentType:"x",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"exactlyOneY",componentType:"y",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"exactlyOneZ",componentType:"z",number:1,takePropertyChildren:!0}),a=e.newLeaf({name:"exactlyOneXs",componentType:"xs",number:1,takePropertyChildren:!0}),s=e.newOperator({name:"displacementViaComponents",operator:"or",propositions:[n,r,i]}),o=e.newLeaf({name:"exactlyOneDisplacement",componentType:"vector",number:1,takePropertyChildren:!0}),l=e.newOperator({name:"displacementOptions",operator:"xor",propositions:[o,a,s]}),c=e.newLeaf({name:"exactlyOneHead",componentType:"head",number:1,takePropertyChildren:!0}),d=e.newLeaf({name:"exactlyOneTail",componentType:"tail",number:1,takePropertyChildren:!0}),p=e.newOperator({name:"vectorDefiningPieces",operator:"or",propositions:[l,c,d]}),m=e.newLeaf({name:"atMostOnePoint",componentType:"point",comparison:"atMost",number:1}),f=e.newLeaf({name:"atMostOneVector",componentType:"vector",comparison:"atMost",number:1});return e.newOperator({name:"normalDefinitionXorPoints",operator:"xor",propositions:[p,m,f],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.displacementShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{displacementShadow:{variablesToCheck:["displacement","displacementShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"displacementShadow",value:e.displacementShadow}]}}},t.headShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{headShadow:{variablesToCheck:["head","headShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"headShadow",value:e.headShadow}]}}},t.tailShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{tailShadow:{variablesToCheck:["tail","tailShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"tailShadow",value:e.tailShadow}]}}},t.basedOnHead={returnDependencies:()=>({headChild:{dependencyType:"child",childLogicName:"exactlyOneHead"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},tailChild:{dependencyType:"child",childLogicName:"exactlyOneTail"},displacementOptions:{dependencyType:"child",childLogicName:"displacementOptions"},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint"},vectorChild:{dependencyType:"child",childLogicName:"atMostOneVector"}}),definition:function({dependencyValues:e}){return e.tailChild.length===1&&e.displacementOptions.length>0?(e.headChild.length===1&&console.warn("Vector is prescribed by head, tail, and displacement.  Ignoring specified head."),{newValues:{basedOnHead:!1},checkForActualChange:{basedOnHead:!0}}):e.headChild.length===1?{newValues:{basedOnHead:!0},checkForActualChange:{basedOnHead:!0}}:e.pointChild.length===1||e.vectorChild.length===1?{newValues:{basedOnHead:!1},checkForActualChange:{basedOnHead:!0}}:{newValues:{basedOnHead:e.headShadow!==null},checkForActualChange:{basedOnHead:!0}}}},t.basedOnTail={returnDependencies:()=>({tailChild:{dependencyType:"child",childLogicName:"exactlyOneTail"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}}),definition:function({dependencyValues:e}){return e.tailChild.length===1?{newValues:{basedOnTail:!0},checkForActualChange:{basedOnTail:!0}}:{newValues:{basedOnTail:e.tailShadow!==null},checkForActualChange:{basedOnTail:!0}}}},t.basedOnDisplacement={returnDependencies:()=>({displacementOptions:{dependencyType:"child",childLogicName:"displacementOptions"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},vectorChild:{dependencyType:"child",childLogicName:"atMostOneVector"},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint"}}),definition:function({dependencyValues:e}){return e.displacementOptions.length>0||e.vectorChild.length===1||e.pointChild.length===1?{newValues:{basedOnDisplacement:!0},checkForActualChange:{basedOnDisplacement:!0}}:{newValues:{basedOnDisplacement:e.displacementShadow!==null},checkForActualChange:{basedOnDisplacement:!0}}}},t.nPointChildren={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atMostOnePoint"}}),definition:function({dependencyValues:e}){return{newValues:{nPointChildren:e.pointChildren.length}}}},t.nVectorChildren={returnDependencies:()=>({vectorChildren:{dependencyType:"child",childLogicName:"atMostOneVector"}}),definition:function({dependencyValues:e}){return{newValues:{nVectorChildren:e.vectorChildren.length}}}},t.nDimensions={public:!0,componentType:"number",returnDependencies:()=>({basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"},displacementChild:{dependencyType:"child",childLogicName:"exactlyOneDisplacement",variableNames:["nDimensions"]},vectorChild:{dependencyType:"child",childLogicName:"atMostOneVector",variableNames:["nDimensions"]},xChild:{dependencyType:"child",childLogicName:"exactlyOneX"},yChild:{dependencyType:"child",childLogicName:"exactlyOneY"},zChild:{dependencyType:"child",childLogicName:"exactlyOneZ"},xsChild:{dependencyType:"child",childLogicName:"exactlyOneXs",variableNames:["nComponents"]},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"},headChild:{dependencyType:"child",childLogicName:"exactlyOneHead",variableNames:["nDimensions"]},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"},tailChild:{dependencyType:"child",childLogicName:"exactlyOneTail",variableNames:["nDimensions"]},pointChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e,changes:n}){let r,i,a;if(e.basedOnDisplacement){if(e.displacementChild.length===1)r=e.displacementChild[0].stateValues.nDimensions;else if(e.vectorChild.length===1)r=e.vectorChild[0].stateValues.nDimensions;else if(e.xsChild.length===1)r=e.xsChild[0].stateValues.nComponents;else if(e.zChild.length===1)r=3;else if(e.yChild.length===1)r=2;else if(e.xChild.length===1)r=1;else if(e.pointChild.length===1)r=e.pointChild[0].stateValues.nDimensions;else if(e.displacementShadow){let o=e.displacementShadow.tree;Array.isArray(o)&&["tuple","vector"].includes(o[0])?r=o.length-1:r=2}}if(e.basedOnHead){if(e.headChild.length===1)i=e.headChild[0].stateValues.nDimensions;else if(headShadow){let o=headShadow.tree;Array.isArray(o)&&["tuple","vector"].includes(o[0])?i=o.length-1:i=2}}if(e.basedOnTail){if(e.tailChild.length===1)a=e.tailChild[0].stateValues.nDimensions;else if(tailShadow){let o=tailShadow.tree;Array.isArray(o)&&["tuple","vector"].includes(o[0])?a=o.length-1:a=2}}let s;if(e.basedOnDisplacement){if(e.basedOnTail){if(r!==a)return console.warn("nDimensions mismatch in vector"),{newValues:{nDimensions:NaN}}}else if(e.basedOnHead&&r!==i)return console.warn("nDimensions mismatch in vector"),{newValues:{nDimensions:NaN}};s=r}else if(e.basedOnTail){if(e.basedOnHead&&a!==i)return console.warn("nDimensions mismatch in vector"),{newValues:{nDimensions:NaN}};s=a}else e.basedOnHead?s=i:s=2;return{newValues:{nDimensions:s},checkForActualChange:{nDimensions:!0}}}},t.displacement={public:!0,componentType:"math",isArray:!0,entryPrefixes:["x"],returnWrappingComponents(e){return e==="x"?[]:[["vector",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},stateVariablesDeterminingDependencies:["basedOnDisplacement","nPointChildren","nVectorChildren"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},displacementShadow:{dependencyType:"stateVariable",variableName:"displacementShadow"}},i={};for(let a of e){let s=Number(a)+1;i[a]={xsChild:{dependencyType:"child",childLogicName:"exactlyOneXs",variableNames:["math"+s]}},n.nPointChildren===1?i[a].displacementChild={dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["x"+s]}:n.nVectorChildren===1?i[a].displacementChild={dependencyType:"child",childLogicName:"atMostOneVector",variableNames:["x"+s]}:i[a].displacementChild={dependencyType:"child",childLogicName:"exactlyOneDisplacement",variableNames:["x"+s]},a==="0"?i[a].componentChild={dependencyType:"child",childLogicName:"exactlyOneX",variableNames:["value"]}:a==="1"?i[a].componentChild={dependencyType:"child",childLogicName:"exactlyOneY",variableNames:["value"]}:a==="2"&&(i[a].componentChild={dependencyType:"child",childLogicName:"exactlyOneZ",variableNames:["value"]}),n.basedOnDisplacement||(i[a].tailX={dependencyType:"stateVariable",variableName:"tailX"+s},i[a].headX={dependencyType:"stateVariable",variableName:"headX"+s})}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=Number(a)+1,o=n[a].displacementChild;if(o&&o.length===1)i[a]=o[0].stateValues["x"+s];else{let l=n[a].xsChild;if(l&&l.length===1)i[a]=l[0].stateValues["math"+s].simplify();else{let c=n[a].componentChild;c&&c.length===1?i[a]=c[0].stateValues.value.simplify():e.displacementShadow!==null?i[a]=e.displacementShadow.get_component(Number(a)):i[a]=n[a].headX.subtract(n[a].tailX).simplify()}}}return{newValues:{displacement:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[],o=!1;for(let l in e.displacement){let c=r[l].displacementChild;if(c&&c.length===1)s.push({setDependency:i[l].displacementChild,desiredValue:e.displacement[l],childIndex:0,variableIndex:0});else{let d=r[l].xsChild;if(d&&d.length===1)s.push({setDependency:i[l].xsChild,desiredValue:e.displacement[l],childIndex:0,variableIndex:0});else{let p=r[l].componentChild;p&&p.length===1?s.push({setDependency:i[l].componentChild,desiredValue:e.displacement[l],childIndex:0,variableIndex:0}):n.displacementShadow!==null?o=!0:s.push({setDependency:i[l].headX,desiredValue:r[l].tailX.add(e.displacement[l]).simplify()})}}}if(o)if(a[0]>1){let l=["vector"];for(let c in e.displacement)l[Number(c)+1]=e.displacement[c].tree;l.length=a[0]+1,s.push({setDependency:"displacementShadow",desiredValue:Fe.fromAst(l)})}else a[0]===1&&"0"in e.displacement&&s.push({setDependency:"displacementShadow",desiredValue:e.displacement[0]});return{success:!0,instructions:s}}},t.x={isAlias:!0,targetVariableName:"x1"},t.y={isAlias:!0,targetVariableName:"x2"},t.z={isAlias:!0,targetVariableName:"x3"},t.head={public:!0,componentType:"math",isArray:!0,entryPrefixes:["headX"],returnWrappingComponents(e){return e==="headX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},stateVariablesDeterminingDependencies:["basedOnHead","basedOnDisplacement"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnTail:{dependencyType:"stateVariable",variableName:"basedOnTail"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},headShadow:{dependencyType:"stateVariable",variableName:"headShadow"}},i={};for(let a of e){let s=Number(a)+1;i[a]={headChild:{dependencyType:"child",childLogicName:"exactlyOneHead",variableNames:["x"+s]}},n.basedOnHead||(i[a].tailX={dependencyType:"stateVariable",variableName:"tailX"+s},n.basedOnDisplacement&&(i[a].x={dependencyType:"stateVariable",variableName:"x"+s}))}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={},a={};for(let o of r){let l=Number(o)+1;e.basedOnHead?n[o].headChild.length===1?i[o]=n[o].headChild[0].stateValues["x"+l]:e.headShadow!==null&&(i[o]=e.headShadow.get_component(Number(o))):e.basedOnDisplacement?i[o]=n[o].tailX.add(n[o].x).simplify():e.basedOnTail?a[o]={get defaultValue(){return o==="0"?n[o].tailX.add(Fe.fromAst(1)).simplify():n[o].tailX},variablesToCheck:["headX"+l]}:a[o]={get defaultValue(){return Fe.fromAst(o==="0"?1:0)},variablesToCheck:["headX"+l]}}let s={};return Object.keys(i).length>0&&(s.newValues={head:i}),Object.keys(a).length>0&&(s.useEssentialOrDefaultValue={head:a}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[],o=!1;for(let l in e.head)n.basedOnHead?r[l].headChild&&r[l].headChild.length===1?s.push({setDependency:i[l].headChild,desiredValue:e.head[l],childIndex:0,variableIndex:0}):n.headShadow!==null&&(o=!0):n.basedOnDisplacement?s.push({setDependency:i[l].x,desiredValue:e.head[l].subtract(r[l].tailX).simplify()}):s.push({setStateVariable:"head",value:{[l]:e.head[l]}});if(o)if(a[0]>1){let l=["vector"];for(let c in e.head)l[Number(c)+1]=e.head[c].tree;l.length=a[0]+1,s.push({setDependency:"headShadow",desiredValue:Fe.fromAst(l)})}else a[0]===1&&"0"in e.head&&s.push({setDependency:"headShadow",desiredValue:e.head[0]});return{success:!0,instructions:s}}},t.tail={public:!0,componentType:"math",isArray:!0,entryPrefixes:["tailX"],returnWrappingComponents(e){return e==="tailX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},stateVariablesDeterminingDependencies:["basedOnHead","basedOnDisplacement"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={basedOnDisplacement:{dependencyType:"stateVariable",variableName:"basedOnDisplacement"},basedOnHead:{dependencyType:"stateVariable",variableName:"basedOnHead"},tailShadow:{dependencyType:"stateVariable",variableName:"tailShadow"}},i={};for(let a of e){let s=Number(a)+1;i[a]={tailChild:{dependencyType:"child",childLogicName:"exactlyOneTail",variableNames:["x"+s]}},n.basedOnTail||(n.basedOnHead&&(i[a].headX={dependencyType:"stateVariable",variableName:"headX"+s}),n.basedOnDisplacement&&(i[a].x={dependencyType:"stateVariable",variableName:"x"+s}))}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={},a={};for(let o of r){let l=Number(o)+1;n[o].tailChild.length===1?i[o]=n[o].tailChild[0].stateValues["x"+l]:e.tailShadow!==null?i[o]=e.tailShadow.get_component(Number(o)):e.basedOnHead&&e.basedOnDisplacement?i[o]=n[o].headX.subtract(n[o].x).simplify():a[o]={get defaultValue(){return Fe.fromAst(0)},variablesToCheck:["tailX"+l]}}let s={};return Object.keys(i).length>0&&(s.newValues={tail:i}),Object.keys(a).length>0&&(s.useEssentialOrDefaultValue={tail:a}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[],o=!1;for(let l in e.tail)r[l].tailChild&&r[l].tailChild.length===1?s.push({setDependency:i[l].tailChild,desiredValue:e.tail[l],childIndex:0,variableIndex:0}):n.tailShadow!==null?o=!0:n.basedOnHead&&n.basedOnDisplacement?s.push({setDependency:i[l].x,desiredValue:r[l].headX.subtract(e.tail[l]).simplify()}):s.push({setStateVariable:"tail",value:{[l]:e.tail[l]}});if(o)if(a[0]>1){let l=["vector"];for(let c in e.tail)l[Number(c)+1]=e.tail[c].tree;l.length=a[0]+1,s.push({setDependency:"tailShadow",desiredValue:Fe.fromAst(l)})}else a[0]===1&&"0"in e.tail&&s.push({setDependency:"tailShadow",desiredValue:e.tail[0]});return{success:!0,instructions:s}}},t.numericalEndpoints={forRenderer:!0,returnDependencies:()=>({head:{dependencyType:"stateVariable",variableName:"head"},tail:{dependencyType:"stateVariable",variableName:"tail"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),definition:function({dependencyValues:e}){let n,r;if(e.nDimensions===1){let i=e.head.evaluate_to_constant();Number.isFinite(i)||(i=NaN),r=e.tail.evaluate_to_constant(),Number.isFinite(r)||(r=NaN)}else{n=[],r=[];for(let i=0;i<e.nDimensions;i++){let a=e.head[i].evaluate_to_constant();Number.isFinite(a)||(a=NaN),n.push(a);let s=e.tail[i].evaluate_to_constant();Number.isFinite(s)||(s=NaN),r.push(s)}}return{newValues:{numericalEndpoints:[r,n]}}}},t.displacementCoords={forRenderer:!0,returnDependencies:()=>({displacement:{dependencyType:"stateVariable",variableName:"displacement"}}),definition({dependencyValues:e}){let n=[];for(let r of e.displacement)r?n.push(r.tree):n.push("\uFF3F");return n.length>1?n=["vector",...n]:n.length===1?n=n[0]:n="\uFF3F",{newValues:{displacementCoords:Fe.fromAst(n)}}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalEndpoints:{dependencyType:"stateVariable",variableName:"numericalEndpoints"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=e.numericalEndpoints[0][0],i=e.numericalEndpoints[0][1],a=e.numericalEndpoints[1][0],s=e.numericalEndpoints[1][1];if(!(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(s)))return{};let o=a-r,l=s-i,c=o*o+l*l;if(c===0)return{};let d=n.x1.evaluate_to_constant(),p=n.x2.evaluate_to_constant();if(!(Number.isFinite(d)&&Number.isFinite(p)))return{};let m=((d-r)*o+(p-i)*l)/c,f={};return m<=0?f={x1:r,x2:i}:m>=1?f={x1:a,x2:s}:f={x1:r+m*o,x2:i+m*l},n.x3!==void 0&&(f.x3=0),f}}})},t}adapters=[{stateVariable:"displacementCoords",componentType:"coords",stateVariableForNewComponent:"value"}];moveVector({tailcoords:t,headcoords:e,transient:n,sourceInformation:r}){let i=[];if(t!==void 0){if(this.stateValues.basedOnHead&&this.stateValues.basedOnDisplacement){let a;e===void 0?a=t.map((s,o)=>this.stateValues.numericalEndpoints[1][o]-s):a=t.map((s,o)=>e[o]-s),i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:a.map(s=>Fe.fromAst(s)),sourceInformation:r})}else i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"tail",value:t.map(a=>Fe.fromAst(a)),sourceInformation:r});if(e===void 0&&!this.stateValues.basedOnHead&&this.stateValues.basedOnDisplacement){let a=t.map((s,o)=>this.stateValues.numericalEndpoints[1][o]-s);i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:a.map(s=>Fe.fromAst(s)),sourceInformation:r})}}if(e!==void 0){if(this.stateValues.basedOnHead||!this.stateValues.basedOnDisplacement)i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"head",value:e.map(a=>Fe.fromAst(a)),sourceInformation:r});else{t==null&&(t=this.stateValues.numericalEndpoints[0]);let a=t.map((s,o)=>e[o]-s);i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:a.map(s=>Fe.fromAst(s)),sourceInformation:r})}if(t===void 0&&this.stateValues.basedOnHead&&this.stateValues.basedOnDisplacement){let a=e.map((s,o)=>s-this.stateValues.numericalEndpoints[0][o]);i.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"displacement",value:a.map(s=>Fe.fromAst(s)),sourceInformation:r})}}n?this.coreFunctions.requestUpdate({updateInstructions:i,transient:n}):this.coreFunctions.requestUpdate({updateInstructions:i,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{head:e,tail:t}}})}},fr=Ki;var Wi=class extends R{static componentType="_componentsize";static rendererType="number";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value","isAbsolute"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1}),r=e.newLeaf({name:"atMostOneNumber",componentType:"number",comparison:"atMost",number:1}),i=e.newOperator({name:"numberAndString",operator:"and",propositions:[r,n],requireConsecutive:!0,sequenceMatters:!0}),a=e.newLeaf({name:"atMostOneComponentSize",componentType:"_componentsize",comparison:"atMost",number:1});return e.newOperator({name:"numberAndStringXorComponentSize",operator:"xor",propositions:[i,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this.componentType;return t.value={public:!0,componentType:"number",additionalStateVariablesDefined:["isAbsolute"],returnDependencies:()=>({componentSizeChild:{dependencyType:"child",childLogicName:"atMostOneComponentSize",variableNames:["value","isAbsolute"]},numberChild:{dependencyType:"child",childLogicName:"atMostOneNumber",variableNames:["value"]},stringChild:{dependencyType:"child",childLogicName:"atMostOneString",variableNames:["value"]}}),definition({dependencyValues:n}){if(n.stringChild.length===0)return n.numberChild.length===0?n.componentSizeChild.length===0?{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:100},isAbsolute:{variablesToCheck:"isAbsolute",defaultValue:!1}}}:{newValues:n.componentSizeChild[0].stateValues}:{newValues:{value:n.numberChild[0].stateValues.value,isAbsolute:!0}};{let r,i;if(n.numberChild.length===1)r=n.numberChild[0].stateValues.value,i=n.stringChild[0].stateValues.value.trim();else{let l=n.stringChild[0].stateValues.value.trim().match(/^(-?[\d.]+)\s*(.*)$/);if(l===null)return console.warn(e+" must begin with a number."),{newValues:{value:null,isAbsolute:!0}};r=l[1],i=l[2].trim()}if(r=Number(r),!Number.isFinite(r))return console.warn(e+" must have a number"),{newValues:{value:null,isAbsolute:!0}};if(i==="")return{newValues:{value:r,isAbsolute:!0}};let a=!(i==="%"||i==="em"),s={px:1,pixel:1,pixels:1,"%":1,em:100,in:96,inch:96,inches:96,pt:1.333333333333,mm:3.7795296,millimeter:3.7795296,millimeters:3.7795296,cm:37.795296,centimeter:37.795296,centimeters:37.795296};return s[i]===void 0?(console.warn(i+" is not a defined unit of measure."),{newValues:{value:r,isAbsolute:!0}}):{newValues:{value:s[i]*r,isAbsolute:a}}}},inverseDefinition({desiredStateVariableValues:n,dependencyValues:r}){return r.stringChild.length===0?r.numberChild.length===0?r.componentSizeChild.length===0?{success:!0,instructions:[{setStateVariable:"value",value:n.value}]}:{success:!0,instructions:[{setDependency:"componentSizeChild",desiredValue:n.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"numberChild",desiredValue:n.value,childIndex:0,variableIndex:0}]}:r.numberChild.length===1?{success:!0,instructions:[{setDependency:"numberChild",desiredValue:n.value,childIndex:0,variableIndex:0},{setDependency:"stringChild",desiredValue:"px",childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"stringChild",desiredValue:n.value+"px",childIndex:0,variableIndex:0}]}}},t.valueForDisplay={forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:n})=>({newValues:{valueForDisplay:n.value}})},t}},In=Wi;var Ui=class extends H{static componentType="variable";static rendererType="math";static additionalStateVariablesForProperties=["validVariable"];static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.validVariable={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){let n=e.value.tree,r=!0;return typeof n=="string"?n==="\uFF3F"&&(r=!1):(!Array.isArray(n)||n[0]!=="_"||typeof n[1]!="string"||typeof n[2]!="string"&&typeof n[2]!="number")&&(r=!1),r||console.warn("Invalid value of a "+this.componentType),{newValues:{validVariable:r}}}},t}},Pn=Ui;var Gi=class extends H{static componentType="_mathwithvariable";static rendererType="math";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.variable={default:void 0},e}},Jt=Gi;var Xi=class extends B{static componentType="textlist";static rendererType="aslist";static stateVariableForPropertyValue="texts";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.unordered={default:!1},e.maximumNumber={default:null},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"text",children:[{componentType:"string",state:{value:s}}]}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTextlists",componentType:"textlist",comparison:"atLeast",number:0});return e.newOperator({name:"textAndTextLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},textAndTextlistChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["nComponents"],variablesOptional:!0}}},definition:function({dependencyValues:e}){let n=0,r=[];for(let[a,s]of e.textAndTextlistChildren.entries())if(s.stateValues.nComponents!==void 0){for(let o=0;o<s.stateValues.nComponents;o++)r[n+o]=[a,o];n+=s.stateValues.nComponents}else r[n]=[a,0],n+=1;let i=e.maximumNumber;return i!==null&&n>i&&(n=i,r=r.slice(0,i)),{newValues:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},t.texts={public:!0,componentType:"text",isArray:!0,entryPrefixes:["text"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},i={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let a of e){let s=[],o="1";n.childIndexByArrayKey[a]&&(s=[n.childIndexByArrayKey[a][0]],o=n.childIndexByArrayKey[a][1]+1),r[a]={textAndTextlistChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["value","text"+o],variablesOptional:!0,childIndices:s}}}return{globalDependencies:i,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].textAndTextlistChildren[0];if(s)if(s.stateValues.value!==void 0)i[a]=s.stateValues.value;else{let o=e.childIndexByArrayKey[a][1]+1;i[a]=s.stateValues["text"+o]}}return{newValues:{texts:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[];for(let o in e.texts){if(!r[o])continue;let l=r[o].textAndTextlistChildren[0];l&&(l.stateValues.value!==void 0?s.push({setDependency:i[o].textAndTextlistChildren,desiredValue:e.texts[o],childIndex:0,variableIndex:0}):s.push({setDependency:i[o].textAndTextlistChildren,desiredValue:e.texts[o],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"texts"},t.text={public:!0,componentType:"text",returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:e})=>({newValues:{text:e.texts.join(", ")}})},t.childrenToRender={returnDependencies:()=>({textAndTextlistChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=[];for(let a of e.textAndTextlistChildren)n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"textlist"})?r.push(...a.stateValues.childrenToRender):r.push(a.componentName);let i=e.maximumNumber;return i!==null&&r.length>i&&(i=Math.max(0,Math.floor(i)),r=r.slice(0,i)),{newValues:{childrenToRender:r}}}},t}},Yt=Xi;import"../_snowpack/pkg/math-expressions.js";var Zi=class extends B{static componentType="numberlist";static rendererType="aslist";static stateVariableForPropertyValue="numbers";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.unordered={default:!1},e.maximumNumber={default:void 0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"number",children:[{componentType:"string",state:{value:s}}]}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroNumbers",componentType:"number",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroNumberlists",componentType:"numberlist",comparison:"atLeast",number:0});return e.newOperator({name:"numberAndNumberLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies:()=>({maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},numberAndNumberlistChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",variableNames:["nComponents"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=0,r=[];for(let[a,s]of e.numberAndNumberlistChildren.entries())if(s.stateValues.nComponents!==void 0){for(let o=0;o<s.stateValues.nComponents;o++)r[n+o]=[a,o];n+=s.stateValues.nComponents}else r[n]=[a,0],n+=1;let i=e.maximumNumber;return i!==null&&n>i&&(n=i,r=r.slice(0,i)),{newValues:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},t.numbers={public:!0,componentType:"number",isArray:!0,entryPrefixes:["number"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},i={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let a of e){let s=[],o="1";n.childIndexByArrayKey[a]&&(s=[n.childIndexByArrayKey[a][0]],o=n.childIndexByArrayKey[a][1]+1),r[a]={numberAndNumberlistChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",variableNames:["value","number"+o],variablesOptional:!0,childIndices:s}}}return{globalDependencies:i,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].numberAndNumberlistChildren[0];if(s)if(s.stateValues.value!==void 0)i[a]=s.stateValues.value;else{let o=e.childIndexByArrayKey[a][1]+1;i[a]=s.stateValues["number"+o]}}return{newValues:{numbers:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[];for(let o in e.numbers){if(!r[o])continue;let l=r[o].numberAndNumberlistChildren[0];l&&(l.stateValues.value!==void 0?s.push({setDependency:i[o].numberAndNumberlistChildren,desiredValue:e.numbers[o],childIndex:0,variableIndex:0}):s.push({setDependency:i[o].numberAndNumberlistChildren,desiredValue:e.numbers[o],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"numbers"},t.text={public:!0,componentType:"text",additionalStateVariablesDefined:["texts"],returnDependencies:()=>({numberAndNumberlistChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e}){let n=[];for(let a of e.numberAndNumberlistChildren)a.stateValues.valueForDisplay!==void 0?n.push(a.stateValues.text):n.push(...a.stateValues.texts);let r=e.maximumNumber;return r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{newValues:{text:n.join(", "),texts:n}}}},t.childrenToRender={returnDependencies:()=>({numberAndNumberlistChildren:{dependencyType:"child",childLogicName:"numberAndNumberLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=[];for(let a of e.numberAndNumberlistChildren)n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"numberlist"})?r.push(...a.stateValues.childrenToRender):r.push(a.componentName);let i=e.maximumNumber;return i!==null&&r.length>i&&(i=Math.max(0,Math.floor(i)),r=r.slice(0,i)),{newValues:{childrenToRender:r}}}},t}},Qt=Zi;import"../_snowpack/pkg/math-expressions.js";var Ji=class extends B{static componentType="mathlist";static rendererType="aslist";static stateVariableForPropertyValue="maths";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.simplify={propagateToDescendants:!0,default:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder","none"]},e.unordered={default:!1},e.maximumNumber={default:null},e.mergeMathLists={default:!1},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"math",children:[{componentType:"string",state:{value:s}}]}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroMathlists",componentType:"mathlist",comparison:"atLeast",number:0});return e.newOperator({name:"mathAndMathLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",stateVariablesDeterminingDependencies:["mergeMathLists"],additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies({stateValues:e}){let n={maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"}};return e.mergeMathLists?n.mathAndMathlistChildren={dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["value","nComponents"],variablesOptional:!0}:n.mathAndMathlistChildren={dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["nComponents"],variablesOptional:!0},n},definition:function({dependencyValues:e}){let n=0,r=[];for(let[a,s]of e.mathAndMathlistChildren.entries())if(s.stateValues.nComponents!==void 0){for(let o=0;o<s.stateValues.nComponents;o++)r[n+o]=[a,o];n+=s.stateValues.nComponents}else if(e.mergeMathLists){let o=s.stateValues.value;if(o&&Array.isArray(o.tree)&&o.tree[0]==="list"){let l=o.tree.length-1;for(let c=0;c<l;c++)r[c+n]=[a,c];n+=l}else r[n]=[a,0],n+=1}else r[n]=[a,0],n+=1;let i=e.maximumNumber;return i!==null&&n>i&&(n=i,r=r.slice(0,i)),{newValues:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},t.maths={public:!0,componentType:"math",isArray:!0,entryPrefixes:["math"],stateVariablesDeterminingDependencies:["mergeMathLists","childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},i={mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"},childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let a of e){let s=[],o="1";n.childIndexByArrayKey[a]&&(s=[n.childIndexByArrayKey[a][0]],o=n.childIndexByArrayKey[a][1]+1),r[a]={mathAndMathlistChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["value","math"+o],variablesOptional:!0,childIndices:s}}}return{globalDependencies:i,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].mathAndMathlistChildren[0];if(s)if(s.stateValues.value!==void 0){let o=s.stateValues.value;if(e.mergeMathLists&&Array.isArray(o.tree)&&o.tree[0]==="list"){let l=e.childIndexByArrayKey[a][1];i[a]=o.get_component(l)}else i[a]=o}else{let o=e.childIndexByArrayKey[a][1]+1;i[a]=s.stateValues["math"+o]}}return{newValues:{maths:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){if(n.mergeMathLists)return console.log("Have not implemented inverse definition for math list with mergeMathLists=true"),{success:!1};let s=[];for(let o in e.maths){if(!r[o])continue;let l=r[o].mathAndMathlistChildren[0];l&&(l.stateValues.value!==void 0?s.push({setDependency:i[o].mathAndMathlistChildren,desiredValue:e.maths[o],childIndex:0,variableIndex:0}):s.push({setDependency:i[o].mathAndMathlistChildren,desiredValue:e.maths[o],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"maths"},t.latex={additionalStateVariablesDefined:["latexs"],public:!0,componentType:"text",returnDependencies:()=>({mathAndMathlistChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["valueForDisplay","latex","latexs"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"}}),definition:function({dependencyValues:e}){let n=[];for(let a of e.mathAndMathlistChildren)if(a.stateValues.valueForDisplay){let s=a.stateValues.valueForDisplay;if(e.mergeMathLists&&Array.isArray(s.tree)&&s.tree[0]==="list")for(let o=0;o<s.tree.length-1;o++)n.push(s.get_component(o).toLatex());else n.push(a.stateValues.latex)}else n.push(...a.stateValues.latexs);let r=e.maximumNumber;return r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{newValues:{latex:n.join(", "),latexs:n}}}},t.text={public:!0,componentType:"text",additionalStateVariablesDefined:["texts"],returnDependencies:()=>({mathAndMathlistChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["valueForDisplay","text","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},mergeMathLists:{dependencyType:"stateVariable",variableName:"mergeMathLists"}}),definition:function({dependencyValues:e}){let n=[];for(let a of e.mathAndMathlistChildren)if(a.stateValues.valueForDisplay){let s=a.stateValues.valueForDisplay;if(e.mergeMathLists&&Array.isArray(s.tree)&&s.tree[0]==="list")for(let o=0;o<s.tree.length-1;o++)n.push(s.get_component(o).toString());else n.push(a.stateValues.text)}else n.push(...a.stateValues.texts);let r=e.maximumNumber;return r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),{newValues:{text:n.join(", "),texts:n}}}},t.childrenToRender={returnDependencies:()=>({mathAndMathlistChildren:{dependencyType:"child",childLogicName:"mathAndMathLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=[];for(let a of e.mathAndMathlistChildren)n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"mathlist"})?r.push(...a.stateValues.childrenToRender):r.push(a.componentName);let i=e.maximumNumber;return i!==null&&r.length>i&&(i=Math.max(0,Math.floor(i)),r=r.slice(0,i)),{newValues:{childrenToRender:r}}}},t}},Ze=Ji;import"../_snowpack/pkg/math-expressions.js";var Yi=class extends k{static componentType="when";static rendererType=void 0;static stateVariableForPropertyValue="conditionSatisfied";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.matchPartial={default:!1},e.symbolicEquality={default:!1},e.expandOnCompare={default:!1,propagateToDescendants:!0},e.simplifyOnCompare={default:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],propagateToDescendants:!0},e.unorderedCompare={default:!1,propagateToDescendants:!0},e.allowedErrorInNumbers={default:0},e.includeErrorInNumberExponents={default:!1},e.allowedErrorIsAbsolute={default:!1},e.nSignErrorsMatched={default:0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={additionalStateVariablesDefined:["fractionSatisfied","conditionSatisfied"],returnDependencies:()=>({matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},stringMathTextBooleanChildren:{dependencyType:"child",childLogicName:"stringsMathsTextsAndBooleans",variableNames:["value","texts","maths","unordered"],variablesOptional:!0},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["value","expand","simplify"]},booleanChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanChildrenByCode"},booleanlistChildrenByCode:{dependencyType:"stateVariable",variableName:"booleanlistChildrenByCode"},textChildrenByCode:{dependencyType:"stateVariable",variableName:"textChildrenByCode"},textlistChildrenByCode:{dependencyType:"stateVariable",variableName:"textlistChildrenByCode"},mathChildrenByCode:{dependencyType:"stateVariable",variableName:"mathChildrenByCode"},mathlistChildrenByCode:{dependencyType:"stateVariable",variableName:"mathlistChildrenByCode"}}),definition({dependencyValues:e,usedDefault:n}){if(e.parsedExpression===null)return{newValues:{conditionSatisfied:!1,value:!1,fractionSatisfied:0}};let r=e.unorderedCompare,i=e.simplifyOnCompare,a=e.expandOnCompare,s=n.unorderedCompare,o=n.simplifyOnCompare,l=n.expandOnCompare;for(let p of e.stringMathTextBooleanChildren)s&&p.stateValues.unordered&&(r=!0);for(let p of e.mathChildren)l&&p.stateValues.expand&&(a=!0),o&&(p.stateValues.simplify==="full"?i="full":p.stateValues.simplify==="numbers"?i!=="full"&&(i="numbers"):p.stateValues.simplify==="numberspreserveorder"&&i!=="full"&&i!=="numbers"&&(i="numberspreserveorder"));let c=Rt({logicTree:e.parsedExpression.tree,unorderedCompare:r,simplifyOnCompare:i,expandOnCompare:a,dependencyValues:e}),d=c===1;return{newValues:{fractionSatisfied:c,conditionSatisfied:d,value:d}}}},t}},zl=Yi;var Qi=class extends B{static componentType="_textOrInline";static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:this.componentType,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let r of e.inlineChildren)typeof r.stateValues.text=="string"&&(n+=r.stateValues.text);return{newValues:{value:n}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:({dependencyValues:e})=>({newValues:{text:e.value}})},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}},On=Qi;import QI from"../_snowpack/pkg/math-expressions.js";var Ul=Kt(ql()),Gl=Kt(Wl()),mv=/\+/g,fv=/\//g;function kt(u,t){let e=Gl.default.stringify((0,Ul.default)(t)).slice(0,10).replace(mv,"_").replace(fv,"-");return"__"+u+"_"+e}function at(u,t){let e=1,n=u+e;for(;t.includes(n);)e+=1,n=u+e;return t.push(n),n}function en(u){let t=u.lastIndexOf("/");if(t===-1)throw Error(`Encountered name ${u} that doesn't include a slash`);return u.slice(0,t+1)}function Xl({}){return null}function Zl(u){u.length===1&&u[0].componentType==="document"&&(u=u[0].children);for(let n=u.length-1;n>=0;n--){let r=u[n];if(["title","meta"].includes(r.componentType)){let i=1,a=u[n+1];a.componentType==="string"&&a.state.value.trim()===""&&(i=2),u.splice(n,i)}}let t,e;for(let[n,r]of u.entries())(r.componentType!=="string"||r.state.value.trim()!=="")&&(t===void 0&&(t=n),e=n);return u=u.slice(t,e+1),u}function Jl(u){let e=/<\/?\w+((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[\^'">\s]+))?)+\s*|\s*)\/?>/.exec(u);if(e===null)return!1;let n=e[0];n=n.toLowerCase();let r=e.index,i=n.split(" "),a=i[0].substring(1,i[0].length-1);i.length>1&&(a=i[0].substring(1,i[0].length)),a.substring(a.length-1,a.length)==="/"&&(a=a.substring(0,a.length-1));let s=e[1];s=s.trim();let o={},l=/\w+\s*=\s*["]/;for(e="not null";e!==null;)if(e=l.exec(s),e!==null){let d=s.substring(e.index+e[0].length-1,s.length),m=/"[^"\\]*(?:\\.[^"\\]*)*"/.exec(d),f=m[0].substring(1,m[0].length-1),y=e[0].split("=")[0].trim();if(y.substring(0,1)==="_")throw Error("The prop "+y+" is reserved for internal use only.");if(f=f.replace(/\\"/g,'"'),y in o)throw Error("Duplicate property "+y+" in tag "+a);o[y]=f,s=s.substring(0,e.index)+s.substring(e.index+e[0].length+m[0].length,s.length)}let c=/\w+\s*=\s*[']/;for(e="not null";e!==null;)if(e=c.exec(s),e!==null){let d=s.substring(e.index+e[0].length-1,s.length),m=/'[^'\\]*(?:\\.[^'\\]*)*'/.exec(d),f=m[0].substring(1,m[0].length-1),y=e[0].split("=")[0].trim();if(y.substring(0,1)==="_")throw Error("The prop "+y+" is reserved for internal use only.");if(f=f.replace(/\\'/g,"'"),y in o)throw Error("Duplicate property "+y+" in tag "+a);o[y]=f,s=s.substring(0,e.index)+s.substring(e.index+e[0].length+m[0].length,s.length)}if(/\S/.test(s)){let d=s.split(" ");for(let p of d)/\S/.test(p)&&(o[p]=!0)}return{tagString:n,tagType:a,tagIndex:r,tagProps:o}}function gr({doenetML:u,includeBlankStrings:t=!0,propertyClasses:e={},standardComponentClasses:n,allComponentClasses:r,init:i=!0}){if(u===void 0)return[];if(i){let l=u.search("<!--");for(;l!==-1;){let c=u.search("-->");c===-1?c=u.length:c=c+3,u=u.substring(0,l)+u.substring(c,u.length),l=u.search("<!--")}}let a=[],s="",o="";for(;u.length>0;){let l=Jl(u);if(l===!1)return(/\S/.test(u)||t&&u.length>0)&&a.push({componentType:"string",state:{value:u}}),a;if(!(l.tagType in n)||l.tagType==="string")throw Error("Tag "+l.tagType+" is not defined.");if(l.tagString.substring(l.tagString.length-2,l.tagString.length-1)==="/")s=u.substring(0,l.tagIndex),o="",u=u.substring(l.tagIndex+l.tagString.length,u.length);else{let y=1,b=0,g=JSON.parse(JSON.stringify(l)),T=0,N="";for(;y>b;){if(T=Number(T)+Number(g.tagString.length)+Number(g.tagIndex),N=u.substring(T,u.length),g=Jl(N),g===!1)throw Error("No matching </"+l.tagType+"> end tag");g.tagType===l.tagType&&y++,g.tagType==="/"+l.tagType&&b++}s=u.substring(0,l.tagIndex);let v=Number(l.tagIndex)+Number(l.tagString.length),C=Number(T)+Number(g.tagIndex);o=u.substring(v,C),u=u.substring(Number(C)+Number(g.tagString.length),u.length)}if(/\S/.test(s))a.push({componentType:"string",state:{value:s}});else if(t&&s.length>0){let y=!0,b=n[l.tagType];for(let g in e){if(e[g])continue;let T=r[g];T!==void 0&&(l.tagType===g||T.isPrototypeOf(b))&&(e[g]=!0,y=!1)}y&&a.push({componentType:"string",state:{value:s}})}let d=[],p=n[l.tagType],m=p.includeBlankStringChildren===!0,f=Object.keys(p.createPropertiesObject({standardComponentClasses:n})).map(y=>y.toLowerCase()),h={};if(f.forEach(y=>h[y]=!1),(/\S/.test(o)||m&&o.length>0)&&(d=gr({doenetML:o,includeBlankStrings:m,propertyClasses:h,standardComponentClasses:n,allComponentClasses:r,init:!1})),a.push({componentType:l.tagType,children:d,props:l.tagProps}),!/\S/.test(u)){if(t&&u.length>0&&a.push({componentType:"string",state:{value:u}}),i){let y,b;for(let[g,T]of a.entries())(T.componentType!=="string"||T.state.value.trim()!=="")&&(y===void 0&&(y=g),b=g);a=a.slice(y,b+1)}return a}}return a}function ea({serializedComponents:u}){let t={};for(let e of u)if(e.componentType==="ref"){if(e.children!==void 0){let n;for(let r of e.children)if(r.componentType==="contentid"){n=r;break}if(n){let r;if(n.state!==void 0&&(r=n.state.value),n.children!==void 0){for(let i of n.children)if(i.componentType==="string"){r=i.state.value;break}}r!==void 0&&(t[r]===void 0&&(t[r]=[]),t[r].push(e))}}}else if(e.children!==void 0){let n=ea({serializedComponents:e.children});for(let r in n)t[r]===void 0&&(t[r]=[]),t[r].push(...n[r])}return t}function Yl(u){if(u.length!==1||u[0].componentType!=="document"){let t=u.splice(0);u.push({componentType:"document",children:t})}}function tn(u,t){for(let e of u){let n=[];if(e.props){for(let r in e.props){let i=r.toLowerCase();if(t[i]!==void 0){let a;e.props[r]===!0?a={componentType:i,doenetAttributes:{isPropertyChild:!0},state:{implicitValue:!0}}:a={componentType:i,doenetAttributes:{isPropertyChild:!0},children:[{componentType:"string",state:{value:e.props[r]}}]},n.push(a),delete e.props[r]}else if(!["name","assignnames","newnamespace","tname","prop","type","alias","indexalias"].includes(i))throw Error("Invalid attribute: "+r)}e.children.unshift(...n)}e.children!==void 0&&tn(e.children,t)}}function Ql(u){let t=[];for(let e of u)if(e.preSugarInd!==void 0)t.push(e.preSugarInd);else if(e.doenetAttributes||(e.doenetAttributes={}),e.doenetAttributes.createdFromSugar=!0,e.children){let n=Ql(e.children);t.push(...n)}return t}function Rn(u,t){return u.forEach(e=>{e.children&&(e.children=Rn(e.children,t))}),u=hv(u,t),u}function hv(u,t){for(let e=0;e<u.length;e++){let n=u[e];if(n.componentType==="string"){let r=n.state.value,i=eu(r);if(i.success){let a=i.firstIndMatched,s=i.matchLength,o=i.nDollarSigns,l;if(i.additionalAttributes){let m=`<copy tname="${i.targetName}" ${i.additionalAttributes} />`,f=gr({doenetML:m,standardComponentClasses:t.standardComponentClasses,allComponentClasses:t.allComponentClasses});tn(f,t.standardComponentClasses),tu(f),f=Rn(f,t),l=f}else{let m={tName:i.targetName,createdFromMacro:!0};i.additionalAttributes===void 0&&(m.isPlainMacro=!0),l=[{componentType:"copy",doenetAttributes:m}]}let c=1,d=r.substring(a+s);if(o===2){let m=r.slice(a+s).match(/^\s*\(/);if(!m)continue;let f=s+m[0].length,h=[],y=!1;r.length>a+f&&(y=!0,h.push({componentType:"string",state:{value:r.substring(a+f)}})),h.push(...u.slice(e+1));let b=yv({componentsFromMacro:l,remainingComponents:h,includeFirstInRemaining:y,componentInfoObjects:t});if(!b.success)continue;l=b.componentsFromMacro,c=b.lastComponentIndMatched+1,y||c++,d=""}let p=[];a>0&&p.push({componentType:"string",state:{value:r.substring(0,a)}}),p.push(...l),d.length>0&&p.push({componentType:"string",state:{value:d}}),u.splice(e,c,...p),a>0&&e++}}}return u}function eu(u){let t=/(\$\$?)(([a-zA-Z_]\w*\b)|\(([a-zA-Z0-9_:.\/\-]+)\s*(\)|{))/,e=0,n;for(;;){if(n=u.substring(e).match(t),!n)return{success:!1};if(n.index===0||u[e+n.index-1]!=="$")break;e+=n.index+n[0].length}let r=n.index+e,i=n[0].length,a=n[1].length;if(n[3])return{success:!0,firstIndMatched:r,matchLength:i,targetName:n[3],nDollarSigns:a};let s=n[4];if(n[5]===")")return{success:!0,firstIndMatched:r,matchLength:i,targetName:s,nDollarSigns:a};let o=u.substring(r+i),l=bv(o);if(l.success)return{success:!0,firstIndMatched:r,matchLength:i+l.parenInd+1,targetName:s,nDollarSigns:a,additionalAttributes:o.substring(0,l.braceInd)};{let c=eu(o);return c.success?{success:!0,firstIndMatched:r+i+c.firstIndMatched,matchLength:c.matchLength,targetName:c.targetName,nDollarSigns:c.nDollarSigns,additionalAttributes:c.additionalAttributes}:{success:!1}}}function bv(u){let t=0;for(let e=0;e<u.length;e++){let n=u[e];if(n==="}"){if(t===0){if(u.substring(e+1).trim()[0]===")"){let r=u.substring(e+1).indexOf(")")+e+1;return{success:!0,braceInd:e,parenInd:r}}return{success:!1}}t--}else n==="{"&&t++}return{success:!1}}function tu(u){for(let t of u)t.doenetAttributes||(t.doenetAttributes={}),t.doenetAttributes.createdFromMacro=!0,t.children&&tu(t.children)}function yv({componentsFromMacro:u,remainingComponents:t,includeFirstInRemaining:e,componentInfoObjects:n}){let r=gv(t);if(r.success){let i=r.componentInd;t=t.slice(0,i+1);let a=t[i],s="";r.charInd+1<a.state.value.length&&(s=a.state.value.substring(r.charInd+1)),r.charInd>0?a.state.value=a.state.value.substring(0,r.charInd):t=t.slice(0,i);let c=Gt({childrenList:t}).pieces.map(m=>Rn(m,n)).map(m=>({componentType:"math",doenetAttributes:{createdFromMacro:!0},children:m})),p=[{componentType:"evaluate",doenetAttributes:{createdFromMacro:!0},children:[...u,{componentType:"input",doenetAttributes:{createdFromMacro:!0},children:c}]}];return s.length>0&&p.push({componentType:"string",state:{value:s}}),{success:!0,componentsFromMacro:p,lastComponentIndMatched:i}}}function gv(u){let t=0;for(let[e,n]of u.entries())if(n.componentType==="string"){let r=n.state.value;for(let i=0;i<r.length;i++){let a=r[i];if(a==="(")t++;else if(a===")"){if(t===0)return{success:!0,componentInd:e,charInd:i};t--}}}return{success:!1}}function ta(u){for(let t of u)t.componentType==="string"?t.state.value=t.state.value.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&dollar;/g,"$").replace(/&amp;/g,"&"):t.children&&ta(t.children)}function na({serializedComponents:u,parentParametersFromSugar:t={},parentProps:e={},componentInfoObjects:n,parentUniqueId:r=""}){for(let[i,a]of u.entries())if(a.children){let s=a.componentType.toLowerCase(),o=n.allComponentClasses[s],l=r+"|"+s+i,c={},d={};if(a.props)for(let p in a.props){let m=p.toLowerCase();m==="newnamespace"?a.props[p]===!0||a.props[p].trim().toLowerCase()==="true"?d[m]=!0:d[m]=!1:d[m]=a.props[p]}d=new Proxy(d,K);for(let[p,m]of o.returnSugarInstructions().entries()){let f=a.children.filter(N=>!(N.doenetAttributes&&N.doenetAttributes.isPropertyChild));if(f.length===0)break;let h=a.children.indexOf(f[0]),y=f.map(N=>N.componentType==="string"?"s":"n").join("");if(m.childrenRegex){let N=y.match(m.childrenRegex);if(!N||N[0].length!==f.length)continue}let b=Z(f),g=0;for(let N of b)N.componentType!=="string"&&(N.preSugarInd=g,g++);let T=m.replacementFunction({matchedChildren:b,parentParametersFromSugar:t,parentProps:e,componentProps:d,uniqueId:l+"|sugar"+p,componentInfoObjects:n});if(T.success){let N=T.newChildren,v=Ql(N);v.length!==g||!v.every((C,x)=>C===x)?console.error(`Invalid sugar for ${s} as didn't return original components in order`):(a.children.splice(h,f.length,...N),T.parametersForChildrenSugar&&Object.assign(c,T.parametersForChildrenSugar))}}na({serializedComponents:a.children,parentParametersFromSugar:c,parentProps:d,componentInfoObjects:n,parentUniqueId:l})}}function nu(u){let t=0,e=[];u=u.trim();let n=0;for(let i=0;i<u.length;i++){let a=u[i];if(a==="("){if(t===0){let s=u.substring(n,i).trim();s.length>0&&e.push(s),n=i}t++}else if(a===")"){if(t===0)return{success:!1};if(t===1){let s=u.substring(n+1,i).trim();if(s.length>0){let o=nu(s);o.success===!0?e.push(o.pieces):e.push(s)}n=i+1}t--}else if(t===0&&a.match(/\s/)){let s=u.substring(n,i).trim();s.length>0&&e.push(s),n=i}}if(t!==0)return{success:!1};let r=u.substring(n,u.length).trim();return r.length>0&&e.push(r),{success:!0,pieces:e}}function xt({serializedComponents:u,namespaceStack:t=[],componentInfoObjects:e,nameSpaceForChildren:n,parentDoenetAttributes:r={},parentName:i,useOriginalNames:a=!1,doenetAttributesByFullTName:s,indOffset:o=0}){t.length===0&&t.push({namespace:"",componentCounts:{},namesUsed:{}});let l=t.length-1,c=t[l];for(let[d,p]of u.entries()){let m=p.componentType.toLowerCase(),f=e.allComponentClasses[m],h=p.doenetAttributes;h===void 0&&(h=p.doenetAttributes={});let y=h.prescribedName,b=h.assignNames,g=h.newNamespace,T=h.tName,N=h.propName,v=h.type,C=h.alias,x=h.indexAlias,V=m==="string"||h.isPropertyChild||h.createdFromSugar||h.createdFromMacro||h.createUniqueName;!g&&a&&p.originalDoenetAttributes&&p.originalDoenetAttributes.newNamespace&&(g=!0);let w=y!==void 0,D=p.props;if(D===void 0)D=p.props={};else for(let S in D){let O=S.toLowerCase();if(O==="name")if(y===void 0)y=D[S],delete D[S];else throw Error("Cannot define name twice for a component");else if(O==="assignnames")if(b===void 0){let P=nu(D[S]);if(P.success)b=P.pieces;else throw Error("Invalid format for assignnames");delete D[S]}else throw Error("Cannot define assignNames twice for a component");else if(O==="newnamespace")if(g===void 0)D[S]===!0||D[S].trim().toLowerCase()==="true"?g=!0:g=!1,delete D[S];else throw Error("Cannot define newNamespace twice for a component");else if(O==="tname")if(T===void 0)T=D[S],delete D[S];else throw Error("Cannot define tName twice for a component");else if(O==="prop")if(N===void 0)N=D[S],delete D[S];else throw Error("Cannot define prop twice for a component");else if(O==="type")if(v===void 0)v=D[S].toLowerCase(),delete D[S];else throw Error("Cannot define type twice for a component");else if(O==="alias")if(C===void 0)C=D[S],delete D[S];else throw Error("Cannot define alias twice for a component");else if(O==="indexalias")if(x===void 0)x=D[S],delete D[S];else throw Error("Cannot define indexAlias twice for a component")}if(y){if(!w&&!h.createdFromSugar){if(!/[a-zA-Z]/.test(y.substring(0,1)))throw Error("Component name must begin with a letter");if(!/^[a-zA-Z0-9_:.\-]+$/.test(y))throw Error("Component name can contain only letters, numbers, hyphens, underscores, colons and periods")}h.prescribedName=y}else if(V){let S=i+"|createUniqueName|";p.downstreamDependencies?S+=JSON.stringify(p.downstreamDependencies):S+=d+"|"+o,y=kt(m,S)}if(!b&&a&&p.originalDoenetAttributes&&p.originalDoenetAttributes.assignNames&&(b=p.originalDoenetAttributes.assignNames),b){if(!f.assignNamesToReplacements)throw Error("Cannot assign names for component type "+p.componentType);h.assignNames=b;let O=ne(b);for(let P of O){if(!/[a-zA-Z]/.test(P.substring(0,1)))throw Error("All assigned names must begin with a letter");if(!/^[a-zA-Z0-9_-]+$/.test(P))throw Error("Assigned names can contain only letters, numbers, hyphens, and underscores")}if(O.length!==new Set(O).size)throw Error("Duplicate assigned names")}g&&(h.newNamespace=g);let I=c.componentCounts[m];I===void 0&&(I=0),h.isPropertyChild||h.createdFromSugar||h.createdFromMacro||(c.componentCounts[m]=++I);let A="";for(let S=0;S<=l;S++)A+=t[S].namespace+"/";if(!y){if(a&&p.originalName){let S=p.originalName.lastIndexOf("/");y=p.originalName.substring(S+1)}y||(y="_"+m+I)}if(A+=y,p.componentName=A,y){if(y in c.namesUsed)throw Error("Duplicate component name "+A);c.namesUsed[y]=!0}if(!g&&b)for(let S of ne(b)){if(S in c.namesUsed)throw Error(`Duplicate component name (from assignNames of ${A}): ${S}`);c.namesUsed[S]=!0}if(p.doenetAttributes.createUniqueAssignNames&&p.originalName){let S=p.doenetAttributes.assignNames=[],O=A+"|createUniqueName|assignNames|",P="",L;if(g)P=A+"/",L=p.originalName+"/";else{for(let M=0;M<=l;M++)P+=t[M].namespace+"/";let F=p.originalName.lastIndexOf("/");L=p.originalName.slice(0,F+1)}for(let[F,M]of p.doenetAttributes.originalAssignNames.entries()){let _=O+F,j=kt("fromAssignNames",_);S.push(j);let q={componentName:P+j,originalName:L+M};ru(q,s)}}if(ru(p,s),T){if(!f.acceptTname)throw Error(`Component type ${m} does not accept a tname property`);h.tName=T,h.fullTName=vv({tName:T,oldFullTName:h.fullTName,namespaceStack:t,acceptDoubleUnderscore:h.createdFromSugar})}if(N){if(!f.acceptProp)throw Error(`Component type ${m} does not accept a prop property`);h.propName=N}if(v){if(!f.acceptType)throw Error(`Component type ${m} does not accept a type property`);h.type=v}else f.acceptType&&f.defaultType&&(h.type=f.defaultType);if(C){if(!f.acceptAlias)throw Error("Cannot specify alias for component type "+p.componentType);if(h.alias=C,!/[a-zA-Z_]/.test(C.substring(0,1)))throw Error("All aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_-]+$/.test(C))throw Error("Aliases can contain only letters, numbers, hyphens, and underscores")}if(x){if(!f.acceptIndexAlias)throw Error("Cannot specify index alias for component type "+p.componentType);if(h.indexAlias=x,!/[a-zA-Z_]/.test(x.substring(0,1)))throw Error("All index aliases must begin with a letter or an underscore");if(!/^[a-zA-Z0-9_-]+$/.test(x))throw Error("Index aliases can contain only letters, numbers, hyphens, and underscores")}if(p.children!==void 0)if(n)t.push({namespace:n,componentCounts:{},namesUsed:{}}),xt({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:e,parentDoenetAttributes:h,parentName:A,useOriginalNames:a,doenetAttributesByFullTName:s}),t.pop();else if(!g)xt({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:e,parentDoenetAttributes:h,parentName:A,useOriginalNames:a,doenetAttributesByFullTName:s});else{let S={};b&&ne(b).forEach(P=>S[P]=!0);let O={namespace:y,componentCounts:{},namesUsed:S};t.push(O),xt({serializedComponents:p.children,namespaceStack:t,componentInfoObjects:e,parentDoenetAttributes:h,parentName:A,useOriginalNames:a,doenetAttributesByFullTName:s}),t.pop()}}return u}function vv({tName:u,oldFullTName:t,namespaceStack:e,acceptDoubleUnderscore:n}){if(!t&&/__/.test(u)&&!n)throw Error("Invalid reference target: "+u);let r=u,i;if(r.substring(0,1)==="/")i=r;else{let a=e.length-1;for(;r.substring(0,3)==="../";)r=r.substring(3),a--;if(a<0)throw Error("Target "+u+" not found");i="";for(let s=0;s<=a;s++)i+=e[s].namespace+"/";i+=r}return i}function Fn({serializedComponents:u,componentTypesCreatingVariants:t,allComponentClasses:e}){let n=[];for(let r of u)if(r.componentType in t&&(r.variants===void 0&&(r.variants={}),r.variants.isVariantComponent=!0,n.push(r)),r.children!==void 0){let a=Fn({serializedComponents:r.children,componentTypesCreatingVariants:t,allComponentClasses:e});if(a.length>0){r.variants===void 0&&(r.variants={});let s,o;for(let[l,c]of a.entries())if(c.componentType==="variantcontrol"){s=l,o=c;break}if(s!==void 0&&(r.variants.isVariantComponent||(r.variants.isVariantComponent=!0,n.push(r)),a.splice(s,1)),r.variants.descendantVariantComponents=a,r.variants.isVariantComponent||n.push(...a),o!==void 0){let l=!1;if(o.state!==void 0&&o.state.uniquevariants!==void 0&&(l=o.state.uniquevariants),o.children!==void 0){for(let c of o.children)if(c.componentType==="uniquevariants"&&(c.state!==void 0&&(c.state.implicitValue!==void 0&&(l=c.state.implicitValue),c.state.value!==void 0&&(l=c.state.value)),c.children!==void 0)){for(let d of c.children)if(d.componentType==="string"){l=d.state.value;break}}}typeof l=="string"&&(l.trim().toLowerCase()==="true"?l=!0:l=!1),l&&(r.variants.uniquevariants=!0,iu({serializedComponent:r,allComponentClasses:e}))}}}return n}function iu({serializedComponent:u,allComponentClasses:t}){let e=1;if(u.children!==void 0){for(let i of u.children)if(i.variants!==void 0&&(i.variants.isVariantComponent||i.variants.descendantVariantComponents!==void 0)){let a=iu({serializedComponent:i,allComponentClasses:t});if(!a.success)return{success:!1};e*=a.numberOfVariants}}let n;u.variants===void 0&&(u.variants={});let r=t[u.componentType];if(r.determineNumberOfUniqueVariants!==void 0){let i=r.determineNumberOfUniqueVariants({serializedComponent:u});if(!i.success)return{success:!1};n=i.numberOfVariants,u.variants.uniqueVariantData=i.uniqueVariantData}return n===void 0&&(n=e),u.variants.numberOfVariants=n,{success:!0,numberOfVariants:n}}function U({assignNames:u=[],serializedComponents:t,parentName:e,parentCreatesNewNamespace:n,componentInfoObjects:r,indOffset:i=0,originalNamesAreConsistent:a=!1}){let s=t.length;au(t);let o={},l=null;if(a){if(s>0&&t[0].originalName){let d=t[0].originalName.lastIndexOf("/");l=t[0].originalName.substring(0,d)}if(l!==null)for(let d of t)ra({namespace:l,components:[d],doenetAttributesByFullTName:o})}else for(let d=0;d<s;d++){let p=t[d];if(l=null,s>0&&p.originalName){let m=p.originalName.lastIndexOf("/");l=p.originalName.substring(0,m)}l!==null&&ra({namespace:l,components:[p],doenetAttributesByFullTName:o})}let c=[];for(let d=0;d<s;d++){let p=d+i,m=u[p],f=t[d];if(f.doenetAttributes||(f.doenetAttributes={}),!a&&(l=null,s>0&&f.originalName)){let h=f.originalName.lastIndexOf("/");l=f.originalName.substring(0,h)}if(Array.isArray(m))if(r.allComponentClasses[f.componentType].assignNamesToReplacements){let h=e+"|assignName|"+p.toString();f.doenetAttributes.prescribedName=kt(f.componentType,h);let y=e;if(!n){let b=e.lastIndexOf("/");y=e.substring(0,b)}y+="/"+f.doenetAttributes.prescribedName,f.componentName=y,f.doenetAttributes.assignNames=m,c.push(f);continue}else console.warn(`Cannot assign names recursively to ${f.componentType}`),m=null;if(!m)if(a&&f.originalName)m=f.originalName.slice(l.length+1);else{let h=e+"|assignName|"+p.toString();m=kt(f.componentType,h)}f.doenetAttributes.prescribedName=m,a&&!f.doenetAttributes.assignNames&&f.originalDoenetAttributes&&f.originalDoenetAttributes.assignNames&&(f.doenetAttributes.assignNames=f.originalDoenetAttributes.assignNames),Cv({parentName:e,ind:p,component:f,parentCreatesNewNamespace:n,componentInfoObjects:r,doenetAttributesByFullTName:o,originalNamesAreConsistent:a}),c.push(f)}return{serializedComponents:c}}function Cv({parentName:u,component:t,ind:e,parentCreatesNewNamespace:n,componentInfoObjects:r,doenetAttributesByFullTName:i,originalNamesAreConsistent:a}){let s=u.split("/");n||s.pop();let o=s.map(c=>({namespace:c,componentCounts:{},namesUsed:{}}));u[0]!=="/"&&o.splice(0,0,{componentCounts:{},namesUsed:{},namespace:""}),t.doenetAttributes||(t.doenetAttributes={});let l;t.doenetAttributes.newNamespace||a?l=!0:(l=!1,t.children&&su(t.children)),xt({serializedComponents:[t],namespaceStack:o,componentInfoObjects:r,parentName:u,useOriginalNames:l,doenetAttributesByFullTName:i,indOffset:e})}function ra({namespace:u,components:t,doenetAttributesByFullTName:e}){let n=u.length;for(let r of t){if(r.doenetAttributes&&r.doenetAttributes.tName){let i=r.doenetAttributes.fullTName;i.substring(0,n)!==u&&(r.doenetAttributes.tName=i),e[i]||(e[i]=[]),e[i].push(r.doenetAttributes)}r.children&&ra({namespace:u,components:r.children,doenetAttributesByFullTName:e})}}function ru(u,t){if(u.originalName&&t&&t[u.originalName]&&u.componentName!==u.originalName)for(let e of t[u.originalName])e.tName=u.componentName,e.fullTName=u.componentName}function au(u){for(let t of u)t.componentName&&(t.originalName=t.componentName,delete t.componentName),t.children&&au(t.children)}function su(u){for(let t of u)t.doenetAttributes||(t.doenetAttributes={}),t.doenetAttributes.createUniqueName=!0,t.doenetAttributes.assignNames&&(t.doenetAttributes.createUniqueAssignNames=!0,t.doenetAttributes.originalAssignNames=t.doenetAttributes.assignNames,delete t.doenetAttributes.assignNames),delete t.doenetAttributes.prescribedName,t.children&&su(t.children)}var ia=class extends R{constructor(t){super(t);this.replacementsWorkspace={}}static componentType="_composite";static rendererType=void 0;static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.replacements={returnDependencies:()=>({replacements:{dependencyType:"replacement"}}),definition:({dependencyValues:e})=>({newValues:{replacements:e.replacements}})},t.recursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0}}),definition:({dependencyValues:e})=>({newValues:{recursiveReplacements:e.recursiveReplacements}})},t.fullRecursiveReplacements={returnDependencies:()=>({recursiveReplacements:{dependencyType:"replacement",recursive:!0,recurseNonStandardComposites:!0}}),definition:({dependencyValues:e})=>({newValues:{fullRecursiveReplacements:e.recursiveReplacements}})},t}static createSerializedReplacements(){return{replacements:[]}}static calculateReplacementChanges(){return[]}get allPotentialRendererTypes(){let t=[];if(this.replacements)for(let e of this.replacements)for(let n of e.allPotentialRendererTypes)t.includes(n)||t.push(n);return t}},G=ia;var aa=class extends G{static componentType="template";static treatAsComponentForRecursiveReplacements=!0;static includeBlankStringChildren=!0;static keepChildrenSerialized({serializedComponent:t,componentInfoObjects:e}){if(t.children===void 0)return[];let n=[];for(let i in this.createPropertiesObject({})){let a=i.toLowerCase();n.push({componentType:a,class:e.allComponentClasses[a]})}let r=[];for(let[i,a]of t.children.entries()){let s=!1;for(let o of n)if(e.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:o.componentType})&&!o.propFound){s=o.propFound=!0;break}s||r.push(i)}return r}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.rendered={default:!1},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.serializedChildren={returnDependencies:()=>({serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:e}){return{newValues:{serializedChildren:e.serializedChildren}}}},t.newNamespace={returnDependencies:()=>({newNamespace:{dependencyType:"doenetAttribute",attributeName:"newNamespace"}}),definition({dependencyValues:e}){return{newValues:{newNamespace:e.newNamespace}}}},t.readyToExpand={returnDependencies:()=>({}),definition:function(){return{newValues:{readyToExpand:!0}}}},t}static createSerializedReplacements({component:t}){return t.stateValues.rendered?{replacements:Z(t.state.serializedChildren.value)}:{replacements:[]}}get allPotentialRendererTypes(){return this.potentialRendererTypesFromSerializedComponents(this.stateValues.serializedChildren)}},vr=aa;var sa=class extends vr{static componentType="option";static includeBlankStringChildren=!1;static assignNamesToReplacements=!0;static originalNamesAreConsistent=!0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.selectForVariants={default:[]},e.selectWeight={default:1},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this;return t.serializedChildren={returnDependencies:()=>({serializedChildren:{dependencyType:"serializedChildren",doNotProxy:!0}}),definition:function({dependencyValues:n}){let r=Z(n.serializedChildren).filter(i=>i.componentType!=="string");return r.length!==n.serializedChildren.length&&console.warn(`String child of ${e.componentType} ignored.`),{newValues:{serializedChildren:r}}}},t}static createSerializedReplacements({component:t,componentInfoObjects:e}){if(t.stateValues.rendered){let n=Z(t.state.serializedChildren.value);if(t.stateValues.hide)for(let i of n)i.state||(i.state={}),i.state.hide=!0;return{replacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:n,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:e,originalNamesAreConsistent:t.doenetAttributes.newNamespace||!t.doenetAttributes.assignNames}).serializedComponents}}else return{replacements:[]}}},Mt=sa;var oa=class extends R{static componentType="variants";static rendererType=void 0;static stateVariableForPropertyValue="variants";static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"variant",state:{value:s}}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroVariants",componentType:"variant",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVariants={public:!0,componentType:"number",returnDependencies:()=>({variantChildren:{dependencyType:"child",childLogicName:"atLeastZeroVariants"}}),definition:function({dependencyValues:e}){return{newValues:{nVariants:e.variantChildren.length}}}},t.variants={public:!0,componentType:"variant",isArray:!0,entryPrefixes:["variant"],returnArraySizeDependencies:()=>({nVariants:{dependencyType:"stateVariable",variableName:"nVariants"}}),returnArraySize({dependencyValues:e}){return[e.nVariants]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={variantChild:{dependencyType:"child",childLogicName:"atLeastZeroVariants",variableNames:["value"],childIndices:[r]}};return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)e[i].variantChild.length===1&&(r[i]=e[i].variantChild[0].stateValues.value.toLowerCase());return{newValues:{variants:r}}}},t}},Cr=oa;var ou=class extends k{static componentType="hide";static rendererType="boolean"},lu=class extends k{static componentType="disabled";static rendererType="boolean"},uu=class extends k{static componentType="draggable";static rendererType="boolean"},cu=class extends k{static componentType="modifyIndirectly";static rendererType="boolean"},du=class extends k{static componentType="fixed";static rendererType="boolean"},pu=class extends z{static componentType="label";static rendererType="text"},mu=class extends ye{static componentType="childnumber";static rendererType="number"},fu=class extends k{static componentType="includeUndefinedObjects";static rendererType="boolean"},hu=class extends z{static componentType="prefill";static rendererType="text"},yu=class extends z{static componentType="format";static rendererType="text"},bu=class extends ${static componentType="credit";static rendererType="number"},gu=class extends ${static componentType="weight";static rendererType="number"},vu=class extends ${static componentType="possiblepoints";static rendererType="number"},Cu=class extends Xt{static componentType="through"},Tu=class extends Ze{static componentType="throughSlopes"},Nu=class extends Xt{static componentType="endpoints"},xu=class extends Xt{static componentType="vertices"},Vu=class extends Nt{static componentType="head";static rendererType="point"},wu=class extends Nt{static componentType="tail";static rendererType="point"},Du=class extends fr{static componentType="displacement";static rendererType="vector"},Au=class extends Nt{static componentType="center";static rendererType="point"},Su=class extends H{static componentType="radius";static rendererType="math"},Iu=class extends ${static componentType="xmin";static rendererType="number"},Pu=class extends ${static componentType="xmax";static rendererType="number"},Ou=class extends ${static componentType="ymin";static rendererType="number"},Lu=class extends ${static componentType="ymax";static rendererType="number"},Ru=class extends ${static componentType="dx";static rendererType="number"},Fu=class extends ${static componentType="dy";static rendererType="number"},ku=class extends ${static componentType="dz";static rendererType="number"},Mu=class extends ${static componentType="xoffset";static rendererType="number"},_u=class extends ${static componentType="yoffset";static rendererType="number"},Bu=class extends ${static componentType="zoffset";static rendererType="number"},Eu=class extends ${static componentType="xthreshold";static rendererType="number"},$u=class extends ${static componentType="ythreshold";static rendererType="number"},zu=class extends ${static componentType="zthreshold";static rendererType="number"},ju=class extends ${static componentType="threshold";static rendererType="number"},Hu=class extends k{static componentType="includegridlines";static rendererType="boolean"},qu=class extends k{static componentType="showcontrols";static rendererType="boolean"},Ku=class extends k{static componentType="showticks";static rendererType="boolean"},Wu=class extends Ft{static componentType="from"},Uu=class extends Ft{static componentType="to"},Gu=class extends Sn{static componentType="exclude"},Xu=class extends Sn{static componentType="excludecombination"},Zu=class extends dr{static componentType="excludecombinations";static componentTypeSingular="excludecombination"},Ju=class extends H{static componentType="step";static rendererType="math"},Yu=class extends ye{static componentType="minnumrows";static rendererType="number"},Qu=class extends ye{static componentType="minnumcolumns";static rendererType="number"},ec=class extends z{static componentType="rownum";static rendererType="text"},tc=class extends z{static componentType="colnum";static rendererType="text"},nc=class extends z{static componentType="defaulttype";static rendererType="text"},rc=class extends z{static componentType="behavior";static rendererType="text"},ic=class extends In{static componentType="width"},ac=class extends In{static componentType="height"},sc=class extends z{static componentType="columns";static rendererType="text"},oc=class extends ${static componentType="depth";static rendererType="number"},lc=class extends ${static rendererType="number";static componentType="initialnumber"},uc=class extends z{static componentType="initialtext";static rendererType="text"},cc=class extends Pn{static componentType="parameter";static rendererType="math"},dc=class extends H{static componentType="parmin";static rendererType="math"},pc=class extends H{static componentType="parmax";static rendererType="math"},mc=class extends H{static componentType="formula";static rendererType="math"},fc=class extends k{static componentType="flipfunction";static rendererType="boolean"},hc=class extends ${static componentType="splinetension";static rendererType="number"},yc=class extends z{static componentType="splineform";static rendererType="text"},bc=class extends mr{static componentType="angles"},gc=class extends ${static componentType="pointnumber";static rendererType="number"},vc=class extends z{static componentType="direction";static rendererType="text"},Cc=class extends H{static componentType="location";static rendererType="math"},Tc=class extends H{static componentType="value";static rendererType="math"},Nc=class extends ${static componentType="xscale";static rendererType="number"},xc=class extends ${static componentType="yscale";static rendererType="number"},Vc=class extends k{static componentType="extrapolatebackward";static rendererType="boolean"},wc=class extends k{static componentType="extrapolateforward";static rendererType="boolean"},Dc=class extends z{static componentType="simplify";static rendererType="text"},Ac=class extends z{static componentType="simplifyOnCompare";static rendererType="text"},Sc=class extends z{static componentType="variablename";static rendererType="text"},Ic=class extends z{static componentType="authorprop";static rendererType="text"},Pc=class extends ${static componentType="index";static rendererType="number"},Oc=class extends k{static componentType="aggregatescores";static rendererType="boolean"},Lc=class extends On{static componentType="title";static rendererType="textorinline"},Rc=class extends ${static componentType="level";static rendererType="number"},Fc=class extends An{static componentType="variant";static rendererType="text"},kc=class extends Cr{static componentType="selectForVariants"},Mc=class extends ye{static componentType="nvariants";static rendererType="number"},_c=class extends k{static componentType="uniquevariants";static rendererType="boolean"},Bc=class extends An{static componentType="seed";static rendererType="text"},Ec=class extends ye{static componentType="numbertoselect";static rendererType="number"},$c=class extends k{static componentType="withreplacement";static rendererType="boolean"},zc=class extends ye{static componentType="length";static rendererType="number"},jc=class extends ye{static componentType="displaydigits";static rendererType="number"},Hc=class extends ye{static componentType="displaydecimals";static rendererType="number"},qc=class extends ${static componentType="selectweight";static rendererType="number"},Kc=class extends Pn{static componentType="independentvariable";static rendererType="math"},Wc=class extends H{static componentType="initialindependentvariablevalue";static rendererType="math"},Uc=class extends Jt{static componentType="righthandside";static rendererType="math"},Gc=class extends z{static componentType="rendermode";static rendererType="text"},Xc=class extends k{static componentType="renderasmath";static rendererType="boolean"},Zc=class extends ${static componentType="chunksize";static rendererType="number"},Jc=class extends k{static componentType="animationon";static rendererType="boolean"},Yc=class extends z{static componentType="animationmode";static rendererType="text"},Qc=class extends ${static componentType="animationinterval";static rendererType="number"},ed=class extends ye{static componentType="initialselectedindex";static rendererType="number"},td=class extends k{static componentType="numeric";static rendererType="boolean"},nd=class extends k{static componentType="symbolic";static rendererType="boolean"},rd=class extends k{static componentType="forceNumeric";static rendererType="boolean"},id=class extends k{static componentType="forceSymbolic";static rendererType="boolean"},ad=class extends Ze{static componentType="input";static rendererType="aslist"},sd=class extends H{static componentType="x";static rendererType="math"},od=class extends H{static componentType="y";static rendererType="math"},ld=class extends H{static componentType="z";static rendererType="math"},ud=class extends Ze{static componentType="xs";static rendererType="aslist"},cd=class extends ye{static componentType="layer";static rendererType="number"},dd=class extends k{static componentType="renderasacuteangle";static rendererType="boolean"},pd=class extends k{static componentType="displayxaxis";static rendererType="boolean"},md=class extends k{static componentType="displayyaxis";static rendererType="boolean"},fd=class extends z{static componentType="xlabel";static rendererType="text"},hd=class extends z{static componentType="ylabel";static rendererType="text"},yd=class extends z{static rendererType="text";static componentType="zlabel"},bd=class extends ${static componentType="uppervalue";static rendererType="number"},gd=class extends ${static componentType="lowervalue";static rendererType="number"},vd=class extends ${static componentType="tolerance";static rendererType="number"},Cd=class extends ye{static componentType="maxiterations";static rendererType="number"},Td=class extends k{static componentType="population";static rendererType="boolean"},Nd=class extends ye{static componentType="numberofsamples";static rendererType="number"},xd=class extends k{static componentType="matchwholeword";static rendererType="boolean"},Vd=class extends k{static componentType="casesensitive";static rendererType="boolean"},wd=class extends H{static componentType="offset";static rendererType="math"},Dd=class extends H{static componentType="period";static rendererType="math"},Ad=class extends H{static componentType="minindex";static rendererType="math"},Sd=class extends H{static componentType="maxindex";static rendererType="math"},Id=class extends ye{static componentType="numberdecimals";static rendererType="number"},Pd=class extends ye{static componentType="numberdigits";static rendererType="number"},Od=class extends Yt{static componentType="componenttypes"},Ld=class extends z{static componentType="source";static rendererType="text"},Rd=class extends On{static componentType="description";static rendererType="textorinline"},Fd=class extends k{static componentType="selectmultiple";static rendererType="boolean"},kd=class extends k{static componentType="assignpartialcredit";static rendererType="boolean"},Md=class extends k{static componentType="inline";static rendererType="boolean"},_d=class extends k{static componentType="fixedorder";static rendererType="boolean"},Bd=class extends z{static componentType="uri";static rendererType="text"},Ed=class extends z{static componentType="youtube";static rendererType="text"},$d=class extends z{static componentType="geogebra";static rendererType="text"},zd=class extends z{static componentType="keyword";static rendererType="text"},jd=class extends ${static componentType="size";static rendererType="number"},Hd=class extends k{static componentType="expand";static rendererType="boolean"},qd=class extends k{static componentType="expandOnCompare";static rendererType="boolean"},Kd=class extends k{static componentType="unordered";static rendererType="boolean"},Wd=class extends k{static componentType="unorderedCompare";static rendererType="boolean"},Ud=class extends k{static componentType="matchpartial";static rendererType="boolean"},Gd=class extends k{static componentType="symbolicequality";static rendererType="boolean"},Xd=class extends k{static componentType="showCorrectness";static rendererType="boolean"},Zd=class extends k{static componentType="createintervals";static rendererType="boolean"},Jd=class extends k{static componentType="createvectors";static rendererType="boolean"},Yd=class extends ${static componentType="allowederrorinnumbers";static rendererType="number"},Qd=class extends k{static componentType="includeerrorinnumberexponents";static rendererType="boolean"},ep=class extends k{static componentType="allowederrorisabsolute";static rendererType="boolean"},tp=class extends ye{static componentType="nsignerrorsmatched";static rendererType="number"},np=class extends z{static componentType="feedbackcode";static rendererType="text"},rp=class extends z{static componentType="feedbacktext";static rendererType="text"},ip=class extends Yt{static componentType="feedbackcodes"},ap=class extends z{static componentType="texttype";static rendererType="text"},sp=class extends z{static componentType="branchid";static rendererType="text"},op=class extends z{static componentType="contentid";static rendererType="text"},lp=class extends z{static componentType="target";static rendererType="text"},up=class extends Yt{static componentType="targetPropertiesToIgnore"},cp=class extends z{static componentType="pluralform";static rendererType="text"},dp=class extends ${static componentType="basedonnumber";static rendererType="number"},pp=class extends k{static componentType="displaysmallaszero";static rendererType="boolean"},mp=class extends ${static componentType="maximumnumber";static rendererType="number"},fp=class extends ${static componentType="maximumNumberToSelect";static rendererType="number"},hp=class extends k{static componentType="showlabel";static rendererType="boolean"},yp=class extends k{static componentType="mergemathlists";static rendererType="boolean"},bp=class extends ${static componentType="attractthreshold";static rendererType="number"},gp=class extends ${static componentType="npoints";static rendererType="number"},vp=class extends k{static componentType="sortresults";static rendererType="boolean"},Cp=class extends H{static componentType="slope";static rendererType="math"},Tp=class extends k{static componentType="forcefullcheckworkbutton";static rendererType="boolean"},Np=class extends Qt{static componentType="PossibleNumberOfGroups";static rendererType="numberlist"},xp=class extends ${static componentType="ndiscretizationpoints";static rendererType="number"},Vp=class extends k{static componentType="periodic";static rendererType="boolean"},wp=class extends k{static componentType="isResponse";static rendererType="boolean"},Dp=class extends k{static componentType="sectionWideCheckWork";static rendererType="boolean"},Ap=class extends ${static componentType="delegateCheckWorkToAnswerNumber";static rendererType="number"},Sp=class extends k{static componentType="condition";static rendererType="boolean"},Ip=class extends z{static componentType="encodedGeogebraContent";static rendererType="text"},Pp=class extends z{static componentType="fromMathInsight";static rendererType="text"},Op=class extends k{static componentType="headDraggable";static rendererType="boolean"},Lp=class extends k{static componentType="tailDraggable";static rendererType="boolean"},Rp=class extends k{static componentType="showNavigation";static rendererType="boolean"},Fp=class extends Qt{static componentType="selectIndices";static rendererType="numberlist"},kp=class extends k{static componentType="rendered";static rendererType="boolean"},Mp=class extends Mt{static componentType="else"},_p=class extends Mt{static componentType="result"},Bp=class extends ${static componentType="componentIndex";static rendererType="number"},Ep=class extends Qt{static componentType="propIndex";static rendererType="number"},$p=class extends H{static componentType="radians";static rendererType="math"},zp=class extends H{static componentType="degrees";static rendererType="math"},jp=class extends k{static componentType="inDegrees";static rendererType="boolean"},Hp=class extends $l{static componentType="betweenLines"};var ua={};fe(ua,{M:()=>nn,Me:()=>qp,Men:()=>Kp});import Tv from"../_snowpack/pkg/math-expressions.js";var nn=class extends B{static componentType="m";static rendererType="math";static primaryStateVariableForDefinition="latex";static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroStrings",componentType:"string",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atLeastZeroMathlists",componentType:"mathlist",comparison:"atLeast",number:0}),s=e.newLeaf({name:"atLeastZeroMs",componentType:"m",comparison:"atLeast",number:0}),o=e.newLeaf({name:"atLeastZeroMathinputs",componentType:"mathinput",comparison:"atLeast",number:0});return e.newOperator({name:"stringsTextsAndMaths",operator:"and",propositions:[n,r,i,a,s,o],requireConsecutive:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.latex={public:!0,componentType:"text",defaultValue:"",returnDependencies:()=>({stringTextMathChildren:{dependencyType:"child",childLogicName:"stringsTextsAndMaths",variableNames:["latex","text"],variablesOptional:!0}}),definition:function({dependencyValues:e,componentInfoObjects:n}){if(e.stringTextMathChildren.length===0)return{useEssentialOrDefaultValue:{latex:{variablesToCheck:"latex"}}};let r="";for(let i of e.stringTextMathChildren)i.stateValues.latex?r+=i.stateValues.latex:i.stateValues.text&&(r+=i.stateValues.text);return{newValues:{latex:r}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({stringTextMathChildren:{dependencyType:"child",childLogicName:"stringsTextsAndMaths",variableNames:["latex","text"],variablesOptional:!0},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){if(e.stringTextMathChildren.length===0)return{newValues:{latexWithInputChildren:[e.latex]}};let r=[],i="",a=0;for(let s of e.stringTextMathChildren)n.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"mathinput"})?(i.length>0&&(r.push(i),i=""),r.push(a),a++):s.stateValues.latex?i+=s.stateValues.latex:s.stateValues.text&&(i+=s.stateValues.text);return i.length>0&&r.push(i),{newValues:{latexWithInputChildren:r}}}},t.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{renderMode:"inline"}})},t.text={returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){let n;try{n=Tv.fromLatex(e.latex)}catch(r){return{newValues:{text:e.latex}}}return{newValues:{text:n.toString()}}}},t.childrenToRender={returnDependencies:()=>({mathinputChildren:{dependencyType:"child",childLogicName:"atLeastZeroMathinputs"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.mathinputChildren.map(n=>n.componentName)}}}},t}},qp=class extends nn{static componentType="me";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"display"}}),t}},Kp=class extends nn{static componentType="men";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"numbered"}}),t}};var ca={};fe(ca,{Md:()=>da,Mdn:()=>Wp,Mrow:()=>Up});import Nv from"../_snowpack/pkg/math-expressions.js";var da=class extends B{static componentType="md";static rendererType="math";static primaryStateVariableForDefinition="latex";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["latex"]}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroMrows",componentType:"mrow",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.latex={public:!0,componentType:"text",defaultValue:"",returnDependencies:()=>({mrowChildren:{dependencyType:"child",childLogicName:"atLeastZeroMrows",variableNames:["latex","hide"]}}),definition:function({dependencyValues:e}){return e.mrowChildren.length>0?{newValues:{latex:e.mrowChildren.filter(r=>!r.stateValues.hide).map(r=>r.stateValues.latex).join("\\\\")}}:{useEssentialOrDefaultValue:{latex:{variablesToCheck:"latex"}}}}},t.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({mrowChildren:{dependencyType:"child",childLogicName:"atLeastZeroMrows",variableNames:["latexWithInputChildren"]},latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){if(e.mrowChildren.length>0){let n=[],r=0,i="";for(let a of e.mrowChildren){for(let s of a.stateValues.latexWithInputChildren)typeof s=="number"?(i.length>0&&(n.push(i),i=""),n.push(r),r++):i+=s;i+="\\\\"}return i.length>0&&n.push(i),{newValues:{latexWithInputChildren:n}}}else return{newValues:{latexWithInputChildren:[e.latex]}}}},t.text={returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:e}){let n;try{n=e.stateValues.latex.split("\\\\").map(r=>Nv.fromLatex(r).toString()).join("\\\\")}catch(r){return{newValues:{text:e.stateValues.latex}}}return{newValues:{text:n}}}},t.renderMode={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{renderMode:"align"}})},t.childrenToRender={returnDependencies:()=>({mrowChildren:{dependencyType:"child",childLogicName:"atLeastZeroMrows",variableNames:["childrenToRender"]}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.mrowChildren.reduce((n,r)=>[...n,...r.stateValues.childrenToRender],[])}}}},t}},Wp=class extends da{static componentType="mdn";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"alignnumbered"}}),t}},Up=class extends nn{static componentType="mrow";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.renderMode.definition=()=>({newValues:{renderMode:"display"}}),t}};var fa={};fe(fa,{And:()=>Zp,Not:()=>Xp,Or:()=>Jp,Xor:()=>Yp});var pa=class extends k{static componentType="_booleanoperator";static rendererType="boolean";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastOneBoolean",componentType:"boolean",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();delete t.parsedExpression,delete t.mathChildrenByCode;let e=this;return t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({booleanChildren:{dependencyType:"child",childLogicName:"atLeastOneBoolean",variableNames:["value"]}}),definition:function({dependencyValues:n}){return{newValues:{value:e.applyBooleanOperator(n.booleanChildren.map(r=>r.stateValues.value))}}}},t}},rn=pa;function st({stateVariableDefinitions:u,oldName:t,newName:e}){let n=u[e]=u[t];if(delete u[t],n.additionalStateVariablesDefined){let o=n.additionalStateVariablesDefined.indexOf(t);o!==-1&&(n.additionalStateVariablesDefined[o]=e)}let r=n.definition,i=["newValues","useEssentialOrDefaultValue"],a=["noChanges","makeEssential","alwaysShadow"];n.definition=function(o){let l=r(o);for(let c of i)l[c]&&t in l[c]&&(l[c][e]=l[c][t],delete l[c][t]);for(let c of a)if(l[c]){let d=l[c].indexOf(t);d!==-1&&(l[c][d]=e)}return l};let s=n.inverseDefinition;n.inverseDefinition=function(o){let l=o.desiredStateVariableValues;l[t]=l[e],delete l[e];let c=s(o);if(c.success)for(let d of c.instructions)d.setStateVariable===t&&(d.setStateVariable=e);return c}}var ma=class extends k{static componentType="_booleanoperatoroneinput";static rendererType="boolean";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this;return st({stateVariableDefinitions:t,oldName:"value",newName:"valuePreOperator"}),t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"valuePreOperator"}}),definition:function({dependencyValues:n}){return{newValues:{value:e.applyBooleanOperator(n.value)}}}},t}},Gp=ma;var Xp=class extends Gp{static componentType="not";static applyBooleanOperator(t){return!t}},Zp=class extends rn{static componentType="and";static applyBooleanOperator(t){return t.every(e=>e)}},Jp=class extends rn{static componentType="or";static applyBooleanOperator(t){return t.some(e=>e)}},Yp=class extends rn{static componentType="xor";static applyBooleanOperator(t){return t.reduce((n,r)=>n+r,0)===1}};var ya={};fe(ya,{IsInteger:()=>Qp,IsNumber:()=>em});var ha=class extends k{static componentType="_booleanoperatorofmath";static rendererType="boolean";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastOneMath",componentType:"math",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();delete t.parsedExpression,delete t.mathChildrenByCode;let e=this;return t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({mathChildren:{dependencyType:"child",childLogicName:"atLeastOneMath",variableNames:["value"]}}),definition:function({dependencyValues:n}){return{newValues:{value:e.applyBooleanOperator(n.mathChildren.map(r=>r.stateValues.value))}}}},t}},kn=ha;var Qp=class extends kn{static componentType="isinteger";static applyBooleanOperator(t){if(t.length===0)return!1;if(t.length!==1)return console.warn("IsInteger requires exactly one math child"),null;let e=t[0].evaluate_to_constant();if(!Number.isFinite(e))return!1;let n=Math.round(e);return Math.abs(n-e)<=1e-15*Math.abs(e)}},em=class extends kn{static componentType="isNumber";static applyBooleanOperator(t){if(t.length===0)return!1;if(t.length!==1)return console.warn("IsNumber requires exactly one math child"),null;let e=t[0].evaluate_to_constant();return Number.isFinite(e)}};var va={};fe(va,{Abs:()=>dm,Ceil:()=>um,ClampNumber:()=>rm,ConvertSetToList:()=>lm,Count:()=>ym,Floor:()=>cm,Max:()=>gm,Mean:()=>pm,Min:()=>bm,Mod:()=>vm,Product:()=>nm,Round:()=>om,StandardDeviation:()=>hm,Sum:()=>tm,Variance:()=>Ca,WrapNumberPeriodic:()=>am});import an from"../_snowpack/pkg/math-expressions.js";var ba=class extends H{static componentType="_mathoperator";static rendererType="math";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.forceSymbolic={default:!1},e.forceNumeric={default:!1},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:Number.isFinite(Number(s))?"number":"math",children:[{componentType:"string",state:{value:s}}]}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atLeastZeroMaths",componentType:"math",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroNumbers",componentType:"number",comparison:"atLeast",number:0});return e.newOperator({name:"mathsAndNumbers",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},mathChildren:{dependencyType:"child",childLogicName:"atLeastZeroMaths",variableNames:["isNumber"],variablesOptional:!0}}),definition({dependencyValues:e}){let n;return e.forceNumeric?n=!0:e.forceSymbolic?n=!1:e.mathChildren.length===0?n=!0:n=e.mathChildren.every(r=>r.stateValues.isNumber),{newValues:{isNumericOperator:n}}}},delete t.codePre,delete t.expressionWithCodes,delete t.codesAdjacentToStrings,delete t.mathChildrenByArrayComponent,t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:e=>an.fromAst("\uFF3F")}})},t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:e=>an.fromAst("\uFF3F")}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:null}})},t.inverseNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseNumericOperator:null}})},t.unnormalizedValue={returnDependencies:()=>({mathNumberChildren:{dependencyType:"child",childLogicName:"mathsAndNumbers",variableNames:["value"]},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},numericOperator:{dependencyType:"stateVariable",variableName:"numericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){if(e.mathNumberChildren.length===0)return{newValues:{unnormalizedValue:an.fromAst("\uFF3F")}};if(e.isNumericOperator){let r=[];for(let i of e.mathNumberChildren)if(n.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"number"}))r.push(i.stateValues.value);else{let a=i.stateValues.value.evaluate_to_constant();Number.isFinite(a)||(a=NaN),r.push(a)}return{newValues:{unnormalizedValue:an.fromAst(e.numericOperator(r))}}}else{let r=[];for(let i of e.mathNumberChildren)n.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:"number"})?r.push(an.fromAst(i.stateValues.value)):r.push(i.stateValues.value);return{newValues:{unnormalizedValue:e.mathOperator(r)}}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){if(n.mathNumberChildren.length===0)return{success:!1};if(n.isNumericOperator)if(n.inverseNumericOperator){let r=[];for(let a of n.mathNumberChildren)if(componentInfoObjects.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"number"}))r.push(a.stateValues.value);else{let s=a.stateValues.value.evaluate_to_constant();Number.isFinite(s)||(s=NaN),r.push(s)}let i=n.inverseNumericOperator({desiredValue:e.unnormalizedValue.evaluate_to_constant(),inputs:r});return i.success?{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:i.inputValue,childIndex:i.inputNumber,variableIndex:0}]}:{success:!1}}else return{success:!1};else if(n.inverseMathOperator){let r=[];for(let a of n.mathNumberChildren)componentInfoObjects.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"number"})?r.push(an.fromAst(a.stateValues.value)):r.push(a.stateValues.value);let i=n.inverseMathOperator({desiredValue:e.unnormalizedValue,inputs:r});return i.success?{success:!0,instructions:[{setDependency:"mathNumberChildren",desiredValue:i.inputValue,childIndex:i.inputNumber,variableIndex:0}]}:{success:!1}}else return{success:!1}}},t.canBeModified={returnDependencies:()=>({modifyIndirectly:{dependencyType:"stateVariable",variableName:"modifyIndirectly"},fixed:{dependencyType:"stateVariable",variableName:"fixed"},mathNumberChildren:{dependencyType:"child",childLogicName:"mathsAndNumbers"},isNumericOperator:{dependencyType:"stateVariable",variableName:"isNumericOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseNumericOperator:{dependencyType:"stateVariable",variableName:"inverseNumericOperator"}}),definition:function({dependencyValues:e}){return{newValues:{canBeModified:e.modifyIndirectly&&!e.fixed&&e.mathNumberChildren.length===1&&(e.isNumericOperator?e.inverseNumericOperator:e.inverseMathOperator)}}}},t}},He=ba;var ga=class extends H{static componentType="_mathoperatoroneinput";static rendererType="math";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:e=>me.fromAst("\uFF3F")}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:null}})},st({stateVariableDefinitions:t,oldName:"unnormalizedValue",newName:"unnormalizedValuePreOperator"}),t.unnormalizedValue={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"unnormalizedValuePreOperator"},mathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"inverseMathOperator"}}),definition:function({dependencyValues:e}){return{newValues:{unnormalizedValue:e.mathOperator(e.value)}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n,componentName:r}){if(n.inverseMathOperator){let i=n.inverseMathOperator(e.unnormalizedValue);return{success:!0,instructions:[{setDependency:"value",desiredValue:i}]}}else return{success:!1}}},st({stateVariableDefinitions:t,oldName:"canBeModified",newName:"canBeModifiedPreOperator"}),t.canBeModified={returnDependencies:()=>({canBeModifiedPreOperator:{dependencyType:"stateVariable",variableName:"canBeModifiedPreOperator"},inverseMathOperator:{dependencyType:"stateVariable",variableName:"mathOperator"}}),definition:function({dependencyValues:e}){let n=e.canBeModifiedPreOperator;return e.inverseMathOperator||(n=!1),{newValues:{canBeModified:n}}}},t}},Je=ga;import ce from"../_snowpack/pkg/math-expressions.js";var tm=class extends He{static componentType="sum";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>n+r)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.reduce((n,r)=>n.add(r))}}})},t}},nm=class extends He{static componentType="product";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>n*r)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.reduce((n,r)=>n.multiply(r))}}})},t}},rm=class extends Je{static componentType="clampnumber";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.lowerValue={default:0},e.upperValue={default:1},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{isNumericOperator:!0}})},t.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){return im({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{inverseMathOperator:function(n){return im({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t}};function im({value:u,lowerValue:t,upperValue:e}){let n=u.evaluate_to_constant();return Number.isFinite(n)?ce.fromAst(Math.max(t,Math.min(e,n))):ce.fromAst(NaN)}var am=class extends Je{static componentType="wrapnumberperiodic";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.lowerValue={default:0},e.upperValue={default:1},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{isNumericOperator:!0}})},t.mathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){return sm({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t.inverseMathOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:({dependencyValues:e})=>({newValues:{inverseMathOperator:function(n){return sm({value:n,lowerValue:e.lowerValue,upperValue:e.upperValue})}}})},t}};function sm({value:u,lowerValue:t,upperValue:e}){let n=u.evaluate_to_constant();return Number.isFinite(n)?t===e?ce.fromAst(t):(t>e&&([e,t]=[t,e]),ce.fromAst(t+ce.math.mod(n-t,e-t))):ce.fromAst(NaN)}var om=class extends Je{static componentType="round";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.numberDecimals={default:0},e.numberDigits={default:null},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({numberDecimals:{dependencyType:"stateVariable",variableName:"numberDecimals"},numberDigits:{dependencyType:"stateVariable",variableName:"numberDigits"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){let r=n.evaluate_numbers({max_digits:Infinity,evaluate_functions:!0});return e.numberDigits!==null?r.round_numbers_to_precision(e.numberDigits):r.round_numbers_to_decimals(e.numberDecimals)}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:e=>e}})},t}},lm=class extends Je{static componentType="convertsettolist";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return delete e.unordered,e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.unordered={returnDependencies:()=>({}),definition:()=>({newValues:{unordered:!0},makeEssential:["unordered"]})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){if(e!==void 0&&Array.isArray(e.tree)&&e.tree[0]==="set"){let n=[];for(let r of e.tree.slice(1))n.some(i=>e.context.equalsViaSyntax(e.context.fromAst(i),e.context.fromAst(r)))||n.push(r);return e.context.fromAst(["list",...n])}return e}}})},t}},um=class extends Je{static componentType="ceil";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){let n=e.evaluate_to_constant();if(!Number.isFinite(n))return e;let r=Math.round(n);return Math.abs((r-n)/n)<1e-15?ce.fromAst(r):ce.fromAst(Math.ceil(n))}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:e=>e}})},t}},cm=class extends Je{static componentType="floor";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){let n=e.evaluate_to_constant();if(!Number.isFinite(n))return e;let r=Math.round(n);return Math.abs((r-n)/n)<1e-15?ce.fromAst(r):ce.fromAst(Math.floor(n))}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:e=>e}})},t}},dm=class extends Je{static componentType="abs";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){let n=e.evaluate_to_constant();return Number.isFinite(n)?ce.fromAst(Math.abs(n)):ce.fromAst(["apply","abs",e.tree])}}})},t.inverseMathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{inverseMathOperator:function(e){let n=e,r=e.evaluate_to_constant();return Number.isFinite(r)&&r<0&&(n=ce.fromAst(0)),n}}})},t}},pm=class extends He{static componentType="mean";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){let n=e.reduce((r,i)=>r+i);return n/=e.length,n}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.reduce((n,r)=>n.add(r)).divide(e.length)}}})},t}},Ca=class extends He{static componentType="variance";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.population={default:!1},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:e})=>({newValues:{numericOperator:function(n){return mm(n,e.population)}}})},t.mathOperator={returnDependencies:()=>({population:{dependencyType:"stateVariable",variableName:"population"}}),definition:({dependencyValues:e})=>({newValues:{mathOperator:function(n){return fm(n,e.population)}}})},t}};function mm(u,t){let e=0,n=0;for(let i of u)e+=i,n+=i*i;let r=u.length;return n-=e**2/r,t?n/=r:n/=r-1,n}function fm(u,t){let e=u.length,n=u.reduce((i,a)=>i.add(a)),r=u.slice(1).reduce((i,a)=>i.add(a.pow(2)),u[0].pow(2)).subtract(n.pow(2).divide(e));return t?r=r.divide(e):r=r.divide(e-1),r}var hm=class extends Ca{static componentType="standarddeviation";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator.definition=({dependencyValues:e})=>({newValues:{numericOperator:function(n){return Math.sqrt(mm(n,e.population))}}}),t.mathOperator.definition=({dependencyValues:e})=>({newValues:{mathOperator:function(n){return ce.fromAst(["apply","sqrt",fm(n,e.population).tree])}}}),t}},ym=class extends He{static componentType="count";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.isNumericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{isNumericOperator:!0}})},t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.length}}})},t}},bm=class extends He{static componentType="min";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>Math.min(n,r),Infinity)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return ce.fromAst(["apply","min",["tuple",...e.map(n=>n.tree)]])}}})},t}},gm=class extends He{static componentType="max";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.reduce((n,r)=>Math.max(n,r),-Infinity)}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return ce.fromAst(["apply","max",["tuple",...e.map(n=>n.tree)]])}}})},t}},vm=class extends He{static componentType="mod";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numericOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericOperator:function(e){return e.length!==2?NaN:ce.math.mod(e[0],e[1])}}})},t.mathOperator={returnDependencies:()=>({}),definition:()=>({newValues:{mathOperator:function(e){return e.length!==2?ce.fromAst("\uFF3F"):ce.fromAst(["apply","mod",["tuple",...e.map(n=>n.tree)]])}}})},t}};var xa={};fe(xa,{ClampFunction:()=>Tm,Derivative:()=>xm,WrapFunctionPeriodic:()=>Nm});import Mn from"../_snowpack/pkg/math-expressions.js";var Ta=class extends B{static componentType="function";static rendererType="math";static get stateVariablesShadowedForReference(){return["variable","numericalf","symbolicf","symbolic","isInterpolatedFunction","formula","prescribedPoints","prescribedMinima","prescribedMaxima","prescribedExtrema"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.simplify={default:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numberspreserveorder"]},e.expand={default:!1},e.xscale={default:1,propagateToDescendants:!0},e.yscale={default:1,propagateToDescendants:!0},e.label={default:"",forRenderer:!0},e.showLabel={default:!0,forRenderer:!0},e.layer={default:0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:/s/,replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"formula",doenetAttributes:{isPropertyChild:!0},children:e}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneFormula",componentType:"formula",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"exactlyOneMinima",componentType:"minima",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"exactlyOneMaxima",componentType:"maxima",number:1,takePropertyChildren:!0}),a=e.newLeaf({name:"exactlyOneExtrema",componentType:"extrema",number:1,takePropertyChildren:!0}),s=e.newLeaf({name:"exactlyOneThrough",componentType:"through",number:1,takePropertyChildren:!0}),o=e.newLeaf({name:"exactlyOneThroughSlopes",componentType:"throughSlopes",number:1,takePropertyChildren:!0}),l=e.newOperator({name:"throughCriteria",operator:"or",propositions:[r,i,a,s,o]}),c=e.newLeaf({name:"atMostOneFunction",componentType:"function",comparison:"atMost",number:1}),d=e.newOperator({name:"functionXorFormula",operator:"xor",propositions:[c,n,l]}),p=e.newLeaf({name:"atMostOneVariable",componentType:"variable",comparison:"atMost",number:1,takePropertyChildren:!0}),m=e.newLeaf({name:"atMostOneSymbolic",componentType:"symbolic",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"formulaWithVariable",operator:"and",propositions:[p,d,m],setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions();return e.selectedStyle={forRenderer:!0,returnDependencies:()=>({styleNumber:{dependencyType:"stateVariable",variableName:"styleNumber"},ancestorWithStyle:{dependencyType:"ancestor",variableNames:["styleDefinitions"]}}),definition:function({dependencyValues:n}){let r=n.ancestorWithStyle.stateValues.styleDefinitions;r||(r=Zt());let i;for(let a of r)n.styleNumber===a.styleNumber&&(i===void 0?i=a:i=Object.assign(Object.assign({},a),i));return i===void 0&&(i=r[0]),{newValues:{selectedStyle:i}}}},e.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:n}){let r="";return n.selectedStyle.lineWidth>=4?r+="thick ":n.selectedStyle.lineWidth<=1&&(r+="thin "),n.selectedStyle.lineStyle==="dashed"?r+="dashed ":n.selectedStyle.lineStyle==="dotted"&&(r+="dotted "),r+=n.selectedStyle.lineColor,{newValues:{styleDescription:r}}}},e.symbolic={public:!0,componentType:"boolean",defaultValue:!1,returnDependencies:()=>({symbolicChild:{dependencyType:"child",childLogicName:"atMostOneSymbolic",variableNames:["value"]},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["symbolic"]}}),definition({dependencyValues:n}){return n.symbolicChild.length===1?{newValues:{symbolic:n.symbolicChild[0].stateValues.value}}:n.functionChild.length===1?{newValues:{symbolic:n.functionChild[0].stateValues.symbolic}}:{useEssentialOrDefaultValue:{symbolic:{variablesToCheck:["symbolic"]}}}}},e.isInterpolatedFunction={returnDependencies:()=>({throughCriteriaChildren:{dependencyType:"child",childLogicName:"throughCriteria"}}),definition({dependencyValues:n}){return{newValues:{isInterpolatedFunction:n.throughCriteriaChildren.length>0}}}},e.variable={public:!0,componentType:"variable",defaultValue:Mn.fromAst("x"),returnDependencies:()=>({variableChild:{dependencyType:"child",childLogicName:"atMostOneVariable",variableNames:["value"]},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["variable"]},parentVariableForChild:{dependencyType:"parentStateVariable",variableName:"variableForChild"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition:function({dependencyValues:n,usedDefault:r}){return n.isInterpolatedFunction?{newValues:{variable:Mn.fromAst("\uFF3F")}}:n.functionChild.length===1?(n.variableChild.length===1&&console.warn("Variable for function is ignored when it has a function child"),{newValues:{variable:n.functionChild[0].stateValues.variable}}):n.variableChild.length===1?{newValues:{variable:n.variableChild[0].stateValues.value}}:n.parentVariableForChild&&!r.parentVariableForChild?{newValues:{variable:n.parentVariableForChild}}:{useEssentialOrDefaultValue:{variable:{variablesToCheck:["variable"]}}}}},e.formula={public:!0,componentType:"formula",defaultValue:Mn.fromAst(0),returnDependencies:()=>({formulaChild:{dependencyType:"child",childLogicName:"exactlyOneFormula",variableNames:["value"]},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["formula"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}),definition:function({dependencyValues:n}){return n.isInterpolatedFunction?{newValues:{formula:Mn.fromAst("\uFF3F")}}:n.formulaChild.length===1?{newValues:{formula:n.formulaChild[0].stateValues.value}}:n.functionChild.length===1?{newValues:{formula:n.functionChild[0].stateValues.formula}}:{useEssentialOrDefaultValue:{formula:{variablesToCheck:["formula"]}}}}},e.nPrescribedPoints={returnDependencies:()=>({throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["nPoints"]}}),definition({dependencyValues:n}){let r=0;return n.throughChild.length===1&&(r=n.throughChild[0].stateValues.nPoints),{newValues:{nPrescribedPoints:r}}}},e.prescribedPoints={isArray:!0,entryPrefixes:["prescribedPoint"],returnArraySizeDependencies:()=>({nPrescribedPoints:{dependencyType:"stateVariable",variableName:"nPrescribedPoints"}}),returnArraySize({dependencyValues:n}){return[n.nPrescribedPoints]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n){let a=Number(i)+1;r[i]={throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["point"+a]},throughSlopesChild:{dependencyType:"child",childLogicName:"exactlyOneThroughSlopes",variableNames:["math"+a]}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].throughChild;if(s.length===1){let o=Number(a)+1,l=s[0].stateValues["point"+o],c=null,d=n[a].throughSlopesChild;d.length===1&&(c=d[0].stateValues["math"+o],c===void 0&&(c=null)),i[a]={x:l[0],y:l[1],slope:c}}}return{newValues:{prescribedPoints:i}}}},e.prescribedMinima={returnDependencies:()=>({minimaChild:{dependencyType:"child",childLogicName:"exactlyOneMinima",variableNames:["minima"]}}),definition({dependencyValues:n}){let r=[];return n.minimaChild.length==1&&(r=n.minimaChild[0].stateValues.minima.map(i=>({x:i[0],y:i[1]}))),{newValues:{prescribedMinima:r}}}},e.prescribedMaxima={returnDependencies:()=>({maximaChild:{dependencyType:"child",childLogicName:"exactlyOneMaxima",variableNames:["maxima"]}}),definition({dependencyValues:n}){let r=[];return n.maximaChild.length==1&&(r=n.maximaChild[0].stateValues.maxima.map(i=>({x:i[0],y:i[1]}))),{newValues:{prescribedMaxima:r}}}},e.prescribedExtrema={returnDependencies:()=>({extremaChild:{dependencyType:"child",childLogicName:"exactlyOneExtrema",variableNames:["extrema"]}}),definition({dependencyValues:n}){let r=[];return n.extremaChild.length==1&&(r=n.extremaChild[0].stateValues.extrema.map(i=>({x:i[0],y:i[1]}))),{newValues:{prescribedExtrema:r}}}},e.interpolationPoints={returnDependencies:()=>({xscale:{dependencyType:"stateVariable",variableName:"xscale"},yscale:{dependencyType:"stateVariable",variableName:"yscale"},prescribedPoints:{dependencyType:"stateVariable",variableName:"prescribedPoints"},prescribedMinima:{dependencyType:"stateVariable",variableName:"prescribedMinima"},prescribedMaxima:{dependencyType:"stateVariable",variableName:"prescribedMaxima"},prescribedExtrema:{dependencyType:"stateVariable",variableName:"prescribedExtrema"}}),definition:({dependencyValues:n})=>xv({dependencyValues:n,numerics:t})},e.xs={additionalStateVariablesDefined:["coeffs"],returnDependencies:()=>({interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"}}),definition:Vv},e.symbolicf={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["symbolicf"]},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){if(n.isInterpolatedFunction){let r=Cm(n);return{newValues:{symbolicf:function(i){Mn.fromAst(r(i.evaluate_to_constant()))}}}}else return n.functionChild.length===1?{newValues:{symbolicf:n.functionChild[0].stateValues.symbolicf}}:{newValues:{symbolicf:Tr(n)}}}},e.numericalf={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["numericalf"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){return n.isInterpolatedFunction?{newValues:{numericalf:Cm(n)}}:n.functionChild.length===1?{newValues:{numericalf:n.functionChild[0].stateValues.numericalf}}:{newValues:{numericalf:Nr(n)}}}},e.f={returnDependencies:()=>({symbolic:{dependencyType:"stateVariable",variableName:"symbolic"},symbolicf:{dependencyType:"stateVariable",variableName:"symbolicf"},numericalf:{dependencyType:"stateVariable",variableName:"numericalf"}}),definition:function({dependencyValues:n}){return n.symbolic?{newValues:{f:n.symbolicf}}:{newValues:{f:n.numericalf}}}},e.latex={public:!0,componentType:"text",returnDependencies:()=>({formula:{dependencyType:"stateVariable",variableName:"formula"}}),definition:function({dependencyValues:n}){return{newValues:{latex:n.formula.toLatex()}}}},e.latexWithInputChildren={forRenderer:!0,returnDependencies:()=>({latex:{dependencyType:"stateVariable",variableName:"latex"}}),definition:function({dependencyValues:n}){return{newValues:{latexWithInputChildren:[n.latex]}}}},e.allMinima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["allMinima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n,componentName:r}){if(n.isInterpolatedFunction){let i=n.xs,a=n.coeffs,s=t.eps,o=[];if(i===null)return{newValues:{allMinima:o}};let l=!1,c=a[0],d=i[1]-i[0];if(c[3]===0){if(c[2]>0){let p=-c[1]/(2*c[2]);p<=d-s?o.push([p+i[0],((c[3]*p+c[2])*p+c[1])*p+c[0]]):Math.abs(p-d)<s&&(l=!0)}}else{let p=4*c[2]*c[2]-12*c[3]*c[1];if(p>0){let m=Math.sqrt(p),f=(-2*c[2]+m)/(6*c[3]);f<=d-s?o.push([f+i[0],((c[3]*f+c[2])*f+c[1])*f+c[0]]):Math.abs(f-d)<s&&(l=!0)}}for(let p=1;p<i.length-2;p++)if(c=a[p],d=i[p+1]-i[p],c[3]===0)if(c[2]>0){let m=-c[1]/(2*c[2]);Math.abs(m)<s?l&&o.push([m+i[p],((c[3]*m+c[2])*m+c[1])*m+c[0]]):m>=s&&m<=d-s&&o.push([m+i[p],((c[3]*m+c[2])*m+c[1])*m+c[0]]),l=Math.abs(m-d)<s}else l=!1;else{let m=4*c[2]*c[2]-12*c[3]*c[1];if(m>0){let f=Math.sqrt(m),h=(-2*c[2]+f)/(6*c[3]);Math.abs(h)<s?l&&o.push([h+i[p],((c[3]*h+c[2])*h+c[1])*h+c[0]]):h>=s&&h<=d-s&&o.push([h+i[p],((c[3]*h+c[2])*h+c[1])*h+c[0]]),l=Math.abs(h-d)<s}else l=!1}if(c=a[i.length-2],c[3]===0){if(c[2]>0){let p=-c[1]/(2*c[2]);Math.abs(p)<s?l&&o.push([p+i[i.length-2],((c[3]*p+c[2])*p+c[1])*p+c[0]]):p>=s&&o.push([p+i[i.length-2],((c[3]*p+c[2])*p+c[1])*p+c[0]])}}else{let p=4*c[2]*c[2]-12*c[3]*c[1];if(p>0){let m=Math.sqrt(p),f=(-2*c[2]+m)/(6*c[3]);f>=s?o.push([f+i[i.length-2],((c[3]*f+c[2])*f+c[1])*f+c[0]]):Math.abs(f)<s&&l&&o.push([f+i[i.length-2],((c[3]*f+c[2])*f+c[1])*f+c[0]])}}return{newValues:{allMinima:o}}}else{if(n.functionChild&&n.functionChild.length===1)return{newValues:{allMinima:n.functionChild[0].stateValues.allMinima}};let i=n.numericalf,a=-100*n.xscale,s=100*n.xscale,o=1e3,l=(s-a)/o,c=[],d=!1,p=i(a);for(let m=0;m<o;m++){let f=a+m*l,h=a+(m+1)*l,y=p;if(p=i(h),Number.isNaN(y)||Number.isNaN(p))continue;let b=t.fminbr(i,[f,h]);if(b.success!==!0)continue;let g=b.x,T=b.fx;y<T?(d&&Number.isFinite(y)&&c.push([f,y]),d=!1):p<T?d=!0:(d=!1,T<p&&T<y&&T<i(g+b.tol)&&T<i(g-b.tol)&&Number.isFinite(T)&&c.push([g,T]))}return{newValues:{allMinima:c}}}}},e.numberMinima={public:!0,componentType:"number",returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}),definition({dependencyValues:n}){return{newValues:{numberMinima:n.allMinima.length},checkForActualChange:{numberMinima:!0}}}},e.minima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],public:!0,componentType:"number",isArray:!0,nDimensions:2,entryPrefixes:["minimum","minimumLocations","minimumLocation","minimumValues","minimumValue"],returnWrappingComponents(n){return n==="minimum"||n===void 0?[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]:[]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if(["minimum","minimumLocation","minimumValue"].includes(n)){let a=Number(r)-1;return Number.isInteger(a)&&a>=0?!i||a<i[0]?n==="minimum"?[a+",0",a+",1"]:n==="minimumLocation"?[a+",0"]:[a+",1"]:[]:[]}else return n==="minimumLocations"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",0"):n==="minimumValues"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,i]=n.split(",");return i==="0"?"minimumLocation"+(Number(r)+1):"minimumValue"+(Number(r)+1)},returnArraySizeDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"}}),returnArraySize({dependencyValues:n}){return[n.numberMinima,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allMinima:{dependencyType:"stateVariable",variableName:"allMinima"}}}},arrayDefinitionByKey({globalDependencyValues:n}){let r={};for(let i=0;i<n.__array_size[0];i++)for(let a=0;a<2;a++){let s=`${i},${a}`;r[s]=n.allMinima[i][a]}return{newValues:{minima:r}}}},e.allMaxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["allMaxima"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){if(n.isInterpolatedFunction){let r=n.xs,i=n.coeffs,a=t.eps,s=[];if(r===null)return{newValues:{allMaxima:s}};let o=!1,l=i[0],c=r[1]-r[0];if(l[3]===0){if(l[2]<0){let d=-l[1]/(2*l[2]);d<=c-a?s.push([d+r[0],((l[3]*d+l[2])*d+l[1])*d+l[0]]):Math.abs(d-c)<a&&(o=!0)}}else{let d=4*l[2]*l[2]-12*l[3]*l[1];if(d>0){let p=Math.sqrt(d),m=(-2*l[2]-p)/(6*l[3]);m<=c-a?s.push([m+r[0],((l[3]*m+l[2])*m+l[1])*m+l[0]]):Math.abs(m-c)<a&&(o=!0)}}for(let d=1;d<r.length-2;d++)if(l=i[d],c=r[d+1]-r[d],l[3]===0)if(l[2]<0){let p=-l[1]/(2*l[2]);Math.abs(p)<a?o&&s.push([p+r[d],((l[3]*p+l[2])*p+l[1])*p+l[0]]):p>=a&&p<=c-a&&s.push([p+r[d],((l[3]*p+l[2])*p+l[1])*p+l[0]]),o=Math.abs(p-c)<a}else o=!1;else{let p=4*l[2]*l[2]-12*l[3]*l[1];if(p>0){let m=Math.sqrt(p),f=(-2*l[2]-m)/(6*l[3]);Math.abs(f)<a?o&&s.push([f+r[d],((l[3]*f+l[2])*f+l[1])*f+l[0]]):f>=a&&f<=c-a&&s.push([f+r[d],((l[3]*f+l[2])*f+l[1])*f+l[0]]),o=Math.abs(f-c)<a}else o=!1}if(l=i[r.length-2],l[3]===0){if(l[2]<0){let d=-l[1]/(2*l[2]);Math.abs(d)<a?o&&s.push([d+r[r.length-2],((l[3]*d+l[2])*d+l[1])*d+l[0]]):d>=a&&s.push([d+r[r.length-2],((l[3]*d+l[2])*d+l[1])*d+l[0]])}}else{let d=4*l[2]*l[2]-12*l[3]*l[1];if(d>0){let p=Math.sqrt(d),m=(-2*l[2]-p)/(6*l[3]);m>=a?s.push([m+r[r.length-2],((l[3]*m+l[2])*m+l[1])*m+l[0]]):Math.abs(m)<a&&o&&s.push([m+r[r.length-2],((l[3]*m+l[2])*m+l[1])*m+l[0]])}}return{newValues:{allMaxima:s}}}else{if(n.functionChild&&n.functionChild.length===1)return{newValues:{allMaxima:n.functionChild[0].stateValues.allMaxima}};let r=p=>-n.numericalf(p),i=-100*n.xscale,a=100*n.xscale,s=1e3,o=(a-i)/s,l=[],c=!1,d=r(i);for(let p=0;p<s;p++){let m=i+p*o,f=i+(p+1)*o,h=d;if(d=r(f),Number.isNaN(h)||Number.isNaN(d))continue;let y=t.fminbr(r,[m,f]);if(y.success!==!0)continue;let b=y.x,g=y.fx;h<g?(c&&Number.isFinite(h)&&l.push([m,-h]),c=!1):d<g?c=!0:(c=!1,g<d&&g<h&&g<r(b+y.tol)&&g<r(b-y.tol)&&Number.isFinite(g)&&l.push([b,-g]))}return{newValues:{allMaxima:l}}}}},e.numberMaxima={public:!0,componentType:"number",returnDependencies:()=>({allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:n}){return{newValues:{numberMaxima:n.allMaxima.length},checkForActualChange:{numberMaxima:!0}}}},e.maxima={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],public:!0,componentType:"number",isArray:!0,nDimensions:2,entryPrefixes:["maximum","maximumLocations","maximumLocation","maximumValues","maximumValue"],returnWrappingComponents(n){return n==="maximum"||n===void 0?[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]:[]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if(["maximum","maximumLocation","maximumValue"].includes(n)){let a=Number(r)-1;return Number.isInteger(a)&&a>=0?!i||a<i[0]?n==="maximum"?[a+",0",a+",1"]:n==="maximumLocation"?[a+",0"]:[a+",1"]:[]:[]}else return n==="maximumLocations"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",0"):n==="maximumValues"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,i]=n.split(",");return i==="0"?"maximumLocation"+(Number(r)+1):"maximumValue"+(Number(r)+1)},returnArraySizeDependencies:()=>({numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),returnArraySize({dependencyValues:n}){return[n.numberMaxima,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}}},arrayDefinitionByKey({globalDependencyValues:n}){let r={};for(let i=0;i<n.__array_size[0];i++)for(let a=0;a<2;a++){let s=`${i},${a}`;r[s]=n.allMaxima[i][a]}return{newValues:{maxima:r}}}},e.numberExtrema={public:!0,componentType:"number",returnDependencies:()=>({numberMinima:{dependencyType:"stateVariable",variableName:"numberMinima"},numberMaxima:{dependencyType:"stateVariable",variableName:"numberMaxima"}}),definition:function({dependencyValues:n}){return{newValues:{numberExtrema:n.numberMinima+n.numberMaxima},checkForActualChange:{numberExtrema:!0}}}},e.allExtrema={returnDependencies:()=>({allMinima:{dependencyType:"stateVariable",variableName:"allMinima"},allMaxima:{dependencyType:"stateVariable",variableName:"allMaxima"}}),definition({dependencyValues:n}){return{newValues:{allExtrema:[...n.allMinima,...n.allMaxima].sort((i,a)=>i[0]-a[0])}}}},e.extrema={public:!0,componentType:"number",isArray:!0,nDimensions:2,entryPrefixes:["extremum","extremumLocations","extremumLocation","extremumValues","extremumValue"],returnWrappingComponents(n){return n==="extremum"||n===void 0?[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]:[]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if(["extremum","extremumLocation","extremumValue"].includes(n)){let a=Number(r)-1;return Number.isInteger(a)&&a>=0?!i||a<i[0]?n==="extremum"?[a+",0",a+",1"]:n==="extremumLocation"?[a+",0"]:[a+",1"]:[]:[]}else return n==="extremumLocations"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",0"):n==="extremumValues"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,i]=n.split(",");return i==="0"?"extremumLocation"+(Number(r)+1):"extremumValue"+(Number(r)+1)},returnArraySizeDependencies:()=>({numberExtrema:{dependencyType:"stateVariable",variableName:"numberExtrema"}}),returnArraySize({dependencyValues:n}){return[n.numberExtrema,2]},returnArrayDependenciesByKey(){return{globalDependencies:{allExtrema:{dependencyType:"stateVariable",variableName:"allExtrema"}}}},arrayDefinitionByKey({globalDependencyValues:n}){let r={};for(let i=0;i<n.__array_size[0];i++)for(let a=0;a<2;a++){let s=`${i},${a}`;r[s]=n.allExtrema[i][a]}return{newValues:{extrema:r}}}},e.functionChild={returnDependencies:()=>({functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction"}}),definition:function({dependencyValues:n}){return n.functionChild.length===1?{newValues:{functionChild:n.functionChild[0]}}:{newValues:{functionChild:null}}}},e.returnNumericalDerivatives={stateVariablesDeterminingDependencies:["isInterpolatedFunction"],returnDependencies({stateValues:n}){return n.isInterpolatedFunction?{xs:{dependencyType:"stateVariable",variableName:"xs"},coeffs:{dependencyType:"stateVariable",variableName:"coeffs"},interpolationPoints:{dependencyType:"stateVariable",variableName:"interpolationPoints"},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}:{functionChild:{dependencyType:"child",childLogicName:"atMostOneFunction",variableNames:["returnNumericalDerivatives"]},isInterpolatedFunction:{dependencyType:"stateVariable",variableName:"isInterpolatedFunction"}}},definition:function({dependencyValues:n}){return n.isInterpolatedFunction?{newValues:{returnNumericalDerivatives:wv(n)}}:n.functionChild.length===1&&n.functionChild[0].stateValues.returnNumericalDerivatives?{newValues:{returnNumericalDerivatives:n.functionChild[0].stateValues.returnNumericalDerivatives}}:{newValues:{returnNumericalDerivatives:null}}}},e}adapters=[{stateVariable:"numericalf",componentType:"curve"},{stateVariable:"formula",componentType:"math"}]},xr=Ta;function Tr(u){let t=u.formula,e=u.variable.tree,n=u.simplify,r=u.expand;return i=>Ge({value:t.substitute({[e]:i}),simplify:n,expand:r})}function Nr(u){let t;try{t=u.formula.f()}catch(n){t=()=>NaN}let e=u.variable.tree;return function(n){try{return t({[e]:n})}catch(r){return NaN}}}function xv({dependencyValues:u,numerics:t}){let e=[],n=[],r={maximum:u.prescribedMaxima,minimum:u.prescribedMinima,extremum:u.prescribedExtrema,point:u.prescribedPoints};for(let v in r)for(let C of r[v]){let x=null,V=null,w=null;if(C.x!==null&&(x=C.x.evaluate_to_constant(),!Number.isFinite(x))){console.warn(`Ignoring non-numerical ${v}`);continue}if(C.y!==null&&(V=C.y.evaluate_to_constant(),!Number.isFinite(V))){console.warn(`Ignoring non-numerical ${v}`);continue}if(C.slope!==null&&C.slope!==void 0&&(w=C.slope.evaluate_to_constant(),Number.isFinite(w)||(console.warn("Ignoring non-numerical slope"),w=null)),x===null){if(V===null){console.warn(`Ignoring empty ${v}`);continue}n.push({type:v,y:V,slope:w})}else e.push({type:v,x,y:V,slope:w})}e.sort((v,C)=>v.x-C.x),n.sort((v,C)=>v.y-C.y);let i=-Infinity,a=t.eps;for(let v=0;v<e.length;v++){let C=e[v];if(C.x<=i+a)return console.warn("Two points with locations too close together.  Can't define function"),{newValues:{interpolationPoints:null}};i=C.x}let s=u.xscale,o=u.yscale;i=void 0;let l,c,d=[],p=e[0];for(let v=0;v<e.length;v++){let C=p;p=e[v+1];let x=y({p:C,pNext:p,typePrev:c,xPrev:i,yPrev:l});c=x.type,i=x.x,l=x.y}let m=!1;for(e.length===0&&(m=!0);n.length>0;){let v;c===void 0?v=N({allowedTypes:["maximum","minimum","extremum"],comparison:"atLeast",value:-Infinity}):c==="maximum"?v=N({allowedTypes:["minimum","extremum"],comparison:"atMost",value:l-o}):c==="minimum"?v=N({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:l+o}):c==="point"&&(v=N({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:l+o}),v.success!==!0&&(v=N({allowedTypes:["minimum","extremum"],comparison:"atMost",value:l-o})));let C;v.success===!0?(C=v.point,n.splice(v.ind,1),m?(C.x=0,m=!1):C.x=i+s):(C=n.pop(),m?(C.x=0,m=!1):C.x=i+2*s);let x=y({p:C,typePrev:c,xPrev:i,yPrev:l});c=x.type,i=x.x,l=x.y}if(d.length===0&&d.push({type:"point",x:0,y:0,slope:0}),m=d[0],m.type==="maximum"){let v={type:"point",x:m.x-s,y:m.y-o,slope:2*o/s};d.splice(0,0,v)}else if(m.type==="minimum"){let v={type:"point",x:m.x-s,y:m.y+o,slope:-2*o/s};d.splice(0,0,v)}else if(m.type==="point")if(d.length===1)m.slope===null&&(m.slope=0);else{let v=d[1],C=(v.y-m.y)/(v.x-m.x);if(v.type==="maximum"||v.type==="minimum")m.slope===null&&(m.slope=2*C);else{d.length===2?m.slope===null&&(m.slope=C):(v.slope===null&&(v.slope=h({point:v,prevPoint:m,nextPoint:d[2]})),m.slope===null&&(m.slope=2*(m.y-v.y)/(m.x-v.x)-v.slope));let x={x:m.x-s,y:m.y-s*m.slope,slope:m.slope};d.splice(0,0,x)}}let f=d[d.length-1];if(f.type==="maximum"){let v={type:"point",x:f.x+s,y:f.y-o,slope:-2*o/s};d.push(v)}else if(f.type==="minimum"){let v={type:"point",x:f.x+s,y:f.y+o,slope:2*o/s};d.push(v)}else if(f.type==="point")if(d.length===1){let v={type:"point",x:f.x+s,y:f.y+m.slope*s,slope:m.slope};d.push(v)}else{let v=d[d.length-2],C=(v.y-f.y)/(v.x-f.x);if(v.type==="maximum"||v.type==="minimum")f.slope===null&&(f.slope=2*C);else{d.length===2?f.slope===null&&(f.slope=C):(v.slope===null&&(v.slope=h({point:v,prevPoint:d[d.length-3],nextPoint:f})),f.slope===null&&(f.slope=2*(v.y-f.y)/(v.x-f.x)-v.slope));let x={x:f.x+s,y:f.y+s*f.slope,slope:f.slope};d.push(x)}}for(let v=1;v<d.length-1;v++){let C=d[v];C.slope===null&&(C.slope=h({point:C,prevPoint:d[v-1],nextPoint:d[v+1]}))}return{newValues:{interpolationPoints:d}};function h({point:v,prevPoint:C,nextPoint:x}){let V=v.x-C.x,w=x.x-v.x,D=v.y-C.y,I=x.y-v.y,A=D/V,S=I/w,O=(A*w+S*V)/(V+w);return(Math.sign(A)+Math.sign(S))*Math.min(Math.abs(A),Math.abs(S),.5*Math.abs(O))}function y({p:v,pNext:C,typePrev:x,xPrev:V,yPrev:w}){let D;if(C!==void 0&&(D=C.y),v.type==="maximum")return b({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C});if(v.type==="minimum")return g({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C});if(v.type==="extremum"){let I;if(x===void 0){if(C===void 0)return b({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C});I=C.type}if(x==="maximum"||I==="maximum")return v.y!==null&&v.y>w-o?b({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C}):I!==void 0&&v.y!==null&&v.y>C.y-o?b({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C}):g({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C});if(x==="minimum"||I==="minimum")return v.y!==null&&v.y<w+o?g({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C}):I!==void 0&&v.y!==null&&v.y>C.y+o?g({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C}):b({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C});if(x==="point"||I==="point"){let A="maximum";return(v.y===null&&C!==void 0&&C.type===maximum||v.y!==null&&v.y<=w-o||I!==void 0&&v.y!==null&&v.y>=C.y-o)&&(A="minimum"),A==="minimum"?g({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C}):b({x:v.x,y:v.y,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C})}}else if(v.type==="point")return T({x:v.x,y:v.y,slope:v.slope,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:C})}function b({x:v,y:C,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:I}){if(x===void 0)C===null&&(D===void 0?C=0:I.type==="maximum"?C=D:C=D+o);else if(x==="maximum"){C===null&&(D===void 0?C=w:I.type==="maximum"?C=Math.max(w,D):C=Math.max(w,D+o));let S=Math.min(w,C)-o,O=(v+V)/2,P,L,F=null,M=N({allowedTypes:["minimum","extremum"],comparison:"atMost",value:S});M.success===!0?(L="minimum",P=M.point.y,n.splice(M.ind,1),F=0):(L="point",P=S),d.push({type:L,x:O,y:P,slope:F})}else if(x==="minimum"){if(C===null)D===void 0?C=w+o:I.type==="maximum"?C=Math.max(w+o,D):C=Math.max(w,D)+o;else if(C<w+o){let S=[(2*V+v)/3,(V+2*v)/3],O=[w+o,C-o],P=["atLeast","atMost"],L=[["maximum","extremum"],["minimum","extremum"]];for(let F=0;F<2;F++){let M=S[F],_,j,q=null,W=N({allowedTypes:L[F],comparison:P[F],value:O[F]});W.success===!0?(j=L[F][0],_=W.point.y,n.splice(W.ind,1),q=0):(j="point",_=O[F],q=null),d.push({type:j,x:M,y:_,slope:q})}}}else if(x==="point"){if(C===null)D===void 0?C=w+o:I.type==="maximum"?C=Math.max(w+o,D):C=Math.max(w,D)+o;else if(C<w+o){let S=(v+V)/2,O,P,L=null,F=N({allowedTypes:["minimum","extremum"],comparison:"atMost",value:C-o});F.success===!0?(P="minimum",O=F.point.y,n.splice(F.ind,1),L=0):(P="point",O=C-o),d.push({type:P,x:S,y:O,slope:L})}}let A={type:"maximum",x:v,y:C,slope:0};return d.push(A),A}function g({x:v,y:C,typePrev:x,xPrev:V,yPrev:w,yNext:D,pNext:I}){if(x===void 0)C===null&&(D===void 0?C=0:I.type==="minimum"?C=D:C=D-o);else if(x==="maximum"){if(C===null)D===void 0?C=w-o:I.type==="minimum"?C=Math.min(w-o,D):C=Math.min(w,D)-o;else if(C>w-o){let S=[(2*V+v)/3,(V+2*v)/3],O=[w-o,C+o],P=["atMost","atLeast"],L=[["minimum","extremum"],["maximum","extremum"]];for(let F=0;F<2;F++){let M=S[F],_,j,q=null,W=N({allowedTypes:L[F],comparison:P[F],value:O[F]});W.success===!0?(j=L[F][0],_=W.point.y,n.splice(W.ind,1),q=0):(j="point",_=O[F],q=null),d.push({type:j,x:M,y:_,slope:q})}}}else if(x==="minimum"){C===null&&(D===void 0?C=w:I.type==="minimum"?C=Math.min(w,D):C=Math.min(w,D-o));let S=Math.max(w,C)+o,O=(v+V)/2,P,L,F=null,M=N({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:S});M.success===!0?(L="maximum",P=M.point.y,n.splice(M.ind,1),F=0):(L="point",P=S),d.push({type:L,x:O,y:P,slope:F})}else if(x==="point"){if(C===null)D===void 0?C=w-o:I.type==="minimum"?C=Math.min(w-o,D):C=Math.min(w,D)-o;else if(C>w-o){let S=(v+V)/2,O,P,L=null,F=N({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:C+o});F.success===!0?(P="maximum",O=F.point.y,n.splice(F.ind,1),L=0):(P="point",O=C+o),d.push({type:P,x:S,y:O,slope:L})}}let A={type:"minimum",x:v,y:C,slope:0};return d.push(A),A}function T({x:v,y:C,slope:x,typePrev:V,xPrev:w,yPrev:D,yNext:I,pNext:A}){if(V==="maximum"){if(C>D-o){let O=Math.min(D,C)-o,P=(v+w)/2,L,F,M=null,_=N({allowedTypes:["minimum","extremum"],comparison:"atMost",value:O});_.success===!0?(F="minimum",L=_.point.y,n.splice(_.ind,1),M=0):(F="point",L=D-o),d.push({type:F,x:P,y:L,slope:M})}}else if(V==="minimum"&&C<D+o){let O=Math.max(D,C)+o,P=(v+w)/2,L,F,M=null,_=N({allowedTypes:["maximum","extremum"],comparison:"atLeast",value:O});_.success===!0?(F="maximum",L=_.point.y,n.splice(_.ind,1),M=0):(F="point",L=D+o),d.push({type:F,x:P,y:L,slope:M})}let S={type:"point",x:v,y:C,slope:x};return d.push(S),S}function N({allowedTypes:v,comparison:C,value:x}){let V=[];if(C==="atMost")V=Object.keys(n).reverse();else if(C==="atLeast")V=Object.keys(n);else return{success:!1};for(let w of v)for(let D of V){let I=n[D];if(I.type===w){if(C==="atMost"){if(I.y<=x)return{success:!0,ind:D,point:I}}else if(I.y>=x)return{success:!0,ind:D,point:I}}}return{success:!1}}}function Vv({dependencyValues:u}){let t=function(s,o,l,c,d){return[s,l,(-3*s/d+3*o/d-2*l-c)/d,(2*s/d-2*o/d+l+c)/(d*d)]},e=u.interpolationPoints;if(e===null)return{newValues:{xs:null,coeffs:null}};let n=[],r=[],i,a=e[0];r.push(a.x);for(let s=1;s<e.length;s++){i=a,a=e[s];let o=t(i.y,a.y,i.slope,a.slope,a.x-i.x);Math.abs(o[3])<1e-14*Math.max(Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2]))&&(o[3]=0,Math.abs(o[2])<1e-14*Math.max(Math.abs(o[0]),Math.abs(o[1]))&&(o[2]=0)),n.push(o),r.push(a.x)}return{newValues:{xs:r,coeffs:n}}}function Cm(u){let t=u.xs,e=u.coeffs,n=[];if(u.interpolationPoints&&(n=u.interpolationPoints.map(a=>a.y)),t===null)return a=>NaN;let r=t[0],i=t[t.length-1];return function(a){if(isNaN(a))return NaN;if(a<=r){a-=r;let p=e[0];return((p[3]*a+p[2])*a+p[1])*a+p[0]}if(a>=i){let p=t.length-2;a-=t[p];let m=e[p];return((m[3]*a+m[2])*a+m[1])*a+m[0]}for(var s=0,o,l=t.length-1;s<=l;){o=Math.floor(.5*(s+l));let p=t[o];if(p<a)s=o+1;else if(p>a)l=o-1;else return n[o]}let c=Math.max(0,l);a-=t[c];let d=e[c];return((d[3]*a+d[2])*a+d[1])*a+d[0]}}function wv(u){let t=u.xs,e=u.coeffs,n=t[0],r=t[t.length-1];return function(i=1){return i>3?a=>0:i<1||!Number.isInteger(i)||t==null?a=>NaN:function(a){if(isNaN(a))return NaN;if(a<=n){a-=n;let p=e[0];return i===1?(3*p[3]*a+2*p[2])*a+p[1]:i===2?6*p[3]*a+2*p[2]:6*p[3]}if(a>=r){let p=t.length-2;a-=t[p];let m=e[p];return i===1?(3*m[3]*a+2*m[2])*a+m[1]:i===2?6*m[3]*a+2*m[2]:6*m[3]}for(var s=0,o,l=t.length-1;s<=l;){o=Math.floor(.5*(s+l));let p=t[o];if(p<a)s=o+1;else if(p>a)l=o-1;else return i===1?e[o][1]:i===2?2*e[o][2]:6*e[o][3]}let c=Math.max(0,l);a-=t[c];let d=e[c];return i===1?(3*d[3]*a+2*d[2])*a+d[1]:i===2?6*d[3]*a+2*d[2]:6*d[3]}}}import _n from"../_snowpack/pkg/math-expressions.js";var Na=class extends xr{static componentType="_functionoperator";static returnSugarInstructions(){let t=[];return t.push({childrenRegex:/s/,replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"math",children:e}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1}),r=e.newLeaf({name:"atMostOneFunctionForOperator",componentType:"function",comparison:"atMost",number:1}),i=e.newOperator({name:"functionXorMath",operator:"xor",propositions:[n,r]}),a=e.newLeaf({name:"atMostOneVariable",componentType:"variable",comparison:"atMost",number:1,takePropertyChildren:!0}),s=e.newLeaf({name:"atMostOneSymbolic",componentType:"symbolic",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"functionAndVariable",operator:"and",propositions:[i,a,s],setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});e.isInterpolatedFunction={returnDependencies:()=>({}),definition:()=>({newValues:{isInterpolatedFunction:!1}})},delete e.nPrescribedPoints,delete e.prescribedPoints,delete e.prescribedMinima,delete e.prescribedMaxima,delete e.prescribedExtrema,delete e.interpolationPoints,delete e.xs;let n=e.variable.returnDependencies;e.variable.returnDependencies=function(){let i=n();return i.functionChild.childLogicName="atMostOneFunctionForOperator",i};let r=e.symbolic.returnDependencies;return e.symbolic.returnDependencies=function(){let i=r();return i.functionChild.childLogicName="atMostOneFunctionForOperator",i},e.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({newValues:{operatorBasedOnFormulaIfAvailable:!1}})},e.formula.returnDependencies=()=>({}),e.formula.definition=()=>({newValues:{formula:_n.fromAst("\uFF3F")}}),e.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({newValues:{operatorComposesWithOriginal:!0}})},e.symbolicFunctionOperator={returnDependencies:()=>({}),definition:()=>({newValues:{symbolicFunctionOperator:i=>_n.fromAst("\uFF3F")}})},e.numericalFunctionOperator={returnDependencies:()=>({}),definition:()=>({newValues:{numericalFunctionOperator:i=>NaN}})},e.formulaOperator={returnDependencies:()=>({}),definition:()=>({newValues:{formulaOperator:i=>_n.fromAst("\uFF3F")}})},e.returnNumericalDerivatives={returnDependencies:()=>({}),definition:()=>({newValues:{returnNumericalDerivatives:null}})},e.formula={public:!0,componentType:"formula",additionalStateVariablesDefined:["operatorBasedOnFormula"],returnDependencies:()=>({operatorBasedOnFormulaIfAvailable:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormulaIfAvailable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["formula"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value"]},formulaOperator:{dependencyType:"stateVariable",variableName:"formulaOperator"}}),definition:function({dependencyValues:i}){if(!i.operatorBasedOnFormulaIfAvailable||(i.functionChild.length===0||i.functionChild[0].stateValues.formula.tree==="\uFF3F")&&(i.mathChild.length===0||i.mathChild[0].stateValues.value.tree==="\uFF3F"))return{newValues:{formula:_n.fromAst("\uFF3F"),operatorBasedOnFormula:!1}};let a;return i.functionChild.length===0?a=i.mathChild[0].stateValues.value:a=i.functionChild[0].stateValues.formula,{newValues:{formula:i.formulaOperator(a),operatorBasedOnFormula:!0}}}},e.symbolicf={returnDependencies:()=>({operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},simplify:{dependencyType:"stateVariable",variableName:"simplify"},expand:{dependencyType:"stateVariable",variableName:"expand"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["symbolicf"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value"]},symbolicFunctionOperator:{dependencyType:"stateVariable",variableName:"symbolicFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"}}),definition:function({dependencyValues:i}){if(i.operatorBasedOnFormula)return{newValues:{symbolicf:Tr(i)}};if(i.operatorComposesWithOriginal)if(i.functionChild.length===0){if(i.mathChild.length===0)return{newValues:{symbolicf:a=>_n.fromAst("\uFF3F")}};{let a=Object.assign({},i);a.formula=i.mathChild[0].stateValues.value;let s=Tr(i);return{newValues:{symbolicf:o=>i.symbolicFunctionOperator(s(o))}}}}else{let a=i.functionChild[0].stateValues.symbolicf;return{newValues:{symbolicf:s=>i.symbolicFunctionOperator(a(s))}}}else return{newValues:{symbolicf:function(a){return i.symbolicFunctionOperator(a)}}}}},e.numericalf={returnDependencies:()=>({operatorBasedOnFormula:{dependencyType:"stateVariable",variableName:"operatorBasedOnFormula"},formula:{dependencyType:"stateVariable",variableName:"formula"},variable:{dependencyType:"stateVariable",variableName:"variable"},functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["numericalf"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value"]},numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"},operatorComposesWithOriginal:{dependencyType:"stateVariable",variableName:"operatorComposesWithOriginal"}}),definition:function({dependencyValues:i}){if(i.operatorBasedOnFormula)return{newValues:{numericalf:Nr(i)}};if(i.operatorComposesWithOriginal)if(i.functionChild.length===0){if(i.mathChild.length===0)return{newValues:{numericalf:a=>NaN}};{let a=Object.assign({},i);a.formula=i.mathChild[0].stateValues.value;let s=Nr(i);return{newValues:{numericalf:o=>i.numericalFunctionOperator(s(o))}}}}else{let a=i.functionChild[0].stateValues.numericalf;return{newValues:{numericalf:s=>i.numericalFunctionOperator(a(s))}}}else return{newValues:{numericalf:function(a){return i.numericalFunctionOperator(a)}}}}},e.functionChild={returnDependencies:()=>({}),definition:()=>({newValues:{functionChild:null}})},e.allMinima.returnDependencies=()=>({numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"}}),e.allMaxima.returnDependencies=()=>({numericalf:{dependencyType:"stateVariable",variableName:"numericalf"},xscale:{dependencyType:"stateVariable",variableName:"xscale"}}),e}},sn=Na;import Vr from"../_snowpack/pkg/math-expressions.js";var Tm=class extends sn{static componentType="clampfunction";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.lowerValue={default:0},e.upperValue={default:1},e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.numericalFunctionOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:n}){return{newValues:{numericalFunctionOperator:function(r){return Number.isFinite(r)?Math.max(n.lowerValue,Math.min(n.upperValue,r)):NaN}}}}},e.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:n}){return{newValues:{symbolicFunctionOperator:r=>Vr.fromAst(n.numericalFunctionOperator(r.evaluate_to_constant()))}}}},e}},Nm=class extends sn{static componentType="wrapfunctionperiodic";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.lowerValue={default:0},e.upperValue={default:1},e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.numericalFunctionOperator={returnDependencies:()=>({lowerValue:{dependencyType:"stateVariable",variableName:"lowerValue"},upperValue:{dependencyType:"stateVariable",variableName:"upperValue"}}),definition:function({dependencyValues:n}){return{newValues:{numericalFunctionOperator:function(r){if(!Number.isFinite(r))return NaN;let i=n.lowerValue,a=n.upperValue;return i===a?i:(i>a&&([a,i]=[i,a]),i+Vr.math.mod(r-i,a-i))}}}}},e.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:n}){return{newValues:{symbolicFunctionOperator:r=>Vr.fromAst(n.numericalFunctionOperator(r.evaluate_to_constant()))}}}},e}},xm=class extends sn{static componentType="derivative";static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.operatorBasedOnFormulaIfAvailable={returnDependencies:()=>({}),definition:()=>({newValues:{operatorBasedOnFormulaIfAvailable:!0}})},e.operatorComposesWithOriginal={returnDependencies:()=>({}),definition:()=>({newValues:{operatorComposesWithOriginal:!1}})},e.formulaOperator={returnDependencies:()=>({variable:{dependencyType:"stateVariable",variableName:"variable"}}),definition({dependencyValues:n}){return{newValues:{formulaOperator:function(r){return r.derivative(n.variable.tree)}}}}},e.numericalFunctionOperator={returnDependencies:()=>({functionChild:{dependencyType:"child",childLogicName:"atMostOneFunctionForOperator",variableNames:["returnNumericalDerivatives"],variablesOptional:!0}}),additionalStateVariablesDefined:["returnNumericalDerivatives"],definition:function({dependencyValues:n}){return n.functionChild.length===0||!n.functionChild[0].stateValues.returnNumericalDerivatives?{newValues:{numericalFunctionOperator:r=>NaN,returnNumericalDerivatives:null}}:{newValues:{numericalFunctionOperator:n.functionChild[0].stateValues.returnNumericalDerivatives(1),returnNumericalDerivatives:(r=1)=>n.functionChild[0].stateValues.returnNumericalDerivatives(r+1)}}}},e.symbolicFunctionOperator={returnDependencies:()=>({numericalFunctionOperator:{dependencyType:"stateVariable",variableName:"numericalFunctionOperator"}}),definition({dependencyValues:n}){return{newValues:{symbolicFunctionOperator:r=>Vr.fromAst(n.numericalFunctionOperator(r.evaluate_to_constant()))}}}},e}};var Va={};fe(Va,{Extrema:()=>Dr,Extremum:()=>wr,Maxima:()=>Dm,Maximum:()=>Vm,Minima:()=>Am,Minimum:()=>wm});var wr=class extends R{static componentType="extremum";static rendererType=void 0;static get stateVariablesShadowedForReference(){return["location","value"]}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let a=Ct({childrenToComponentFunction:s=>({componentType:"x",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});if(!a.success&&n.length===1)return{success:!0,newChildren:[{componentType:"value",doenetAttributes:{isPropertyChild:!0},children:n}]};if(a.success)if(a.newChildren.length===1)a.newChildren[0].componentType="value",a.newChildren[0].doenetAttributes={isPropertyChild:!0};else if(a.newChildren.length===2)a.newChildren[0].componentType="location",a.newChildren[0].doenetAttributes={isPropertyChild:!0},a.newChildren[1].componentType="value",a.newChildren[1].doenetAttributes={isPropertyChild:!0},(a.newChildren[1].children.length===0||a.newChildren[1].children.length===1&&a.newChildren[1].children[0].componentType==="string"&&a.newChildren[1].children[0].state.value.trim()==="")&&a.newChildren.splice(1,1),(a.newChildren[0].children.length===0||a.newChildren[0].children.length===1&&a.newChildren[0].children[0].componentType==="string"&&a.newChildren[0].children[0].state.value.trim()==="")&&a.newChildren.splice(0,1);else return{success:!1};return a};return t.push({childrenRegex:/s+(.*s)?/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneLocation",componentType:"location",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"exactlyOneValue",componentType:"value",number:1,takePropertyChildren:!0}),i=e.newOperator({name:"locationOrValue",operator:"or",propositions:[n,r]}),a=e.newLeaf({name:"atMostOnePoint",componentType:"point",comparison:"atMost",number:1});return e.newOperator({name:"locationValueXorPoint",operator:"xor",propositions:[i,a],setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t}),n=this;return e.value={public:!0,componentType:"math",defaultValue:null,additionalStateVariablesDefined:[{variableName:"location",public:!0,componentType:"math",defaultValue:null}],returnDependencies:()=>({extremumChild:{dependencyType:"child",childLogicName:"atMostOnePoint",variableNames:["nDimensions","xs"]},locationChild:{dependencyType:"child",childLogicName:"exactlyOneLocation",variableNames:["value"]},valueChild:{dependencyType:"child",childLogicName:"exactlyOneValue",variableNames:["value"]}}),definition:function({dependencyValues:r}){let i,a;if(r.extremumChild.length===1){let p=r.extremumChild[0];p.stateValues.nDimensions!==2?(console.log("Cannot determine "+n.componentType+" from a point that isn't 2D"),i=null,a=null):(i=p.stateValues.xs[0],a=p.stateValues.xs[1])}else r.locationChild.length===1&&(i=r.locationChild[0].stateValues.value),r.valueChild.length===1&&(a=r.valueChild[0].stateValues.value);let s={},o={},l=!1,c=!1;i===void 0?(o.location={variablesToCheck:["location"]},c=!0):(s.location=i,l=!0),a===void 0?(o.value={variablesToCheck:["value"]},c=!0):(s.value=a,l=!0);let d={};return l&&(d.newValues=s),c&&(d.useEssentialOrDefaultValue=o),d}},e}},Vm=class extends wr{static componentType="maximum"},wm=class extends wr{static componentType="minimum"},Dr=class extends R{static componentType="extrema";static rendererType="container";static componentTypeSingular="extremum";static get componentTypeCapitalized(){return this.componentType.charAt(0).toUpperCase()+this.componentType.slice(1)}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=this,n=function({matchedChildren:r}){let i=Xe({componentList:r});return i.success!==!0?{success:!1}:{success:!0,newChildren:i.pieces.map(function(a){return a.length>1||a[0].componentType==="string"?{componentType:e.componentTypeSingular,children:a}:a[0]})}};return t.push({replacementFunction:n}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroExtrema",componentType:this.componentTypeSingular,comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0});return e.newOperator({name:"extremaAndPoints",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=this;return t["n"+e.componentTypeCapitalized]={additionalStateVariablesDefined:["childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"extremaAndPoints"}}),definition:function({dependencyValues:n}){return{newValues:{["n"+e.componentTypeCapitalized]:n.children.length,childIdentities:n.children}}}},t[e.componentType]={isArray:!0,nDimensions:2,entryPrefixes:[e.componentTypeSingular,e.componentTypeSingular+"Locations",e.componentTypeSingular+"Location",e.componentTypeSingular+"Values",e.componentTypeSingular+"Value"],stateVariablesDeterminingDependencies:["childIdentities"],getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if([e.componentTypeSingular,e.componentTypeSingular+"Location",e.componentTypeSingular+"Value"].includes(n)){let a=Number(r)-1;return Number.isInteger(a)&&a>=0?!i||a<i[0]?n===e.componentTypeSingular?[a+",0",a+",1"]:n===e.componentTypeSingular+"Location"?[a+",0"]:[a+",1"]:[]:[]}else return n===e.componentTypeSingular+"Locations"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",0"):n===e.componentTypeSingular+"Values"?!i||r!==""?[]:Array.from(Array(i[0]),(a,s)=>s+",1"):[]},arrayVarNameFromArrayKey(n){let[r,i]=n.split(",");return i==="0"?e.componentTypeSingular+"Location"+(Number(r)+1):e.componentTypeSingular+"Value"+(Number(r)+1)},returnArraySizeDependencies:()=>({nChildren:{dependencyType:"stateVariable",variableName:"n"+e.componentTypeCapitalized}}),returnArraySize({dependencyValues:n}){return[n.nChildren,2]},returnArrayDependenciesByKey({arrayKeys:n,stateValues:r}){let i={};for(let a of n){let[s,o]=a.split(","),l;r.childIdentities[s].componentType===e.componentTypeSingular?l=Number(o)===0?"location":"value":l="x"+(Number(o)+1),i[a]={child:{dependencyType:"child",childLogicName:"extremaAndPoints",variableNames:[l],childIndices:[s]}}}return{dependenciesByKey:i}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].child[0];if(s){let o=a.split(",")[1],l=Number(o)===0?"location":"value";l in s.stateValues?i[a]=s.stateValues[l]:i[a]=s.stateValues["x"+(Number(o)+1)]}}return{newValues:{[e.componentType]:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r}){let i=[];for(let a in n[e.componentType])i.push({setDependency:r[a].extremumChild,desiredValue:n[e.componentType][a],childIndex:0,variableIndex:0});return{success:!0,instructions:i}}},t.childrenToRender={returnDependencies:()=>({extremumChildren:{dependencyType:"child",childLogicName:"atLeastZeroExtrema"}}),definition:({dependencyValues:n})=>({newValues:{childrenToRender:n.extremumChildren.map(r=>r.componentName)}})},t}},Dm=class extends Dr{static componentType="maxima";static componentTypeSingular="maximum"},Am=class extends Dr{static componentType="minima";static componentTypeSingular="minimum"};var wa={};fe(wa,{Pattern:()=>Sm,Replace:()=>Im});var Sm=class extends R{static componentType="pattern";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"exactlyOneChild",componentType:"_base",number:1,setAsBase:!0}),e}},Im=class extends R{static componentType="replace";static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:a}){let s=a[0],o=s.state.value.split(",");if(o.length!==2)return{success:!1};let l=o.map(c=>({componentType:"string",state:{value:c.trim()}}));return{success:!0,newChildren:l,toDelete:[s.componentName]}},r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),i=e.newLeaf({name:"exactlyTwoChildren",componentType:"_base",number:2});return e.newOperator({name:"SugarXorChildren",operator:"xor",propositions:[r,i],setAsBase:!0}),e}};var Aa={};fe(Aa,{Alert:()=>Om,Em:()=>Pm,Q:()=>Lm,SQ:()=>Rm,Term:()=>Fm,c:()=>km});var Da=class extends B{static componentType="_inlinerenderinlinechildren";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"AtLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenToRender={returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"AtLeastZeroInline"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.inlineChildren.map(n=>n.componentName)}}}},t}static includeBlankStringChildren=!0},ot=Da;var Pm=class extends ot{static componentType="em"},Om=class extends ot{static componentType="alert"},Lm=class extends ot{static componentType="q"},Rm=class extends ot{static componentType="sq"},Fm=class extends ot{static componentType="term";static rendererType="alert"},km=class extends ot{static componentType="c"};var Sa={};fe(Sa,{Mdash:()=>_m,NBSP:()=>Bm,Ndash:()=>Mm});var Mm=class extends B{static componentType="ndash"},_m=class extends B{static componentType="mdash"},Bm=class extends B{static componentType="nbsp"};var La={};fe(La,{AnswerSet:()=>Wm,Aside:()=>Hm,Example:()=>Km,Exercise:()=>qm,Paragraphs:()=>jm,Problem:()=>Ra,Section:()=>Em,StandinForFutureLayoutTag:()=>Um,Subsection:()=>$m,Subsubsection:()=>zm});var Ia=class extends R{static componentType="_block"},Q=Ia;import Pa from"../_snowpack/pkg/math-expressions.js";function Bn({numberOfIndices:u,numberOfOptions:t,maxNumber:e=Infinity,withReplacement:n=!0}){if(u===1){let s=[...Array(t).keys()];return s=[...s.slice(1),0].slice(0,e),s=s.map(o=>[o]),s}let r=Bn({numberOfIndices:u-1,numberOfOptions:t,maxNumber:e,withReplacement:n}),i=[],a=0;for(let s of r)for(let o=1;o<=t;o++){let l=[o%t,...s.map(c=>(o+c)%t)];if(!(!n&&new Set(l).size<u)&&(i.push(l),a++,a>=e))return i}return i}function on({numberOfOptionsByIndex:u,maxNumber:t=Infinity}){let e=u.length;if(e===0)return[];let n=[];for(let f=0;f<e;f++){let h=[];for(let y=0;y<f;y++)h.push(Pa.math.gcd(u[f],u[y]));n.push(h)}let r=n.reduce((f,h)=>[...h,...f],[]).reduce((f,h)=>Math.max(f,h),1);if(r===1){let f=u.reduce((y,b)=>y*b);f=Math.min(f,t);let h=[];for(let y=0;y<f;y++){let b=u.map(g=>y%g);h.push(b)}return h}if(e===2){let f=r,h=Pa.math.lcm(...u),y=[],b=0;for(let g=0;g<f;g++)for(let T=0;T<h;T++){let N=[T%u[0],(T+g)%u[1]];if(y.push(N),b++,b>=t)return y}return y}let i=[];for(let f=0;f<e;f++){let h=[];for(let y=0;y<f;y++)n[f][y]>1?h.push(Pa.math.lcm(u[f],u[y])):h.push(null);i.push(h)}let a=i.reduce((f,h)=>[...h,...f],[]).filter(f=>f!==null).reduce((f,h)=>Math.min(f,h),Infinity),s;for(let f=0;f<e;f++){for(let h=0;h<f;h++)if(i[f][h]===a){s=[h,f];break}if(s)break}let o=u[s[0]],l=u[s[1]],c=[o,l],d=u;d[s[0]]=o*l,d.splice(s[1],1);let p=on({numberOfOptionsByIndex:d,maxNumber:t}),m=on({numberOfOptionsByIndex:c,maxNumber:t});for(let f of p){let h=m[f[s[0]]];f.splice(s[0],1,h[0]),f.splice(s[1],0,h[1])}return p}function ln({variantNumber:u,serializedComponent:t,allComponentClasses:e}){if(t.variants===void 0)return{success:!1};let n=t.variants.descendantVariantComponents;if(n===void 0)return{success:!1};let r=n.map(s=>s.variants.numberOfVariants),i=on({numberOfOptionsByIndex:r,maxNumber:u+1})[u],a=[];for(let[s,o]of n.entries()){let c=e[o.componentType].getUniqueVariant({serializedComponent:o,variantNumber:i[s],allComponentClasses:e});if(c.success)a.push(c.desiredVariant);else return{succss:!1}}return{success:!0,desiredVariants:a}}var Oa=class extends Q{static componentType="_sectioningcomponent";static setUpVariantIfVariantControlChild=!0;static get stateVariablesShadowedForReference(){return["title"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.aggregateScores={default:!1},e.weight={default:1},e.sectionWideCheckWork={default:!1},e.delegateCheckWorkToAnswerNumber={default:null,forRenderer:!0},e.feedbackDefinitions={propagateToDescendants:!0,mergeArrays:!0},e.styleDefinitions={propagateToDescendants:!0,mergeArrays:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneVariantControl",componentType:"variantcontrol",comparison:"atMost",number:1,allowSpillover:!1}),r=e.newLeaf({name:"atMostOneTitle",componentType:"title",comparison:"atMost",number:1}),i=e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"variantTitleAndAnything",operator:"and",propositions:[n,r,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.enumeration={forRenderer:!0,returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningcomponent",variableNames:["enumeration"]}}),definition({dependencyValues:e}){let n=[];return e.sectionAncestor&&n.push(...e.sectionAncestor.stateValues.enumeration),n.push(e.countAmongSiblings),{newValues:{enumeration:n}}}},t.sectionName={returnDependencies:()=>({}),definition:()=>({newValues:{sectionName:"Section"}})},t.titleDefinedByChildren={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"}}),definition({dependencyValues:e}){return{newValues:{titleDefinedByChildren:e.titleChild.length===1}}}},t.title={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle",variableNames:["text"]},sectionName:{dependencyType:"stateVariable",variableName:"sectionName"},enumeration:{dependencyType:"stateVariable",variableName:"enumeration"}}),definition({dependencyValues:e}){return e.titleChild.length===0?{newValues:{title:e.sectionName+" "+e.enumeration.join(".")}}:{newValues:{title:e.titleChild[0].stateValues.text}}}},t.containerTag={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{containerTag:"section"}})},t.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{level:1}})},t.viewedSolution={defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:{variablesToCheck:["viewedSolution"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"viewedSolution",value:e.viewedSolution}]}}},t.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningcomponent","answer"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:e}){let n=[];for(let r of e.scoredDescendants)r.stateValues.aggregateScores||r.stateValues.scoredDescendants===void 0?n.push(r):n.push(...r.stateValues.scoredDescendants);return{newValues:{scoredDescendants:n}}}},t.answerDescendants={returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],recurseToMatchedChildren:!1}}),definition({dependencyValues:e}){return{newValues:{answerDescendants:e.answerDescendants}}}},t.justSubmitted={forRenderer:!0,returnDependencies:()=>({answerDescendants:{dependencyType:"descendant",componentTypes:["answer"],variableNames:["justSubmitted"],recurseToMatchedChildren:!1}}),definition({dependencyValues:e}){return{newValues:{justSubmitted:e.answerDescendants.every(n=>n.stateValues.justSubmitted)}}}},t.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"}}),definition({dependencyValues:e}){return{newValues:{showCorrectness:e.showCorrectnessFlag!==!1}}}},t.displayDigitsForCreditAchieved={returnDependencies:()=>({}),definition:()=>({newValues:{displayDigitsForCreditAchieved:3}})},t.creditAchieved={public:!0,componentType:"number",forRenderer:!0,defaultValue:0,stateVariablesPrescribingAdditionalProperties:{displayDigits:"displayDigitsForCreditAchieved"},additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,componentType:"number",stateVariablesPrescribingAdditionalProperties:{displayDigits:"displayDigitsForCreditAchieved"}}],stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:e}){let n={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(e.aggregateScores){n.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[r,i]of e.scoredDescendants.entries())n["creditAchieved"+r]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"creditAchieved"}}return n},definition({dependencyValues:e}){if(!e.aggregateScores)return{newValues:{creditAchieved:0,percentCreditAchieved:0}};let n=0,r=0;for(let[s,o]of e.scoredDescendants.entries()){let l=o.stateValues.weight;n+=e["creditAchieved"+s]*l,r+=l}let i=n/r,a=i*100;return{newValues:{creditAchieved:i,percentCreditAchieved:a}}}},t.creditAchievedIfSubmit={defaultValue:0,stateVariablesDeterminingDependencies:["aggregateScores","scoredDescendants"],returnDependencies({stateValues:e}){let n={aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"}};if(e.aggregateScores){n.scoredDescendants={dependencyType:"stateVariable",variableName:"scoredDescendants"};for(let[r,i]of e.scoredDescendants.entries())n["creditAchievedIfSubmit"+r]={dependencyType:"stateVariable",componentName:i.componentName,variableName:"creditAchievedIfSubmit"}}return n},definition({dependencyValues:e}){if(!e.aggregateScores)return{newValues:{creditAchievedIfSubmit:0}};let n=0,r=0;for(let[a,s]of e.scoredDescendants.entries()){let o=s.stateValues.weight;n+=e["creditAchievedIfSubmit"+a]*o,r+=o}return{newValues:{creditAchievedIfSubmit:n/r}}}},t.selectedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:e})=>({variantControlChild:{dependencyType:"child",childLogicName:"atMostOneVariantControl",variableNames:["selectedVariantNumber"]},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){let n,r={};e.variantControlChild.length===1?(n=!0,r.index=e.variantControlChild[0].stateValues.selectedVariantNumber):n=!1;let i=r.subvariants=[];for(let a of e.variantDescendants)a.stateValues.isVariantComponent?i.push(a.stateValues.selectedVariantInfo):a.stateValues.selectedVariantInfo&&i.push(...a.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:r,isVariantComponent:n}}}},t.collapsible={componentType:"boolean",forRenderer:!0,returnDependencies:()=>({}),definition(){return{newValues:{collapsible:!1}}}},t.open={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!0,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{open:{variablesToCheck:["open"]}}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"open",value:e.open}]}}},t.childrenToRender={returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"},activeChildren:{dependencyType:"child",childLogicName:"anything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:[...e.titleChild,...e.activeChildren].map(n=>n.componentName)}}}},t.createSubmitAllButton={forRenderer:!0,additionalStateVariablesDefined:["createSubmitAllButtonOnAnswer"],returnDependencies:()=>({sectionWideCheckWork:{dependencyType:"stateVariable",variableName:"sectionWideCheckWork"},delegateCheckWorkToAnswerNumber:{dependencyType:"stateVariable",variableName:"delegateCheckWorkToAnswerNumber"},aggregateScores:{dependencyType:"stateVariable",variableName:"aggregateScores"},answerDescendants:{dependencyType:"stateVariable",variableName:"answerDescendants"}}),definition({dependencyValues:e,componentName:n}){let r=!1,i=null;if(e.sectionWideCheckWork)if(!e.aggregateScores)console.warn(`Cannot create submit all button for ${n} because it doesn't aggegrate scores`);else{let a=null;if(e.delegateCheckWorkToAnswerNumber>0)a=e.answerDescendants[e.delegateCheckWorkToAnswerNumber-1];else if(e.delegateCheckWorkToAnswerNumber<0){let s=e.answerDescendants.length+e.delegateCheckWorkToAnswerNumber;a=e.answerDescendants[s]}a?i=a.componentName:r=!0}return{newValues:{createSubmitAllButton:r,createSubmitAllButtonOnAnswer:i}}}},t.suppressAnswerSubmitButtons={additionalStateVariablesDefined:["answerDelegatedForSubmitAll","componentNameForSubmitAll","justSubmittedForSubmitAll","creditAchievedForSubmitAll"],forRenderer:!0,returnDependencies:()=>({createSubmitAllButton:{dependencyType:"stateVariable",variableName:"createSubmitAllButton"},createSubmitAllButtonOnAnswer:{dependencyType:"stateVariable",variableName:"createSubmitAllButtonOnAnswer"},justSubmitted:{dependencyType:"stateVariable",variableName:"justSubmitted"},creditAchieved:{dependencyType:"stateVariable",variableName:"creditAchieved"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningcomponent",variableNames:["suppressAnswerSubmitButtons","answerDelegatedForSubmitAll","componentNameForSubmitAll","justSubmittedForSubmitAll","creditAchievedForSubmitAll"]}}),definition({dependencyValues:e,componentName:n}){let r=!1,i=null,a=null,s=null,o=null;if(e.createSubmitAllButton||e.createSubmitAllButtonOnAnswer)a=n,r=!0,e.createSubmitAllButtonOnAnswer&&(i=e.createSubmitAllButtonOnAnswer,s=e.justSubmitted,o=e.creditAchieved);else if(e.sectionAncestor){let l=e.sectionAncestor.stateValues;r=l.suppressAnswerSubmitButtons,a=l.componentNameForSubmitAll,i=l.answerDelegatedForSubmitAll,s=l.justSubmittedForSubmitAll,o=l.creditAchievedForSubmitAll}return{newValues:{suppressAnswerSubmitButtons:r,componentNameForSubmitAll:a,answerDelegatedForSubmitAll:i,justSubmittedForSubmitAll:s,creditAchievedForSubmitAll:o}}}},t}actions={submitAllAnswers:this.submitAllAnswers.bind(this),revealSection:this.revealSection.bind(this),closeSection:this.closeSection.bind(this)};submitAllAnswers(){this.coreFunctions.requestRecordEvent({verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{creditAchieved:this.stateValues.creditAchievedIfSubmit}});for(let t of this.stateValues.answerDescendants)this.coreFunctions.requestAction({componentName:t.componentName,actionName:"submitAnswer"})}revealSection(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}closeSection(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}static setUpVariant({serializedComponent:t,sharedParameters:e,definingChildrenSoFar:n,allComponentClasses:r}){let i;for(let s of n)if(s!==void 0&&s.componentType==="variantcontrol"){i=s;break}e.variant=i.state.selectedVariant.value,e.variantNumber=i.state.selectedVariantNumber.value,e.selectRng=i.state.selectRng.value,e.allPossibleVariants=i.state.variants.value,console.log("Variant for "+this.componentType+": "+e.variant);let a=t.variants.desiredVariant;if(a===void 0&&(a={}),a.subvariants===void 0&&t.variants.uniquevariants){let s=this.getUniqueVariant({serializedComponent:t,variantNumber:e.variantNumber,allComponentClasses:r});s.success&&Object.assign(a,s.desiredVariant)}if(a!==void 0&&a.subvariants!==void 0&&t.variants.descendantVariantComponents!==void 0)for(let s in a.subvariants){let o=a.subvariants[s],l=t.variants.descendantVariantComponents[s];if(l===void 0)break;l.variants.desiredVariant=o}}static determineNumberOfUniqueVariants({serializedComponent:t}){if(t.children===void 0)return{success:!0};let e,n;for(let[a,s]of t.children.entries())if(s.componentType==="variantcontrol"||s.createdComponent&&components[s.componentName].componentType==="variantcontrol"){e=a,n=s;break}if(e===void 0)return{success:!0};let r=100;if(n.children!==void 0){for(let a of n.children)if(a.componentType==="nvariants"){let s=!1;if(a.state!==void 0&&a.state.value!==void 0&&(r=Math.round(Number(a.state.value)),s=!0),a.children!==void 0&&a.children.length===1&&a.children[0].componentType==="string"&&(r=Math.round(Number(a.children[0].state.value)),s=!0),!s)return{success:!1};break}}t.variants===void 0&&(t.variants={});let i;if(t.variants.uniquevariants){let a=1,s=[];t.variants.descendantVariantComponents!==void 0&&(s=t.variants.descendantVariantComponents.map(o=>o.variants.numberOfVariants),a=s.reduce((o,l)=>o*l,1),i={numberOfVariantsByDescendant:s}),r=Math.min(a,r)}return{success:!0,numberOfVariants:r,uniqueVariantData:i}}static getUniqueVariant({serializedComponent:t,variantNumber:e,allComponentClasses:n}){if(t.variants===void 0)return{succes:!1};let r=t.variants.numberOfVariants;if(r===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=r)return{success:!1};let i={index:e};if(t.variants.uniquevariants){let a=ln({variantNumber:e,serializedComponent:t,allComponentClasses:n});a.success?i.subvariants=a.desiredVariants:console.log("Failed to get unique variant for "+t.componentType)}return{success:!0,desiredVariant:i}}static includeBlankStringChildren=!0},_e=Oa;var Em=class extends _e{static componentType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:1}}),t}},$m=class extends _e{static componentType="subsection";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:2}}),t}},zm=class extends _e{static componentType="subsubsection";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:3}}),t}},jm=class extends _e{static componentType="paragraphs";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:4}}),t}},Hm=class extends _e{static componentType="aside";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.collapsible.definition=()=>({newValues:{collapsible:!0}}),t.open.defaultValue=!1,t.level.definition=()=>({newValues:{level:3}}),t.containerTag.definition=()=>({newValues:{containerTag:"aside"}}),t}},Ra=class extends _e{static componentType="problem";static rendererType="section";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.aggregateScores={default:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sectionName.definition=()=>({newValues:{sectionName:"Problem"}}),t.level.definition=()=>({newValues:{level:3}}),t}},qm=class extends Ra{static componentType="exercise";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sectionName.definition=()=>({newValues:{sectionName:"Exercise"}}),t}},Km=class extends _e{static componentType="Example";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sectionName.definition=()=>({newValues:{sectionName:"Example"}}),t.level.definition=()=>({newValues:{level:3}}),t}},Wm=class extends _e{static componentType="answerSet";static rendererType="section";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.aggregateScores={default:!0},e.sectionWideCheckWork={default:!0,forRenderer:!0,ignorePropagationFromAncestors:!0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:null}}),t.containerTag.definition=()=>({newValues:{containerTag:"none"}}),t}},Um=class extends _e{static componentType="standinForFutureLayoutTag";static rendererType="section";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.level.definition=()=>({newValues:{level:3}}),t.containerTag.definition=()=>({newValues:{containerTag:"aside"}}),t}};var Fa={};fe(Fa,{Li:()=>Xm,Ol:()=>ka,Ul:()=>Gm});var ka=class extends Q{static componentType="ol";static rendererType="list";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.label={default:void 0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroLis",componentType:"li",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{numbered:!0}})},t.childrenToRender={returnDependencies:()=>({liChildren:{dependencyType:"child",childLogicName:"atLeastZeroLis"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.liChildren.map(n=>n.componentName)}}}},t}},Gm=class extends ka{static componentType="ul";static rendererType="list";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numbered={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{numbered:!1}})},t}},Xm=class extends R{static componentType="li";static rendererType="list";static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroBlock",componentType:"_block",comparison:"atLeast",number:0});return e.newOperator({name:"inlineOrBlock",operator:"or",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.item={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{item:!0}})},t.childrenToRender={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"inlineOrBlock"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.children.map(n=>n.componentName)}}}},t}};var $a={};fe($a,{CobwebPolyline:()=>Jm,HideInitialCondition:()=>Qm,InitialCondition:()=>Ym,InitialPoint:()=>ef,ODESystem:()=>Zm});import lt from"../_snowpack/pkg/math-expressions.js";var Ma=class extends B{static componentType="odesystem";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.independentvariable={default:lt.fromAst("t")},e.initialindependentvariablevalue={default:lt.fromAst(0)},e.displaydigits={default:14},e.rendermode={default:"align"},e.chunksize={default:10},e.tolerance={default:1e-6},e.maxIterations={default:1e3},e.hideInitialCondition={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atMostOneVariables",componentType:"variables",comparison:"atMost",number:1}),r=e.newLeaf({name:"atLeastZeroRHSs",componentType:"righthandside",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroInitialConditions",componentType:"initialcondition",comparison:"atLeast",number:0});return e.newOperator({name:"ODEsystemLogic",operator:"and",propositions:[n,r,i],setAsBase:!0}),e}updateState(t={}){if(t.init===!0&&(this.makePublicStateVariableArray({variableName:"variables",componentType:"variable"}),this.makePublicStateVariableArrayEntry({entryName:"var",arrayVariableName:"variables"}),this.makePublicStateVariableArray({variableName:"rhss",componentType:"righthandside"}),this.makePublicStateVariableArrayEntry({entryName:"rhs",arrayVariableName:"rhss"}),this.makePublicStateVariableAlias({variableName:"rhs",targetName:"rhs",arrayIndex:"1"}),this.makePublicStateVariableArrayEntry({entryName:"righthandside",arrayVariableName:"rhss"}),this.makePublicStateVariableAlias({variableName:"righthandside",targetName:"rhs",arrayIndex:"1"}),this.makePublicStateVariableAlias({variableName:"righthandsides",targetName:"rhss"}),this.makePublicStateVariableArray({variableName:"initialconditions",componentType:"initialcondition"}),this.makePublicStateVariableArrayEntry({entryName:"initialcondition",arrayVariableName:"initialconditions"}),this.makePublicStateVariableAlias({variableName:"initialcondition",targetName:"initialcondition",arrayIndex:"1"}),this.makePublicStateVariableArray({variableName:"numericalsolutions",componentType:"function",stateVariableForRef:"numericF"}),this.makePublicStateVariableArrayEntry({entryName:"numericalsolution",arrayVariableName:"numericalsolutions"}),this.makePublicStateVariableAlias({variableName:"numericalsolution",targetName:"numericalsolution",arrayIndex:"1"})),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.variables=!0,this.unresolvedState.rhss=!0,this.unresolvedState.initialconditions=!0,this.unresolvedState.numericalsolutions=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let a=this.childLogic.returnMatches("atMostOneVariables");a.length===1?this.state.variablesChild=this.activeChildren[a[0]]:(delete this.state.variablesChild,this.state.validVariables=[],this._state.variables.essential||(this.state.variables=[]));let s=this.childLogic.returnMatches("atLeastZeroRHSs");this.state.rhsChildren=s.map(l=>this.activeChildren[l]);let o=this.childLogic.returnMatches("atLeastZeroInitialConditions");this.state.initialConditionChildren=o.map(l=>this.activeChildren[l])}let r=e.getVariableChanges({component:this,variable:"variables"})||e.getVariableChanges({component:this,variable:"independentvariable"})||this.state.rhsChildren.some(a=>e.getVariableChanges({component:a,variable:"variable"}))||this.state.initialConditionChildren.some(a=>e.getVariableChanges({component:a,variable:"variable"}));if(this.state.variablesChild){if(this.state.variablesChild.unresolvedState.variables)this.unresolvedState.variables=!0;else if(n||r||e.getVariableChanges({component:this.state.variablesChild,variable:"variables"})){r=!0,this.state.variables=[...this.state.variablesChild.state.variables];for(let a=0;a<this.state.variables.length;a++){let s=this.state.variables[a];this.state.independentvariable.equals(s)&&console.warn("Variables of odesystem must be different than independent variable.");for(let o=0;o<a;o++)this.state.variables[o].equals(s)&&console.warn("Variables of odesystem must be unique.")}}this.state.variablesChild.unresolvedState.validVariables?this.unresolvedState.validVariables=!0:(n||r||e.getVariableChanges({component:this.state.variablesChild,variable:"validVariables"}))&&(r=!0,this.state.validVariables=[...this.state.variablesChild.state.validVariables])}else r&&(this.state.validVariables=[],this._state.variables.essential||(this.state.variables=[]));if(this.state.rhsChildren.some(a=>a.unresolvedState.variable||a.unresolvedState.value)||this.state.initialConditionChildren.some(a=>a.unresolvedState.variable||a.unresolvedState.value)){this.unresolvedState.variables=!0,this.unresolvedState.rhss=!0,this.unresolvedState.initialconditions=!0,this.unresolvedState.numericalsolutions=!0;return}let i=n||r||this.state.rhsChildren.some(a=>e.getVariableChanges({component:a,variable:"value"}))||this.state.initialConditionChildren.some(a=>e.getVariableChanges({component:a,variable:"value"}));if(i){this.state.rhss=[];let a=new Set,s=new Set;for(let[p,m]of this.state.rhsChildren.entries()){let f=m.state.variable,h;if(f!==void 0&&(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1))if(this.state.rhss[h]===void 0)this.state.rhss[h]=m.state.value,s.add(p);else{let y="Duplicate variable "+f+" in rhs of odesystem.";console.warn(y)}}for(let[p,m]of this.state.rhsChildren.entries()){if(s.has(p))continue;let f=m.state.variable,h;if(f===void 0)h=this.state.rhss.findIndex(y=>!y),h===-1&&(h=this.state.rhss.length),this.state.rhss[h]=m.state.value,f=this.state.variables[h],f===void 0&&(a.add(h),this.state.variables[h]=lt.fromAst("\uFF3F\uFF3F"));else if(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1){let y="Duplicate variable "+f+" in rhs of odesystem.";if(t.init)throw Error(y);y+=" Repeated rhs with same variable are ignored",console.warn(y)}else h=this.state.variables.findIndex(y=>!y),h===-1&&(h=this.state.variables.length),this.state.rhss[h]=m.state.value,this.state.variables[h]=f,m._state.variable.additionalVars&&(this.state.validVariables[h]=m._state.variable.additionalVars.validVariable)}for(let p of a)this.state.variables[p]=void 0;s=new Set,this.state.initialconditions=[];let o=0,l=0;for(let[p,m]of this.state.initialConditionChildren.entries()){let f=m.state.variable,h;if(f===void 0)o++;else if(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1)if(l++,this.state.initialconditions[h]===void 0)this.state.initialconditions[h]=m.state.value,s.add(p);else{let y="Duplicate variable "+f+" in initial condtion of odesystem.";if(t.init)throw Error(y);y+=" Repeated initial conditions with same variable are ignored",console.warn(y)}}let c=this.state.variables.length-a.size-l,d=Math.max(0,o-c);for(let[p,m]of this.state.initialConditionChildren.entries()){if(s.has(p))continue;let f=m.state.variable,h;if(f===void 0){if(h=this.state.initialconditions.findIndex(y=>!y),h===-1&&(h=this.state.initialconditions.length),f=this.state.variables[h],f===void 0)if(d>0)d--,a.add(h),this.state.variables[h]=lt.fromAst("\uFF3F\uFF3F");else for(;h<this.state.variables.length-1&&(h++,f=this.state.variables[h],f===void 0););this.state.initialconditions[h]=m.state.value}else if(h=this.state.variables.findIndex(y=>y&&y.equals(f)),h!==-1){let y="Duplicate variable "+f+" in initial conditions of odesystem.";if(t.init)throw Error(y);y+=" Repeated initial conditions with same variable are ignored",console.warn(y)}else h=this.state.variables.findIndex(y=>!y),h===-1?h=this.state.variables.length:a.delete(h),this.state.initialconditions[h]=m.state.value,this.state.variables[h]=f}if(a.size>0){a=[...a].sort();let p=[];for(let m=0;m<this.state.variables.length;m++){let f;m<3?f=lt.fromAst(["x","y","z"][m]):f=lt.fromAst(["_","x",m+1]),this.state.variables.findIndex(h=>h&&h.equals(f))===-1&&p.push(f)}p.reverse();for(let m of a)this.state.variables[m]=p.pop()}this.state.nDimensions=this.state.variables.length;for(let p in this.state.variables)this.state.rhss[p]||(this.state.rhss[p]=lt.fromAst(0)),this.state.initialconditions[p]||(this.state.initialconditions[p]=lt.fromAst(0))}if(i||e.getVariableChanges({component:this,variable:"hideInitialCondition"})||e.getVariableChanges({component:this,variable:"displaydigits"})||e.getVariableChanges({component:this,variable:"independentvariable"})||e.getVariableChanges({component:this,variable:"initialindependentvariablevalue"})||e.getVariableChanges({component:this,variable:"initialconditions"})){let a=[];for(let[s,o]of this.state.rhss.entries()){let l=this.state.variables[s],c="\\frac{\\mathrm{d} "+l.toLatex()+" }{ \\mathrm{d} "+this.state.independentvariable.toLatex()+" } &= "+o.round_numbers_to_precision(this.state.displaydigits).toLatex();a.push(c)}if(!this.state.hideInitialCondition)for(let[s,o]of this.state.initialconditions.entries()){let c=this.state.variables[s].toLatex()+" ( "+this.state.initialindependentvariablevalue+" ) &= "+o.round_numbers_to_precision(this.state.displaydigits).toLatex();a.push(c)}this.state.latex=a.join("\\\\")}(i||e.getVariableChanges({component:this,variable:"chunksize"})||e.getVariableChanges({component:this,variable:"tolerance"})||e.getVariableChanges({component:this,variable:"maxIterations"})||e.getVariableChanges({component:this,variable:"independentvariable"})||e.getVariableChanges({component:this,variable:"initialindependentvariablevalue"})||e.getVariableChanges({component:this,variable:"initialconditions"}))&&(this.state.fnumericRHS=this.returnNumericRHSfunction(),this.state.t0=this.state.initialindependentvariablevalue.evaluate_to_constant(),this.state.x0s=this.state.initialconditions.map(a=>a.evaluate_to_constant()),!Number.isFinite(this.state.t0)||!this.state.x0s.every(a=>Number.isFinite(a))?this.state.nonNumericValues=!0:delete this.state.nonNumericValues,this.state.calculatedNumericSolutions=[],this.state.endingNumericalValues=[],this.state.maxPossibleTime=void 0,this.state.numericalsolutions=this.state.variables.map((a,s)=>this.returnNumericSolution(s)),e.addNewValue(this,"numericalsolutions"))}returnNumericRHSfunction(t){let e=this.state.rhss;if(t!==void 0){let a=e[t];if(a===void 0)return;e=[a]}let n;try{n=e.map(a=>a.subscripts_to_strings().f())}catch(a){return console.warn("Cannot define ODE RHS function.  Error creating mathjs function"),s=>NaN}if(this._state.independentvariable.additionalVars&&!this._state.independentvariable.additionalVars.validVariable)return console.warn("Can't define ODE RHS function with invalid independent variable."),a=>NaN;if(this.state.validVariables.some(a=>a===!1))return console.warn("Can't define ODE RHS function with dependent variables."),a=>NaN;let r=this.state.independentvariable.subscripts_to_strings().tree,i=this.state.variables.map(a=>a.subscripts_to_strings().tree);return i.includes(r)?(console.warn("Can't define ODE RHS function when independent variable is a dependent varaible"),a=>NaN):[...new Set(i)].length!==i.length?(console.warn("Can't define ODE RHS function with duplicate dependent varaible names"),a=>NaN):function(a,s){let o={[r]:a};Array.isArray(s)?s.forEach((l,c)=>o[i[c]]=l):o[i[0]]=s;try{return n.map(l=>l(o))}catch(l){return NaN}}}returnNumericSolution(t){return function(n){if(this.state.nonNumericValues)return NaN;if(!Number.isFinite(n))return NaN;if(n===this.state.t0)return t!==void 0?this.state.x0s[t]:this.state.x0s;let r=this.state.calculatedNumericSolutions.length,i=Math.ceil((n-this.state.t0)/this.state.chunksize)-1;if(i<0)return NaN;if(this.state.maxPossibleTime===void 0&&i>=r)for(let s=r;s<=i;s++){let o=this.state.endingNumericalValues[s-1];o===void 0&&(o=this.state.x0s);let l=this.state.t0+s*this.state.chunksize,c=lt.math.dopri(l,l+this.state.chunksize,o,this.state.fnumericRHS,this.state.tolerance,this.state.maxIterations);this.state.endingNumericalValues.push(c.y[c.y.length-1]),this.state.calculatedNumericSolutions.push(c.at.bind(c));let d=c.x[c.x.length-1];if(d<(l+this.state.chunksize)*(1-1e-6)){this.state.maxPossibleTime=d;let p="For chunksize "+this.state.chunksize+" and tolerance "+this.state.tolerance+", odesystem";this.doenetAttributes.componentName!==void 0&&(p+=" ("+this.doenetAttributes.componentName+")"),p+=" hit maxiterations ("+this.state.maxIterations+") at t = "+this.state.maxPossibleTime+". Will not calculate solution beyond that time. Decrease chunksize, increase maxiterations, or increase tolerance to calculate further.",console.warn(p);break}}if(n>this.state.maxPossibleTime)return NaN;let a=this.state.calculatedNumericSolutions[i](n);return t!==void 0&&(a=a[t]),a}.bind(this)}initializeRenderer({}){if(this.renderer!==void 0){this.updateRenderer();return}this.renderer=new this.availableRenderers.math({key:this.componentName,mathLatex:this.state.latex,renderMode:this.state.rendermode})}updateRenderer(){this.renderer.updateMathLatex(this.state.latex)}},Zm=Ma;import _a from"../_snowpack/pkg/math-expressions.js";var Ba=class extends le{static componentType="polyline";actions={movePolyline:this.movePolyline.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["vertices","nVertices"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneVertices",componentType:"vertices",comparison:"atMost",number:1,takePropertyChildren:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.nVertices={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return e.verticesChild.length===1?{newValues:{nVertices:e.verticesChild[0].stateValues.nPoints}}:{newValues:{nVertices:0}}}},t.nDimensions={public:!0,componentType:"number",returnDependencies(){return{verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["nDimensions"]}}},definition:function({dependencyValues:e}){return e.verticesChild.length===1?{newValues:{nDimensions:e.verticesChild[0].stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},t.vertices={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],returnWrappingComponents(e){return e==="vertexX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="vertexX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nVertices,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[i,a]=r.split(","),s=Number(i)+1+"_"+(Number(a)+1);n[r]={verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["pointX"+s]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let[a,s]=i.split(","),o=Number(a)+1+"_"+(Number(s)+1),l=e[i].verticesChild;l.length===1&&l[0].stateValues["pointX"+o]?r[i]=l[0].stateValues["pointX"+o]:r[i]=_a.fromAst("\uFF3F")}return{newValues:{vertices:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:i,stateValues:a}){if(i&&!a.draggable)return{success:!1};let s=[];for(let o in e.vertices){let[l,c]=o.split(","),d=Number(l)+1+"_"+(Number(c)+1);if(n[o].verticesChild.length===1&&n[o].verticesChild[0].stateValues["pointX"+d])s.push({setDependency:r[o].verticesChild,desiredValue:e.vertices[o],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:s}}},t.numericalVertices={isArray:!0,entryPrefixes:["numericalVertex"],forRenderer:!0,returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:e}){return[e.nVertices]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={vertex:{dependencyType:"stateVariable",variableName:"vertex"+(Number(r)+1)}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].vertex.map(s=>s.evaluate_to_constant());a.every(s=>Number.isFinite(s))||(a=Array(a.length).fill(NaN)),r[i]=a}return{newValues:{numericalVertices:r}}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},vertices:{dependencyType:"stateVariable",variableName:"vertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2||e.nVertices===0)return{};let r=Infinity,i={},a=n.x1.evaluate_to_constant(),s=n.x2.evaluate_to_constant(),o,l,c=e.vertices[0][0].evaluate_to_constant(),d=e.vertices[0][1].evaluate_to_constant();for(let p=1;p<e.nVertices;p++){if(o=c,l=d,c=e.vertices[p][0].evaluate_to_constant(),d=e.vertices[p][1].evaluate_to_constant(),!(Number.isFinite(o)&&Number.isFinite(l)&&Number.isFinite(c)&&Number.isFinite(d)))continue;let m=c-o,f=d-l,h=m*m+f*f;if(h===0)continue;let y=((a-o)*m+(s-l)*f)/h,b;y<=0?b={x1:o,x2:l}:y>=1?b={x1:c,x2:d}:b={x1:o+y*m,x2:l+y*f};let g=Math.pow(a-b.x1,2)+Math.pow(s-b.x2,2);g<r&&(r=g,i=b)}return n.x3!==void 0&&Object.keys(i).length>0&&(i.x3=0),i}}})},t}movePolyline(t,e,n){let r={};for(let i in t)r[i+",0"]=_a.fromAst(t[i][0]),r[i+",1"]=_a.fromAst(t[i][1]);e?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:r,sourceInformation:n}],transient:e}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:r,sourceInformation:n}],event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{pointCoordinates:t}}})}},un=Ba;import Vt from"../_snowpack/pkg/math-expressions.js";var Ea=class extends un{static componentType="cobwebpolyline";static rendererType="cobwebpolyline";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.attractThreshold={default:.5},e.nPoints={default:1,clamp:[0,Infinity],forRenderer:!0},e.variable={default:Vt.fromAst("x"),forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"exactlyOneInitialPoint",componentType:"initialpoint",number:1}),r=e.newLeaf({name:"exactlyOneFunction",componentType:"function",number:1});return e.newOperator({name:"initialPointAndFunction",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nDimensions.returnDependencies=()=>({}),t.nDimensions.definition=()=>({newValues:{nDimensions:2}}),t.initialPoint={isArray:!0,entryPrefixes:["initialPointX"],returnWrappingComponents(e){return e==="initialPointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let i=Number(r)+1;n[r]={initialPointChild:{dependencyType:"child",childLogicName:"exactlyOneInitialPoint",variableNames:["x"+i]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=Number(i)+1;e[i].initialPointChild.length===1?r[i]=e[i].initialPointChild[0].stateValues["x"+a]:r[i]=0}return{newValues:{initialPoint:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r}){let i=[];for(let a in e.initialPoint)if(n[a].initialPointChild.length===1&&n[a].initialPointChild[0].stateValues["x"+(Number(a)+1)])i.push({setDependency:r[a].initialPointChild,desiredValue:e.initialPoint[a],childIndex:0,variableIndex:0});else return{success:!1};return{success:!0,instructions:i}}},t.f={forRenderer:!0,returnDependencies:()=>({functionChild:{dependencyType:"child",childLogicName:"exactlyOneFunction",variableNames:["numericalf"]}}),definition({dependencyValues:e}){return e.functionChild.length===1?{newValues:{f:e.functionChild[0].stateValues.numericalf}}:{newValues:{f:null}}}},t.nVertices={isAlias:!0,targetVariableName:"nPoints"},t.nOriginalVertices={providePreviousValuesInDefinition:!0,returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition({dependencyValues:e,previousValues:n}){let r=e.nVertices;return n.nOriginalVertices>r&&(r=n.nOriginalVertices),{newValues:{nOriginalVertices:r}}}},t.originalVertices={essential:!0,isArray:!0,nDimensions:2,entryPrefixes:["originalVertexX","originalVertex"],defaultEntryValue:Vt.fromAst(0),getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="originalVertexX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},returnArraySizeDependencies:()=>({nOriginalVertices:{dependencyType:"stateVariable",variableName:"nOriginalVertices"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nOriginalVertices-1,e.nDimensions]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let n={};for(let r of e){let i=r.split(",").map(a=>Number(a)+1).join("_");n[r]={variablesToCheck:["originalVertex"+i]}}return{useEssentialOrDefaultValue:{originalVertices:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let n=[];for(let r in e.originalVertices)n.push({setStateVariable:"originalVertices",value:{[r]:e.originalVertices[r]}});return{success:!0,instructions:n}}},t.vertices.additionalStateVariablesDefined=[{variableName:"prelimCorrectVertices",entryPrefixes:["prelimCorrectVertexX","prelimCorrectVertex"],getArrayKeysFromVarName:function({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="prelimCorrectVertexX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}}}],t.vertices.basedOnArrayKeyStateVariables=!0,t.vertices.returnArrayDependenciesByKey=function({arrayKeys:e}){let n={f:{dependencyType:"stateVariable",variableName:"f"},attractThreshold:{dependencyType:"stateVariable",variableName:"attractThreshold"}},r={};for(let i of e){let[a,s]=i.split(",");a==="0"?r[i]={initialPoint:{dependencyType:"stateVariable",variableName:"initialPointX"+(Number(s)+1)}}:r[i]={originalVertexX1:{dependencyType:"stateVariable",variableName:"originalVertexX"+a+"_1"},originalVertexX2:{dependencyType:"stateVariable",variableName:"originalVertexX"+a+"_2"},previousVertexX1:{dependencyType:"stateVariable",variableName:"vertexX"+a+"_1"},previousVertexX2:{dependencyType:"stateVariable",variableName:"vertexX"+a+"_2"}}}return{globalDependencies:n,dependenciesByKey:r}},t.vertices.arrayDefinitionByKey=function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={},a={};for(let s of r){let[o,l]=s.split(",");if(o==="0")i[s]=n[s].initialPoint,a[s]=null;else{let c,d;try{c=[n[s].originalVertexX1.evaluate_to_constant(),n[s].originalVertexX2.evaluate_to_constant()],d=[n[s].previousVertexX1.evaluate_to_constant(),n[s].previousVertexX2.evaluate_to_constant()]}catch(f){i[o+",0"]=Vt.fromAst(0),i[o+",1"]=Vt.fromAst(0),a[o+",0"]=!1;continue}let p;if(Number(o)%2==1){let f=e.f(d[0]);p=[d[0],f]}else p=[d[1],d[1]];Math.pow(c[0]-p[0],2)+Math.pow(c[1]-p[1],2)<e.attractThreshold*e.attractThreshold?(i[o+",0"]=Vt.fromAst(p[0]),i[o+",1"]=Vt.fromAst(p[1]),a[o+",0"]=!0):(i[o+",0"]=n[s].originalVertexX1,i[o+",1"]=n[s].originalVertexX2,a[o+",0"]=!1),a[o+",1"]=null}}return{newValues:{vertices:i,prelimCorrectVertices:a}}},t.vertices.inverseArrayDefinitionByKey=function({desiredStateVariableValues:e,dependencyNamesByKey:n,initialChange:r,stateValues:i}){if(r&&!i.draggable)return{success:!1};let a=[];for(let s in e.vertices){let[o,l]=s.split(",");o==="0"?a.push({setDependency:n[s].initialPoint,desiredValue:e.vertices[s]}):a.push({setDependency:n[s]["originalVertexX"+(Number(l)+1)],desiredValue:e.vertices[s]})}return{success:!0,instructions:a}},t.correctVertices={isArray:!0,public:!0,componentType:"boolean",entryPrefixes:["correctVertex"],returnArraySizeDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),returnArraySize({dependencyValues:e}){return[e.nVertices-1]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={prelimCorrectVertex:{dependencyType:"stateVariable",variableName:"prelimCorrectVertexX"+(Number(r)+2)+"_1"}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)r[i]=e[i].prelimCorrectVertex;return{newValues:{correctVertices:r}}}},t.fractionCorrectVertices={public:!0,componentType:"number",additionalStateVariablesDefined:[{variableName:"nGradedVertices",public:!0,componentType:"number"},{variableName:"nCorrectVertices",public:!0,componentType:"number"}],returnDependencies:()=>({correctVertices:{dependencyType:"stateVariable",variableName:"correctVertices"}}),definition({dependencyValues:e}){let n=e.correctVertices.length,r,i;return n===0?(r=0,i=0):(i=e.correctVertices.reduce((a,s)=>a+s,0),r=i/n),{newValues:{fractionCorrectVertices:r,nGradedVertices:n,nCorrectVertices:i}}}},t.nIterateValues={public:!0,componentType:"number",returnDependencies:()=>({nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({newValues:{nIterateValues:Math.ceil((e.nVertices+1)/2)}})},t.iterateValues={isArray:!0,public:!0,componentType:"number",entryPrefixes:["iterateValue"],returnArraySizeDependencies:()=>({nIterateValues:{dependencyType:"stateVariable",variableName:"nIterateValues"}}),returnArraySize({dependencyValues:e}){return[e.nIterateValues]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)r==="0"?n[r]={iterateValue:{dependencyType:"stateVariable",variableName:"vertexX1_1"}}:n[r]={iterateValue:{dependencyType:"stateVariable",variableName:"vertexX"+2*Number(r)+"_2"}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)r[i]=e[i].iterateValue;return{newValues:{iterateValues:r}}}},t.childrenToRender={returnDependencies:()=>({}),definition:()=>({newValues:{childrenToRender:[]}})},t}updateState(t={}){super.updateState(t),t.init&&(this.makePublicStateVariableArray({variableName:"iteratevalues",componentType:"number"}),this.makePublicStateVariableArrayEntry({entryName:"iteratevalue",arrayVariableName:"iteratevalues"}),this.makePublicStateVariableAlias({variableName:"lastvertex",targetName:"vertex",arrayIndex:"-1"}),this.state.draggablePoints=[]);let e=!1;(childrenChanged||trackChanges.getVariableChanges({component:this.state.initialPointChild,variable:"coords"})||trackChanges.getVariableChanges({component:this,variable:"vertices",index:0}))&&(this.state.initialPoint=this.state.initialPointChild.state.coords.copy(),this.state.vertices[0]=this.state.initialPoint,e=!0);let n=this.state.vertices.length;if(this.state.nPoints>n){let i=Math.min(this.state.nPoints,n+this.state.removedVertices.length);i>n&&(this.state.vertices.push(...this.state.removedVertices.slice(0,i-n)),this.state.removedVertices=this.state.removedVertices.slice(i-n),n=i);for(let a=n;a<this.state.nPoints;a++){let s=Vt.fromAst(["tuple",0,0]);this.state.vertices.push(s)}}else this.state.nPoints<n&&(this.state.removedVertices=[...this.state.vertices.slice(this.state.nPoints),...this.state.removedVertices],this.state.vertices.length=this.state.nPoints,this.state.correctvertices.length=this.state.nPoints-1);this.state.draggablePoints.length!==this.state.nPoints&&(this.state.draggablePoints=new Array(this.state.nPoints).fill(!1),this.state.nPoints>1&&(this.state.draggablePoints[this.state.nPoints-1]=!0));let r=[];e?(r=[...Array(this.state.nPoints).keys()].slice(1),this.state.correctvertices=[]):this.state.nPoints>1&&(r=[this.state.nPoints-1]);for(let i of r){let a;if(i%2==1){let s=this.state.vertices[i-1],o=this.findFiniteNumericalValue(s.get_component(0)),l=this.state.f(o);a=[o,l]}else{let s=this.state.vertices[i-1],o=this.findFiniteNumericalValue(s.get_component(1));a=[o,o]}if(a!==void 0){let s=this.state.vertices[i],o=this.findFiniteNumericalValue(s.get_component(0)),l=this.findFiniteNumericalValue(s.get_component(1));Math.pow(o-a[0],2)+Math.pow(l-a[1],2)<this.state.attractThreshold*this.state.attractThreshold?(this.state.vertices[i]=Vt.fromAst(["tuple",...a]),this.state.correctvertices[i-1]=!0):this.state.correctvertices[i-1]=!1}}this.state.iteratevalues=this.state.vertices.filter((i,a)=>a%2==1).map(i=>i.get_component(1).evaluate_to_constant())}initializeRenderer({}){if(this.renderer!==void 0){this.updateRenderer();return}if(this.unresolvedState.vertices===void 0){let t={movePolyline:this.movePolyline};this.renderer=new this.availableRenderers.polyline2d({key:this.componentName,actions:t,label:this.state.label,draggable:!1,layer:this.state.layer,visible:!this.state.hide,pointcoords:this.state.vertices.map(e=>[e.get_component(0).evaluate_to_constant(),e.get_component(1).evaluate_to_constant()]),color:this.state.selectedStyle.lineColor,width:this.state.selectedStyle.lineWidth,style:this.state.selectedStyle.lineStyle,pointColor:this.state.selectedStyle.markerColor,pointSize:this.state.selectedStyle.markerSize,pointStyle:this.state.selectedStyle.markerStyle})}}updateRenderer(){this.renderer.updatePolyline({visible:!this.state.hide,pointcoords:this.state.vertices.map(t=>[t.get_component(0).evaluate_to_constant(),t.get_component(1).evaluate_to_constant()])})}calculateDownstreamChanges({stateVariablesToUpdate:t,stateVariableChangesToSave:e,dependenciesToUpdate:n}){let r={},i=new Set([]),a=Array(this.state.nPoints);for(let c in t)if(c==="vertices"){r[c]===void 0&&(r[c]={isArray:!0,changes:{arrayComponents:{}}});for(let d in t[c].changes.arrayComponents)i.add(Number(d)),a[d]=r[c].changes.arrayComponents[d]=t[c].changes.arrayComponents[d]}i.has(0)&&(n[this.state.initialPointChild.componentName]={coords:{changes:a[0]}});let s=this.updateShadowSources({newStateVariables:r,dependenciesToUpdate:n}),o=s.shadowedStateVariables,l=s.isReplacement;for(let c in r)this._state[c].essential===!0&&!o.has(c)&&!l&&(e[c]=r[c]);return!0}},Jm=Ea;var Ym=class extends Jt{static componentType="initialcondition";static rendererType="math";""},Qm=class extends k{static componentType="hideinitialcondition";static rendererType="boolean"},ef=class extends Nt{static componentType="initialpoint";static rendererType="point"};var za={};fe(za,{FeedbackDefinition:()=>tf,FeedbackDefinitions:()=>nf});var tf=class extends R{static componentType="feedbackdefinition";static createPropertiesObject(){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneFeedbackCode",componentType:"feedbackcode",number:1}),r=e.newLeaf({name:"exactlyOneFeedbackText",componentType:"feedbacktext",number:1});return e.newOperator({name:"feedbackMapping",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:()=>({feedbackCodeChild:{dependencyType:"child",childLogicName:"exactlyOneFeedbackCode",variableNames:["value"]},feedbackTextChild:{dependencyType:"child",childLogicName:"exactlyOneFeedbackText",variableNames:["value"]}}),definition:({dependencyValues:e})=>({newValues:{value:{feedbackCode:e.feedbackCodeChild[0].stateValues.value.toLowerCase(),feedbackText:e.feedbackTextChild[0].stateValues.value}}})},t}},nf=class extends R{static componentType="feedbackdefinitions";static createPropertiesObject(){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroFeedbackDefinitions",componentType:"feedbackDefinition",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nDefinitions={returnDependencies:()=>({feedbackDefinitionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFeedbackDefinitions"}}),definition:({dependencyValues:e})=>({newValues:{nDefinitions:e.feedbackDefinitionChildren.length}})},t.value={isArray:!0,entryPrefixes:["feedbackDefinition"],returnArraySizeDependencies:()=>({nDefinitions:{dependencyType:"stateVariable",variableName:"nDefinitions"}}),returnArraySize({dependencyValues:e}){return[e.nDefinitions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n.feedbackDefinitionChild={dependencyType:"child",childLogicName:"atLeastZeroFeedbackDefinitions",variableNames:["value"],childIndices:[r]};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].feedbackDefinitionChild;a.length===1&&(r[i]=a[0].stateValues.value)}return{newValues:{value:r}}}},t}};var ja={};fe(ja,{StyleDefinition:()=>rf,StyleDefinitions:()=>af});var Ha=["lineColor","lineWidth","lineStyle","markerColor","markerStyle","markerSize"],rf=class extends R{static componentType="styledefinition";static createPropertiesObject(){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneStyleNumber",componentType:"stylenumber",number:1}),r=[];for(let i of Ha)r.push(e.newLeaf({name:`atMostOne${i}`,componentType:i,comparison:"atMost",number:1}));return e.newOperator({name:"styleMapping",operator:"and",propositions:[n,...r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:function(){let e={styleNumberChild:{dependencyType:"child",childLogicName:"exactlyOneStyleNumber",variableNames:["value"]}};for(let n of Ha)e[`${n}Child`]={dependencyType:"child",childLogicName:`atMostOne${n}`,variableNames:["value"]};return e},definition:function({dependencyValues:e}){let n={styleNumber:e.styleNumberChild[0].stateValues.value};for(let r of Ha)e[`${r}Child`].length===1&&(n[r]=e[`${r}Child`][0].stateValues.value);return{newValues:{value:n}}}},t}},af=class extends R{static componentType="styledefinitions";static createPropertiesObject(){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroStyleDefinitions",componentType:"styleDefinition",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nDefinitions={returnDependencies:()=>({styleDefinitionChildren:{dependencyType:"child",childLogicName:"atLeastZeroStyleDefinitions"}}),definition:({dependencyValues:e})=>({newValues:{nDefinitions:e.styleDefinitionChildren.length}})},t.value={isArray:!0,entryPrefixes:["styleDefinition"],returnArraySizeDependencies:()=>({nDefinitions:{dependencyType:"stateVariable",variableName:"nDefinitions"}}),returnArraySize({dependencyValues:e}){return[e.nDefinitions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n.styleDefinitionChild={dependencyType:"child",childLogicName:"atLeastZeroStyleDefinitions",variableNames:["value"],childIndices:[r]};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].styleDefinitionChild;a.length===1&&(r[i]=a[0].stateValues.value)}return{newValues:{value:r}}}},t}};var qa={};fe(qa,{LineColor:()=>of,LineStyle:()=>uf,LineWidth:()=>lf,MarkerColor:()=>cf,MarkerSize:()=>df,MarkerStyle:()=>pf,StyleNumber:()=>sf});var sf=class extends ${static componentType="stylenumber";static rendererType="number"},of=class extends z{static componentType="lineColor";static rendererType="text"},lf=class extends ${static componentType="lineWidth";static rendererType="number"},uf=class extends z{static componentType="lineStyle";static rendererType="text"},cf=class extends z{static componentType="markerColor";static rendererType="text"},df=class extends ${static componentType="markerSize";static rendererType="number"},pf=class extends z{static componentType="markerStyle";static rendererType="text"};var Ka=class extends R{static componentType="document";static rendererType="section";static createsVariants=!0;static alwaysSetUpVariant=!0;static createPropertiesObject(){return{feedbackDefinitions:{get default(){return Dv()},propagateToDescendants:!0,mergeArrayWithDefault:!0},styleDefinitions:{get default(){return Zt()},propagateToDescendants:!0,mergeArrayWithDefault:!0}}}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneMeta",componentType:"meta",comparison:"atMost",number:1,allowSpillover:!1}),r=e.newLeaf({name:"atMostOneVariantControl",componentType:"variantcontrol",comparison:"atMost",number:1,allowSpillover:!1}),i=e.newLeaf({name:"atMostOneTitle",componentType:"title",comparison:"atMost",number:1}),a=e.newLeaf({name:"atMostOneDescription",componentType:"description",comparison:"atMost",number:1}),s=e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"variantTitleDescriptionMetaAnything",operator:"and",propositions:[r,i,a,n,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.titleDefinedByChildren={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"}}),definition({dependencyValues:e}){return{newValues:{titleDefinedByChildren:e.titleChild.length===1}}}},t.title={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle",variableNames:["text"]}}),definition({dependencyValues:e}){return e.titleChild.length===0?{newValues:{title:""}}:{newValues:{title:e.titleChild[0].stateValues.text}}}},t.description={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({descriptionChild:{dependencyType:"child",childLogicName:"atMostOneDescription",variableNames:["text"]}}),definition({dependencyValues:e}){return e.descriptionChild.length===0?{newValues:{description:""}}:{newValues:{description:e.descriptionChild[0].stateValues.text}}}},t.level={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{level:0}})},t.viewedSolution={defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{viewedSolution:{variablesToCheck:["viewedSolution"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"viewedSolution",value:e.viewedSolution}]}}},t.scoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"descendant",componentTypes:["_sectioningcomponent","answer"],variableNames:["scoredDescendants","aggregateScores","weight"],recurseToMatchedChildren:!1,variablesOptional:!0}}),definition({dependencyValues:e}){let n=[];for(let r of e.scoredDescendants)r.stateValues.aggregateScores||r.stateValues.scoredDescendants===void 0?n.push(r):n.push(...r.stateValues.scoredDescendants);return{newValues:{scoredDescendants:n}}}},t.nScoredDescendants={returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"}}),definition({dependencyValues:e}){return{newValues:{nScoredDescendants:e.scoredDescendants.length}}}},t.itemCreditAchieved={isArray:!0,returnArraySizeDependencies:()=>({nScoredDescendants:{dependencyType:"stateVariable",variableName:"nScoredDescendants"}}),returnArraySize({dependencyValues:e}){return[e.nScoredDescendants]},stateVariablesDeterminingDependencies:["scoredDescendants"],returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let i of e){let a=n.scoredDescendants[i];a&&(r[i]={creditAchieved:{dependencyType:"stateVariable",componentName:a.componentName,variableName:"creditAchieved"}})}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)r[i]=e[i].creditAchieved;return{newValues:{itemCreditAchieved:r}}},markStaleByKey({arrayKeys:e,changes:n}){if(n.__array_size||n.__array_keys)return{itemScoreChanged:{itemNumbers:e}};let r=/^__(\d+)_/,i=[];for(let a in n){let s=r.exec(a);s&&i.push(s[1])}return{itemScoreChanged:{itemNumbers:i}}}},t.displayDigitsForCreditAchieved={returnDependencies:()=>({}),definition:()=>({newValues:{displayDigitsForCreditAchieved:3}})},t.creditAchieved={public:!0,componentType:"number",defaultValue:0,stateVariablesPrescribingAdditionalProperties:{displayDigits:"displayDigitsForCreditAchieved"},additionalStateVariablesDefined:[{variableName:"percentCreditAchieved",public:!0,componentType:"number",stateVariablesPrescribingAdditionalProperties:{displayDigits:"displayDigitsForCreditAchieved"}}],returnDependencies:()=>({scoredDescendants:{dependencyType:"stateVariable",variableName:"scoredDescendants"},itemCreditAchieved:{dependencyType:"stateVariable",variableName:"itemCreditAchieved"}}),definition({dependencyValues:e}){let n=0,r=0;for(let[s,o]of e.scoredDescendants.entries()){let l=o.stateValues.weight;n+=e.itemCreditAchieved[s]*l,r+=l}let i=n/r,a=i*100;return{newValues:{creditAchieved:i,percentCreditAchieved:a}}}},t.selectedVariantInfo={returnDependencies:({sharedParameters:e,componentInfoObjects:n})=>({variantNumber:{dependencyType:"value",value:e.variantNumber},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(n.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){let n={index:e.variantNumber},r=n.subvariants=[];for(let i of e.variantDescendants)i.stateValues.isVariantComponent?r.push(i.stateValues.selectedVariantInfo):i.stateValues.selectedVariantInfo&&r.push(...i.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:n}}}},t.childrenToRender={returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"},activeChildren:{dependencyType:"child",childLogicName:"anything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:[...e.titleChild,...e.activeChildren].map(n=>n.componentName)}}}},t}submitAllAnswers(){let t=[];for(let e of this.descendantsFound.answer)e.state.allAwardsJustSubmitted||t.push(e);if(this.answersToSubmitCounter=t.length,this.answersToSubmitCounter===0)this.externalFunctions.allAnswersSubmitted();else for(let e of t)e.submitAnswer()}static setUpVariant({serializedComponent:t,sharedParameters:e,definingChildrenSoFar:n,allComponentClasses:r}){let i;for(let s of n)if(s!==void 0&&s.componentType==="variantcontrol"){i=s;break}if(i===void 0){let s=100;t.variants.uniquevariants&&(s=t.variants.numberOfVariants),e.allPossibleVariants=[...Array(s).keys()].map(mf);let o,l=t.variants.desiredVariant;if(l!==void 0){if(l.index!==void 0){let p=Number(l.index);if(Number.isInteger(p))o=p%s,o<0&&(o+=s);else throw Error("Variant number "+l.index+" must be an integer")}else if(l.value!==void 0){if(typeof l.value=="string"){let p=e.allPossibleVariants.indexOf(l.value.toLowerCase());p!==-1&&(o=p)}o===void 0&&(console.log("Variant "+l.value+" is not valid, convert to variant index"),o=Math.abs(e.hashStringToInteger(JSON.stringify(l.value))%s),console.log(o))}}if(o===void 0){let p=e.selectRng.random();o=Math.floor(p*s)}let c=o+1,d=e.hashStringToInteger(c.toString());e.variantNumber=o,e.variant=mf(o),e.selectRng=new e.rngClass(d),t.variants.generatedSelectParameters={selectRng:e.selectRng,variant:e.variant,allPossibleVariants:e.allPossibleVariants}}else e.variant=i.state.selectedVariant.value,e.variantNumber=i.state.selectedVariantNumber.value,e.selectRng=i.state.selectRng.value,e.allPossibleVariants=i.state.variants.value;console.log("Document variant: "+e.variant);let a=t.variants.desiredVariant;if(a===void 0&&(a={}),a.subvariants===void 0&&t.variants.uniquevariants){let s=this.getUniqueVariant({serializedComponent:t,variantNumber:e.variantNumber,allComponentClasses:r});s.success&&Object.assign(a,s.desiredVariant)}if(a.subvariants!==void 0&&t.variants.descendantVariantComponents!==void 0)for(let s in a.subvariants){let o=a.subvariants[s],l=t.variants.descendantVariantComponents[s];if(l===void 0)break;l.variants.desiredVariant=o}}static determineNumberOfUniqueVariants({serializedComponent:t}){if(t.children===void 0)return{success:!0,numberOfVariants:1};let e,n;for(let[o,l]of t.children.entries())if(l.componentType==="variantcontrol"||l.createdComponent&&components[l.componentName].componentType==="variantcontrol"){e=o,n=l;break}let r=100;if(e!==void 0&&n.children!==void 0){for(let o of n.children)if(o.componentType==="nvariants"){let l=!1;if(o.state!==void 0&&o.state.value!==void 0&&(r=Math.round(Number(o.state.value)),l=!0),o.children!==void 0&&o.children.length===1&&o.children[0].componentType==="string"&&(r=Math.round(Number(o.children[0].state.value)),l=!0),!l)return{success:!1};break}}let i,a=1,s=[];return t.variants.descendantVariantComponents!==void 0&&(s=t.variants.descendantVariantComponents.map(o=>o.variants.numberOfVariants),a=s.reduce((o,l)=>o*l,1),i={numberOfVariantsByDescendant:s}),r=Math.min(a,r),{success:!0,numberOfVariants:r,uniqueVariantData:i}}static getUniqueVariant({serializedComponent:t,variantNumber:e,allComponentClasses:n}){if(t.variants===void 0)return{succes:!1};let r=t.variants.numberOfVariants;if(r===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=r)return{success:!1};let i=ln({variantNumber:e,serializedComponent:t,allComponentClasses:n});return i.success?{success:!0,desiredVariant:{subvariants:i.desiredVariants}}:(console.log("Failed to get unique variant for document."),{success:!1})}static includeBlankStringChildren=!0},ff=Ka;function mf(u){let t="";for(;;){let e=u%26;if(t=String.fromCharCode(97+e)+t,u<26)break;u=Math.floor(u/26)-1}return t}function Dv(){return[{feedbackCode:"numericalerror",feedbackText:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?"},{feedbackCode:"goodjob",feedbackText:"Good job!"},{feedbackCode:"onesignerror",feedbackText:"Credit reduced because it appears that you made a sign error."},{feedbackCode:"twosignerrors",feedbackText:"Credit reduced because it appears that you made two sign errors."}]}var Wa=class extends B{static componentType="string";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["value"]}static createPropertiesObject(){return{hide:{default:!1}}}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:()=>({}),defaultValue:"",forRenderer:!0,set:String,definition:()=>({useEssentialOrDefaultValue:{value:{variablesToCheck:"value"}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"value",value:String(e.value)}]}}},t.text={returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition({dependencyValues:e}){return{newValues:{text:e.value}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"value",desiredValue:e.text}]}}},t}},hf=Wa;var Ua=class extends z{static componentType="letters";static rendererType="text";updateState(t={}){if(super.updateState(t),!(!this.childLogicSatisfied||this.unresolvedState.value)&&!Av.test(this.state.value))throw Error("Letters can only contain a-z or A-Z: '"+this.state.value+"' is invalid.")}},yf=Ua,Av=/^[a-zA-Z]*$/;var Ga=class extends B{static componentType="randomizedtextlist";static stateVariableForPropertyValue="texts";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.unordered={default:!1},e.maximumNumber={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroTexts",componentType:"text",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroTextlists",componentType:"textlist",comparison:"atLeast",number:0}),i=function({dependencyValues:o}){let l=o.stringChildren[0],c=l.stateValues.value.split(",").map(d=>({componentType:"text",state:{value:d.trim()}}));return{success:!0,newChildren:c,toDelete:[l.componentName]}},a=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,returnSugarDependencies:()=>({stringChildren:{dependencyType:"child",childLogicName:"exactlyOneString",variableNames:["value"]}}),logicToWaitOnSugar:["atLeastZeroTexts"],replacementFunction:i}),s=e.newOperator({name:"textAndTextLists",operator:"and",propositions:[n,r]});return e.newOperator({name:"TextsXorSugar",operator:"xor",propositions:[a,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.texts={public:!0,componentType:"text",isArray:!0,entryPrefixes:["text"],returnDependencies:()=>({textAndTextlistChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["value","texts"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},childrenToRender:{dependencyType:"stateVariable",variableName:"childrenToRender"}}),definition:function({dependencyValues:e}){let n=[],r=e.textAndTextlistChildren.map(i=>i.componentName);for(let i of e.childrenToRender){let a=r.indexOf(i),s=e.textAndTextlistChildren[a];s.stateValues.texts?n.push(...s.stateValues.texts):n.push(s.stateValues.value)}return{newValues:{texts:n}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:({dependencyValues:e})=>({newValues:{text:e.texts.join(", ")}})},t.nComponents={public:!0,componentType:"number",returnDependencies:()=>({texts:{dependencyType:"stateVariable",variableName:"texts"}}),definition:function({dependencyValues:e}){return{newValues:{nComponents:e.texts.length}}}},t.childrenToRender={returnDependencies:({sharedParameters:e})=>({textAndTextlistChildren:{dependencyType:"child",childLogicName:"textAndTextLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){let n=[];for(let a of e.textAndTextlistChildren)a.stateValues.childrenToRender?n.push(...a.stateValues.childrenToRender):n.push(a.componentName);let r=e.maximumNumber;r!==null&&n.length>r&&(r=Math.max(0,Math.floor(r)),n=n.slice(0,r)),console.log("randomizing children");for(let a=n.length-1;a>0;a--){let s=e.selectRng.random(),o=Math.floor(s*(a+1));[n[a],n[o]]=[n[o],n[a]]}let i=Math.ceil(e.selectRng.random()*n.length);return console.log(`numChildren: ${i}`),n=n.slice(0,i),{newValues:{childrenToRender:n}}}},t}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.aslist({key:this.componentName}))}},bf=Ga;var Xa=class extends Q{static componentType="p";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let r of e.inlineChildren)typeof r.stateValues.text=="string"?n+=r.stateValues.text:n+=" ";return{newValues:{text:n}}}},t}static includeBlankStringChildren=!0},gf=Xa;var Za=class extends B{static componentType="booleanlist";static rendererType="aslist";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.unordered={default:!1},e.maximumNumber={default:void 0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"boolean",children:[{componentType:"string",state:{value:s}}]}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroBooleans",componentType:"boolean",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroBooleanlists",componentType:"booleanlist",comparison:"atLeast",number:0});return e.newOperator({name:"booleanAndBooleanLists",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.overrideChildHide={returnDependencies:()=>({}),definition:()=>({newValues:{overrideChildHide:!0}})},t.nComponents={public:!0,componentType:"number",additionalStateVariablesDefined:["childIndexByArrayKey"],returnDependencies(){return{maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"},booleanAndBooleanlistChildren:{dependencyType:"child",childLogicName:"booleanAndBooleanLists",variableNames:["nComponents"],variablesOptional:!0}}},definition:function({dependencyValues:e}){let n=0,r=[];for(let[a,s]of e.booleanAndBooleanlistChildren.entries())if(s.stateValues.nComponents!==void 0){for(let o=0;o<s.stateValues.nComponents;o++)r[n+o]=[a,o];n+=s.stateValues.nComponents}else r[n]=[a,0],n+=1;let i=e.maximumNumber;return i!==null&&n>i&&(n=i,r=r.slice(0,i)),{newValues:{nComponents:n,childIndexByArrayKey:r},checkForActualChange:{nComponents:!0}}}},t.booleans={public:!0,componentType:"boolean",isArray:!0,entryPrefixes:["boolean"],stateVariablesDeterminingDependencies:["childIndexByArrayKey"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:e}){return[e.nComponents]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},i={childIndexByArrayKey:{dependencyType:"stateVariable",variableName:"childIndexByArrayKey"}};for(let a of e){let s=[],o="1";n.childIndexByArrayKey[a]&&(s=[n.childIndexByArrayKey[a][0]],o=n.childIndexByArrayKey[a][1]+1),r[a]={booleanAndBooleanlistChildren:{dependencyType:"child",childLogicName:"booleanAndBooleanLists",variableNames:["value","boolean"+o],variablesOptional:!0,childIndices:s}}}return{globalDependencies:i,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].booleanAndBooleanlistChildren[0];if(s)if(s.stateValues.value!==void 0)i[a]=s.stateValues.value;else{let o=e.childIndexByArrayKey[a][1]+1;i[a]=s.stateValues["boolean"+o]}}return{newValues:{booleans:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[];for(let o in e.booleans){if(!r[o])continue;let l=r[o].booleanAndBooleanlistChildren[0];l&&(l.stateValues.value!==void 0?s.push({setDependency:i[o].booleanAndBooleanlistChildren,desiredValue:e.booleans[o],childIndex:0,variableIndex:0}):s.push({setDependency:i[o].booleanAndBooleanlistChildren,desiredValue:e.booleans[o],childIndex:0,variableIndex:1}))}return{success:!0,instructions:s}}},t.nValues={isAlias:!0,targetVariableName:"nComponents"},t.values={isAlias:!0,targetVariableName:"booleans"},t.childrenToRender={returnDependencies:()=>({booleanAndBooleanlistChildren:{dependencyType:"child",childLogicName:"booleanAndBooleanLists",variableNames:["childrenToRender"],variablesOptional:!0},maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=[];for(let a of e.booleanAndBooleanlistChildren)n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"booleanlist"})?r.push(...a.stateValues.childrenToRender):r.push(a.componentName);let i=e.maximumNumber;return i!==null&&r.length>i&&(i=Math.max(0,Math.floor(i)),r=r.slice(0,i)),{newValues:{childrenToRender:r}}}},t}},vf=Za;function ke({serializedComponents:u,componentName:t,addShadowDependencies:e=!0,uniqueIdentifiersUsed:n,identifierPrefix:r=""}){return Ja({serializedComponents:u,componentName:t,addShadowDependencies:e,uniqueIdentifiersUsed:n,identifierPrefix:r}),u}function Ja({serializedComponents:u,componentName:t,addShadowDependencies:e=!0,uniqueIdentifiersUsed:n=[],identifierPrefix:r=""}){for(let i in u){let a=u[i],s;if(a.originalName){if(s=r+a.originalName+"|shadow",e&&!a.originalNameFromSerializedComponent){let o={[a.originalName]:[{dependencyType:"referenceShadow",compositeName:t}]};if(a.state){let l=Object.keys(a.state);o[a.originalName].downstreamStateVariables=l,o[a.originalName].upstreamStateVariables=l}a.includeAnyDefiningChildren&&(o[a.originalName].includeAnyDefiningChildren=a.includeAnyDefiningChildren),a.includePropertyChildren&&(o[a.originalName].includePropertyChildren=a.includePropertyChildren),a.downstreamDependencies=o}}else s=r+a.componentType+"|shadowUnnamed";a.uniqueIdentifier=at(s,n),Ja({serializedComponents:a.children,componentName:t,addShadowDependencies:e,uniqueIdentifiersUsed:n,identifierPrefix:r}),a.replacements&&Ja({serializedComponents:a.replacements,componentName:t,addShadowDependencies:e,uniqueIdentifiersUsed:n,identifierPrefix:r})}}var Ya=class extends G{constructor(t){super(t);this.processNewDoenetML=this.processNewDoenetML.bind(this)}static componentType="copy";static assignNamesToReplacements=!0;static acceptTname=!0;static acceptProp=!0;static get stateVariablesShadowedForReference(){return["targetComponent","propName"]}static createPropertiesObject({allPossibleProperties:t}){if(t===void 0)return{};let e={};for(let n of t)e[n]={ignorePropagationFromAncestors:!0,default:null};return delete e.string,delete e.contentid,delete e.math,delete e.number,delete e.text,e.includeUndefinedObjects={default:!1},e.componentIndex={default:null},e.propIndex={default:null},e.targetPropertiesToIgnore={default:["hide"]},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneContentId",componentType:"contentid",number:1,comparison:"atMost",setAsBase:!0}),e}static returnStateVariableDefinitions({propertyNames:t}){let e=super.returnStateVariableDefinitions();return e.tName={returnDependencies:()=>({tName:{dependencyType:"doenetAttribute",attributeName:"tName"}}),definition:({dependencyValues:n})=>({newValues:{tName:n.tName}})},e.targetSourcesName={additionalStateVariablesDefined:["sourcesChildNumber"],stateVariablesDeterminingDependencies:["tName"],returnDependencies:function({stateValues:n,sharedParameters:r}){let i=r.sourceNameMappings;if(!i)return{};let a=i[n.tName];return a?{targetSourcesName:{dependencyType:"value",value:a.name},sourcesChildNumber:{dependencyType:"value",value:a.childNumber}}:{}},definition:function({dependencyValues:n}){let r=n.targetSourcesName,i=n.sourcesChildNumber;return r||(r=null,i=null),{newValues:{targetSourcesName:r,sourcesChildNumber:i},makeEssential:["targetSourcesName","sourcesChildNumber"]}}},e.targetSources={stateVariablesDeterminingDependencies:["targetSourcesName"],returnDependencies({stateValues:n}){return n.targetSourcesName?{targetSourcesComponent:{dependencyType:"componentIdentity",componentName:n.targetSourcesName}}:{}},definition:function({dependencyValues:n}){let r=n.targetSourcesComponent;return r||(r=null),{newValues:{targetSources:r}}}},e.sourceIndex={stateVariablesDeterminingDependencies:["tName"],returnDependencies:function({stateValues:n,sharedParameters:r}){let i=r.sourceIndexMappings;if(!i)return{};let a=i[n.tName];return a===void 0?{}:{sourceIndex:{dependencyType:"value",value:a}}},definition:function({dependencyValues:n}){let r=n.sourceIndex;return r===void 0&&(r=null),{newValues:{sourceIndex:r},makeEssential:["sourceIndex"]}}},e.targetComponent={stateVariablesDeterminingDependencies:["targetSources","sourceIndex"],returnDependencies({stateValues:n}){return n.sourceIndex!==null?{}:n.targetSources!==null?{targetSourcesChildren:{dependencyType:"stateVariable",componentName:n.targetSources.componentName,variableName:"childIdentities"},sourcesChildNumber:{dependencyType:"stateVariable",variableName:"sourcesChildNumber"}}:{targetComponent:{dependencyType:"targetComponent"}}},definition:function({dependencyValues:n}){let r=null;return n.targetSourcesChildren?(r=n.targetSourcesChildren[n.sourcesChildNumber],r||(r=null)):n.targetComponent&&(r=n.targetComponent),{newValues:{targetComponent:r}}}},e.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:n}){return n.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:n.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:n}){return{newValues:{targetInactive:Boolean(n.targetIsInactiveCompositeReplacement)}}}},e.contentId={returnDependencies:()=>({contentIdChild:{dependencyType:"child",childLogicName:"atMostOneContentId",variableNames:["value"]},newNamespace:{dependencyType:"doenetAttribute",attributeName:"newNamespace"}}),defaultValue:null,definition:function({dependencyValues:n}){if(n.contentIdChild.length===0)return{useEssentialOrDefaultValue:{contentId:{variablesToCheck:"contentId"}}};if(!newNamespace.value)throw Error("Cannot copy contentId without specifying a new namespace");return{newValues:{contentId:n.contentIdChild[0].stateValues.value}}}},e.serializedStateForContentId={returnDependencies:()=>({}),defaultValue:null,definition:function(){return{useEssentialOrDefaultValue:{serializedStateForContentId:{variablesToCheck:"serializedStateForContentId"}}}}},e.propName={returnDependencies:()=>({propName:{dependencyType:"doenetAttribute",attributeName:"propName"}}),definition:function({dependencyValues:n}){return{newValues:{propName:n.propName}}}},e.isPlainMacro={returnDependencies:()=>({isPlainMacro:{dependencyType:"doenetAttribute",attributeName:"isPlainMacro"}}),definition:function({dependencyValues:n}){return{newValues:{isPlainMacro:n.isPlainMacro}}}},e.preliminaryReplacementSourceIdentities={stateVariablesDeterminingDependencies:["targetComponent","componentIndex"],returnDependencies:function({stateValues:n,componentInfoObjects:r}){let i={};return n.targetComponent!==null&&(r.isCompositeComponent({componentType:n.targetComponent.componentType,includeNonStandard:!1})?i.targets={dependencyType:"replacement",compositeName:n.targetComponent.componentName,recursive:!0,componentIndex:n.componentIndex}:(n.componentIndex===null||n.componentIndex===1)&&(i.targets={dependencyType:"stateVariable",variableName:"targetComponent"})),i},definition({dependencyValues:n}){let r=null;return n.targets&&(r=n.targets,Array.isArray(r)||(r=[r])),{newValues:{preliminaryReplacementSourceIdentities:r}}}},e.replacementSourceIdentities={additionalStateVariablesDefined:["effectivePropNameBySource"],stateVariablesDeterminingDependencies:["preliminaryReplacementSourceIdentities","propName","isPlainMacro"],returnDependencies:function({stateValues:n,componentInfoObjects:r}){let i={preliminaryReplacementSourceIdentities:{dependencyType:"stateVariable",variableName:"preliminaryReplacementSourceIdentities"}};if(n.preliminaryReplacementSourceIdentities!==null)for(let[a,s]of n.preliminaryReplacementSourceIdentities.entries()){let o=n.propName;n.isPlainMacro&&(o=r.allComponentClasses[s.componentType].variableForPlainMacro),o&&(i["propName"+a]={dependencyType:"value",value:o}),i["target"+a]={dependencyType:"componentIdentity",componentName:s.componentName}}return i},definition({dependencyValues:n}){let r=null,i=null;if(n.preliminaryReplacementSourceIdentities!==null){r=[],i=[];for(let a in n.preliminaryReplacementSourceIdentities)n["target"+a]&&r.push(n["target"+a]),n["propName"+a]&&(i[a]=n["propName"+a])}return{newValues:{replacementSourceIdentities:r,effectivePropNameBySource:i}}}},e.replacementSources={stateVariablesDeterminingDependencies:["preliminaryReplacementSourceIdentities","propName","propIndex","isPlainMacro","effectivePropNameBySource"],returnDependencies:function({stateValues:n,componentInfoObjects:r}){let i={preliminaryReplacementSourceIdentities:{dependencyType:"stateVariable",variableName:"preliminaryReplacementSourceIdentities"}};if(!n.propName&&n.propIndex!==null)throw Error("You cannot specify a propIndex without specifying a prop.");if(n.preliminaryReplacementSourceIdentities!==null)for(let[a,s]of n.preliminaryReplacementSourceIdentities.entries()){let o=n.effectivePropNameBySource[a],l;o?l={dependencyType:"stateVariable",componentName:s.componentName,variableName:o,returnAsComponentObject:!0,variablesOptional:!0,propIndex:n.propIndex,caseInsensitiveVariableMatch:!0,publicStateVariablesOnly:!0,useMappedVariableNames:!0}:l={dependencyType:"componentIdentity",componentName:s.componentName},i["target"+a]=l}return i},definition({dependencyValues:n}){let r=null;if(n.preliminaryReplacementSourceIdentities!==null){r=[];for(let i in n.preliminaryReplacementSourceIdentities)n["target"+i]&&r.push(n["target"+i])}return{newValues:{replacementSources:r}}}},e.readyToExpand={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:n,componentInfoObjects:r}){let i={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"},replacementSources:{dependencyType:"stateVariable",variableName:"replacementSources"}};return n.targetComponent&&r.isCompositeComponent({componentType:n.targetComponent.componentType,includeNonStandard:!1})&&(i.targetReadyToExpand={dependencyType:"stateVariable",componentName:n.targetComponent.componentName,variableName:"readyToExpand"}),i},definition:function({dependencyValues:n}){let r=!0;return n.targetReadyToExpand!==void 0&&(r=n.targetReadyToExpand),{newValues:{readyToExpand:r}}}},e.needsReplacementsUpdatedWhenStale={stateVariablesDeterminingDependencies:["targetComponent","replacementSourceIdentities","effectivePropNameBySource"],returnDependencies:function({stateValues:n,componentInfoObjects:r}){let i={targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},targetInactive:{dependencyType:"stateVariable",variableName:"targetInactive"},replacementSourceIdentities:{dependencyType:"stateVariable",variableName:"replacementSourceIdentities"}};if(n.effectivePropNameBySource!==null){for(let[a,s]of n.effectivePropNameBySource.entries())if(s){let o=n.replacementSourceIdentities[a];i["sourceArraySize"+a]={dependencyType:"stateVariableArraySize",componentName:o.componentName,variableName:s,variablesOptional:!0,caseInsensitiveVariableMatch:!0},i["sourceComponentType"+a]={dependencyType:"stateVariableComponentType",componentName:o.componentName,variableName:s,variablesOptional:!0,caseInsensitiveVariableMatch:!0}}}return n.targetComponent!==null&&r.isCompositeComponent({componentType:n.targetComponent.componentType,includeNonStandard:!1})&&(i.allReplacementIdentities={dependencyType:"replacement",compositeName:n.targetComponent.componentName,recursive:!0,variableNames:["isInactiveCompositeReplacement"]}),i},markStale(){return{updateReplacements:!0}},definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},e}processNewDoenetML({newDoenetMLs:t,message:e,success:n}){if(!n){console.warn(e);return}let r=Xl({doenetML:t[0],standardComponentClasses:this.componentInfoObjects.standardComponentClasses,allComponentClasses:this.componentInfoObjects.allComponentClasses});r=Zl(r),tn(r,this.componentInfoObjects.standardComponentClasses),xt({serializedState:r,componentInfoObjects:this.componentInfoObjects}),this.componentNameToPreserializedName(r,this.componentInfoObjects.componentTypesTakingComponentNames),Fn({serializedState:r,componentTypesCreatingVariants:this.componentInfoObjects.componentTypesCreatingVariants,componentInfoObjects:this.componentInfoObjects}),this.coreFunctions.requestUpdate({updateType:"updateValue",updateInstructions:[{componentName:this.componentName,variableUpdates:{serializedContent:{changes:r},serializedContentChanged:{changes:!0}}}],saveSerializedState:!1})}componentNameToPreserializedName(t,e){for(let n of t){let r=n.componentName;if(r!==void 0&&(n.componentName=this.componentName+r),n.componentType in e){let i;for(let a of n.children)if(a.componentType==="string"){a.state.value=this.componentName+a.state.value;break}n.targetComponentName=i}n.children!==void 0&&this.componentNameToPreserializedName(n.children,e)}}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){if(n.numReplacementsBySource=[],n.propVariablesCopiedBySource=[],n.sourceNames=[],n.uniqueIdentifiersUsedBySource={},t.stateValues.needsReplacementsUpdatedWhenStale,t.stateValues.sourceIndex!==null){let o=[{componentType:"number",state:{value:t.stateValues.sourceIndex,fixed:!0},downstreamDependencies:{[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]}}];return{replacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:o,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:r}).serializedComponents}}if(!t.stateValues.targetComponent||!t.stateValues.replacementSources)return{replacements:[]};let i=[],a=[],s=0;for(let o in t.stateValues.replacementSources){let l=n.uniqueIdentifiersUsedBySource[o]=[],c=this.createReplacementForSource({component:t,sourceNum:o,components:e,numReplacementsSoFar:s,uniqueIdentifiersUsed:l,componentInfoObjects:r});n.propVariablesCopiedBySource[o]=c.propVariablesCopiedByReplacement;let d=c.serializedReplacements;a[o]=d.length,s+=d.length,i.push(...d)}return n.numReplacementsBySource=a,n.sourceNames=t.stateValues.replacementSources.map(o=>o.componentName),{replacements:i}}static createReplacementForSource({component:t,sourceNum:e,components:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:i,componentInfoObjects:a}){let s=t.stateValues.replacementSources[e],o=n[s.componentName];if(o.stateValues.isInactiveCompositeReplacement)return{serializedReplacements:[]};if(t.stateValues.effectivePropNameBySource[e]){let d=En({component:t,components:n,replacementSource:s,propName:t.stateValues.effectivePropNameBySource[e],numReplacementsSoFar:r,uniqueIdentifiersUsed:i});return{serializedReplacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:d.serializedReplacements,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,indOffset:r,componentInfoObjects:a}).serializedComponents,propVariablesCopiedByReplacement:d.propVariablesCopiedByReplacement}}let l=[o.serialize({forCopy:!0})];return l=ke({serializedComponents:l,componentName:t.componentName,uniqueIdentifiersUsed:i}),{serializedReplacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:l,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,indOffset:r,componentInfoObjects:a}).serializedComponents}}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:i}){if(t.stateValues.sourceIndex!==null)return[];t.stateValues.needsReplacementsUpdatedWhenStale;let a=[];if(!t.stateValues.targetComponent||!t.stateValues.replacementSources){if(t.replacements.length>0){let p={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:t.replacements.length};a.push(p)}return r.sourceNames=[],r.numReplacementsBySource=[],r.propVariablesCopiedBySource=[],a}if(t.stateValues.targetInactive){let p=t.replacements.length;if(p>0&&t.replacementsToWithhold!==p){let m={changeType:"changeReplacementsToWithhold",replacementsToWithhold:p};a.push(m)}return a}if(t.replacementsToWithhold>0){let p={changeType:"changeReplacementsToWithhold",replacementsToWithhold:0};a.push(p)}let s=0,o=[],l=[],c=Math.max(t.stateValues.replacementSourceIdentities.length,r.numReplacementsBySource.length),d=!1;for(let p=0;p<c;p++){let m=t.stateValues.replacementSources[p];if(m===void 0){if(r.numReplacementsBySource[p]>0){if(!d){let C=r.numReplacementsBySource.slice(p).reduce((x,V)=>x+V,0);if(C>0){let x={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToDelete:C};a.push(x)}d=!0,r.numReplacementsBySource.slice(p).forEach((x,V)=>r.numReplacementsBySource[V]=0)}r.uniqueIdentifiersUsedBySource[p]=[]}o[p]=0,l.push([]);continue}let f=r.sourceNames[p],h=f===void 0||m.componentName!==f||d;if(!h)for(let C=0;C<r.numReplacementsBySource[p];C++){let x=t.replacements[s+C];if(x){if(!t.stateValues.effectivePropNameBySource[p]&&x.shadows.componentName!==t.stateValues.replacementSourceIdentities[p].componentName){h=!0;break}}else{h=!0;break}}if(h){let C=0;f!==void 0&&(C=r.numReplacementsBySource[p]);let x=C;d&&(x=0);let V=r.uniqueIdentifiersUsedBySource[p]=[],w=this.recreateReplacements({component:t,sourceNum:p,numReplacementsSoFar:s,numReplacementsToDelete:x,components:n,uniqueIdentifiersUsed:V,componentInfoObjects:i});s+=w.numReplacements,o[p]=w.numReplacements,l[p]=w.propVariablesCopiedByReplacement;let D=w.replacementInstruction;if(!d&&w.numReplacements!==C){let I=r.numReplacementsBySource.slice(p).reduce((A,S)=>A+S,0);D.numberReplacementsToReplace=I,d=!0,r.numReplacementsBySource.slice(p).forEach((A,S)=>r.numReplacementsBySource[S]=0)}a.push(D);continue}if(!t.stateValues.effectivePropNameBySource[p]){if(n[m.componentName].stateValues.isInactiveCompositeReplacement){if(r.numReplacementsBySource[p]===0){s+=r.numReplacementsBySource[p],o[p]=r.numReplacementsBySource[p];continue}}else if(r.numReplacementsBySource[p]>0){s+=r.numReplacementsBySource[p],o[p]=r.numReplacementsBySource[p];continue}}let y=r.uniqueIdentifiersUsedBySource[p]=[],b=this.createReplacementForSource({component:t,sourceNum:p,components:n,numReplacementsSoFar:s,uniqueIdentifiersUsed:y,componentInfoObjects:i}),g=b.propVariablesCopiedByReplacement,T=b.serializedReplacements,N=T.length,v=r.numReplacementsBySource[p];if(N!==v){let C=r.numReplacementsBySource.slice(p).reduce((V,w)=>V+w,0),x={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToReplace:C,serializedReplacements:T,assignNamesOffset:s};a.push(x),d=!0,r.numReplacementsBySource.slice(p).forEach((V,w)=>r.numReplacementsBySource[w]=0)}else for(let C=0;C<N;C++)if(g[C].length!==r.propVariablesCopiedBySource[p][C].length||r.propVariablesCopiedBySource[p][C].some((x,V)=>x!==g[C][V])||t.replacements[s+C].componentType!==T[C].componentType){let x={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s+C,numberReplacementsToReplace:1,serializedReplacements:[T[C]],assignNamesOffset:s+C};a.push(x)}s+=N,o[p]=N,l[p]=g}return r.numReplacementsBySource=o,r.sourceNames=t.stateValues.replacementSources.map(p=>p.componentName),r.propVariablesCopiedBySource=l,a}static recreateReplacements({component:t,sourceNum:e,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:i,components:a,componentInfoObjects:s}){let o=this.createReplacementForSource({component:t,sourceNum:e,numReplacementsSoFar:n,components:a,uniqueIdentifiersUsed:i,componentInfoObjects:s}),l=o.propVariablesCopiedByReplacement,c=o.serializedReplacements,d={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:c,assignNamesOffset:n};return{numReplacements:c.length,propVariablesCopiedByReplacement:l,replacementInstruction:d}}},Cf=Ya;function En({component:u,components:t,replacementSource:e,propName:n,uniqueIdentifiersUsed:r}){let i=[],a=[],s=-1,o=t[e.componentName],l=Object.keys(e.stateValues)[0];if(l===void 0)return console.warn(`Could not find prop ${n} on a component of type ${e.componentType}`),{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let c=o.state[l];if(c.isArray||c.isArrayEntry){let d,p;if(c.isArray?(d=c,p=c.getAllArrayKeys(c.arraySize,!1)):(d=o.state[c.arrayStateVariable],p=c.unflattenedArrayKeys),!d.componentType)return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};let m=c.wrappingComponents,f=m.length,h;if(c.isArray)h=c.arraySize.slice(0,c.arraySize.length-f).reduce((y,b)=>y*b,1);else if(c.arrayKeys.length===0)u.stateValues.includeUndefinedObjects?h=1:h=0;else if(f===0)h=c.arrayKeys.length;else if(f>=c.nDimensions)h=1;else if(f===c.nDimensions-1)h=p.length;else{let y=c.nDimensions-f-1;h=xi(p,y).length}if(f===0){let y=ne(p);for(let b=0;b<h;b++){s++;let g=a[s]=[],T=d.componentType;Array.isArray(T)&&(c.isArrayEntry?T=T[d.keyToIndex(c.arrayKeys[b])]:T=T[b]),T=T.toLowerCase();let N=y[b];if(N){let v=d.arrayVarNameFromArrayKey(N);g.push(v);{let C=e.componentName+"|shadow|"+v,x=at(C,r);i.push({componentType:T,downstreamDependencies:{[e.componentName]:[{dependencyType:"referenceShadow",compositeName:u.componentName,propVariable:v}]},uniqueIdentifier:x})}}else{let v=T+"|empty",C=at(v,r);i.push({componentType:T,uniqueIdentifier:C})}}}else{let y=function(T,N){let v=[],C=[];if(N>1)for(let V of T){let w=y(V,N-1);v.push(...w.pieces),C.push(...w.propVariablesCopiedByPiece)}else for(let V of T){let w=d.arrayVarNameFromArrayKey(V),D=[w];{let I=e.componentName+"|shadow|"+w,A=at(I,r),S=d.componentType;Array.isArray(S)&&(S=S[d.keyToIndex(V)]),S=S.toLowerCase(),v.push({componentType:S,downstreamDependencies:{[e.componentName]:[{dependencyType:"referenceShadow",compositeName:u.componentName,propVariable:w}]},uniqueIdentifier:A})}C.push(D)}let x=m[N-1];if(v.length>0&&x&&x.length>0){for(let V=x.length-1;V>=0;V--){let w=typeof x[V]=="object"?x[V].componentType:x[V],D=w+"|wrapper",I=at(D,r);v=[{componentType:w.toLowerCase(),children:v,uniqueIdentifier:I}],typeof x[V]=="object"&&x[V].doenetAttributes&&(v[0].doenetAttributes=Object.assign({},x[V].doenetAttributes))}C=[ne(C)]}return{pieces:v,propVariablesCopiedByPiece:C}},b=y(p,c.nDimensions),g=b.pieces;a=b.propVariablesCopiedByPiece;for(let T of g)T.downstreamDependencies={[e.componentName]:[{dependencyType:"referenceShadow",compositeName:u.componentName,propVariable:l,ignorePrimaryStateVariable:!0}]};if(s+=g.length,i.push(...g),g.length<h)for(let T=g.length;T<h;T++){s++,a[s]=[];let N,v=m[0],C;v&&v.length>0?typeof v[0]=="object"?(N=v[0].componentType,C=Object.assign({},v[0].doenetAttributes)):N=v[0]:(N=d.componentType,Array.isArray(N)&&(c.isArrayEntry?N=N[d.keyToIndex(c.arrayKeys[T])]:N=N[T]),N=N.toLowerCase());let x=N+"|empty",V=at(x,r),w={componentType:N,uniqueIdentifier:V};C&&(w.doenetAttributes=C),i.push(w)}else if(g>h)throw Error(`Something went wrong when creating replacements for ${u.componentName} as we ended up with too many replacements`)}}else{if(!c.componentType)return{serializedReplacements:[],propVariablesCopiedByReplacement:[]};s++,(a[s]=[]).push(l);let p=o.componentName+"|shadow|"+l,m=at(p,r);i.push({componentType:c.componentType.toLowerCase(),downstreamDependencies:{[o.componentName]:[{dependencyType:"referenceShadow",compositeName:u.componentName,propVariable:l}]},uniqueIdentifier:m})}return{serializedReplacements:i,propVariablesCopiedByReplacement:a}}var Qa=class extends G{static componentType="extract";static assignNamesToReplacements=!0;static acceptProp=!0;static get stateVariablesShadowedForReference(){return["propName"]}static createPropertiesObject({allPossibleProperties:t}){if(t===void 0)return{};let e={};for(let n of t)e[n]={ignorePropagationFromAncestors:!0,default:null};return delete e.string,delete e.contentid,delete e.math,delete e.number,delete e.text,e.includeUndefinedObjects={default:!1},e.componentIndex={default:null},e.propIndex={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",excludeComponentTypes:["_composite"],number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.propName={returnDependencies:()=>({propName:{dependencyType:"doenetAttribute",attributeName:"propName"}}),definition:function({dependencyValues:e}){return{newValues:{propName:e.propName}}}},t.sourceComponents={stateVariablesDeterminingDependencies:["propName","componentIndex","propIndex"],returnDependencies:({stateValues:e})=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:[e.propName],variablesOptional:!0,componentIndex:e.componentIndex,propIndex:e.propIndex,publicCaseInsensitiveVariableMatch:!0,useMappedVariableNames:!0,requireChildLogicInitiallySatisfied:!0}}),definition:({dependencyValues:e})=>({newValues:{sourceComponents:e.children}})},t.readyToExpand={returnDependencies:()=>({replacementClasses:{dependencyType:"stateVariable",variableName:"sourceComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition(){return{newValues:{readyToExpand:!0}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies(){return{sourceComponents:{dependencyType:"stateVariable",variableName:"sourceComponents"}}},markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}get allPotentialRendererTypes(){let t=[];if(this.replacements)for(let e of this.replacements)for(let n of e.allPotentialRendererTypes)t.includes(n)||t.push(n);return t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){t.stateValues.needsReplacementsUpdatedWhenStale;let i=[],a=[],s=0;n.propVariablesCopiedBySource=[],n.uniqueIdentifiersUsedBySource={};for(let o=0;o<t.stateValues.sourceComponents.length;o++)if(t.stateValues.sourceComponents[o]!==void 0){let l=n.uniqueIdentifiersUsedBySource[o]=[],c=this.createReplacementForSource({component:t,sourceNum:o,components:e,numReplacementsSoFar:s,uniqueIdentifiersUsed:l,componentInfoObjects:r});n.propVariablesCopiedBySource[o]=c.propVariablesCopiedByReplacement;let d=c.serializedReplacements;a[o]=d.length,s+=d.length,i.push(...d)}else a[o]=0;return n.numReplacementsBySource=a,n.sourceNames=t.stateValues.sourceComponents.map(o=>o.componentName),{replacements:i}}static createReplacementForSource({component:t,components:e,sourceNum:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:i,componentInfoObjects:a}){let s=En({component:t,components:e,replacementSource:t.stateValues.sourceComponents[n],propName:t.stateValues.propName,uniqueIdentifiersUsed:i}),o=s.serializedReplacements,l=s.propVariablesCopiedByReplacement;return o=U({assignNames:t.doenetAttributes.assignNames,serializedComponents:o,parentName:t.componentName,indOffset:r,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:a}).serializedComponents,{serializedReplacements:o,propVariablesCopiedByReplacement:l}}static calculateReplacementChanges({component:t,components:e,workspace:n,componentInfoObjects:r}){t.stateValues.needsReplacementsUpdatedWhenStale;let i=[],a=0,s=[],o=[],l=Math.max(t.stateValues.sourceComponents.length,n.numReplacementsBySource.length),c=!1;for(let d=0;d<l;d++){let p=t.stateValues.sourceComponents[d];if(p===void 0){if(n.numReplacementsBySource[d]>0){if(!c){let v=n.numReplacementsBySource.slice(d).reduce((C,x)=>C+x,0);if(v>0){let C={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:a,numberReplacementsToDelete:v};i.push(C)}c=!0,n.numReplacementsBySource.slice(d).forEach((C,x)=>n.numReplacementsBySource[x]=0)}n.uniqueIdentifiersUsedBySource[d]=[]}s[d]=0,o.push([]);continue}let m=n.sourceNames[d],f=m===void 0||p.componentName!==m||c;if(!f){for(let v=0;v<n.numReplacementsBySource[d];v++)if(!t.replacements[a+v]){f=!0;break}}if(f){let v=0;m!==void 0&&(v=n.numReplacementsBySource[d]);let C=v;c&&(C=0);let x=n.uniqueIdentifiersUsedBySource[d]=[],V=this.recreateReplacements({component:t,sourceNum:d,numReplacementsSoFar:a,numReplacementsToDelete:C,components:e,uniqueIdentifiersUsed:x,componentInfoObjects:r});a+=V.numReplacements,s[d]=V.numReplacements,o[d]=V.propVariablesCopiedByReplacement;let w=V.replacementInstruction;if(!c&&V.numReplacements!==v){let D=n.numReplacementsBySource.slice(d).reduce((I,A)=>I+A,0);w.numberReplacementsToReplace=D,c=!0,n.numReplacementsBySource.slice(d).forEach((I,A)=>n.numReplacementsBySource[A]=0)}i.push(w);continue}let h=n.uniqueIdentifiersUsedBySource[d]=[],y=this.createReplacementForSource({component:t,sourceNum:d,components:e,numReplacementsSoFar:a,uniqueIdentifiersUsed:h,componentInfoObjects:r}),b=y.propVariablesCopiedByReplacement,g=y.serializedReplacements,T=g.length,N=n.numReplacementsBySource[d];if(T!==N){let v=n.numReplacementsBySource.slice(d).reduce((x,V)=>x+V,0),C={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:a,numberReplacementsToReplace:v,serializedReplacements:g,assignNamesOffset:a};i.push(C),c=!0,n.numReplacementsBySource.slice(d).forEach((x,V)=>n.numReplacementsBySource[V]=0)}else for(let v=0;v<T;v++)if(b[v].length!==n.propVariablesCopiedBySource[d][v].length||n.propVariablesCopiedBySource[d][v].some((C,x)=>C!==b[v][x])){let C={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:a+v,numberReplacementsToReplace:1,serializedReplacements:[g[v]],assignNamesOffset:a+v};i.push(C)}a+=T,s[d]=T,o[d]=b}return n.numReplacementsBySource=s,n.sourceNames=t.stateValues.sourceComponents.map(d=>d.componentName),n.propVariablesCopiedBySource=o,i}static recreateReplacements({component:t,sourceNum:e,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:i,components:a,componentInfoObjects:s}){let o=this.createReplacementForSource({component:t,sourceNum:e,numReplacementsSoFar:n,components:a,uniqueIdentifiersUsed:i,componentInfoObjects:s}),l=o.propVariablesCopiedByReplacement,c=o.serializedReplacements,d={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:c,assignNamesOffset:n};return{numReplacements:c.length,propVariablesCopiedByReplacement:l,replacementInstruction:d}}},Tf=Qa;var es=class extends G{static componentType="collect";static assignNamesToReplacements=!0;static acceptTname=!0;static acceptProp=!0;static get stateVariablesShadowedForReference(){return["targetComponent","propName","componentTypesToCollect"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.maximumNumber={default:null},e.componentIndex={default:null},e.propIndex={default:null},e.targetPropertiesToIgnore={default:["hide"]},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneComponentTypes",componentType:"componentTypes",comparison:"atMost",number:1,takePropertyChildren:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){return{newValues:{targetComponent:e.targetComponent}}}},t.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:e}){return e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:e}){return{newValues:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},t.targetName={returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"}}),definition:function({dependencyValues:e}){return e.targetComponent===null?(console.warn("No copy target"),{newValues:{targetName:""}}):{newValues:{targetName:e.targetComponent.componentName}}}},t.propName={returnDependencies:()=>({propName:{dependencyType:"doenetAttribute",attributeName:"propName"}}),definition:function({dependencyValues:e}){return{newValues:{propName:e.propName}}}},t.componentTypesToCollect={returnDependencies:()=>({componentTypesChild:{dependencyType:"child",childLogicName:"atMostOneComponentTypes",variableNames:["texts"]}}),definition:function({dependencyValues:e}){return e.componentTypesChild.length===1?{newValues:{componentTypesToCollect:e.componentTypesChild[0].stateValues.texts}}:{newValues:{componentTypesToCollect:[]}}}},t.componentClassesToCollect={returnDependencies:()=>({componentTypesToCollect:{dependencyType:"stateVariable",variableName:"componentTypesToCollect"}}),definition:function({dependencyValues:e,componentInfoObjects:n}){let r=[];for(let i of e.componentTypesToCollect){let a=n.allComponentClasses[i];if(a===void 0){let s="Cannot collect component type "+i+". Component type not found.";console.warn(s)}else r.push(a)}return{newValues:{componentClassesToCollect:r}}}},t.collectedComponents={stateVariablesDeterminingDependencies:["componentTypesToCollect","targetName","propName","componentIndex","propIndex"],returnDependencies:function({stateValues:e}){if(!e.targetName)return{};let n={dependencyType:"descendant",ancestorName:e.targetName,componentTypes:e.componentTypesToCollect,useReplacementsForComposites:!0,includeNonActiveChildren:!0,recurseToMatchedChildren:!1,componentIndex:e.componentIndex};return e.propName&&(n.variableNames=[e.propName],n.variablesOptional=!0,n.componentIndex=e.componentIndex,n.propIndex=e.propIndex,n.publicCaseInsensitiveVariableMatch=!0,n.useMappedVariableNames=!0),{descendants:n,maximumNumber:{dependencyType:"stateVariable",variableName:"maximumNumber"}}},definition:function({dependencyValues:e}){let n=e.descendants;if(n||(n=[]),e.maximumNumber!==null&&n.length>e.maximumNumber){let r=Math.max(0,Math.floor(e.maximumNumber));n=n.slice(0,r)}return{newValues:{collectedComponents:n}}}},t.readyToExpand={returnDependencies:()=>({collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition:()=>({newValues:{readyToExpand:!0}})},t.needsReplacementsUpdatedWhenStale={returnDependencies(){return{collectedComponents:{dependencyType:"stateVariable",variableName:"collectedComponents"}}},markStale(){return{updateReplacements:!0}},definition(){return{newValues:{needsReplacementsUpdatedWhenStale:!0}}}},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){if(t.stateValues.needsReplacementsUpdatedWhenStale,!t.stateValues.targetComponent)return{replacements:[]};let i=[],a=[],s=0;n.propVariablesCopiedByCollected=[],n.uniqueIdentifiersUsedByCollected={};for(let o=0;o<t.stateValues.collectedComponents.length;o++)if(t.stateValues.collectedComponents[o]){let l=n.uniqueIdentifiersUsedByCollected[o]=[],c=this.createReplacementForCollected({component:t,collectedNum:o,components:e,numReplacementsSoFar:s,uniqueIdentifiersUsed:l,componentInfoObjects:r});n.propVariablesCopiedByCollected[o]=c.propVariablesCopiedByReplacement;let d=c.serializedReplacements;a[o]=d.length,s+=d.length,i.push(...d)}else a[o]=0;return n.numReplacementsByCollected=a,n.collectedNames=t.stateValues.collectedComponents.map(o=>o.componentName),{replacements:i}}static createReplacementForCollected({component:t,components:e,collectedNum:n,numReplacementsSoFar:r,uniqueIdentifiersUsed:i,componentInfoObjects:a}){let s=t.stateValues.collectedComponents[n],o=s.componentName,l=e[o],c=[],d=[];if(!l)return{serializedReplacements:c,propVariablesCopiedByReplacement:d};if(t.stateValues.propName){let m=En({component:t,components:e,replacementSource:s,propName:t.stateValues.propName,uniqueIdentifiersUsed:i});c=m.serializedReplacements,d=m.propVariablesCopiedByReplacement}else{let m=[l.serialize({forCopy:!0})];c=ke({serializedComponents:m,componentName:t.componentName,uniqueIdentifiersUsed:i,identifierPrefix:n+"|"})}return c=U({assignNames:t.doenetAttributes.assignNames,serializedComponents:c,parentName:t.componentName,indOffset:r,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:a}).serializedComponents,{serializedReplacements:c,propVariablesCopiedByReplacement:d}}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:i}){t.stateValues.needsReplacementsUpdatedWhenStale;let a=[],s=0,o=[],l=[],c=Math.max(t.stateValues.collectedComponents.length,r.numReplacementsByCollected.length),d=!1;for(let p=0;p<c;p++){let m=t.stateValues.collectedComponents[p];if(m===void 0){if(r.numReplacementsByCollected[p]>0){if(!d){let v=r.numReplacementsByCollected.slice(p).reduce((C,x)=>C+x,0);if(v>0){let C={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToDelete:v};a.push(C)}d=!0,r.numReplacementsByCollected.slice(p).forEach((C,x)=>r.numReplacementsByCollected[x]=0)}r.uniqueIdentifiersUsedByCollected[p]=[]}o[p]=0,l.push([]);continue}let f=r.collectedNames[p];if(f===void 0||m.componentName!==f||d){let v=0;f!==void 0&&(v=r.numReplacementsByCollected[p]);let C=v;d&&(C=0);let x=r.uniqueIdentifiersUsedByCollected[p]=[],V=this.recreateReplacements({component:t,collectedNum:p,numReplacementsSoFar:s,numReplacementsToDelete:C,components:n,uniqueIdentifiersUsed:x,componentInfoObjects:i});s+=V.numReplacements,o[p]=V.numReplacements,l[p]=V.propVariablesCopiedByReplacement;let w=V.replacementInstruction;if(!d&&V.numReplacements!==v){let D=r.numReplacementsByCollected.slice(p).reduce((I,A)=>I+A,0);w.numberReplacementsToReplace=D,d=!0,r.numReplacementsByCollected.slice(p).forEach((I,A)=>r.numReplacementsByCollected[A]=0)}a.push(w);continue}if(!t.stateValues.propName){s+=r.numReplacementsByCollected[p],o[p]=r.numReplacementsByCollected[p];continue}let h=r.uniqueIdentifiersUsedByCollected[p]=[],y=this.createReplacementForCollected({component:t,collectedNum:p,components:n,numReplacementsSoFar:s,uniqueIdentifiersUsed:h,componentInfoObjects:i}),b=y.propVariablesCopiedByReplacement,g=y.serializedReplacements,T=g.length,N=r.numReplacementsByCollected[p];if(T!==N){let v=r.numReplacementsByCollected.slice(p).reduce((x,V)=>x+V,0),C={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToReplace:v,serializedReplacements:g,assignNamesOffset:s};a.push(C),d=!0,r.numReplacementsByCollected.slice(p).forEach((x,V)=>r.numReplacementsByCollected[V]=0)}else for(let v=0;v<T;v++)if(b[v].length!==r.propVariablesCopiedByCollected[p][v].length||r.propVariablesCopiedByCollected[p][v].some((C,x)=>C!==b[v][x])){let C={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s+v,numberReplacementsToReplace:1,serializedReplacements:[g[v]],assignNamesOffset:s+v};a.push(C)}s+=T,o[p]=T,l[p]=b}return r.numReplacementsByCollected=o,r.collectedNames=t.stateValues.collectedComponents.map(p=>p.componentName),r.propVariablesCopiedByCollected=l,a}static recreateReplacements({component:t,collectedNum:e,numReplacementsSoFar:n,numReplacementsToDelete:r,uniqueIdentifiersUsed:i,components:a,componentInfoObjects:s}){let o=this.createReplacementForCollected({component:t,collectedNum:e,components:a,numReplacementsSoFar:n,uniqueIdentifiersUsed:i,componentInfoObjects:s}),l=o.propVariablesCopiedByReplacement,c=o.serializedReplacements,d={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:n,numberReplacementsToReplace:r,serializedReplacements:c,assignNamesOffset:n};return{numReplacements:c.length,propVariablesCopiedByReplacement:l,replacementInstruction:d}}},Nf=es;var ts=class extends B{static componentType="ref";static acceptTname=!0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.texttype={default:"type-global"},e.uri={default:null,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroAnything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.targetComponent={returnDependencies:()=>({targetComponent:{dependencyType:"targetComponent"}}),definition:function({dependencyValues:e}){return{newValues:{targetComponent:e.targetComponent}}}},t.targetInactive={stateVariablesDeterminingDependencies:["targetComponent"],returnDependencies({stateValues:e}){return e.targetComponent?{targetIsInactiveCompositeReplacement:{dependencyType:"stateVariable",componentName:e.targetComponent.componentName,variableName:"isInactiveCompositeReplacement"}}:{}},definition:function({dependencyValues:e}){return{newValues:{targetInactive:Boolean(e.targetIsInactiveCompositeReplacement)}}}},t.targetName={forRenderer:!0,returnDependencies:()=>({targetComponent:{dependencyType:"stateVariable",variableName:"targetComponent"},uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:e}){return e.targetComponent===null?{newValues:{targetName:""}}:e.uri!==null?(console.warn("Haven't implemented ref with uri and tname, ignoring tname."),{newValues:{targetName:""}}):{newValues:{targetName:e.targetComponent.componentName}}}},t.contentId={returnDependencies:()=>({uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition({dependencyValues:e}){if(e.uri!==null){let n=e.uri.match(/^\s*doenet\s*:\s*(\S*)\s*$/i);if(n!==null)return{newValues:{contentId:n[1]}}}return{newValues:{contentId:null}}}},t.linkText={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroAnything",variableNames:["text"],variablesOptional:!0},uri:{dependencyType:"stateVariable",variableName:"uri"}}),definition:function({dependencyValues:e}){let n="";if(e.inlineChildren.length===0)e.uri!==null&&(n=e.uri);else for(let r of e.inlineChildren)typeof r.stateValues.text=="string"&&(n+=r.stateValues.text);return{newValues:{linkText:n}}}},t.childrenToRender={returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroAnything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.inlineChildren.map(n=>n.componentName)}}}},t}},xf=ts;var ns=class extends H{static componentType="coords";static rendererType="math";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.createVectors={default:!0},e}},Vf=ns;import X from"../_snowpack/pkg/math-expressions.js";var rs=class extends le{static componentType="line";actions={moveLine:this.moveLine.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["points","variables"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:"s",replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"equation",doenetAttributes:{isPropertyChild:!0},children:e}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneEquation",componentType:"equation",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"atMostOneThrough",componentType:"through",comparison:"atMost",number:1,takePropertyChildren:!0}),i=e.newOperator({name:"equationXorThrough",operator:"xor",propositions:[n,r]}),a=e.newLeaf({name:"atMostOneVariables",componentType:"variables",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"lineLogic",operator:"and",propositions:[i,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.nDimensions={public:!0,componentType:"number",stateVariablesDeterminingDependencies:["equationChild"],returnDependencies:function({stateValues:e}){return e.equationChild===null?{throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["nDimensions"]}}:{equationChild:{dependencyType:"child",childLogicName:"exactlyOneEquation"}}},definition:function({dependencyValues:e,changes:n}){return e.equationChild?n.equationChild&&n.equationChild.componentIdentitiesChanged?{newValues:{nDimensions:2},checkForActualChange:{nDimensions:!0}}:{noChanges:["nDimensions"]}:e.throughChild.length===1?{newValues:{nDimensions:e.throughChild[0].stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},t.variables={isArray:!0,public:!0,componentType:"variable",entryPrefixes:["var"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey(){return{globalDependencies:{variablesChild:{dependencyType:"child",childLogicName:"atMostOneVariables",variableNames:["variables"]}}}},arrayDefinitionByKey({globalDependencyValues:e,arraySize:n}){let r=[];return e.variablesChild.length===1&&(r=e.variablesChild[0].stateValues.variables),{newValues:{variables:Ll(n[0],r)}}}},t.equationChild={returnDependencies:()=>({equationChild:{dependencyType:"child",childLogicName:"exactlyOneEquation"}}),definition:function({dependencyValues:e}){return e.equationChild.length===1?{newValues:{equationChild:e.equationChild[0]}}:{newValues:{equationChild:null}}}},t.points={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],returnWrappingComponents(e){return e==="pointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="pointX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},stateVariablesDeterminingDependencies:["equationChild"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[2,e.nDimensions]},returnArrayDependenciesByKey({stateValues:e,arrayKeys:n}){if(e.equationChild===null){let r={};for(let i of n){let[a,s]=i.split(","),o=Number(a)+1+"_"+(Number(s)+1);r[i]={throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["pointX"+o]}}}return{dependenciesByKey:r}}else return{globalDependencies:{coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"},variables:{dependencyType:"stateVariable",variableName:"variables"},lastPointsFromInverting:{dependencyType:"stateVariable",variableName:"lastPointsFromInverting"}}}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r,arraySize:i,componentName:a}){if("coeff0"in e){let s=Iv(e);if(s.success)return{newValues:{points:s.points}};{let o={};for(let l=0;l<i[0];l++)for(let c=0;c<i[1];c++)o[l+","+c]=X.fromAst("\uFF3F");return{newValues:{points:o}}}}else{let s={},o={};for(let c of r){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);n[c].throughChild.length===1&&n[c].throughChild[0].stateValues["pointX"+m]?s[c]=n[c].throughChild[0].stateValues["pointX"+m]:c==="0,0"?o[c]={defaultValue:X.fromAst(1)}:o[c]={defaultValue:X.fromAst(0)}}let l={};return Object.keys(s).length>0&&(l.newValues={points:s}),Object.keys(o).length>0&&(l.useEssentialOrDefaultValue={points:o}),l}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,initialChange:a,stateValues:s,workspace:o}){if(a&&!s.draggable)return{success:!1};if("coeff0"in n){o.desiredPoints||(o.desiredPoints={}),Object.assign(o.desiredPoints,e.points);let l,c,d,p;if(o.desiredPoints["0,0"]?l=o.desiredPoints["0,0"]:l=s.points[0][0],o.desiredPoints["0,1"]?c=o.desiredPoints["0,1"]:c=s.points[0][1],o.desiredPoints["1,0"]?d=o.desiredPoints["1,0"]:d=s.points[1][0],o.desiredPoints["1,1"]?p=o.desiredPoints["1,1"]:p=s.points[1][1],typeof l.tree=="number"&&typeof c.tree=="number"&&typeof d.tree=="number"&&typeof p.tree=="number"){let y=[l.tree,c.tree],b=[d.tree,p.tree],g=y[1]-b[1],T=b[0]-y[0],N=y[0]*b[1]-y[1]*b[0],v=Math.abs(g*s.coeffvar2-s.coeffvar1*T),C=[];return v<Math.abs(g*s.coeffvar2)*1e-12?(g!==0?N*=s.coeffvar1/g:N*=s.coeffvar2/T,C.push({setDependency:"coeff0",desiredValue:N,additionalDependencyValues:{coeffvar1:s.coeffvar1,coeffvar2:s.coeffvar2}})):C.push({setDependency:"coeff0",desiredValue:N,additionalDependencyValues:{coeffvar1:g,coeffvar2:T}}),C.push({setDependency:"lastPointsFromInverting",desiredValue:[y,b]}),{success:!0,instructions:C}}let m=c.subtract(p).simplify(),f=d.subtract(l).simplify(),h=l.multiply(p).subtract(c.multiply(d)).simplify();return{success:!0,instructions:[{setDependency:"coeff0",desiredValue:h,additionalDependencyValues:{coeffvar1:m,coeffvar2:f}}]}}else{let l=[];for(let c of Object.keys(e.points).reverse()){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);r[c].throughChild.length===1&&r[c].throughChild[0].stateValues["pointX"+m]?l.push({setDependency:i[c].throughChild,desiredValue:e.points[c],childIndex:0,variableIndex:0}):l.push({setStateVariable:"points",value:{[c]:re(e.points[c])}})}return{success:!0,instructions:l}}}},t.equation={public:!0,componentType:"equation",forRenderer:!0,stateVariablesDeterminingDependencies:["equationChild"],additionalStateVariablesDefined:[{variableName:"coeff0",public:!0,componentType:"math"},{variableName:"coeffvar1",public:!0,componentType:"math"},{variableName:"coeffvar2",public:!0,componentType:"math"}],returnDependencies:function({stateValues:e}){let n={variables:{dependencyType:"stateVariable",variableName:"variables"}};return e.equationChild===null?(n.points={dependencyType:"stateVariable",variableName:"points"},n.nDimensions={dependencyType:"stateVariable",variableName:"nDimensions"}):n.equationChild={dependencyType:"child",childLogicName:"exactlyOneEquation",variableNames:["value"]},n},definition:function({dependencyValues:e}){let n=e.variables,r=X.fromAst("\uFF3F");if(e.equationChild){let h=e.equationChild[0].stateValues.value,y=Sv({equation:h,variables:n});if(!y.success)return{newValues:{equation:h,coeff0:r,coeffvar1:r,coeffvar2:r}};let{coeff0:b,coeffvar1:g,coeffvar2:T}=y;return{newValues:{equation:h,coeff0:b,coeffvar1:g,coeffvar2:T}}}let i=e.nDimensions;if(Number.isNaN(i))return console.warn("Line through points of undetermined dimensions"),{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};if(i<2)return console.warn("Line must be through points of at least two dimensions"),{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};let a=e.points[0][0],s=e.points[0][1],o=e.points[1][0],l=e.points[1][1],c=[...n.map(h=>h.toString())];for(let h=0;h<i;h++)if(a.variables().indexOf(c[h])!==-1||s.variables().indexOf(c[h])!==-1||o.variables().indexOf(c[h])!==-1||l.variables().indexOf(c[h])!==-1)return console.warn("Points through line depend on variables: "+c.join(", ")),{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};if(i!==2)return{newValues:{equation:r,coeff0:r,coeffvar1:r,coeffvar2:r}};if(a.equals(o)&&s.equals(l)){let h=X.fromAst(0);return{newValues:{equation:r,coeff0:h,coeffvar1:h,coeffvar2:h}}}let d=s.subtract(l).simplify(),p=o.subtract(a).simplify(),m=a.multiply(l).subtract(s.multiply(o)).simplify();return{newValues:{equation:X.fromAst(["=",["+",["*","a","x"],["*","b","y"],"c"],0]).substitute({a:d,b:p,c:m,x:n[0],y:n[1]}).simplify(),coeff0:m,coeffvar1:d,coeffvar2:p}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){if(n.points)return console.log("Haven't implemented inverse definition of equation of line based on points"),{success:!1};if(e.equation)return{success:!0,instructions:[{setDependency:"equationChild",desiredValue:e.equation,childIndex:0,variableIndex:0}]};if(!("coeff0"in e&&"coeffvar1"in e&&"coeffvar2"in e))return console.log("Haven't implemented inverting coeffs if not specifying all of them"),{success:!1};let r=X.fromAst(["=",0,["+",["*","a","x"],["*","b","y"],"c"]]).substitute({a:e.coeffvar1,b:e.coeffvar2,c:e.coeff0,x:n.variables[0],y:n.variables[1]}).simplify();return{success:!0,instructions:[{setDependency:"equationChild",desiredValue:r,childIndex:0,variableIndex:0}]}}},t.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return Number.isNaN(e.nDimensions)?[0]:[2]},returnArrayDependenciesByKey({arrayKeys:e}){let n={nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},r={};for(let i of e)r[i]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(i)+1)}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r,componentName:i}){if(Number.isNaN(e.nDimensions))return{};let a={};for(let s of r){let o=n[s].point,l=[];for(let c=0;c<e.nDimensions;c++){let d=o[c].evaluate_to_constant();Number.isFinite(d)||(d=NaN),l.push(d)}a[s]=l}return{newValues:{numericalPoints:a}}}},t.numericalCoeff0={additionalStateVariablesDefined:["numericalCoeffvar1","numericalCoeffvar2"],returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:e}){let n=e.coeff0.evaluate_to_constant();Number.isFinite(n)||(n=NaN);let r=e.coeffvar1.evaluate_to_constant();Number.isFinite(r)||(r=NaN);let i=e.coeffvar2.evaluate_to_constant();return Number.isFinite(i)||(i=NaN),{newValues:{numericalCoeff0:n,numericalCoeffvar1:r,numericalCoeffvar2:i}}}},t.slope={public:!0,componentType:"math",returnDependencies:()=>({coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:function({dependencyValues:e}){return{newValues:{slope:X.fromAst(["-",["/","a","b"]]).substitute({a:e.coeffvar1,b:e.coeffvar2}).simplify()}}}},t.xintercept={public:!0,componentType:"math",returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar1:{dependencyType:"stateVariable",variableName:"coeffvar1"}}),definition:({dependencyValues:e})=>({newValues:{xintercept:X.fromAst(["-",["/","a","b"]]).substitute({a:e.coeff0,b:e.coeffvar1}).simplify()}})},t.yintercept={public:!0,componentType:"math",returnDependencies:()=>({coeff0:{dependencyType:"stateVariable",variableName:"coeff0"},coeffvar2:{dependencyType:"stateVariable",variableName:"coeffvar2"}}),definition:({dependencyValues:e})=>({newValues:{yintercept:X.fromAst(["-",["/","a","b"]]).substitute({a:e.coeff0,b:e.coeffvar2}).simplify()}})},t.lastPointsFromInverting={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{lastPointsFromInverting:{variableToCheck:"lastPointsFromInverting"}}}),inverseDefinition:({desiredStateVariableValues:e})=>({success:!0,instructions:[{setStateVariable:"lastPointsFromInverting",value:e.lastPointsFromInverting}]})},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},numericalCoeff0:{dependencyType:"stateVariable",variableName:"numericalCoeff0"},numericalCoeffvar1:{dependencyType:"stateVariable",variableName:"numericalCoeffvar1"},numericalCoeffvar2:{dependencyType:"stateVariable",variableName:"numericalCoeffvar2"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=e.numericalCoeffvar1,i=e.numericalCoeffvar2,a=e.numericalCoeff0;if(!(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)))return{};let s=r*r+i*i;if(s===0)return{};let o=n.x1.evaluate_to_constant(),l=n.x2.evaluate_to_constant();if(!(Number.isFinite(o)&&Number.isFinite(l)))return{};let c={};return c.x1=(i*(i*o-r*l)-r*a)/s,c.x2=(r*(-i*o+r*l)-i*a)/s,n.x3!==void 0&&(c.x3=0),c}}})},t}adapters=["equation"];moveLine({point1coords:t,point2coords:e,transient:n}){let r={"0,0":X.fromAst(t[0]),"0,1":X.fromAst(t[1]),"1,0":X.fromAst(e[0]),"1,1":X.fromAst(e[1])};n?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:r}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"points",value:r}],event:{verb:"interacted",object:{componentId:this.componentName},result:{point1:t,point2:e}}})}},wf=rs;function Sv({equation:u,variables:t}){let e=t[0],n=t[1],r=e.toString(),i=n.toString();u=u.expand().simplify();let a=X.fromAst(["+",u.tree[2],["-",u.tree[1]]]).expand().simplify(),s=[];Array.isArray(a.tree)&&a.tree[0]==="+"?s=a.tree.slice(1):s=[a.tree];let o=X.fromAst(0),l=X.fromAst(0),c=X.fromAst(0);for(let p of s){let m=d(p);if(!m.success)return{success:!1};o=o.add(m.coeffvar1),l=l.add(m.coeffvar2),c=c.add(m.coeff0)}return o=o.simplify(),l=l.simplify(),c=c.simplify(),{success:!0,coeff0:c,coeffvar1:o,coeffvar2:l};function d(p){let m=0,f=0,h=0;if(typeof p=="string")p===r?m=1:p===i?f=1:h=p;else if(typeof p=="number")h=p;else if(Array.isArray(p)){let y=p[0],b=p.slice(1);if(y==="-"){let g=d(b[0]);if(!g.success)return{success:!1};m=["-",g.coeffvar1.tree],f=["-",g.coeffvar2.tree],h=["-",g.coeff0.tree]}else{if(y==="+")return console.warn("Invalid format for equation of line in variables "+e+" and "+n),{success:!1};if(y==="*"){let g=-1,T=-1;for(let N=0;N<b.length;N++)if(e.equals(X.fromAst(b[N]))){g=N;break}else if(n.equals(X.fromAst(b[N]))){T=N;break}g!==-1?(b.splice(g,1),b.length===1?m=b[0]:m=["*"].concat(b)):T!==-1?(b.splice(T,1),b.length===1?f=b[0]:f=["*"].concat(b)):h=p}else if(y==="/"){let g=d(b[0]);if(!g.success)return{success:!1};m=["/",g.coeffvar1.tree,b[1]],f=["/",g.coeffvar2.tree,b[1]],h=["/",g.coeff0.tree,b[1]]}else y==="_"?e.equals(X.fromAst(p))?m=1:n.equals(X.fromAst(p))?f=1:h=p:h=p}}else return console.warn("Invalid format for equation of line in variables "+e+" and "+n),{success:!1};return{success:!0,coeffvar1:X.fromAst(m),coeffvar2:X.fromAst(f),coeff0:X.fromAst(h)}}}function Iv({coeff0:u,coeffvar1:t,coeffvar2:e,variables:n,lastPointsFromInverting:r}){let i=n[0],a=n[1],s=i.toString(),o=a.toString();if(t.variables(!0).indexOf(s)!==-1||t.variables(!0).indexOf(o)!==-1||e.variables(!0).indexOf(s)!==-1||e.variables(!0).indexOf(o)!==-1||u.variables(!0).indexOf(s)!==-1||u.variables(!0).indexOf(o)!==-1)return console.warn("Invalid format for equation of line in variables "+s+" and "+o),{success:!1};let l=X.fromAst(0);if(t.equals(l)&&e.equals(l))return console.warn("Invalid format for equation of line in variables "+s+" and "+o),{success:!1};let c=t.evaluate_to_constant(),d=e.evaluate_to_constant(),p=u.evaluate_to_constant(),m,f,h,y,b={};if(Number.isFinite(p)&&Number.isFinite(c)&&Number.isFinite(d)){let g=c*c+d*d;if(g===0)return{success:!1};if(r){let T=r[0][0],N=r[0][1];m=(d*(d*T-c*N)-c*p)/g,f=(c*(-d*T+c*N)-d*p)/g,T=r[1][0],N=r[1][1],h=(d*(d*T-c*N)-c*p)/g,y=(c*(-d*T+c*N)-d*p)/g}else m=(2*d-c*p)/g,f=(-2*c-d*p)/g,h=(d-c*p)/g,y=-(c+d*p)/g;b["0,0"]=X.fromAst(m),b["0,1"]=X.fromAst(f),b["1,0"]=X.fromAst(h),b["1,1"]=X.fromAst(y)}else{let g=t.pow(2).add(e.pow(2));m=e.multiply(2).subtract(t.multiply(u)).divide(g),f=t.multiply(-2).subtract(e.multiply(u)).divide(g),h=e.subtract(t.multiply(u)).divide(g),y=t.add(e.multiply(u)).multiply(-1).divide(g),b["0,0"]=m,b["0,1"]=f,b["1,0"]=h,b["1,1"]=y}return{success:!0,points:b}}import cn from"../_snowpack/pkg/math-expressions.js";var is=class extends le{static componentType="linesegment";actions={moveLineSegment:this.moveLineSegment.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["endpoints"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneEndpoints",componentType:"endpoints",comparison:"atMost",number:1,takePropertyChildren:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:e}){let n="";return e.selectedStyle.lineWidth>=4?n+="thick ":e.selectedStyle.lineWidth<=1&&(n+="thin "),e.selectedStyle.lineStyle==="dashed"?n+="dashed ":e.selectedStyle.lineStyle==="dotted"&&(n+="dotted "),n+=e.selectedStyle.lineColor,{newValues:{styleDescription:n}}}},t.nDimensions={public:!0,componentType:"number",returnDependencies:()=>({endpointsChild:{dependencyType:"child",childLogicName:"atMostOneEndpoints",variableNames:["nDimensions"]}}),definition:function({dependencyValues:e}){return e.endpointsChild.length===1?{newValues:{nDimensions:e.endpointsChild[0].stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},t.endpoints={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["endpointX","endpoint"],returnWrappingComponents(e){return e==="endpointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="endpointX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[2,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let[i,a]=r.split(","),s=Number(i)+1+"_"+(Number(a)+1);n[r]={endpointsChild:{dependencyType:"child",childLogicName:"atMostOneEndpoints",variableNames:["pointX"+s]}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n,arraySize:r}){let i={},a={};for(let o of n){let[l,c]=o.split(","),d=Number(l)+1+"_"+(Number(c)+1);e[o].endpointsChild.length===1&&e[o].endpointsChild[0].stateValues["pointX"+d]?i[o]=e[o].endpointsChild[0].stateValues["pointX"+d]:o==="0,0"?a[o]={defaultValue:cn.fromAst(1)}:a[o]={defaultValue:cn.fromAst(0)}}let s={};return Object.keys(i).length>0&&(s.newValues={endpoints:i}),Object.keys(a).length>0&&(s.useEssentialOrDefaultValue={endpoints:a}),s},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:i,stateValues:a}){if(i&&!a.draggable)return{success:!1};let s=[];for(let o in e.endpoints){let[l,c]=o.split(","),d=Number(l)+1+"_"+(Number(c)+1);n[o].endpointsChild.length===1&&n[o].endpointsChild[0].stateValues["pointX"+d]?s.push({setDependency:r[o].endpointsChild,desiredValue:e.endpoints[o],childIndex:0,variableIndex:0}):s.push({setStateVariable:"endpoints",value:{[o]:re(e.endpoints[o])}})}return{success:!0,instructions:s}}},t.numericalEndpoints={isArray:!0,entryPrefixes:["numericalEndpoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return Number.isNaN(e.nDimensions)?[0]:[2]},returnArrayDependenciesByKey({arrayKeys:e}){let n={nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},r={};for(let i of e)r[i]={endpoint:{dependencyType:"stateVariable",variableName:"endpoint"+(Number(i)+1)}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){if(Number.isNaN(e.nDimensions))return{};let i={};for(let a of r){let s=n[a].endpoint,o=[];for(let l=0;l<e.nDimensions;l++){let c=s[l].evaluate_to_constant();Number.isFinite(c)||(c=NaN),o.push(c)}i[a]=o}return{newValues:{numericalEndpoints:i}}}},t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},endpoints:{dependencyType:"stateVariable",variableName:"endpoints"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=e.endpoints[0][0].evaluate_to_constant(),i=e.endpoints[0][1].evaluate_to_constant(),a=e.endpoints[1][0].evaluate_to_constant(),s=e.endpoints[1][1].evaluate_to_constant();if(!(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(s)))return{};let o=a-r,l=s-i,c=o*o+l*l;if(c===0)return{};let d=((n.x1-r)*o+(n.x2-i)*l)/c,p={};return d<=0?p={x1:r,x2:i}:d>=1?p={x1:a,x2:s}:p={x1:r+d*o,x2:i+d*l},n.x3!==void 0&&(p.x3=0),p}}})},t}moveLineSegment({point1coords:t,point2coords:e,transient:n}){let r={};t!==void 0&&(r["0,0"]=cn.fromAst(t[0]),r["0,1"]=cn.fromAst(t[1])),e!==void 0&&(r["1,0"]=cn.fromAst(e[0]),r["1,1"]=cn.fromAst(e[1])),n?this.coreFunctions.requestUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:r}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{componentName:this.componentName,updateType:"updateValue",stateVariable:"endpoints",value:r}],event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{point1:t,point2:e}}})}},Df=is;var as=class extends un{static componentType="polygon";actions={movePolygon:this.movePolygon.bind(new Proxy(this,this.readOnlyProxyHandler))};get movePolygon(){return this.movePolyline}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nearestPoint={returnDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},vertices:{dependencyType:"stateVariable",variableName:"vertices"},nVertices:{dependencyType:"stateVariable",variableName:"nVertices"}}),definition:({dependencyValues:e})=>({newValues:{nearestPoint:function(n){if(e.nDimensions!==2)return{};let r=Infinity,i={},a=n.x1.evaluate_to_constant(),s=n.x2.evaluate_to_constant(),o,l,c=e.vertices[e.nVertices-1][0].evaluate_to_constant(),d=e.vertices[e.nVertices-1][1].evaluate_to_constant();for(let p=0;p<e.nVertices;p++){if(o=c,l=d,c=e.vertices[p][0].evaluate_to_constant(),d=e.vertices[p][1].evaluate_to_constant(),!(Number.isFinite(o)&&Number.isFinite(l)&&Number.isFinite(c)&&Number.isFinite(d)))continue;let m=c-o,f=d-l,h=m*m+f*f;if(h===0)continue;let y=((a-o)*m+(s-l)*f)/h,b;y<=0?b={x1:o,x2:l}:y>=1?b={x1:c,x2:d}:b={x1:o+y*m,x2:l+y*f};let g=Math.pow(a-b.x1,2)+Math.pow(s-b.x2,2);g<r&&(r=g,i=b)}return n.x3!==void 0&&Object.keys(i).length>0&&(i.x3=0),i}}})},t}},dn=as;import pn from"../_snowpack/pkg/math-expressions.js";var ss=class extends dn{static componentType="triangle";static rendererType="polygon";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.vertices.returnArraySizeDependencies=()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),t.vertices.returnArraySize=function({dependencyValues:e}){return[3,e.nDimensions]},t.vertices.arrayDefinitionByKey=function({dependencyValuesByKey:e,arrayKeys:n}){let r={},i={};for(let a of n){let[s,o]=a.split(","),l=Number(s)+1+"_"+(Number(o)+1),c=e[a].verticesChild;if(c.length===1&&c[0].stateValues["pointX"+l])r[a]=c[0].stateValues["pointX"+l];else{let d;s==="0"?o==="1"?d=pn.fromAst(1):d=pn.fromAst(0):s==="1"?o==="0"?d=pn.fromAst(1):d=pn.fromAst(0):d=pn.fromAst(0),i[a]={variablesToCheck:["vertexX"+l],defaultValue:d}}}return{newValues:{vertices:r},useEssentialOrDefaultValue:{vertices:i}}},t.vertices.inverseArrayDefinitionByKey=function({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,initialChange:i,stateValues:a}){if(i&&!a.draggable)return{success:!1};let s=[];for(let o in e.vertices){let[l,c]=o.split(","),d=Number(l)+1+"_"+(Number(c)+1);n[o].verticesChild.length===1&&n[o].verticesChild[0].stateValues["pointX"+d]?s.push({setDependency:r[o].verticesChild,desiredValue:e.vertices[o],childIndex:0,variableIndex:0}):s.push({setStateVariable:"vertices",value:{[o]:e.vertices[o].simplify()}})}return{success:!0,instructions:s}},t.vertices.inverseDefinition=function({desiredStateVariableValues:e,dependencyValues:n,stateValues:r,initialChange:i,arrayKeys:a,workspace:s}){if(i&&!r.draggable)return{success:!1};let o;if(a&&(o=Number(a[0])),s.desiredVertices||(s.desiredVertices={}),o===void 0){let l=[],c=0;if(n.verticesChild.length===1){c=Math.min(3,n.verticesChild[0].stateValues.nPoints);let d;if(Array.isArray(e))d=e.vertices.slice(0,c);else{d={};for(let p in e.vertices)Number(p)<c&&(d[p]=e.vertices[p]);Object.keys(d).length===0&&(d=void 0)}d&&l.push({setDependency:"verticesChild",desiredValue:d,childIndex:0,variableIndex:0})}for(let d=c;d<3;d++)if(e.vertices[d]!==void 0){let p=Af({workspaceVertices:s.desiredVertices[d],currentVertexValue:r.vertices[d],desiredVertex:e.vertices[d]});s.desiredVertices[d]=p.tree,l.push({setStateVariable:"vertices",value:{[d]:p.simplify()}})}return{success:!0,instructions:l}}else{if(o>2)return{success:!1};if(n.verticesChild.length===1){let c=Math.min(3,n.verticesChild[0].stateValues.nPoints);if(o<c)return{success:!0,instructions:[{setDependency:"verticesChild",desiredValue:e.vertices[o],childIndex:0,variableIndex:0}]}}let l=Af({workspaceVertices:s.desiredVertices[o],currentVertexValue:r.vertices[o],desiredVertex:e.vertices[o]});return s.desiredVertices[o]=l.tree,{success:!0,instructions:[{setStateVariable:"vertices",value:{[o]:l.simplify()}}]}}},t.nVertices={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{nVertices:3}})},t}},Sf=ss;function Af({workspaceVertices:u,currentVertexValue:t,desiredVertex:e}){let n;u?n=u.slice(0):n=t.tree.slice(0);for(let[r,i]of e.tree.entries())i!==void 0&&(n[r]=i);return pn.fromAst(n)}import Be from"../_snowpack/pkg/math-expressions.js";var os=class extends dn{static componentType="rectangle";static rendererType="polygon";static get stateVariablesShadowedForReference(){return["vertices","nVertices","nVerticesSpecified","haveSpecifiedCenter","specifiedWidth","specifiedHeight","specifiedCenter"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneCenter",componentType:"center",comparison:"atMost",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"atMostOneWidth",componentType:"width",comparison:"atMost",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"atMostOneHeight",componentType:"height",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"rectangleLogic",operator:"and",propositions:[n,r,i,e.baseLogic],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVerticesSpecified={returnDependencies:()=>({verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["nPoints"]}}),definition:function({dependencyValues:e}){return e.verticesChild.length===1?{newValues:{nVerticesSpecified:e.verticesChild[0].stateValues.nPoints}}:{newValues:{nVerticesSpecified:0}}}},t.essentialVertex={isArray:!0,entryPrefixes:["essentialVertexX"],defaultEntryValue:Be.fromAst(0),returnArraySizeDependencies:()=>({nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}}),returnArraySize({dependencyValues:e}){return[e.nVerticesSpecified===0?2:0]},returnArrayDependenciesByKey(){return{}},arrayDefinitionByKey:function({arrayKeys:e}){let n={};for(let r of e)n[r]={variablesToCheck:["essentialVertexX"+(Number(r)+1)]};return{useEssentialOrDefaultValue:{essentialVertex:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let n=[];for(let r in e.essentialVertex)n.push({setStateVariable:"essentialVertex",value:{[r]:e.essentialVertex[r]}});return{success:!0,instructions:n}}},t.haveSpecifiedCenter={returnDependencies:()=>({centerChild:{dependencyType:"child",childLogicName:"atMostOneCenter"}}),definition:({dependencyValues:e})=>({newValues:{haveSpecifiedCenter:e.centerChild.length===1}})},t.specifiedCenter={isArray:!0,entryPrefixes:["specifiedCenterX"],returnArraySizeDependencies:()=>({haveSpecifiedCenter:{dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"}}),returnArraySize({dependencyValues:e}){return[e.haveSpecifiedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let i=Number(r)+1;n[r]={centerChild:{dependencyType:"child",childLogicName:"atMostOneCenter",variableNames:["x"+i]}}}return{dependenciesByKey:n}},arrayDefinitionByKey:function({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=Number(a)+1;n[a].centerChild.length===1&&(i[a]=n[a].centerChild[0].stateValues["x"+s])}return{newValues:{specifiedCenter:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,arraySize:a}){let s=[];for(let o in e.specifiedCenter)r[o].centerChild&&r[o].centerChild.length===1&&s.push({setDependency:i[o].centerChild,desiredValue:e.specifiedCenter[o],childIndex:0,variableIndex:0});return{success:!0,instructions:s}}},t.specifiedWidth={defaultValue:1,returnDependencies(){return{specifiedWidthChild:{dependencyType:"child",childLogicName:"atMostOneWidth",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},centerChild:{dependencyType:"child",childLogicName:"atMostOneCenter"}}},definition({dependencyValues:e}){return e.specifiedWidthChild.length===1?{newValues:{specifiedWidth:e.specifiedWidthChild[0].stateValues.value}}:e.centerChild.length+e.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedWidth:{variablesToCheck:["specifiedWidth"]}}}:{newValues:{specifiedWidth:null}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.specifiedWidthChild.length===1?{success:!0,instructions:[{setDependency:"specifiedWidthChild",desiredValue:e.specifiedWidth,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"specifiedWidth",value:e.specifiedWidth}]}}},t.specifiedHeight={defaultValue:1,returnDependencies(){return{specifiedHeightChild:{dependencyType:"child",childLogicName:"atMostOneHeight",variableNames:["value"]},nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"},centerChild:{dependencyType:"child",childLogicName:"atMostOneCenter"}}},definition({dependencyValues:e}){return e.specifiedHeightChild.length===1?{newValues:{specifiedHeight:e.specifiedHeightChild[0].stateValues.value}}:e.centerChild.length+e.nVerticesSpecified<=1?{useEssentialOrDefaultValue:{specifiedHeight:{variablesToCheck:["specifiedHeight"]}}}:{newValues:{specifiedHeight:null}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.specifiedHeightChild.length===1?{success:!0,instructions:[{setDependency:"specifiedHeightChild",desiredValue:e.specifiedHeight,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"specifiedHeight",value:e.specifiedHeight}]}}},t.center={public:!0,isArray:!0,entryPrefixes:["centerX"],componentType:"math",returnWrappingComponents(e){return e==="centerX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},returnArraySizeDependencies:()=>({}),returnArraySize:()=>[2],returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e){let i=Number(r)+1;n[r]={vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_"+i},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_"+i}}}return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].vertex0,s=e[i].vertex2;r[i]=a.add(s).divide(2).simplify()}return{newValues:{center:r}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,dependencyNamesByKey:r,stateValues:i}){let a=[];for(let s in e.center){let o=Number(s),l=n[s].vertex0,c=n[s].vertex2,d=e.center[o].subtract(i.center[o]),p=l.add(d).simplify(),m=c.add(d).simplify();a.push({setDependency:r[s].vertex0,desiredValue:p},{setDependency:r[s].vertex2,desiredValue:m})}return{success:!0,instructions:a}}},t.width={public:!0,componentType:"number",returnDependencies({}){return{vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_1"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_1"}}},definition({dependencyValues:e}){let n=e.vertex0.evaluate_to_constant(),r=e.vertex2.evaluate_to_constant();return{newValues:{width:Math.abs(n-r)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n,stateValues:r}){let i=n.vertex0.evaluate_to_constant(),a=n.vertex2.evaluate_to_constant(),s=(a+i)/2,l=(a-i<0?-1:1)*Math.max(0,e.width)/2,c=Be.fromAst(s-l),d=Be.fromAst(s+l);return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:c},{setDependency:"vertex2",desiredValue:d}]}}},t.height={public:!0,componentType:"number",returnDependencies({}){return{vertex0:{dependencyType:"stateVariable",variableName:"vertexX1_2"},vertex2:{dependencyType:"stateVariable",variableName:"vertexX3_2"}}},definition({dependencyValues:e}){let n=e.vertex0.evaluate_to_constant(),r=e.vertex2.evaluate_to_constant();return{newValues:{height:Math.abs(n-r)}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){let r=n.vertex0.evaluate_to_constant(),i=n.vertex2.evaluate_to_constant(),a=(i+r)/2,o=(i-r<0?-1:1)*Math.max(0,e.height)/2,l=Be.fromAst(a-o),c=Be.fromAst(a+o);return{success:!0,instructions:[{setDependency:"vertex0",desiredValue:l},{setDependency:"vertex2",desiredValue:c}]}}},t.vertices={public:!0,componentType:"point",isArray:!0,nDimensions:2,entryPrefixes:["vertexX","vertex"],returnWrappingComponents(e){return e==="vertexX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="vertexX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},stateVariablesDeterminingDependencies:["nVerticesSpecified","haveSpecifiedCenter"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[4,2]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={},i={nVerticesSpecified:{dependencyType:"stateVariable",variableName:"nVerticesSpecified"}};if(n.nVerticesSpecified===0)if(i.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},n.haveSpecifiedCenter)for(let a of e){let[s,o]=a.split(",");r[a]={specifiedCenter:{dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(o)+1)}},o==="0"?r[a].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}:r[a].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"}}else for(let a of e){let[s,o]=a.split(",");r[a]={essentialVertex:{dependencyType:"stateVariable",variableName:"essentialVertexX"+(Number(o)+1)}},o==="0"?(s==="1"||s==="2")&&(r[a].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):(s==="2"||s==="3")&&(r[a].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else if(n.nVerticesSpecified===1)if(i.haveSpecifiedCenter={dependencyType:"stateVariable",variableName:"haveSpecifiedCenter"},n.haveSpecifiedCenter)for(let a of e){let[s,o]=a.split(","),l="1_"+(Number(o)+1);r[a]={verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["pointX"+l]}},(o==="0"&&s==="1"||s==="2"||o==="1"&&s==="2"||s==="3")&&(r[a].specifiedCenter={dependencyType:"stateVariable",variableName:"specifiedCenterX"+(Number(o)+1)})}else for(let a of e){let[s,o]=a.split(","),l="1_"+(Number(o)+1);r[a]={verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["pointX"+l]}},o==="0"?(s==="1"||s==="2")&&(r[a].specifiedWidth={dependencyType:"stateVariable",variableName:"specifiedWidth"}):(s==="2"||s==="3")&&(r[a].specifiedHeight={dependencyType:"stateVariable",variableName:"specifiedHeight"})}else for(let a of e){let[s,o]=a.split(","),l="1_"+(Number(o)+1),c="2_"+(Number(o)+1),d;s==="0"?d=l:s==="2"?d=c:s==="1"?o==="0"?d=c:d=l:o==="0"?d=l:d=c,r[a]={verticesChild:{dependencyType:"child",childLogicName:"atMostOneVertices",variableNames:["pointX"+d]}}}return{dependenciesByKey:r,globalDependencies:i}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n,globalDependencyValues:r}){let i={};if(r.nVerticesSpecified===0)if(r.haveSpecifiedCenter)for(let a of n){let[s,o]=a.split(","),l=e[a].specifiedCenter;if(o==="0"){let c=e[a].specifiedWidth;s==="0"||s==="3"?i[a]=l.subtract(c/2):i[a]=l.add(c/2)}else{let c=e[a].specifiedHeight;s==="0"||s==="1"?i[a]=l.subtract(c/2):i[a]=l.add(c/2)}}else for(let a of n){let[s,o]=a.split(","),l=e[a].essentialVertex;if(o==="0")if(s==="0"||s==="3")i[a]=l;else{let c=e[a].specifiedWidth;i[a]=l.add(c)}else if(s==="0"||s==="1")i[a]=l;else{let c=e[a].specifiedHeight;i[a]=l.add(c)}}else if(r.nVerticesSpecified===1)if(r.haveSpecifiedCenter)for(let a of n){let[s,o]=a.split(","),l=e[a].verticesChild,c;if(l.length===1&&Object.keys(l[0].stateValues).length===1?c=Object.values(l[0].stateValues)[0]:c=Be.fromAst("\uFF3F"),o==="0"&&(s==="0"||s==="3")||o==="1"&&(s==="0"||s==="1"))i[a]=c;else{let d=e[a].specifiedCenter;i[a]=c.add(d.subtract(c).multiply(2))}}else for(let a of n){let[s,o]=a.split(","),l=e[a].verticesChild,c;if(l.length===1&&Object.keys(l[0].stateValues).length===1?c=Object.values(l[0].stateValues)[0]:c=Be.fromAst("\uFF3F"),o==="0")if(s==="0"||s==="3")i[a]=c;else{let d=e[a].specifiedWidth;i[a]=c.add(d)}else if(s==="0"||s==="1")i[a]=c;else{let d=e[a].specifiedHeight;i[a]=c.add(d)}}else for(let a of n){let s=e[a].verticesChild;s.length===1&&Object.keys(s[0].stateValues).length===1?i[a]=Object.values(s[0].stateValues)[0]:i[a]=Be.fromAst("\uFF3F")}return{newValues:{vertices:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyValuesByKey:n,globalDependencyValues:r,stateValues:i,workspace:a,initialChange:s,dependencyNamesByKey:o}){if(s&&!i.draggable)return{success:!1};a.v0||(a.v0=[...i.vertices[0]],a.v2=[...i.vertices[2]]);let l,c,d,p,m,f;for(let y in e.vertices){let[b,g]=y.split(","),T=e.vertices[y];b==="0"?a.v0[Number(g)]=T:b==="2"?a.v2[Number(g)]=T:b==="1"?g==="0"?a.v2[Number(g)]=T:a.v0[Number(g)]=T:g==="0"?a.v0[Number(g)]=T:a.v2[Number(g)]=T,g==="0"?(l=y,b==="0"||b==="3"?d=y:m=y):(c=y,b==="0"||b==="1"?p=y:f=y)}let h=[];if(r.nVerticesSpecified===0)if(r.haveSpecifiedCenter){if(l!==void 0){let y=a.v2[0].subtract(a.v0[0]).evaluate_to_constant(),b=a.v2[0].add(a.v0[0]).divide(2).simplify();h.push({setDependency:o[l].specifiedWidth,desiredValue:y},{setDependency:o[l].specifiedCenter,desiredValue:b})}if(c!==void 0){let y=a.v2[1].subtract(a.v0[1]).evaluate_to_constant(),b=a.v2[1].add(a.v0[1]).divide(2).simplify();h.push({setDependency:o[c].specifiedHeight,desiredValue:y},{setDependency:o[c].specifiedCenter,desiredValue:b})}}else{if(d!==void 0){let y=a.v0[0].simplify();h.push({setDependency:o[d].essentialVertex,desiredValue:y})}if(m!==void 0){let y=a.v2[0].subtract(a.v0[0]).evaluate_to_constant();h.push({setDependency:o[m].specifiedWidth,desiredValue:y})}if(p!==void 0){let y=a.v0[1].simplify();h.push({setDependency:o[p].essentialVertex,desiredValue:y})}if(f!==void 0){let y=a.v2[1].subtract(a.v0[1]).evaluate_to_constant();h.push({setDependency:o[f].specifiedHeight,desiredValue:y})}}else if(r.nVerticesSpecified===1)if(r.haveSpecifiedCenter){if(d!==void 0){let y=a.v0[0].simplify();h.push({setDependency:o[d].verticesChild,desiredValue:y,childIndex:0,variableIndex:0})}if(m!==void 0){let y=a.v2[0].add(a.v0[0]).divide(2).simplify();h.push({setDependency:o[m].specifiedCenter,desiredValue:y})}if(p!==void 0){let y=a.v0[1].simplify();h.push({setDependency:o[p].verticesChild,desiredValue:y,childIndex:0,variableIndex:0})}if(f!==void 0){let y=a.v2[1].add(a.v0[1]).divide(2).simplify();h.push({setDependency:o[f].specifiedCenter,desiredValue:y})}}else{if(d!==void 0){let y=a.v0[0].simplify();h.push({setDependency:o[d].verticesChild,desiredValue:y,childIndex:0,variableIndex:0})}if(m!==void 0){let y=a.v2[0].subtract(a.v0[0]).evaluate_to_constant();h.push({setDependency:o[m].specifiedWidth,desiredValue:y})}if(p!==void 0){let y=a.v0[1].simplify();h.push({setDependency:o[p].verticesChild,desiredValue:y,childIndex:0,variableIndex:0})}if(f!==void 0){let y=a.v2[1].subtract(a.v0[1]).evaluate_to_constant();h.push({setDependency:o[f].specifiedHeight,desiredValue:y})}}else d!==void 0&&h.push({setDependency:o[d].verticesChild,desiredValue:a.v0[0],childIndex:0,variableIndex:0}),m!==void 0&&h.push({setDependency:o[m].verticesChild,desiredValue:a.v2[0],childIndex:0,variableIndex:0}),p!==void 0&&h.push({setDependency:o[p].verticesChild,desiredValue:a.v0[1],childIndex:0,variableIndex:0}),f!==void 0&&h.push({setDependency:o[f].verticesChild,desiredValue:a.v2[1],childIndex:0,variableIndex:0});return{success:!0,instructions:h}}},t.nVertices={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{nVertices:4}})},t}movePolygon(t){let e=[],n={};for(let r in t)n[r+",0"]=Be.fromAst(t[r][0]),n[r+",1"]=Be.fromAst(t[r][1]);if(e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"vertices",value:n}),Object.keys(t).length===1){let r=Number(Object.keys(t)[0]),i=Be.fromAst(t[r][0]),a=Be.fromAst(t[r][1]),s=(r+2)%4,o=this.stateValues.vertices[s][0],l=this.stateValues.vertices[s][1];if(this.stateValues.nVerticesSpecified<2)if(this.stateValues.haveSpecifiedCenter){let c,d;r===0?(c=i.add(o).divide(2),d=a.add(l).divide(2)):r===1?d=a.add(l).divide(2):r===3&&(c=i.add(o).divide(2)),c!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{0:c.simplify()}}),d!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedCenter",value:{1:d.simplify()}})}else{let c,d;r===0?(c=o.subtract(i),d=l.subtract(a)):r===1?d=l.subtract(a):r===3&&(c=o.subtract(i)),c!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedWidth",value:c.simplify()}),d!==void 0&&e.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"specifiedHeight",value:d.simplify()})}}this.coreFunctions.requestUpdate({updateInstructions:e})}},If=os;import Ce from"../_snowpack/pkg/math-expressions.js";var ls=class extends le{static componentType="curve";static rendererType="curve";actions={moveControlVector:this.moveControlVector.bind(new Proxy(this,this.readOnlyProxyHandler)),moveThroughPoint:this.moveThroughPoint.bind(new Proxy(this,this.readOnlyProxyHandler)),changeVectorControlDirection:this.changeVectorControlDirection.bind(new Proxy(this,this.readOnlyProxyHandler))};static primaryStateVariableForDefinition="fShadow";static get stateVariablesShadowedForReference(){return["variableForChild","parmin","parmax","curveType","nThroughPoints","nDimensions","throughPoints"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e.label.propagateToDescendants=!0,e.showLabel.propagateToDescendants=!0,e.layer.propagateToDescendants=!0,e.flipFunction={default:!1,forRenderer:!0},e.nDiscretizationPoints={default:500},e.periodic={default:!1},e.splineTension={default:.8,clamp:[0,1]},e.extrapolateBackward={default:!1,forRenderer:!0},e.extrapolateForward={default:!1,forRenderer:!0},e.splineForm={default:"centripetal",toLowerCase:!0,validValues:["centripetal","uniform"]},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let a=Ct({childrenToComponentFunction:s=>({componentType:"function",children:s}),mustStripOffOuterParentheses:!0})({matchedChildren:n});return a.success?a:{success:!0,newChildren:[{componentType:"function",children:n}]}};return t.push({childrenRegex:/s/,replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroFunctions",componentType:"function",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atMostOneThrough",componentType:"through",comparison:"atMost",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"atMostOneBezierControls",componentType:"beziercontrols",comparison:"atMost",number:1}),a=e.newOperator({name:"throughAndControls",operator:"and",propositions:[r,i]}),s=e.newOperator({name:"functionsXorThrough",operator:"xor",propositions:[n,a]}),o=e.newLeaf({name:"atMostOneVariable",componentType:"variable",comparison:"atMost",number:1,takePropertyChildren:!0}),l=e.newLeaf({name:"atMostOneParMin",componentType:"parmin",comparison:"atMost",number:1,takePropertyChildren:!0}),c=e.newLeaf({name:"atMostOneParMax",componentType:"parmax",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"curveLogic",operator:"and",propositions:[s,o,l,c],setAsBase:!0}),e}static returnStateVariableDefinitions({numerics:t}){let e=super.returnStateVariableDefinitions({numerics:t});return e.styleDescription={public:!0,componentType:"text",returnDependencies:()=>({selectedStyle:{dependencyType:"stateVariable",variableName:"selectedStyle"}}),definition:function({dependencyValues:n}){let r="";return n.selectedStyle.lineWidth>=4?r+="thick ":n.selectedStyle.lineWidth<=1&&(r+="thin "),n.selectedStyle.lineStyle==="dashed"?r+="dashed ":n.selectedStyle.lineStyle==="dotted"&&(r+="dotted "),r+=n.selectedStyle.lineColor,{newValues:{styleDescription:r}}}},e.variableForChild={defaultValue:Ce.fromAst("x"),returnDependencies:()=>({variableChild:{dependencyType:"child",childLogicName:"atMostOneVariable",variableNames:["value"]}}),definition({dependencyValues:n}){return n.variableChild.length===1?{newValues:{variableForChild:n.variableChild[0].stateValues.value}}:{useEssentialOrDefaultValue:{variableForChild:{variablesToCheck:["variable","variableForChild"]}}}}},e.curveType={forRenderer:!0,returnDependencies:()=>({functionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFunctions"},throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough"}}),definition({dependencyValues:n}){let r="function";return n.throughChild.length===1?r="bezier":n.functionChildren.length>1&&(r="parameterization"),{newValues:{curveType:r}}}},e.fShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{fShadow:{variablesToCheck:["fShadow"]}}})},e.parmax={public:!0,componentType:"number",forRenderer:!0,defaultValue:10,returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMaxChild:{dependencyType:"child",childLogicName:"atMostOneParMax",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"}}),definition:function({dependencyValues:n}){let r;if(n.curveType==="bezier")r=n.nThroughPoints-1,n.extrapolateForward&&(r*=2);else if(n.parMaxChild.length===1)r=n.parMaxChild[0].stateValues.value.evaluate_to_constant(),Number.isFinite(r)||(r=NaN);else return{useEssentialOrDefaultValue:{parmax:{variablesToCheck:["parmax"]}}};return{newValues:{parmax:r}}}},e.parmin={forRenderer:!0,public:!0,componentType:"number",defaultValue:-10,returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},parMinChild:{dependencyType:"child",childLogicName:"atMostOneParMin",variableNames:["value"]},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"}}),definition:function({dependencyValues:n}){let r;if(n.curveType==="bezier")r=0,n.extrapolateBackward&&(r=-(n.nThroughPoints-1));else if(n.parMinChild.length===1)r=n.parMinChild[0].stateValues.value.evaluate_to_constant(),Number.isFinite(r)||(r=NaN);else return{useEssentialOrDefaultValue:{parmin:{variablesToCheck:["parmin"]}}};return{newValues:{parmin:r}}}},e.nThroughPoints={returnDependencies:()=>({throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["nPoints"]}}),definition({dependencyValues:n}){let r=0;return n.throughChild.length===1&&(r=n.throughChild[0].stateValues.nPoints),{newValues:{nThroughPoints:r}}}},e.nDimensions={public:!0,componentType:"number",returnDependencies(){return{throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["nDimensions"]}}},definition:function({dependencyValues:n}){return n.throughChild.length===1?{newValues:{nDimensions:n.throughChild[0].stateValues.nDimensions},checkForActualChange:{nDimensions:!0}}:{newValues:{nDimensions:2}}}},e.throughPoints={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],returnWrappingComponents(n){return n==="throughPointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if(n==="throughPointX"){let a=r.split("_").map(s=>Number(s)-1);return a.length===2&&a.every((s,o)=>Number.isInteger(s)&&s>=0)?i?a.every((s,o)=>s<i[o])?[String(a)]:[]:[String(a)]:[]}else{if(!i)return[];let a=Number(r)-1;return Number.isInteger(a)&&a>=0&&a<i[0]?Array.from(Array(i[1]),(s,o)=>a+","+o):[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,n.nDimensions]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n){let[a,s]=i.split(","),o=Number(a)+1+"_"+(Number(s)+1);r[i]={throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["pointX"+o]}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let[s,o]=a.split(","),l=Number(s)+1+"_"+(Number(o)+1),c=n[a].throughChild;c.length===1&&c[0].stateValues["pointX"+l]?i[a]=c[0].stateValues["pointX"+l]:i[a]=Ce.fromAst(0)}return{newValues:{throughPoints:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,initialChange:a,stateValues:s}){if(a&&!s.draggable)return{success:!1};let o=[];for(let l in n.throughPoints){let[c,d]=l.split(","),p=Number(c)+1+"_"+(Number(d)+1);if(r[l].throughChild.length===1&&r[l].throughChild[0].stateValues["pointX"+p])o.push({setDependency:i[l].throughChild,desiredValue:n.throughPoints[l],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:o}}},e.numericalThroughPoints={isArray:!0,entryPrefixes:["numericalThroughPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n)r[i]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(i)+1)}};return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].throughPoint.map(o=>o.evaluate_to_constant());s.every(o=>Number.isFinite(o))||(s=Array(s.length).fill(NaN)),i[a]=s}return{newValues:{numericalThroughPoints:i}}}},e.haveBezierControls={forRenderer:!0,returnDependencies:()=>({controlChild:{dependencyType:"child",childLogicName:"atMostOneBezierControls"}}),definition({dependencyValues:n}){return{newValues:{haveBezierControls:n.controlChild.length===1}}}},e.vectorControlDirections={public:!0,componentType:"text",isArray:!0,entryPrefixes:["vectorControlDirection"],forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let a of n)r[a]={controlChild:{dependencyType:"child",childLogicName:"atMostOneBezierControls",variableNames:["direction"+(Number(a)+1)]}};return{dependenciesByKey:r,globalDependencies:{haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"}}}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].controlChild;s&&s.length===1?i[a]=s[0].stateValues["direction"+(Number(a)+1)]:i[a]="none"}return{newValues:{vectorControlDirections:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r,dependencyValuesByKey:i,globalDependencyValues:a}){if(!a.haveBezierControls)return{success:!1};let s=[],o={};for(let l in n.vectorControlDirections){let c=i[l].controlChild;c&&c.length===1?s.push({setDependency:r[l].controlChild,desiredValue:n.vectorControlDirections[l],childIndex:0,variableIndex:0}):o[l]=n.vectorControlDirections[l]}return Object.keys(o).length>0&&s.push({setStateVariable:"vectorControlDirections",value:o}),{success:!0,instructions:s}}},e.controlVectors={isArray:!0,public:!0,componentType:"math",entryPrefixes:["controlVectorX","controlVector"],nDimensions:3,stateVariablesDeterminingDependencies:["vectorControlDirections","nThroughPoints"],returnWrappingComponents(n){return n==="controlVectorX"?[]:[["vector",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if(n==="controlVectorX"){let a=r.split("_").map(s=>Number(s)-1);return a.length===3&&a.every((s,o)=>Number.isInteger(s)&&s>=0)?i?a.every((s,o)=>s<i[o])?[String(a)]:[]:[String(a)]:[]}else{if(!i)return[];let a=r.split("_").map(s=>Number(s)-1);return a.length===2&&a.every((s,o)=>Number.isInteger(s)&&s>=0&&s<i[o])?Array.from(Array(i[2]),(s,o)=>String(a)+","+o):[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2,n.nDimensions]},returnArrayDependenciesByKey({arrayKeys:n,stateValues:r}){let i={haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"},splineTension:{dependencyType:"stateVariable",variableName:"splineTension"},splineForm:{dependencyType:"stateVariable",variableName:"splineForm"}},a={};for(let s of n){let o=s.split(",").map(f=>Number(f)),l=o.map(f=>f+1),c=l.join("_");a[s]={direction:{dependencyType:"stateVariable",variableName:"vectorControlDirection"+l[0]},controlChild:{dependencyType:"child",childLogicName:"atMostOneBezierControls",variableNames:["control"+c]}};let d=o[0],p=r.vectorControlDirections[d],m=[];p==="none"?m=[d-1,d,d+1]:p==="previous"?m=[d,d+1]:p==="next"&&(m=[d-1,d]);for(let f of m)f>=0&&f<r.nThroughPoints&&(a[s]["throughPoint"+(f+1)]={dependencyType:"stateVariable",variableName:"throughPoint"+(f+1)})}return{globalDependencies:i,dependenciesByKey:a}},arrayDefinitionByKey({globalDependencyValues:n,dependencyValuesByKey:r,arrayKeys:i}){let a={};for(let s of i){if(n.nDimensions!==2){a[s]=Ce.fromAst(NaN);continue}if(s in a)continue;let o=s.split(",").map(f=>Number(f)),c=o.map(f=>f+1).join("_"),d=o[0],p=o[1],m=r[s].direction;if(m||(m="none"),m==="none"){let f=r[s]["throughPoint"+(d+1)],h,y;d>0&&(h=r[s]["throughPoint"+d]),d<n.nThroughPoints&&(y=r[s]["throughPoint"+(d+2)]);let{coordsNumeric:b,numericEntries:g}=Pf({tau:n.splineTension,eps:t.eps,splineForm:n.splineForm,point1:h,point2:f,point3:y});for(let T=0;T<2;T++){let N=d+","+p+","+T,v=d+","+(1-p)+","+T;p===0?(a[N]=b[T],a[v]=Ce.fromAst(-b[T].tree)):(a[N]=Ce.fromAst(-b[T].tree),a[v]=b[T])}}else{let f=!1,h=r[s].controlChild;if(h.length===1){let y=h[0].stateValues["control"+c];y&&(f=!0,a[s]=y)}if(!f){let y=r[s]["throughPoint"+d],b=r[s]["throughPoint"+(d+1)],g=r[s]["throughPoint"+(d+2)],{coordsNumeric:T,numericEntries:N}=Pf({tau:n.splineTension,eps:t.eps,splineForm:n.splineForm,point1:y||g,point2:b,point3:void 0});for(let v=0;v<2;v++){let C=d+","+p+","+v;a[C]=T[v]}}}}return{newValues:{controlVectors:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r,dependencyValuesByKey:i,globalDependencyValues:a}){if(!a.haveBezierControls||a.nDimensions!==2)return{success:!1};let s=[];for(let o in n.controlVectors){let d=o.split(",").map(m=>Number(m)).map(m=>m+1).join("_"),p=i[o].controlChild;p.length===1&&p[0].stateValues["control"+d]&&s.push({setDependency:r[o].controlChild,desiredValue:n.controlVectors[o],childIndex:0,variableIndex:0})}return{success:!0,instructions:s}}},e.numericalControlVectors={isArray:!0,entryPrefixes:["numericalControlVector"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n){let o=i.split(",").map(l=>Number(l)).map(l=>l+1).join("_");r[i]={controlVector:{dependencyType:"stateVariable",variableName:"controlVector"+o}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].controlVector.map(o=>o.tree);i[a]=s}return{newValues:{numericalControlVectors:i}}}},e.controlPoints={isArray:!0,public:!0,componentType:"math",entryPrefixes:["controlPointX","controlPoint"],nDimensions:3,returnWrappingComponents(n){return n==="controlPointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:n,varEnding:r,arraySize:i}){if(n==="controlPointX"){let a=r.split("_").map(s=>Number(s)-1);return a.length===3&&a.every((s,o)=>Number.isInteger(s)&&s>=0)?i?a.every((s,o)=>s<i[o])?[String(a)]:[]:[String(a)]:[]}else{if(!i)return[];let a=r.split("_").map(s=>Number(s)-1);return a.length===2&&a.every((s,o)=>Number.isInteger(s)&&s>=0&&s<i[o])?Array.from(Array(i[2]),(s,o)=>String(a)+","+o):[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2,n.nDimensions]},returnArrayDependenciesByKey({arrayKeys:n}){let r={haveBezierControls:{dependencyType:"stateVariable",variableName:"haveBezierControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}},i={};for(let a of n){let o=a.split(",").map(c=>Number(c)).map(c=>c+1),l=o.join("_");i[a]={throughPointX:{dependencyType:"stateVariable",variableName:"throughPointX"+o[0]+"_"+o[2]},controlVectorX:{dependencyType:"stateVariable",variableName:"controlVectorX"+l}}}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey({globalDependencyValues:n,dependencyValuesByKey:r,arrayKeys:i}){let a={};for(let s of i)if(n.nDimensions!==2)a[s]=Ce.fromAst(NaN);else{let o=r[s].controlVectorX;if(o){let l=r[s].throughPointX.evaluate_to_constant();Number.isFinite(l)||(l=NaN),a[s]=Ce.fromAst(l+o.tree)}else a[s]=null}return{newValues:{controlPoints:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:n,dependencyNamesByKey:r,dependencyValuesByKey:i,globalDependencyValues:a}){if(!a.haveBezierControls||a.nDimensions!==2)return{success:!1};let s=[];for(let o in n.controlPoints)if(i[o].controlVectorX){let c=i[o].throughPointX,d=n.controlPoints[o];d.tree&&(d=d.tree);let p=Ce.fromAst(["+",d,["-",c.tree]]);s.push({setDependency:r[o].controlVectorX,desiredValue:p})}return{success:!0,instructions:s}}},e.numericalControlPoints={isArray:!0,entryPrefixes:["numericalControlPoint"],forRenderer:!0,nDimensions:2,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n){let o=i.split(",").map(l=>Number(l)).map(l=>l+1).join("_");r[i]={controlPoint:{dependencyType:"stateVariable",variableName:"controlPoint"+o}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].controlPoint.map(o=>o.tree);i[a]=s}return{newValues:{numericalControlPoints:i}}}},e.splineCoeffs={isArray:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:n}){return[n.nThroughPoints-1]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n){let a=Number(i)+1,s=a+1;r[i]={previousPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+a},nextPoint:{dependencyType:"stateVariable",variableName:"numericalThroughPoint"+s},previousVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+a+"_2"},nextVector:{dependencyType:"stateVariable",variableName:"numericalControlVector"+s+"_1"}}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r){let s=n[a].previousPoint,o=n[a].nextPoint,l=n[a].previousVector,c=n[a].nextVector,d=[];for(let p=0;p<2;p++)d.push(Lv(s[p],o[p],3*l[p],-3*c[p]));i[a]=d}return{newValues:{splineCoeffs:i}}}},e.extrapolateBackwardCoeffs={returnDependencies:()=>({extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},throughPoint1:{dependencyType:"stateVariable",variableName:"numericalThroughPoint1"},throughPoint2:{dependencyType:"stateVariable",variableName:"numericalThroughPoint2"},controlVector:{dependencyType:"stateVariable",variableName:"numericalControlVector1_1"}}),definition({dependencyValues:n}){if(!n.extrapolateBackward)return{newValues:{extrapolateBackwardCoeffs:null}};let r=n.throughPoint1,i=n.throughPoint2,a=n.controlVector;if(!(r&&i&&a))return{newValues:{extrapolateBackwardCoeffs:null}};let s=[];s[0]=[r[0],-3*a[0]*4,0];let o=(i[0]-r[0]-3*a[0])*-16;return o!==0&&a[0]/o>0&&(s[0][2]=o),s[1]=[r[1],-3*a[1]*4,0],o=(i[1]-r[1]-3*a[1])*-16,o!==0&&a[1]/o>0&&(s[1][2]=o),{newValues:{extrapolateBackwardCoeffs:s}}}},e.extrapolateForwardCoeffs={stateVariablesDeterminingDependencies:["nThroughPoints"],returnDependencies({stateValues:n}){let r={extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"}};return n.nThroughPoints>=2&&(r.throughPoint1={dependencyType:"stateVariable",variableName:"numericalThroughPoint"+(n.nThroughPoints-1)},r.throughPoint2={dependencyType:"stateVariable",variableName:"numericalThroughPoint"+n.nThroughPoints},r.controlVector={dependencyType:"stateVariable",variableName:"numericalControlVector"+n.nThroughPoints+"_2"}),r},definition({dependencyValues:n}){if(!n.extrapolateForward)return{newValues:{extrapolateForwardCoeffs:null}};let r=n.throughPoint1,i=n.throughPoint2,a=n.controlVector;if(!(r&&i&&a))return{newValues:{extrapolateForwardCoeffs:null}};let s=[];s[0]=[i[0],3*a[0]*4,0];let o=(r[0]-i[0]-3*a[0])*-16;return o!==0&&a[0]/o>0&&(s[0][2]=o),s[1]=[i[1],3*a[1]*4,0],o=(r[1]-i[1]-3*a[1])*-16,o!==0&&a[1]/o>0&&(s[1][2]=o),{newValues:{extrapolateForwardCoeffs:s}}}},e.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],defaultEntryValue:()=>0,returnArraySizeDependencies:()=>({functionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFunctions"},curveType:{dependencyType:"stateVariable",variableName:"curveType"}}),returnArraySize({dependencyValues:n}){return n.curveType==="bezier"?[2]:[Math.max(1,n.functionChildren.length)]},returnArrayDependenciesByKey({arrayKeys:n}){let r={curveType:{dependencyType:"stateVariable",variableName:"curveType"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},splineCoeffs:{dependencyType:"stateVariable",variableName:"splineCoeffs"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},extrapolateBackward:{dependencyType:"stateVariable",variableName:"extrapolateBackward"},extrapolateBackwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateBackwardCoeffs"},extrapolateForward:{dependencyType:"stateVariable",variableName:"extrapolateForward"},extrapolateForwardCoeffs:{dependencyType:"stateVariable",variableName:"extrapolateForwardCoeffs"}},i={};for(let a of n)i[a]={functionChild:{dependencyType:"child",childLogicName:"atLeastZeroFunctions",variableNames:["numericalf"],childIndices:[a]}},Number(a)===0&&(i[a].fShadow={dependencyType:"stateVariable",variableName:"fShadow"});return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey({globalDependencyValues:n,dependencyValuesByKey:r,arrayKeys:i}){if(n.curveType==="bezier")return{newValues:{fs:Rv({globalDependencyValues:n,arrayKeys:i})}};let a={},s={};for(let o of i){let l=r[o].functionChild;l.length===1?a[o]=l[0].stateValues.numericalf:Number(o)===0&&r[o].fShadow?a[o]=r[o].fShadow:s[o]={variablesToCheck:[{variableName:"fs",arrayIndex:o}]}}return{newValues:{fs:a},useEssentialOrDefaultValue:{fs:s}}}},e.f={isAlias:!0,targetVariableName:"f1"},e.nearestPoint={returnDependencies:()=>({curveType:{dependencyType:"stateVariable",variableName:"curveType"},fs:{dependencyType:"stateVariable",variableName:"fs"},flipFunction:{dependencyType:"stateVariable",variableName:"flipFunction"},nDiscretizationPoints:{dependencyType:"stateVariable",variableName:"nDiscretizationPoints"},parmin:{dependencyType:"stateVariable",variableName:"parmin"},parmax:{dependencyType:"stateVariable",variableName:"parmax"},periodic:{dependencyType:"stateVariable",variableName:"periodic"}}),definition({dependencyValues:n}){let r=null;return n.curveType==="function"?r=Pv({dependencyValues:n,numerics:t}):["parameterization","bezier"].includes(n.curveType)&&(r=Ov({dependencyValues:n,numerics:t})),{newValues:{nearestPoint:r}}}},e}moveControlVector({controlVector:t,controlVectorInds:e,transient:n}){let r={[e+",0"]:Ce.fromAst(t[0]),[e+",1"]:Ce.fromAst(t[1])};n?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:r,sourceInformation:{controlVectorMoved:e}}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"controlVectors",value:r,sourceInformation:{controlVectorMoved:e}}],event:{verb:"interacted",object:{componentId:this.componentName},result:{["controlVector"+e.join("_")]:t}}})}moveThroughPoint({throughPoint:t,throughPointInd:e,transient:n}){let r={[e+",0"]:Ce.fromAst(t[0]),[e+",1"]:Ce.fromAst(t[1])};n?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:r,sourceInformation:{throughPointMoved:e}}],transient:n}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"throughPoints",value:r,sourceInformation:{throughPointMoved:e}}],event:{verb:"interacted",object:{componentId:this.componentName},result:{["throughPoint"+e]:t}}})}changeVectorControlDirection({direction:t,throughPointInd:e}){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"vectorControlDirection",value:{[e]:t}}]})}},mn=ls;function Pv({dependencyValues:u,numerics:t}){let e=u.flipFunction,n=u.fs[0],r=u.nDiscretizationPoints;return function(i){let a,s;e?(s=i.x2.evaluate_to_constant(),a=n(s)):(a=i.x1.evaluate_to_constant(),s=n(a));let o=i.x1.evaluate_to_constant(),l=i.x2.evaluate_to_constant();if(!(Number.isFinite(o)&&Number.isFinite(l)))return Number.isFinite(a)&&Number.isFinite(s)?(T={x1:a,x2:x2Asx1AsFunction},i.x3!==void 0&&(T.x3=0),T):{};let c=function(C){let x=-10*Math.log(1/C-1),V=o,w=l;return e?(V-=n(x),w-=x):(V-=x,w-=n(x)),V*V+w*w},d=0,p=1,m=r,f=(p-d)/m,h=d,y=c(d),b=d,g=d+f;for(let C=1;C<=m;C++){let x=d+C*f,V=c(x);(V<y||Number.isNaN(y))&&(h=x,y=V,b=x-f,C===m?g=x:g=x+f)}let T=t.fminbr(c,[b,g]);h=T.x;let N=-10*Math.log(1/h-1),v=n(N);if(e&&([N,v]=[v,N]),Number.isFinite(a)&&Number.isFinite(s)){let C=Math.pow(a-o,2)+Math.pow(s-l,2),x=Math.pow(N-o,2)+Math.pow(v-l,2);if(C<100*x)return T={x1:a,x2:s},i.x3!==void 0&&(T.x3=0),T}return T={x1:N,x2:v},i.x3!==void 0&&(T.x3=0),T}}function Ov({dependencyValues:u,numerics:t}){let e=u.fs,n=u.parmin,r=u.parmax,i=u.nDiscretizationPoints,a=u.periodic;return function(s){if(u.fs.length!==2)return{};let o=s.x1.evaluate_to_constant(),l=s.x2.evaluate_to_constant();if(!(Number.isFinite(o)&&Number.isFinite(l)))return{};let c=function(C){let x=o-e[0](C),V=l-e[1](C);return x*x+V*V},d=n,p=r,m=i,f=(p-d)/m,h=d,y=c(d),b=d,g=d+f;for(let C=1;C<=m;C++){let x=d+C*f,V=c(x);(V<y||Number.isNaN(y))&&(h=x,y=V,b=x-f,C===m?g=x:g=x+f)}a&&(Math.abs(h-d)<t.eps?b=d-f:Math.abs(h-p)<t.eps&&(g=p+f));let T=t.fminbr(c,[b,g]);h=T.x;let N=e[0](h),v=e[1](h);return T={x1:N,x2:v},s.x3!==void 0&&(T.x3=0),T}}function Pf({tau:u,eps:t,point1:e,point2:n,point3:r,splineForm:i}){let a=function(m,f){let h=m[0]-f[0],y=m[1]-f[1];return Math.sqrt(h*h+y*y)},s,o,l;if(n)o=n.map(m=>m.evaluate_to_constant());else return{coordsNumeric:[Ce.fromAst(NaN),Ce.fromAst(NaN)],numericEntries:!1};if(r)l=r.map(m=>m.evaluate_to_constant()),e?s=e.map(m=>m.evaluate_to_constant()):s=[2*o[0]-l[0],2*o[1]-l[1]];else if(e)s=e.map(m=>m.evaluate_to_constant()),l=[2*o[0]-s[0],2*o[1]-s[1]];else return{coordsNumeric:[Ce.fromAst(NaN),Ce.fromAst(NaN)],numericEntries:!1};let c=[];if(i==="centripetal"){let m=a(s,o),f=a(o,l);m=Math.sqrt(m),f=Math.sqrt(f),f<t&&(f=1),m<t&&(m=f);for(let h=0;h<2;h++){let y=(o[h]-s[h])/m-(l[h]-s[h])/(f+m)+(l[h]-o[h])/f;y*=u*Math.sqrt(m*f),c.push(-y/3)}}else for(let m=0;m<2;m++)c.push(-u*(l[m]-s[m])/3);let d=c.map(m=>Ce.fromAst(m)),p=Number.isFinite(c[0])&&Number.isFinite(c[1]);return{coordsNumeric:d,numericEntries:p}}function Lv(u,t,e,n){return[u,e,-3*u+3*t-2*e-n,2*u-2*t+e+n]}function Rv({globalDependencyValues:u,arrayKeys:t}){if(u.nThroughPoints<1){let a={};for(let s of t)a[s]=()=>NaN;return a}let e=u.nThroughPoints-1,n={},r=u.extrapolateBackward,i=u.extrapolateForward;for(let a of t){let s=u.numericalThroughPoints[0][a],o=u.numericalThroughPoints[e][a],l=u.splineCoeffs.map(p=>p[a]),c;r&&(c=u.extrapolateBackwardCoeffs[a]);let d;i&&(d=u.extrapolateForwardCoeffs[a]),n[a]=function(p){if(isNaN(p))return NaN;if(p<0)return r?(c[2]*p+c[1])*p+c[0]:s;if(p>=e)return i?(p-=e,(d[2]*p+d[1])*p+d[0]):o;let m=Math.floor(p);p-=m;let f=l[m];return((f[3]*p+f[2])*p+f[1])*p+f[0]}}return n}import te from"../_snowpack/pkg/math-expressions.js";var us=class extends mn{static componentType="circle";static rendererType="circle";actions={moveCircle:this.moveCircle.bind(new Proxy(this,this.readOnlyProxyHandler))};static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["throughPoints","nThroughPoints","prescribedCenter","prescribedRadius","havePrescribedCenter","havePrescribedRadius"]}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"exactlyOneThrough",componentType:"through",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"atMostOneCenter",componentType:"center",comparison:"atMost",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"exactlyOneRadius",componentType:"radius",number:1,takePropertyChildren:!0});return e.newOperator({name:"radiusCenterOrThrough",operator:"or",propositions:[i,n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(t){let e=le.returnStateVariableDefinitions(t),n=super.returnStateVariableDefinitions(t);return e.styleDescription=n.styleDescription,e.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{curveType:"circle"}})},e.parmax={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parmax:NaN}})},e.parmin={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parmin:NaN}})},e.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],defaultEntryValue:()=>0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[0],returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey:()=>({newValues:{fs:{}}})},e.nThroughPoints={returnDependencies:()=>({throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["nPoints"]}}),definition:function({dependencyValues:r}){return r.throughChild.length===1?{newValues:{nThroughPoints:r.throughChild[0].stateValues.nPoints}}:{newValues:{nThroughPoints:0}}}},e.throughPoints={public:!0,componentType:"math",isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],returnWrappingComponents(r){return r==="throughPointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:r,varEnding:i,arraySize:a}){if(r==="throughPointX"){let s=i.split("_").map(o=>Number(o)-1);return s.length===2&&s.every((o,l)=>Number.isInteger(o)&&o>=0)?a?s.every((o,l)=>o<a[l])?[String(s)]:[]:[String(s)]:[]}else{if(!a)return[];let s=Number(i)-1;return Number.isInteger(s)&&s>=0&&s<a[0]?Array.from(Array(a[1]),(o,l)=>s+","+l):[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:r}){return[r.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:r}){let i={};for(let a of r){let[s,o]=a.split(","),l=Number(s)+1+"_"+(Number(o)+1);i[a]={throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["pointX"+l]}}}return{dependenciesByKey:i}},arrayDefinitionByKey({dependencyValuesByKey:r,arrayKeys:i}){let a={};for(let s of i){let[o,l]=s.split(","),c=Number(o)+1+"_"+(Number(l)+1),d=r[s].throughChild;d.length===1&&d[0].stateValues["pointX"+c]?a[s]=d[0].stateValues["pointX"+c]:a[s]=te.fromAst("\uFF3F")}return{newValues:{throughPoints:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyValuesByKey:i,dependencyNamesByKey:a,initialChange:s,stateValues:o}){if(s&&!o.draggable)return{success:!1};let l=[];for(let c in r.throughPoints){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);if(i[c].throughChild.length===1&&i[c].throughChild[0].stateValues["pointX"+m])l.push({setDependency:a[c].throughChild,desiredValue:r.throughPoints[c],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:l}}},e.radiusShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{radiusShadow:{variablesToCheck:["radius","radiusShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:r}){return{success:!0,instructions:[{setStateVariable:"radiusShadow",value:r.radiusShadow}]}}},e.centerShadow={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{centerShadow:{variablesToCheck:["center","centerShadow"]}}}),inverseDefinition:function({desiredStateVariableValues:r}){return{success:!0,instructions:[{setStateVariable:"centerShadow",value:r.centerShadow}]}}},e.havePrescribedCenter={returnDependencies:()=>({centerChild:{dependencyType:"child",childLogicName:"atMostOneCenter"},centerShadow:{dependencyType:"stateVariable",variableName:"centerShadow"}}),definition:({dependencyValues:r})=>({newValues:{havePrescribedCenter:r.centerChild.length===1||r.centerShadow!==null},checkForActualChange:{havePrescribedCenter:!0}})},e.prescribedCenter={isArray:!0,entryPrefixes:["prescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize({dependencyValues:r}){return[r.havePrescribedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:r}){let i={centerShadow:{dependencyType:"stateVariable",variableName:"centerShadow"}},a={};for(let s of r){let o=Number(s)+1;a[s]={centerChild:{dependencyType:"child",childLogicName:"atMostOneCenter",variableNames:["x"+o]}}}return{globalDependencies:i,dependenciesByKey:a}},arrayDefinitionByKey:function({globalDependencyValues:r,dependencyValuesByKey:i,arrayKeys:a}){let s={};for(let o of a){let l=Number(o)+1;i[o].centerChild.length===1?s[o]=i[o].centerChild[0].stateValues["x"+l]:r.centerShadow!==null&&(s[o]=r.centerShadow.get_component(Number(o)))}return{newValues:{prescribedCenter:s}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,globalDependencyValues:i,dependencyValuesByKey:a,dependencyNamesByKey:s,arraySize:o}){let l=[],c=!1;for(let d of Object.keys(r.prescribedCenter).reverse())a[d].centerChild&&a[d].centerChild.length===1?l.push({setDependency:s[d].centerChild,desiredValue:r.prescribedCenter[d],childIndex:0,variableIndex:0}):i.centerShadow!==null&&(c=!0);if(c)if(o[0]>1){let d=["vector"];for(let p in r.prescribedCenter)d[Number(p)+1]=r.prescribedCenter[p].tree;d.length=o[0]+1,l.push({setDependency:"centerShadow",desiredValue:te.fromAst(d)})}else o[0]===1&&"0"in r.prescribedCenter&&l.push({setDependency:"centerShadow",desiredValue:r.prescribedCenter[0]});return{success:!0,instructions:l}}},e.prescribedRadius={defaultValue:null,returnDependencies:()=>({radiusChild:{dependencyType:"child",childLogicName:"exactlyOneRadius",variableNames:["value"]},radiusShadow:{dependencyType:"stateVariable",variableName:"radiusShadow"}}),definition:function({dependencyValues:r}){return r.radiusChild.length===1?{newValues:{prescribedRadius:r.radiusChild[0].stateValues.value}}:{newValues:{prescribedRadius:r.radiusShadow}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i}){return i.radiusChild.length===1?{success:!0,instructions:[{setDependency:"radiusChild",desiredValue:r.prescribedRadius,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"radiusShadow",desiredValue:r.prescribedRadius}]}}},e.havePrescribedRadius={returnDependencies:()=>({radiusChild:{dependencyType:"child",childLogicName:"exactlyOneRadius"},radiusShadow:{dependencyType:"stateVariable",variableName:"radiusShadow"}}),definition:({dependencyValues:r})=>({newValues:{havePrescribedRadius:r.radiusChild.length===1||r.radiusShadow!==null},checkForActualChange:{havePrescribedRadius:!0}})},e.numericalPrescribedRadius={returnDependencies:()=>({prescribedRadius:{dependencyType:"stateVariable",variableName:"prescribedRadius"}}),additionalStateVariablesDefined:["haveNonNumericalPrescribedRadius"],definition:function({dependencyValues:r}){let i=!1,a;return r.prescribedRadius===null?a=null:(a=r.prescribedRadius.evaluate_to_constant(),Number.isFinite(a)||(a=NaN,i=!0)),{newValues:{haveNonNumericalPrescribedRadius:i,numericalPrescribedRadius:a},checkForActualChange:{haveNonNumericalEntriesNumericalRadius:!0}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i,stateValues:a}){return a.haveNonNumericalPrescribedRadius?{success:!1}:r.numericalPrescribedRadius!==void 0?i.prescribedRadius===null?{success:!1}:{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:te.fromAst(r.numericalPrescribedRadius)}]}:{success:!1}}},e.numericalPrescribedCenter={isArray:!0,entryPrefixes:["numericalPrescribedCenterX"],returnArraySizeDependencies:()=>({havePrescribedCenter:{dependencyType:"stateVariable",variableName:"havePrescribedCenter"}}),returnArraySize({dependencyValues:r}){return[r.havePrescribedCenter?2:0]},returnArrayDependenciesByKey({arrayKeys:r}){let i={};for(let a of r){let s=Number(a)+1;i[a]={prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+s}}}return{dependenciesByKey:i}},arrayDefinitionByKey:function({dependencyValuesByKey:r,arrayKeys:i}){let a={};for(let s of i)a[s]=r[s].prescribedCenterX.evaluate_to_constant(),Number.isFinite(a[s])||(a[s]=NaN);return{newValues:{numericalPrescribedCenter:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyNamesByKey:i}){let a=[];for(let s in r.numericalPrescribedCenter)a.push({setDependency:i[s].prescribedCenterX,desiredValue:te.fromAst(r.numericalPrescribedCenter[s])});return{success:!0,instructions:a}}},e.haveNonNumericalPrescribedCenter={returnDependencies:()=>({numericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"}}),definition({dependencyValues:r}){return{newValues:{haveNonNumericalPrescribedCenter:r.numericalPrescribedCenter.some(a=>!Number.isFinite(a))},checkForActualChange:{haveNonNumericalPrescribedCenter:!0}}}},e.numericalThroughPoints={returnDependencies:()=>({throughPoints:{dependencyType:"stateVariable",variableName:"throughPoints"}}),additionalStateVariablesDefined:["haveNonNumericalThroughPoints"],definition:function({dependencyValues:r}){let i=!1,a=[];for(let s of r.throughPoints){let o=[];for(let l=0;l<2;l++){let c;try{c=s[l].evaluate_to_constant()}catch(d){console.warn("Invalid point of circle"),i=!0,o=[];break}if(Number.isFinite(c))o.push(c);else{i=!0,o=[];break}}if(o.length>0)a.push(o);else{a=[];break}}return{newValues:{haveNonNumericalThroughPoints:i,numericalThroughPoints:a},checkForActualChange:{haveNonNumericalThroughPoints:!0}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i,stateValues:a}){if(a.haveNonNumericalThroughPoints)return{success:!1};if(r.numericalThroughPoints!==void 0){let s={};for(let[o,l]of r.numericalThroughPoints.entries())s[o+",0"]=te.fromAst(l[0]),s[o+",1"]=te.fromAst(l[1]);return{success:!0,instructions:[{setDependency:"throughPoints",desiredValue:s}]}}return{success:!1}}},e.haveNumericalEntries={returnDependencies:()=>({haveNonNumericalPrescribedCenter:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},haveNonNumericalThroughPoints:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:({dependencyValues:r})=>({newValues:{haveNumericalEntries:!(r.haveNonNumericalPrescribedCenter||r.haveNonNumericalPrescribedRadius||r.haveNonNumericalThroughPoints)}})},e.numericalRadiusCalculatedWithCenter={additionalStateVariablesDefined:["numericalCenterCalculatedWithRadius"],returnDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"}}),definition:function({dependencyValues:r}){if(r.haveNonNumericalThroughPoints){let i="Haven't implemented circle through "+r.nThroughPoints+" points";return i+=" in case where don't have numerical values.",console.warn(i),{newValues:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}if(r.nThroughPoints===2){let{numericalCenter:i,numericalRadius:a}=cs({point1:r.numericalThroughPoints[0],point2:r.numericalThroughPoints[1]});return{newValues:{numericalCenterCalculatedWithRadius:i,numericalRadiusCalculatedWithCenter:a}}}else if(r.nThroughPoints===3){let i=r.numericalThroughPoints[0][0],a=r.numericalThroughPoints[1][0],s=r.numericalThroughPoints[2][0],o=r.numericalThroughPoints[0][1],l=r.numericalThroughPoints[1][1],c=r.numericalThroughPoints[2][1],d,p;if(i===a&&o===l)if(i===s&&o===c)d=[i,o],p=0;else{let m=cs({point1:[i,o],point2:[s,c]});d=m.numericalCenter,p=m.numericalRadius}else if(i===s&&o===c||a===s&&l===c){let m=cs({point1:[i,o],point2:[a,l]});d=m.numericalCenter,p=m.numericalRadius}else{let m=i*i+o*o,f=a*a+l*l,h=s*s+c*c,y=i*(l-c)-o*(a-s)+a*c-s*l,b=m*(c-l)+f*(o-c)+h*(l-o),g=m*(a-s)+f*(s-i)+h*(i-a),T=m*(s*l-a*c)+f*(i*c-s*o)+h*(a*o-i*l);y!==0?(d=[-b/(2*y),-g/(2*y)],p=Math.sqrt((b*b+g*g-4*y*T)/(4*y*y))):(d=[NaN,NaN],p=NaN)}return{newValues:{numericalCenterCalculatedWithRadius:d,numericalRadiusCalculatedWithCenter:p}}}else return r.nThroughPoints>3?(console.warn("Can't calculate circle through more than 3 points"),{newValues:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}):{newValues:{numericalRadiusCalculatedWithCenter:null,numericalCenterCalculatedWithRadius:null}}}},e.numericalRadius={forRenderer:!0,stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],defaultValue:1,returnDependencies:function({stateValues:r}){let i={haveNonNumericalPrescribedRadius:{dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return r.havePrescribedRadius?(i.numericalPrescribedRadius={dependencyType:"stateVariable",variableName:"numericalPrescribedRadius"},r.havePrescribedCenter&&r.nThroughPoints>0&&(i.haveCenterRadiusPoints={dependencyType:"value",value:!0})):r.havePrescribedCenter?r.nThroughPoints===1&&(i.haveNonNumericalPrescribedCenter={dependencyType:"stateVariable",variableName:"haveNonNumericalPrescribedCenter"},i.numericalPrescribedCenter={dependencyType:"stateVariable",variableName:"numericalPrescribedCenter"},i.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},i.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}):r.nThroughPoints>1&&(i.numericalRadiusCalculatedWithCenter={dependencyType:"stateVariable",variableName:"numericalRadiusCalculatedWithCenter"},i.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"}),i},definition:function({dependencyValues:r}){if(r.haveNonNumericalPrescribedRadius||r.haveNonNumericalPrescribedCenter||r.haveNonNumericalThroughPoints)return{newValues:{numericalRadius:NaN}};if(r.numericalPrescribedRadius!==void 0)return r.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{numericalRadius:NaN}}):{newValues:{numericalRadius:Math.max(0,r.numericalPrescribedRadius)}};if(r.numericalPrescribedCenter!==void 0){if(r.nThroughPoints===0)return{useEssentialOrDefaultValue:{numericalRadius:{variablesToCheck:"numericalRadius"}}};if(r.nThroughPoints===1){let i=r.numericalThroughPoints[0];return i===void 0?{newValues:{numericalRadius:NaN}}:{newValues:{numericalRadius:Math.sqrt(Math.pow(i[0]-r.numericalPrescribedCenter[0],2)+Math.pow(i[1]-r.numericalPrescribedCenter[1],2))}}}else return console.warn("Can't calculate circle with specified center through more than 1 point"),{newValues:{numericalRadius:NaN}}}return r.nThroughPoints<2?{useEssentialOrDefaultValue:{numericalRadius:{variablesToCheck:"numericalRadius"}}}:{newValues:{numericalRadius:r.numericalRadiusCalculatedWithCenter}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i,stateValues:a}){if(i.numericalPrescribedRadius!==void 0)return{success:!0,instructions:[{setDependency:"numericalPrescribedRadius",desiredValue:Math.max(0,r.numericalRadius)}]};if(i.numericalPrescribedCenter!==void 0){if(i.nThroughPoints===0)return{success:!0,instructions:[{setStateVariable:"numericalRadius",value:Math.max(0,r.numericalRadius)}]};if(i.nThroughPoints===1){let s=Math.max(0,r.numericalRadius),o=a.throughAngles[0];if(!Number.isFinite(o))return{success:!1};let l=[a.numericalCenter[0]+s*Math.cos(o),a.numericalCenter[1]+s*Math.sin(o)];return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:[l]}]}}else return{success:!1}}if(i.nThroughPoints<2)return{success:!0,instructions:[{setStateVariable:"numericalRadius",value:Math.max(0,r.numericalRadius)}]};{let s=[],o=Math.max(0,r.numericalRadius);for(let l=0;l<i.nThroughPoints;l++){let c=a.throughAngles[l];if(!Number.isFinite(c))return{success:!1};let d=[a.numericalCenter[0]+o*Math.cos(c),a.numericalCenter[1]+o*Math.sin(c)];s.push(d)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:s}]}}}},e.numericalCenter={forRenderer:!0,isArray:!0,entryPrefixes:["numericalCenterX"],defaultEntryValue:0,stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:r,stateValues:i}){let a={},s={};if(i.havePrescribedCenter){for(let o of r){let l=Number(o)+1;s[o]={numericalPrescribedCenterX:{dependencyType:"stateVariable",variableName:"numericalPrescribedCenterX"+l}}}i.havePrescribedRadius&&i.nThroughPoints>0&&(a.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else a.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},a.numericalThroughPoints={dependencyType:"stateVariable",variableName:"numericalThroughPoints"},a.haveNonNumericalThroughPoints={dependencyType:"stateVariable",variableName:"haveNonNumericalThroughPoints"},i.havePrescribedRadius?a.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:i.nThroughPoints==1?a.numericalRadius={dependencyType:"stateVariable",variableName:"numericalRadius"}:i.nThroughPoints>1&&(a.numericalCenterCalculatedWithRadius={dependencyType:"stateVariable",variableName:"numericalCenterCalculatedWithRadius"});return{globalDependencies:a,dependenciesByKey:s}},arrayDefinitionByKey:function({globalDependencyValues:r,dependencyValuesByKey:i,arrayKeys:a}){let s={};for(let o of a)if(i[o].numericalPrescribedCenterX!==void 0){if(r.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{numericalCenter:[NaN,NaN]}};s[o]=i[o].numericalPrescribedCenterX}if(Object.keys(s).length>0)return{newValues:{numericalCenter:s}};if(r.haveNonNumericalPrescribedRadius||r.haveNonNumericalThroughPoints)return{newValues:{numericalCenter:[NaN,NaN]}};if(r.numericalRadius!==void 0)if(r.nThroughPoints===0){let o={};for(let l of a)o[l]={variablesToCheck:"numericalCenterX"+l};return{useEssentialOrDefaultValue:{numericalCenter:o}}}else{if(r.nThroughPoints===1)return r.numericalThroughPoints.length<1?{newValues:{numericalCenter:[NaN,NaN]}}:{newValues:{numericalCenter:[r.numericalThroughPoints[0][0],r.numericalThroughPoints[0][1]-r.numericalRadius]}};if(r.nThroughPoints===2){if(r.numericalThroughPoints.length<2)return{newValues:{numericalCenter:[NaN,NaN]}};let o=r.numericalRadius,l=r.numericalThroughPoints[0][0],c=r.numericalThroughPoints[1][0],d=r.numericalThroughPoints[0][1],p=r.numericalThroughPoints[1][1],m=Math.pow(l-c,2)+Math.pow(d-p,2),f=o*o;if(o<0||4*f<m)return console.warn("Can't find circle through given radius and two points"),{newValues:{numericalCenter:[NaN,NaN]}};if(m===0)return{newValues:{numericalCenter:[l,d-o]}};let h=.5*(m*(l+c)+(p-d)*Math.sqrt((4*f-m)*m))/m,y=.5*(m*(d+p)+(l-c)*Math.sqrt((4*f-m)*m))/m;return{newValues:{numericalCenter:[h,y]}}}else return console.warn("Can't create circle through more than two points with given radius"),{newValues:{numericalCenter:[NaN,NaN]}}}if(r.nThroughPoints===0){let o={};for(let l of a)o[l]={variablesToCheck:"numericalCenterX"+l};return{useEssentialOrDefaultValue:{numericalCenter:o}}}else return r.numericalCenterCalculatedWithRadius===void 0?{newValues:{numericalCenter:[NaN,NaN]}}:{newValues:{numericalCenter:r.numericalCenterCalculatedWithRadius}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,globalDependencyValues:i,dependencyValuesByKey:a,dependencyNamesByKey:s,stateValues:o,workspace:l}){let c=[];for(let d in r.numericalCenter)a[d].numericalPrescribedCenterX!==void 0&&c.push({setDependency:s[d].numericalPrescribedCenterX,desiredValue:r.numericalCenter[d]});if(c.length>0)return{success:!0,instructions:c};if(i.nThroughPoints===0){for(let d in r.numericalCenter)c.push({setStateVariable:"numericalCenter",value:{[d]:r.numericalCenter[d]}});return{success:!0,instructions:c}}else{l.desiredCenter||(l.desiredCenter={});for(let p=0;p<2;p++)r.numericalCenter[p]!==void 0?l.desiredCenter[p]=r.numericalCenter[p]:l.desiredCenter[p]===void 0&&(l.desiredCenter[p]=o.numericalCenter[p]);let d=[];for(let p=0;p<i.nThroughPoints;p++){let m=o.throughAngles[p];if(!Number.isFinite(m))return{success:!1};let f=[l.desiredCenter[0]+o.numericalRadius*Math.cos(m),l.desiredCenter[1]+o.numericalRadius*Math.sin(m)];d.push(f)}return{success:!0,instructions:[{setDependency:"numericalThroughPoints",desiredValue:d}]}}}},e.throughAngles={defaultValue:[],returnDependencies:()=>({haveNumericalEntries:{dependencyType:"stateVariable",variableName:"haveNumericalEntries"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"},numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"}}),definition:function({dependencyValues:r}){if(!(r.haveNumericalEntries&&r.nThroughPoints>0&&r.numericalRadius>0&&r.numericalCenter.every(a=>Number.isFinite(a))))return{useEssentialOrDefaultValue:{throughAngles:{variablesToCheck:["throughAngles"]}}};let i=[];for(let a of r.numericalThroughPoints)i.push(Math.atan2(a[1]-r.numericalCenter[1],a[0]-r.numericalCenter[0]));return{newValues:{throughAngles:i},makeEssential:["throughAngles"]}}},e.radius={public:!0,componentType:"math",stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],defaultValue:te.fromAst(1),returnDependencies:function({stateValues:r}){let i={numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"},nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}};return r.havePrescribedRadius?(i.prescribedRadius={dependencyType:"stateVariable",variableName:"prescribedRadius"},r.havePrescribedCenter&&r.nThroughPoints>0&&(i.haveCenterRadiusPoints={dependencyType:"value",value:!0})):r.havePrescribedCenter&&r.nThroughPoints===1&&(i.prescribedCenter={dependencyType:"stateVariable",variableName:"prescribedCenter"},i.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"}),i},definition:function({dependencyValues:r}){if(Number.isFinite(r.numericalRadius))return{newValues:{radius:te.fromAst(r.numericalRadius)},makeEssential:["radius"]};if(r.prescribedRadius!==void 0)return r.haveCenterRadiusPoints?(console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{radius:te.fromAst("\uFF3F")}}):{newValues:{radius:r.prescribedRadius}};if(r.prescribedCenter!==void 0){if(r.nThroughPoints===0)return{useEssentialOrDefaultValue:{radius:{variablesToCheck:"radius"}}};if(r.nThroughPoints===1)try{let i=r.throughPoints[0],a=i[0],s=i[1],o=r.prescribedCenter[0],l=r.prescribedCenter[1];return{newValues:{radius:a.subtract(o).pow(2).add(s.subtract(l).pow(2)).pow(.5).simplify()}}}catch(i){return console.warn("Invalid center or through points of circle"),{newValues:{radius:te.fromAst("\uFF3F")}}}else return console.warn("Can't calculate circle with specified center through more than 1 point"),{newValues:{radius:te.fromAst("\uFF3F")}}}return r.nThroughPoints<2?{useEssentialOrDefaultValue:{radius:{variablesToCheck:"radius"}}}:(console.warn(`Have not implemented circle through ${r.nThroughPoints} points when non-numerical values`),{newValues:{radius:te.fromAst("\uFF3F")}})},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i,stateValues:a}){let s=r.radius.evaluate_to_constant();if(Number.isFinite(s)&&Number.isFinite(i.numericalRadius))return{success:!0,instructions:[{setDependency:"numericalRadius",desiredValue:s}]};if(i.prescribedRadius!==void 0)return{success:!0,instructions:[{setDependency:"prescribedRadius",desiredValue:r.radius}]};if(i.nThroughPoints===0){let o=[{setStateVariable:"radius",value:r.radius}];return Number.isFinite(s)&&o.push({setDependency:"numericalRadius",desiredValue:s}),{success:!0,instructions:o}}else return console.warn("Can't change radius of circle with non-numerical values through points"),{success:!1}}},e.diameter={public:!0,componentType:"math",returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:r}){return{newValues:{diameter:r.radius.multiply(2).simplify()}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i,stateValues:a}){return{success:!0,instructions:[{setDependency:"radius",desiredValue:r.diameter.divide(2).simplify()}]}}},e.center={forRenderer:!0,public:!0,componentType:"math",isArray:!0,entryPrefixes:["centerX"],defaultEntryValue:te.fromAst(0),returnWrappingComponents(r){return r==="centerX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},stateVariablesDeterminingDependencies:["nThroughPoints","havePrescribedCenter","havePrescribedRadius"],returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey({arrayKeys:r,stateValues:i}){console.log("array dependencies by key for circle center"),console.log(r),console.log(i);let a={},s={};if(i.havePrescribedCenter){a.havePrescribedCenter={dependencyType:"value",value:!0};for(let o of r){let l=Number(o)+1;s[o]={numericalCenterX:{dependencyType:"stateVariable",variableName:"numericalCenterX"+l},prescribedCenterX:{dependencyType:"stateVariable",variableName:"prescribedCenterX"+l}}}i.havePrescribedRadius&&i.nThroughPoints>0&&(a.haveCenterRadiusPoints={dependencyType:"value",value:!0})}else a.numericalCenter={dependencyType:"stateVariable",variableName:"numericalCenter"},a.nThroughPoints={dependencyType:"stateVariable",variableName:"nThroughPoints"},a.throughPoints={dependencyType:"stateVariable",variableName:"throughPoints"},i.havePrescribedRadius?a.radius={dependencyType:"stateVariable",variableName:"prescribedRadius"}:i.nThroughPoints==1&&(a.radius={dependencyType:"stateVariable",variableName:"radius"});return console.log({dependenciesByKey:s,globalDependencies:a}),{dependenciesByKey:s,globalDependencies:a}},arrayDefinitionByKey:function({globalDependencyValues:r,dependencyValuesByKey:i,arrayKeys:a}){if(r.havePrescribedCenter){if(r.haveCenterRadiusPoints)return console.warn("Can't calculate circle with specified radius and center and through points"),{newValues:{center:[te.fromAst("\uFF3F"),te.fromAst("\uFF3F")]}};let s={};for(let o of a)Number.isFinite(i[o].numericalCenterX)?s[o]=te.fromAst(i[o].numericalCenterX):s[o]=i[o].prescribedCenterX;return{newValues:{center:s}}}if(r.numericalCenter.every(s=>Number.isFinite(s)))return{newValues:{center:r.numericalCenter.map(s=>te.fromAst(s))},makeEssential:["center"]};if(r.radius!==void 0)if(r.nThroughPoints===0){let s={};for(let o of a)s[o]={variablesToCheck:"centerX"+o};return{useEssentialOrDefaultValue:{center:s}}}else if(r.nThroughPoints===1){let s;try{s=[r.throughPoints[0][0],r.throughPoints[0][1].subtract(r.radius).simplify()]}catch(o){s=[te.fromAst("\uFF3F"),te.fromAst("\uFF3F")]}return{newValues:{center:s}}}else return console.warn("Can't create circle through more than one point with given radius when don't have numerical values"),{newValues:{center:[te.fromAst("\uFF3F"),te.fromAst("\uFF3F")]}};if(r.nThroughPoints===0){let s={};for(let o of a)s[o]={variablesToCheck:"centerX"+o};return{useEssentialOrDefaultValue:{center:s}}}else return console.warn("Can't create circle through more than one point when don't have numerical values"),{newValues:{center:[te.fromAst("\uFF3F"),te.fromAst("\uFF3F")]}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,globalDependencyValues:i,stateValues:a,dependencyNamesByKey:s,workspace:o}){if(i.havePrescribedCenter){let d=[];for(let p in r.center)d.push({setDependency:s[p].prescribedCenterX,desiredValue:r.center[p],arrayKey:p});return{success:!0,instructions:d}}o.desiredCenter||(o.desiredCenter={});for(let d=0;d<2;d++)r.center[d]!==void 0?o.desiredCenter[d]=r.center[d]:o.desiredCenter[d]===void 0&&(o.desiredCenter[d]=a.center[d]);let l=[],c=!0;for(let d=0;d<2;d++){let p=o.desiredCenter[d].evaluate_to_constant();if(!Number.isFinite(p)){c=!1;break}l.push(p)}if(c&&i.numericalCenter.every(d=>Number.isFinite(d)))return{success:!0,instructions:[{setDependency:"numericalCenter",desiredValue:l}]};if(i.nThroughPoints===0){let d=[{setStateVariable:"center",value:o.desiredCenter}];return c&&d.push({setDependency:"numericalCenter",desiredValue:l}),{success:!0,instructions:d}}else return console.warn("Haven't implemented changing center of circle through points with non numerical values"),{success:!1}}},e.childrenToRender={returnDependencies:()=>({}),definition:()=>({newValues:{childrenToRender:[]}})},e.nearestPoint={returnDependencies:()=>({numericalCenter:{dependencyType:"stateVariable",variableName:"numericalCenter"},numericalRadius:{dependencyType:"stateVariable",variableName:"numericalRadius"}}),definition:({dependencyValues:r})=>({newValues:{nearestPoint:function(i){let a=i.x1.evaluate_to_constant(),s=i.x2.evaluate_to_constant();if(!(Number.isFinite(a)&&Number.isFinite(s)))return{};if(!(Number.isFinite(r.numericalCenter[0])&&Number.isFinite(r.numericalCenter[1])&&Number.isFinite(r.numericalRadius)))return{};let o=Math.atan2(s-r.numericalCenter[1],a-r.numericalCenter[0]),l={x1:r.numericalCenter[0]+r.numericalRadius*Math.cos(o),x2:r.numericalCenter[1]+r.numericalRadius*Math.sin(o)};return i.x3!==void 0&&(l.x3=0),l}}})},e}moveCircle({center:t,transient:e}){let n=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalCenter",value:t}];if(this.stateValues.nThroughPoints===1&&this.stateValues.numericalPrescribedCenter!==null&&this.stateValues.numericalPrescribedRadius===null){let r=this.stateValues.throughAngles[0],i=[t[0]+this.stateValues.numericalRadius*Math.cos(r),t[1]+this.stateValues.numericalRadius*Math.sin(r)];n.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"numericalThroughPoints",value:[i]})}e?this.coreFunctions.requestUpdate({updateInstructions:n,transient:e}):this.coreFunctions.requestUpdate({updateInstructions:n,event:{verb:"interacted",object:{componentName:this.componentName,componentType:this.componentType},result:{center:t}}})}},Of=us;function cs({point1:u,point2:t}){let e=(u[0]+t[0])/2,n=(u[1]+t[1])/2,r=[e,n],i=Math.sqrt(Math.pow(e-u[0],2)+Math.pow(n-u[1],2));return{numericalCenter:r,numericalRadius:i}}import Ye from"../_snowpack/pkg/math-expressions.js";var ds=class extends mn{static componentType="parabola";static rendererType="curve";static get stateVariablesShadowedForReference(){return["nThroughPoints","throughPoints"]}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atMostOneThrough",componentType:"through",comparison:"atMost",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"atMostOneVariables",componentType:"variables",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"parabolaLogic",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(t){let e=le.returnStateVariableDefinitions(t),n=super.returnStateVariableDefinitions(t);return e.styleDescription=n.styleDescription,e.curveType={forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{curveType:"function"}})},e.parmax={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parmax:NaN}})},e.parmin={public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({newValues:{parmin:NaN}})},e.aShadow={defaultValue:1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{aShadow:{variablesToCheck:["aShadow","a"]}}}),inverseDefinition:function({desiredStateVariableValues:r}){return{success:!0,instructions:[{setStateVariable:"aShadow",value:r.aShadow}]}}},e.nThroughPoints={returnDependencies:()=>({throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["nPoints"]}}),definition:function({dependencyValues:r}){return r.throughChild.length===0?{newValues:{nThroughPoints:0}}:{newValues:{nThroughPoints:r.throughChild[0].stateValues.nPoints}}}},e.throughPoints={public:!0,componentType:"point",isArray:!0,nDimensions:2,entryPrefixes:["throughPointX","throughPoint"],returnWrappingComponents(r){return r==="throughPointX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},getArrayKeysFromVarName({arrayEntryPrefix:r,varEnding:i,arraySize:a}){if(r==="throughPointX"){let s=i.split("_").map(o=>Number(o)-1);return s.length===2&&s.every((o,l)=>Number.isInteger(o)&&o>=0)?a?s.every((o,l)=>o<a[l])?[String(s)]:[]:[String(s)]:[]}else{if(!a)return[];let s=Number(i)-1;return Number.isInteger(s)&&s>=0&&s<a[0]?Array.from(Array(a[1]),(o,l)=>s+","+l):[]}},returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:r}){return[r.nThroughPoints,2]},returnArrayDependenciesByKey({arrayKeys:r}){let i={};for(let a of r){let[s,o]=a.split(","),l=Number(s)+1+"_"+(Number(o)+1);i[a]={throughChild:{dependencyType:"child",childLogicName:"atMostOneThrough",variableNames:["pointX"+l]}}}return{dependenciesByKey:i}},arrayDefinitionByKey({dependencyValuesByKey:r,arrayKeys:i}){let a={};for(let s of i){let[o,l]=s.split(","),c=Number(o)+1+"_"+(Number(l)+1),d=r[s].throughChild;if(d.length===1&&d[0].stateValues["pointX"+c]){let p=d[0].stateValues["pointX"+c].evaluate_to_constant();Number.isFinite(p)?a[s]=Ye.fromAst(p):a[s]=Ye.fromAst("\uFF3F")}else a[s]=Ye.fromAst("\uFF3F")}return{newValues:{throughPoints:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyValuesByKey:i,dependencyNamesByKey:a,initialChange:s,stateValues:o}){if(s&&!o.draggable)return{success:!1};let l=[];for(let c in r.throughPoints){let[d,p]=c.split(","),m=Number(d)+1+"_"+(Number(p)+1);if(i[c].throughChild.length===1&&i[c].throughChild[0].stateValues["pointX"+m])l.push({setDependency:a[c].throughChild,desiredValue:r.throughPoints[c],childIndex:0,variableIndex:0});else return{success:!1}}return{success:!0,instructions:l}}},e.numericalThroughPoints={isArray:!0,forRenderer:!0,returnArraySizeDependencies:()=>({nThroughPoints:{dependencyType:"stateVariable",variableName:"nThroughPoints"}}),returnArraySize({dependencyValues:r}){return[r.nThroughPoints]},returnArrayDependenciesByKey({arrayKeys:r}){let i={};for(let a of r)i[a]={throughPoint:{dependencyType:"stateVariable",variableName:"throughPoint"+(Number(a)+1)}};return{dependenciesByKey:i}},arrayDefinitionByKey({dependencyValuesByKey:r,arrayKeys:i}){let a={};for(let s of i){let o=r[s].throughPoint.map(l=>l.tree);o.every(l=>Number.isFinite(l))||(o=Array(o.length).fill(NaN)),a[s]=o}return{newValues:{numericalThroughPoints:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:r,dependencyValuesByKey:i,dependencyNamesByKey:a}){let s=[];for(let o in r.numericalThroughPoints)if(i[o].throughPoint)s.push({setDependency:a[o].throughPoint,desiredValue:r.numericalThroughPoints[o].map(l=>Ye.fromAst(l))});else return{success:!1};return{success:!0,instructions:s}}},e.pointsAreNumerical={returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"}}),definition:({dependencyValues:r})=>({newValues:{pointsAreNumerical:r.numericalThroughPoints.every(i=>Number.isFinite(i[0]))},checkForActualChange:{pointsAreNumerical:!0}})},e.a={public:!0,componentType:"number",additionalStateVariablesDefined:[{variableName:"b",public:!0,componentType:"number"},{variableName:"c",public:!0,componentType:"number"},"realValued"],returnDependencies:()=>({numericalThroughPoints:{dependencyType:"stateVariable",variableName:"numericalThroughPoints"},pointsAreNumerical:{dependencyType:"stateVariable",variableName:"pointsAreNumerical"},aShadow:{dependencyType:"stateVariable",variableName:"aShadow"}}),definition:function({dependencyValues:r}){if(!r.pointsAreNumerical)return{newValues:{a:NaN,b:NaN,c:NaN,realValued:!1}};let i,a,s,o=!0;if(r.numericalThroughPoints.length===0)return{useEssentialOrDefaultValue:{b:{variablesToCheck:["b"],defaultValue:0},c:{variablesToCheck:["c"],defaultValue:0}},newValues:{a:r.aShadow,realValued:!0}};if(r.numericalThroughPoints.length===1){let l=r.numericalThroughPoints[0],c=l[0],d=l[1];return i=r.aShadow,a=-2*i*c,s=i*c*c+d,{newValues:{a:i,b:a,c:s,realValued:!0}}}else if(r.numericalThroughPoints.length===2){i=r.aShadow;let l=r.numericalThroughPoints[0],c=l[0],d=l[1],p=c*c,m=r.numericalThroughPoints[1],f=m[0],h=m[1],y=f*f;return c===f?d==h?(a=-2*i*c,s=i*p+d):(o=!1,i=NaN,a=NaN,s=NaN):(a=(d-h-i*(p-y))/(c-f),s=d-i*p-a*c),{newValues:{a:i,b:a,c:s,realValued:o}}}else if(r.numericalThroughPoints.length===3){let l=r.numericalThroughPoints[0],c=l[0],d=l[1],p=c*c,m=r.numericalThroughPoints[1],f=m[0],h=m[1],y=f*f,b=r.numericalThroughPoints[2],g=b[0],T=b[1],N=g*g,v=p-N,C=y-N,x=c-g,V=f-g,w=d-T,D=h-T,I=v*V-C*x;if(I===0){let A=!1,S,O,P;c===f?d===h?c===g?d==T?S=1:A=!0:(S=2,O=g,P=T):A=!0:c===g?d===T?(S=2,O=f,P=h):A=!0:f===g&&h===T?(S=2,O=f,P=h):A=!0,A?(o=!1,i=NaN,a=NaN,s=NaN):S===1?(i=r.aShadow,a=-2*i*c,s=i*c*c+d):(i=r.aShadow,a=(d-P-i*(p-O*O))/(c-O),s=d-i*p-a*c)}else i=(w*V-D*x)/I,a=(D*v-w*C)/I,s=d-a*c-i*p;return{newValues:{a:i,b:a,c:s,realValued:o}}}else return console.warn("Haven't implemented parabola through more than 3 points"),{newValues:{a:NaN,b:NaN,c:NaN,realValued:!1}}},inverseDefinition:function({desiredStateVariableValues:r,dependencyValues:i,stateValues:a,workspace:s}){if(!i.pointsAreNumerical)return{success:!1};let o={},l=function(d){if(Number.isFinite(d))return{success:!0,value:d};if(d instanceof Ye.class){let p=d.evaluate_to_constant();if(Number.isFinite(p))return{success:!0,value:p}}return{success:!1}};if(r.a!==void 0){let d=l(r.a);if(d.success)o.a=d.value;else return{success:!1}}if(r.b!==void 0){let d=l(r.b);if(d.success)o.b=d.value;else return{success:!1}}if(r.c!==void 0){let d=l(r.c);if(d.success)o.c=d.value;else return{success:!1}}Object.assign(s,o);let c=function(d){return s[d]!==void 0?s[d]:a[d]};if(i.numericalThroughPoints.length===0){let d=[];return o.a!==void 0&&d.push({setDependency:"aShadow",desiredValue:o.a}),o.b!==void 0&&d.push({setStateVariable:"b",value:o.b}),o.c!==void 0&&d.push({setStateVariable:"c",value:o.c}),{success:!0,instructions:d}}else if(i.numericalThroughPoints.length===1){let d=c("a"),p=c("b"),m=c("c"),f=-p/(2*d),h=m-p*p/(4*d),y=[{setDependency:"numericalThroughPoints",desiredValue:[[f,h]]}];return o.a!==void 0&&y.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:y}}else if(i.numericalThroughPoints.length===2){let d=c("a"),p=c("b"),m=c("c"),h=i.numericalThroughPoints[0][0],b=i.numericalThroughPoints[1][0];if(h===b){h=-p/(2*d);let g=m-p*p/(4*d),T=[{setDependency:"numericalThroughPoints",desiredValue:[[h,g],[h,g]]}];return o.a!==void 0&&T.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:T}}else{let g=d*h*h+p*h+m,T=d*b*b+p*b+m,N=[{setDependency:"numericalThroughPoints",desiredValue:[[h,g],[b,T]]}];return o.a!==void 0&&N.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:N}}}else if(i.numericalThroughPoints.length===3){let d=c("a"),p=c("b"),m=c("c"),h=i.numericalThroughPoints[0][0],b=i.numericalThroughPoints[1][0],T=i.numericalThroughPoints[2][0],N=3,v;if(h===b?h===T?N=1:(N=2,v=3):h===T?(N=2,v=2):b===T&&(N=2,v=1),N===3){let C=d*h*h+p*h+m,x=d*b*b+p*b+m,V=d*T*T+p*T+m,w=[{setDependency:"numericalThroughPoints",desiredValue:[[h,C],[b,x],[T,V]]}];return o.a!==void 0&&w.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:w}}else if(N===2)if(v===1){let C=h,x=b,V=d*C*C+p*C+m,w=d*x*x+p*x+m,D=[{setDependency:"numericalThroughPoints",desiredValue:[[C,V],[x,w],[x,w]]}];return o.a!==void 0&&D.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:D}}else if(v===2){let C=h,x=b,V=d*C*C+p*C+m,w=d*x*x+p*x+m,D=[{setDependency:"numericalThroughPoints",desiredValue:[[C,V],[x,w],[C,V]]}];return o.a!==void 0&&D.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:D}}else{let C=h,x=T,V=d*C*C+p*C+m,w=d*x*x+p*x+m,D=[{setDependency:"numericalThroughPoints",desiredValue:[[C,V],[C,V],[x,w]]}];return o.a!==void 0&&D.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:D}}else{h=-p/(2*d);let C=m-p*p/(4*d),x=[{setDependency:"numericalThroughPoints",desiredValue:[[h,C],[h,C],[h,C]]}];return o.a!==void 0&&x.push({setDependency:"aShadow",desiredValue:o.a}),{success:!0,instructions:x}}}else return{success:!1}}},e.vertex={public:!0,componentType:"math",isArray:!0,entryPrefixes:["vertexX"],returnWrappingComponents(r){return r==="vertexX"?[]:[["point",{componentType:"xs",doenetAttributes:{isPropertyChild:!0}}]]},returnArraySizeDependencies:()=>({}),returnArraySize(){return[2]},returnArrayDependenciesByKey(){return{globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"},realValued:{dependencyType:"stateVariable",variableName:"realValued"}}}},arrayDefinitionByKey:function({globalDependencyValues:r}){let i={};return r.realValued&&r.a!==0?(i[0]=Ye.fromAst(-r.b/(2*r.a)),i[1]=Ye.fromAst(r.c-r.b**2/(4*r.a))):(i[0]=Ye.fromAst("\uFF3F"),i[1]=Ye.fromAst("\uFF3F")),{newValues:{vertex:i}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:r,globalDependencyValues:i,workspace:a,stateValues:s}){let o;if("0"in r.vertex?o=r.vertex[0].evaluate_to_constant():a.x!==void 0?o=a.x:o=s.vertex[0].tree,Number.isFinite(o))a.x=o;else return{success:!1};let l;if("1"in r.vertex?l=r.vertex[1].evaluate_to_constant():a.y!==void 0?l=a.y:l=s.vertex[1].tree,Number.isFinite(l))a.y=l;else return{success:!1};let c=i.a,d=-2*c*o,p=l+c*o*o;return{success:!0,instructions:[{setDependency:"b",desiredValue:d,additionalDependencyValues:{c:p}}]}}},e.equation={public:!0,componentType:"equation",additionalProperties:{simplify:"numberspreserveorder",displaysmallaszero:!0},returnDependencies:()=>({a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}),definition:function({dependencyValues:r}){let i=["=","y",["+",["*",r.a,["^","x",2]],["*",r.b,"x"],r.c]];return{newValues:{equation:Ye.fromAst(i).evaluate_numbers({skip_ordering:!0})}}}},e.fs={forRenderer:!0,isArray:!0,entryPrefixes:["f"],defaultEntryValue:()=>0,returnArraySizeDependencies:()=>({}),returnArraySize:()=>[1],returnArrayDependenciesByKey(){return{globalDependencies:{a:{dependencyType:"stateVariable",variableName:"a"},b:{dependencyType:"stateVariable",variableName:"b"},c:{dependencyType:"stateVariable",variableName:"c"}}}},arrayDefinitionByKey({globalDependencyValues:r}){return{newValues:{fs:[function(a){return r.a*a*a+r.b*a+r.c}]}}}},e.nearestPoint={returnDependencies:()=>({f:{dependencyType:"stateVariable",variableName:"f"}}),definition:({dependencyValues:r})=>({newValues:{nearestPoint:function(i){let a=i.x1.evaluate_to_constant(),s=r.f(a),o={x1:a,x2:s};return i.x3!==void 0&&(o.x3=0),o}}})},e.childrenToRender={returnDependencies:()=>({}),definition:()=>({newValues:{childrenToRender:[]}})},e}},Lf=ds;import Qe from"../_snowpack/pkg/math-expressions.js";var ps=class extends R{static componentType="beziercontrols";static rendererType="container";static get stateVariablesShadowedForReference(){return["controls"]}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=Xe({componentList:n});return r.success!==!0?{success:!1}:{success:!0,newChildren:r.pieces.map(function(i){return i.length>1||i[0].componentType==="string"?{componentType:"controlvectors",children:[{componentType:"vector",children:i}]}:i[0]})}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.deleteAllLogic(),e.newLeaf({name:"atLeastZeroControlvectors",componentType:"controlvectors",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nControls={returnDependencies:()=>({nParentPoints:{dependencyType:"parentStateVariable",variableName:"nThroughPoints"}}),definition({dependencyValues:e}){let n=e.nParentPoints;return Number.isInteger(n)&&n>=0||(n=0),{newValues:{nControls:n}}}},t.pointIndMap={returnDependencies:()=>({controlChildren:{dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["pointNumber"]}}),definition:function({dependencyValues:e}){let n=[],r=-1;for(let[i,a]of e.controlChildren.entries()){let s=a.stateValues.pointNumber;Number.isFinite(s)?r=Math.round(s)-1:r+=1,n[r]=i}return{newValues:{pointIndMap:n}}}},t.directions={isArray:!0,entryPrefixes:["direction"],defaultEntryValue:"none",stateVariablesDeterminingDependencies:["pointIndMap"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"}}),returnArraySize({dependencyValues:e}){return[e.nControls]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let i of e){let a=n.pointIndMap[i];a!==void 0&&(r[i]={controlChild:{dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["direction"],childIndices:[a]}})}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={},i={};for(let a of n){let s=e[a].controlChild;s&&s.length===1?r[a]=s[0].stateValues.direction:i[a]={variablesToCheck:[{variableName:"directions",arrayIndex:a}]}}return{newValues:{directions:r},useEssentialOrDefaultValue:{directions:i}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n,dependencyValuesByKey:r}){let i=[],a={};for(let s in e.directions){let o=r[s].controlChild;o&&o.length===1?i.push({setDependency:n[s].controlChild,desiredValue:e.directions[s],childIndex:0,variableIndex:0}):a[s]=e.directions[s]}return Object.keys(a).length>0&&i.push({setStateVariable:"directions",value:a}),{success:!0,instructions:i}}},t.nDimensions={returnDependencies(){return{nParentDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensions"}}},definition:function({dependencyValues:e}){let n=e.nParentDimensions;return Number.isInteger(n)&&n>=0||(n=0),{newValues:{nDimensions:n},checkForActualChange:{nDimensions:!0}}}},t.essentialSymmetricControls={isArray:!0,entryPrefixes:["essentialSymmetricControl"],nDimensions:2,defaultEntryValue:Qe.fromAst(1),returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nControls,e.nDimensions]},returnArrayDependenciesByKey:()=>({}),arrayDefinitionByKey({arrayKeys:e}){let n={};for(let r of e){let i=r.split(",").map(a=>Number(a));n[r]={variablesToCheck:[{variableName:"essentialSymmetricControls",arrayIndex:i}]}}return{useEssentialOrDefaultValue:{essentialSymmetricControls:n}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e}){let n=[],r={};for(let i in e.essentialSymmetricControls)r[i]=e.essentialSymmetricControls[i];return Object.keys(r).length>0&&n.push({setStateVariable:"essentialSymmetricControls",value:r}),{success:!0,instructions:n}}},t.controls={isArray:!0,entryPrefixes:["control"],nDimensions:3,defaultEntryValue:Qe.fromAst(1),stateVariablesDeterminingDependencies:["pointIndMap","directions"],returnArraySizeDependencies:()=>({nControls:{dependencyType:"stateVariable",variableName:"nControls"},nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nControls,2,e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={};for(let i of e){let a=i.split(",").map(l=>Number(l)),s=a.map(l=>l+1);r[i]={direction:{dependencyType:"stateVariable",variableName:"direction"+s[0]}};let o=n.directions[a[0]];if(console.log(`direction: ${o}`),o&&o!=="none"&&(a[1]===0||a[1]===1)){let l=n.pointIndMap[a[0]];l!==void 0&&(o==="symmetric"||o==="previous"&&a[1]===0||o==="next"&&a[1]===1?r[i].controlChild={dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["vectorX1_"+s[2]],childIndices:[l]}:o==="both"&&(r[i].controlChild={dependencyType:"child",childLogicName:"atLeastZeroControlvectors",variableNames:["vectorX"+s[1]+"_"+s[2]],childIndices:[l]})),o==="symmetric"&&(r[i].essentialSymmetricControl={dependencyType:"stateVariable",variableName:"essentialSymmetricControl"+s[0]+"_"+s[2]})}}return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n,componentName:r}){console.log(`definition of controls for beziercontrols of ${r}`),console.log(JSON.parse(JSON.stringify(e))),console.log(JSON.parse(JSON.stringify(n)));let i={},a={};for(let s of n){let o=s.split(",").map(d=>Number(d)),l=o.map(d=>d+1),c=e[s].direction;if(!c)a[s]={variablesToCheck:[{variableName:"controls",arrayIndex:o}]};else if(o[1]===0)if(c==="none"||c==="next")a[s]={variablesToCheck:[{variableName:"controls",arrayIndex:o}]};else{let d=e[s].controlChild,p=!0;if(d&&d.length===1){let m=d[0].stateValues["vectorX1_"+l[2]];m&&(p=!1,m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),i[s]=Qe.fromAst(m))}p&&(c==="symmetric"?i[s]=e[s].essentialSymmetricControl:a[s]={variablesToCheck:[{variableName:"controls",arrayIndex:o}]})}else if(o[1]===1)if(c==="none"||c==="previous")a[s]={variablesToCheck:[{variableName:"controls",arrayIndex:o}]};else{let d=e[s].controlChild,p=!0;if(d&&d.length===1)if(c==="both"){let m=d[0].stateValues["vectorX2_"+l[2]];m&&(p=!1,m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),i[s]=Qe.fromAst(m))}else{let m=d[0].stateValues["vectorX1_"+l[2]];m&&(p=!1,m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),c==="symmetric"?i[s]=Qe.fromAst(-m):i[s]=Qe.fromAst(m))}p&&(c==="symmetric"?e[s].essentialSymmetricControl&&(i[s]=Qe.fromAst(-e[s].essentialSymmetricControl.tree)):a[s]={variablesToCheck:[{variableName:"controls",arrayIndex:o}]})}}return{newValues:{controls:i},useEssentialOrDefaultValue:{controls:a}}},inverseArrayDefinitionByKey({desiredStateVariableValues:e,dependencyNamesByKey:n,dependencyValuesByKey:r}){let i=[],a={};for(let s in e.controls){let o=s.split(",").map(d=>Number(d)),l=o.map(d=>d+1),c=r[s].direction;if(c){if(o[1]===0){if(!(c==="none"||c==="next")){let d=r[s].controlChild,p=!0;if(d&&d.length===1&&d[0].stateValues["vectorX1_"+l[2]]&&(p=!1,i.push({setDependency:n[s].controlChild,desiredValue:e.controls[s],childIndex:0,variableIndex:0})),p){let m=e.controls[s].evaluate_to_constant();Number.isFinite(m)||(m=NaN),m=Qe.fromAst(m),c==="symmetric"?i.push({setDependency:n[s].essentialSymmetricControl,desiredValue:m}):a[s]=m}}}else if(o[1]===1&&!(c==="none"||c==="previous")){let d=r[s].controlChild,p=!0;d&&d.length===1&&(c==="both"?d[0].stateValues["vectorX2_"+l[2]]&&(p=!1):d[0].stateValues["vectorX1_"+l[2]]&&(p=!1));let m;c==="symmetric"?m=Qe.fromAst(["-",e.controls[s].tree]):m=e.controls[s],p?(m=m.evaluate_to_constant(),Number.isFinite(m)||(m=NaN),m=Qe.fromAst(m),c==="symmetric"?i.push({setDependency:n[s].essentialSymmetricControl,desiredValue:m}):a[s]=m):i.push({setDependency:n[s].controlChild,desiredValue:m,childIndex:0,variableIndex:0})}}}return Object.keys(a).length>0&&i.push({setStateVariable:"controls",value:a}),{success:!0,instructions:i}}},t}},Rf=ps;var ms=class extends pr{static componentType="controlvectors";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.direction={default:"symmetric",toLowerCase:!0,validValues:["symmetric","previous","next","both","none"]},e.pointNumber={default:null},e}},Ff=ms;import ie from"../_snowpack/pkg/math-expressions.js";var fs=class extends le{static componentType="angle";static get stateVariablesShadowedForReference(){return["nPointsSpecified","points","radians","degrees","numericalPoints"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.draggable={default:!0,forRenderer:!0},e.radius={default:ie.fromAst(1)},e.renderAsAcuteAngle={default:!1,forRenderer:!0},e.inDegrees={default:!1,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();return t.push({childrenRegex:"s",replacementFunction:({matchedChildren:e})=>({success:!0,newChildren:[{componentType:"radians",children:e,doenetAttributes:{isPropertyChild:!0}}]})}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneRadians",componentType:"radians",comparison:"atMost",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"exactlyOneDegrees",componentType:"degrees",comparison:"atMost",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"exactlyOneThrough",componentType:"through",number:1,takePropertyChildren:!0}),a=e.newLeaf({name:"exactlyOneBetweenLines",componentType:"betweenLines",number:1,takePropertyChildren:!0});return e.newOperator({name:"throughLogic",operator:"xor",propositions:[i,a,r,n],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.lineNames={returnDependencies:()=>({betweenLinesChild:{dependencyType:"child",childLogicName:"exactlyOneBetweenLines",variableNames:["lineNames"]}}),definition({dependencyValues:e}){let n=[];return e.betweenLinesChild.length===1&&(n=e.betweenLinesChild[0].stateValues.lineNames),{newValues:{lineNames:n}}}},t.betweenLinesName={returnDependencies:()=>({betweenLinesChild:{dependencyType:"child",childLogicName:"exactlyOneBetweenLines"}}),definition({dependencyValues:e}){let n=null;return e.betweenLinesChild.length===1&&(n=e.betweenLinesChild[0].componentName),{newValues:{betweenLinesName:n}}}},t.nPointsSpecified={returnDependencies:()=>({throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["nPoints"]}}),definition({dependencyValues:e}){return e.throughChild.length===1?{newValues:{nPointsSpecified:e.throughChild[0].stateValues.nPoints}}:{newValues:{nPointsSpecified:0}}}},t.points={isArray:!0,nDimensions:2,entryPrefixes:["pointX","point"],stateVariablesDeterminingDependencies:["nPointsSpecified","betweenLinesName"],returnArraySizeDependencies:()=>({radiansChild:{dependencyType:"child",childLogicName:"atMostOneRadians"},degreesChild:{dependencyType:"child",childLogicName:"exactlyOneDegrees"}}),returnArraySize({dependencyValues:e}){return e.radiansChild.length===1||e.degreesChild.length===1?[0,0]:[3,2]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="pointX"){let i=n.split("_").map(a=>Number(a)-1);return i.length===2&&i.every((a,s)=>Number.isInteger(a)&&a>=0)?r?i.every((a,s)=>a<r[s])?[String(i)]:[]:[String(i)]:[]}else{if(!r)return[];let i=Number(n)-1;return Number.isInteger(i)&&i>=0&&i<r[0]?Array.from(Array(r[1]),(a,s)=>i+","+s):[]}},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={nPointsSpecified:{dependencyType:"value",value:n.nPointsSpecified}};n.betweenLinesName!==null&&(r.lineChildren={dependencyType:"child",parentName:n.betweenLinesName,childLogicName:"atLeastZeroLines",variableNames:["points","nDimensions","coeff0","coeffvar1","coeffvar2"]});let i={};for(let a of e){let[s,o]=a.split(",");if(s==="0"||n.nPointsSpecified>2){let l=Number(s)+1+"_"+(Number(o)+1);i[a]={throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["pointX"+l]}}}else if(s==="2"&&n.nPointsSpecified===2){let l="2_"+(Number(o)+1);i[a]={throughChild:{dependencyType:"child",childLogicName:"exactlyOneThrough",variableNames:["pointX"+l]}}}}return{globalDependencies:r,dependenciesByKey:i}},arrayDefinitionByKey({dependencyValuesByKey:e,globalDependencyValues:n,arrayKeys:r}){if(n.lineChildren)if(n.lineChildren.length!==2)console.warn(`Cannot define an angle between ${n.lineChildren.length} line(s)`);else{let l=n.lineChildren[0],c=n.lineChildren[1],d=Fv(l,c);if(d===void 0){let T={};for(let N=0;N<3;N++)for(let v=0;v<2;v++)T[N+","+v]=ie.fromAst("\uFF3F");return{newValues:{points:T}}}let p=d,m=l.stateValues.points[0][0].evaluate_to_constant(),f=l.stateValues.points[0][1].evaluate_to_constant(),h=l.stateValues.points[1][0].evaluate_to_constant(),y=l.stateValues.points[1][1].evaluate_to_constant(),b=[ie.fromAst(p[0].tree+h-m),ie.fromAst(p[1].tree+y-f)];m=c.stateValues.points[0][0].evaluate_to_constant(),f=c.stateValues.points[0][1].evaluate_to_constant(),h=c.stateValues.points[1][0].evaluate_to_constant(),y=c.stateValues.points[1][1].evaluate_to_constant();let g=[ie.fromAst(p[0].tree+h-m),ie.fromAst(p[1].tree+y-f)];return{newValues:{points:{"0,0":b[0],"0,1":b[1],"1,0":p[0],"1,1":p[1],"2,0":g[0],"2,1":g[1]}}}}let i=n.nPointsSpecified,a={},s={};for(let l of r){let[c,d]=l.split(",");if(c==="0"||i>2){let p=Number(c)+1+"_"+(Number(d)+1),m;e[l].throughChild.length===1&&(m=e[l].throughChild[0].stateValues["pointX"+p]),m===void 0?c==="0"&&d==="1"||c==="2"&&d==="0"?s[l]={defaultValue:ie.fromAst(1)}:s[l]={defaultValue:ie.fromAst(0)}:a[l]=m}else if(c==="2"&&i===2){let p="2_"+(Number(d)+1),m;e[l].throughChild.length===1&&(m=e[l].throughChild[0].stateValues["pointX"+p]),m===void 0?d==="0"?s[l]={defaultValue:ie.fromAst(1)}:s[l]={defaultValue:ie.fromAst(0)}:a[l]=m}else c==="2"&&d==="0"?s[l]={defaultValue:ie.fromAst(1)}:s[l]={defaultValue:ie.fromAst(0)}}let o={};return Object.keys(a).length>0&&(o.newValues={points:a}),Object.keys(s).length>0&&(o.useEssentialOrDefaultValue={points:s}),o}},t.radians={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({radiansChild:{dependencyType:"child",childLogicName:"atMostOneRadians",variableNames:["value"]},degreesChild:{dependencyType:"child",childLogicName:"exactlyOneDegrees",variableNames:["value"]},points:{dependencyType:"stateVariable",variableName:"points"}}),definition({dependencyValues:e}){if(e.radiansChild.length===1)return{newValues:{radians:e.radiansChild[0].stateValues.value.simplify()}};if(e.degreesChild.length===1)return{newValues:{radians:e.degreesChild[0].stateValues.value.multiply(ie.fromAst(["/","pi",180])).simplify()}};let n=[],r=!1;for(let a=0;a<3;a++)n.push([e.points[a][0].evaluate_to_constant(),e.points[a][1].evaluate_to_constant()]),(n[a][0]===null||n[a][1]===null)&&(r=!0);let i;return r?{newValues:{radians:ie.fromAst("\uFF3F")}}:(i=Math.atan2(n[2][1]-n[1][1],n[2][0]-n[1][0])-Math.atan2(n[0][1]-n[1][1],n[0][0]-n[1][0]),i<0&&(i+=2*Math.PI),{newValues:{radians:ie.fromAst(i)}})}},t.value={isAlias:!0,targetVariableName:"radians"},t.angle={isAlias:!0,targetVariableName:"radians"},t.degrees={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({radians:{dependencyType:"stateVariable",variableName:"radians"}}),definition({dependencyValues:e}){let n;return e.radians.tree==="\uFF3F"||Number.isNaN(e.radians.tree)?n=e.radians:n=e.radians.multiply(ie.fromAst(["/",180,"pi"])).simplify(),{newValues:{degrees:n}}}},t.numericalPoints={isArray:!0,entryPrefixes:["numericalPoint"],forRenderer:!0,returnArraySizeDependencies:()=>({radiansChild:{dependencyType:"child",childLogicName:"atMostOneRadians"},degreesChild:{dependencyType:"child",childLogicName:"exactlyOneDegrees"}}),returnArraySize({dependencyValues:e}){return e.radiansChild.length===1||e.degreesChild.length===1?[0]:[3]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={point:{dependencyType:"stateVariable",variableName:"point"+(Number(r)+1)}};return{dependenciesByKey:n}},arrayDefinitionByKey({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n){let a=e[i].point,s=[];for(let o=0;o<2;o++){let l=a[o].evaluate_to_constant();Number.isFinite(l)||(l=NaN),s.push(l)}r[i]=s}return{newValues:{numericalPoints:r}}}},t.numericalRadius={forRenderer:!0,returnDependencies:()=>({radius:{dependencyType:"stateVariable",variableName:"radius"}}),definition({dependencyValues:e}){let n=e.radius.evaluate_to_constant();return Number.isFinite(n)||(n=NaN),{newValues:{numericalRadius:n}}}},t}adapters=["radians"]},kf=fs;function Fv(u,t){if(u.stateValues.nDimensions!==2||t.stateValues.nDimensions!==2){console.log("Calculating angle between two lines implemented only in 2D");return}let e=u.stateValues.coeffvar1.evaluate_to_constant(),n=u.stateValues.coeffvar2.evaluate_to_constant(),r=u.stateValues.coeff0.evaluate_to_constant(),i=t.stateValues.coeffvar1.evaluate_to_constant(),a=t.stateValues.coeffvar2.evaluate_to_constant(),s=t.stateValues.coeff0.evaluate_to_constant();if(!(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(s))){console.log("Calculating angle between two lines implemented only for constant coefficients");return}let o=e*a-i*n;if(Math.abs(o)<1e-14)if(Math.abs(s*e-r*i)>1e-14){console.log("Cannot calculate angle between two parallel lines");return}else return e===0&&n===0&&r===0||i===0&&a===0&&s===0?void 0:n!==0?[ie.fromAst(0),ie.fromAst(-r/n)]:[ie.fromAst(-r/e),ie.fromAst(0)];let l=(s*n-r*a)/o,c=(r*i-s*e)/o;return[ie.fromAst(l),ie.fromAst(c)]}var hs=class extends H{static componentType="equation";static rendererType="math";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions(),e=t.value.definition;return t.value.definition=function({dependencyValues:n}){let r=e({dependencyValues:n}).newValues.value,i=r.tree;return(!Array.isArray(i)||i[0]!=="="||i.length!==3)&&console.warn("Invalid format for equation"),{newValues:{value:r}}},t}},Mf=hs;var ys=class extends B{constructor(t){super(t);Object.defineProperty(this.actions,"submitAllAnswers",{get:function(){return this.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>null}.bind(this)})}static componentType="answer";static acceptType=!0;static get stateVariablesShadowedForReference(){return["showCorrectness"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.weight={default:1},e.inline={default:!1,propagateToDescendants:!0},e.symbolicEquality={default:!1,propagateToDescendants:!0},e.fixedOrder={default:!1,propagateToDescendants:!0},e.size={default:10,propagateToDescendants:!0},e.forceFullCheckworkButton={default:!1},e.expandOnCompare={default:!1,propagateToDescendants:!0},e.simplifyOnCompare={default:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],propagateToDescendants:!0},e.unorderedCompare={default:!1,propagateToDescendants:!0},e.allowedErrorInNumbers={default:0,propagateToDescendants:!0},e.includeErrorInNumberExponents={default:!1,propagateToDescendants:!0},e.allowedErrorIsAbsolute={default:!1,propagateToDescendants:!0},e.nSignErrorsMatched={default:0,propagateToDescendants:!0},e.feedbackDefinitions={propagateToDescendants:!0,mergeArrays:!0},e.prefill={propagateToDescendants:!0,default:""},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:r,componentProps:i}){let a;return i.type?a=i.type:a="math",["math","text"].includes(a)||(console.warn(`Invalid type ${a}`),a="math"),{success:!0,newChildren:[{componentType:"award",children:[{componentType:a,children:r}]}]}};t.push({childrenRegex:"s",replacementFunction:e});function n({matchedChildren:r,componentProps:i,componentInfoObjects:a}){let s=!1;for(let c of r){if(a.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"_input"}))return{success:!1};if(a.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"considerAsResponses"}))return{success:!1};(a.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"_composite"})||a.isInheritedComponentType({inheritedComponentType:c.componentType,baseComponentType:"award"})&&c.children&&!c.children.some(d=>a.isInheritedComponentType({inheritedComponentType:d.componentType,baseComponentType:"when"})))&&(s=!0)}if(!s)return{success:!1};let l=[{componentType:i.type==="text"?"textinput":"mathinput"},...r];return{success:!0,newChildren:l}}return t.push({replacementFunction:n}),t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroAwards",componentType:"award",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastZeroInputs",componentType:"_input",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroConsiderAsResponses",componentType:"considerAsResponses",comparison:"atLeast",number:0}),a=e.newLeaf({name:"atMostOneShowCorrectness",componentType:"showCorrectness",comparison:"atMost",number:1,takePropertyChildren:!0}),s=e.newOperator({name:"awardsInputResponses",operator:"and",propositions:[n,r,i]});return e.newOperator({name:"answerChildLogic",operator:"and",propositions:[s,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.haveAwardThatRequiresInput={returnDependencies:()=>({awardChildren:{dependencyType:"child",childLogicName:"atLeastZeroAwards",variableNames:["requireInputInAnswer"]}}),definition({dependencyValues:e}){return{newValues:{haveAwardThatRequiresInput:e.awardChildren.some(n=>n.stateValues.requireInputInAnswer)}}}},t.allInputChildren={returnDependencies:()=>({allInputChildren:{dependencyType:"child",childLogicName:"atLeastZeroInputs"}}),definition({dependencyValues:e}){return{newValues:{allInputChildren:e.allInputChildren}}}},t.inputChild={stateVariablesDeterminingDependencies:["allInputChildren"],additionalStateVariablesDefined:["inputChildIndex"],forRenderer:!0,returnDependencies({stateValues:e}){let n={allInputChildren:{dependencyType:"stateVariable",variableName:"allInputChildren"},haveAwardThatRequiresInput:{dependencyType:"stateVariable",variableName:"haveAwardThatRequiresInput"}};for(let[r,i]of e.allInputChildren.entries())n[`child${r}FromSugar`]={dependencyType:"doenetAttribute",componentName:i.componentName,attributeName:"createdFromSugar"};return n},definition({dependencyValues:e}){let n=null,r=null;for(let[i,a]of e.allInputChildren.entries())if(e[`child${i}FromSugar`])e.haveAwardThatRequiresInput&&!n&&(n=a,r=i);else{n=a,r=i;break}return{newValues:{inputChild:n,inputChildIndex:r}}}},t.inputChildWithValues={stateVariablesDeterminingDependencies:["inputChildIndex"],forRenderer:!0,returnDependencies:({stateValues:e})=>({inputChild:{dependencyType:"child",childLogicName:"atLeastZeroInputs",variableNames:["valueToRecordOnSubmit","valueRecordedAtSubmit","value","immediateValue"],childIndices:[e.inputChildIndex],variablesOptional:!0}}),definition:function({dependencyValues:e}){return e.inputChild.length===1?{newValues:{inputChildWithValues:e.inputChild[0]}}:{newValues:{inputChildWithValues:null}}}},t.awardInputResponseChildren={returnDependencies:()=>({awardInputResponseChildren:{dependencyType:"child",childLogicName:"awardsInputResponses"}}),definition:({dependencyValues:e})=>({newValues:{awardInputResponseChildren:e.awardInputResponseChildren}})},t.nResponses={stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnDependencies({stateValues:e,componentInfoObjects:n}){let r={childTypes:{dependencyType:"value",value:e.awardInputResponseChildren.map(i=>i.componentType)}};for(let[i,a]of e.awardInputResponseChildren.entries())n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"award"})?r["child"+i]={dependencyType:"descendant",ancestorName:a.componentName,componentTypes:["_base"],variableNames:["isResponse","nValues"],variablesOptional:!0,requireChildLogicInitiallySatisfied:!0,recurseToMatchedChildren:!0,includePropertyChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_input"})?r["childNValues"+i]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"nValues",variablesOptional:!0}:r["child"+i]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"childrenWithNValues"};return r},definition({dependencyValues:e,componentInfoObjects:n}){let r=0;for(let[i,a]of e.childTypes.entries())if(n.isInheritedComponentType({inheritedComponentType:a,baseComponentType:"award"}))for(let s of e["child"+i])!s.stateValues.isResponse||n.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"_composite"})||(s.stateValues.nValues===void 0?r+=1:r+=s.stateValues.nValues);else if(n.isInheritedComponentType({inheritedComponentType:a,baseComponentType:"_input"})){let s=e["childNValues"+i];s===void 0?r+=1:r+=s}else for(let s of e["child"+i])s.stateValues.nValues===void 0?r+=1:r+=s.stateValues.nValues;return{newValues:{nResponses:r}}}},t.currentResponses={public:!0,isArray:!0,entryPrefixes:["currentResponse"],hasVariableComponentType:!0,defaultEntryValue:"\uFF3F",stateVariablesDeterminingDependencies:["awardInputResponseChildren"],returnArraySizeDependencies:()=>({nResponses:{dependencyType:"stateVariable",variableName:"nResponses"}}),returnArraySize({dependencyValues:e}){return[e.nResponses]},returnArrayDependenciesByKey({stateValues:e,componentInfoObjects:n}){let r={childTypes:{dependencyType:"value",value:e.awardInputResponseChildren.map(i=>i.componentType)}};for(let[i,a]of e.awardInputResponseChildren.entries())n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"award"})?r["child"+i]={dependencyType:"descendant",ancestorName:a.componentName,componentTypes:["_base"],variableNames:["isResponse","value","values","componentType"],variablesOptional:!0,requireChildLogicInitiallySatisfied:!0,recurseToMatchedChildren:!0,includePropertyChildren:!0,includeNonActiveChildren:!0,skipOverAdapters:!0}:n.isInheritedComponentType({inheritedComponentType:a.componentType,baseComponentType:"_input"})?(r["childValue"+i]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"value",variablesOptional:!0},r["childValues"+i]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"values",variablesOptional:!0},r["childComponentType"+i]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"componentType",variablesOptional:!0}):r["child"+i]={dependencyType:"stateVariable",componentName:a.componentName,variableName:"childrenAsResponses"};return{globalDependencies:r}},arrayDefinitionByKey({globalDependencyValues:e,componentInfoObjects:n}){let r=[],i=[],a=[];for(let[s,o]of e.childTypes.entries())if(n.isInheritedComponentType({inheritedComponentType:o,baseComponentType:"award"}))for(let l of e["child"+s])!l.stateValues.isResponse||n.isInheritedComponentType({inheritedComponentType:l.componentType,baseComponentType:"_composite"})||a.push(l);else if(n.isInheritedComponentType({inheritedComponentType:o,baseComponentType:"_input"})){let l={componentType:o,stateValues:{value:e["childValue"+s],values:e["childValues"+s],componentType:e["childComponentType"+s]}};a.push(l)}else a.push(...e["child"+s]);for(let s of a){let o=s.stateValues.componentType;o||(o=s.componentType),Array.isArray(s.stateValues.values)?(r.push(...s.stateValues.values),i.push(...Array(s.stateValues.values.length).fill(o))):(r.push(s.stateValues.value),i.push(o))}return{newValues:{currentResponses:r},setComponentType:{currentResponses:i}}}},t.currentResponse={isAlias:!0,targetVariableName:"currentResponse1"},t.nSubmittedResponses={public:!0,componentType:"number",returnDependencies:()=>({nResponses:{dependencyType:"stateVariable",variableName:"nResponses"}}),definition:({dependencyValues:e})=>({useEssentialOrDefaultValue:{nSubmittedResponses:{variablesToCheck:["nSubmittedResponses"],defaultValue:0}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"nSubmittedResponses",value:e.nSubmittedResponses}]}}},t.submittedResponsesComponentType={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submittedResponsesComponentType:{variablesToCheck:["submittedResponsesComponentType"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return e.submittedResponsesComponentType?{success:!0,instructions:[{setStateVariable:"submittedResponsesComponentType",value:[...e.submittedResponsesComponentType]}]}:{success:!0,instructions:[{setStateVariable:"submittedResponsesComponentType",value:[]}]}}},t.submittedResponses={public:!0,isArray:!0,entryPrefixes:["submittedResponse"],defaultEntryValue:"\uFF3F",essential:!0,componentType:"math",hasVariableComponentType:!0,returnArraySizeDependencies:()=>({nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}),returnArraySize({dependencyValues:e}){return[e.nSubmittedResponses]},returnArrayDependenciesByKey(){return{globalDependencies:{submittedResponsesComponentType:{dependencyType:"stateVariable",variableName:"submittedResponsesComponentType"},nSubmittedResponses:{dependencyType:"stateVariable",variableName:"nSubmittedResponses"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n=[];e.submittedResponsesComponentType&&n.push(...e.submittedResponsesComponentType.slice(0,e.nSubmittedResponses));let r={};for(let i=0;i<e.nSubmittedResponses;i++)r[i]={variablesToCheck:[{variableName:"submittedResponses",arrayIndex:i}]},n[i]||(n[i]="math");return{useEssentialOrDefaultValue:{submittedResponses:r},setComponentType:{submittedResponses:n}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"nSubmittedResponses",desiredValue:e.submittedResponses.length},{setStateVariable:"submittedResponses",value:[...e.submittedResponses]}]}}},t.submittedResponse={isAlias:!0,targetVariableName:"submittedResponse1"},t.delegateCheckWork={additionalStateVariablesDefined:["delegateCheckWorkToInput","delegateCheckWorkToAncestor",{variableName:"submitAllAnswersAtAncestor",forRenderer:!0}],forRenderer:!0,returnDependencies:()=>({inputChild:{dependencyType:"stateVariable",variableName:"inputChild"},forceFullCheckworkButton:{dependencyType:"stateVariable",variableName:"forceFullCheckworkButton"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningcomponent",variableNames:["suppressAnswerSubmitButtons","componentNameForSubmitAll","answerDelegatedForSubmitAll","justSubmittedForSubmitAll","creditAchievedForSubmitAll"]}}),definition:function({dependencyValues:e,componentName:n}){let r=!1,i=!1,a=!1,s=null;if(e.sectionAncestor){let o=e.sectionAncestor.stateValues;o.suppressAnswerSubmitButtons&&(o.answerDelegatedForSubmitAll===n?s=o.componentNameForSubmitAll:r=a=!0)}return!r&&e.inputChild&&!e.forceFullCheckworkButton&&(i=a=!0),{newValues:{delegateCheckWork:a,delegateCheckWorkToAncestor:r,delegateCheckWorkToInput:i,submitAllAnswersAtAncestor:s}}}},t.creditAchievedIfSubmit={additionalStateVariablesDefined:["awardUsedIfSubmit","awardChildren","inputUsedIfSubmit"],stateVariablesDeterminingDependencies:["inputChildIndex"],returnDependencies:({stateValues:e})=>({awardChildren:{dependencyType:"child",childLogicName:"atLeastZeroAwards",variableNames:["credit","creditAchieved","fractionSatisfied"]},inputChild:{dependencyType:"child",childLogicName:"atLeastZeroInputs",variableNames:["creditAchievedIfSubmit"],childIndices:[e.inputChildIndex],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=0,r=null,i=null;if(e.awardChildren.length===0){if(e.inputChild.length===1){let a=e.inputChild[0].stateValues.creditAchievedIfSubmit;a>=0&&(n=a,i=e.inputChild[0].componentName)}}else for(let a of e.awardChildren)if(Math.max(0,Math.min(1,a.stateValues.credit))>n||r===null){let o=a.stateValues.creditAchieved;a.stateValues.fractionSatisfied>0&&(o>n||r===null)&&(n=o,r=a.componentName)}return{newValues:{creditAchievedIfSubmit:n,awardUsedIfSubmit:r,awardChildren:e.awardChildren,inputUsedIfSubmit:i}}}},t.creditAchieved={defaultValue:0,public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchieved:{variablesToCheck:["creditAchieved"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"creditAchieved",value:e.creditAchieved}]}}},t.responseHasBeenSubmitted={public:!0,componentType:"boolean",defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{responseHasBeenSubmitted:{variablesToCheck:["responseHasBeenSubmitted"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"responseHasBeenSubmitted",value:e.responseHasBeenSubmitted}]}}},t.creditAchievedDependencies={returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"recursiveDependencyValues",variableName:"creditAchievedIfSubmit",changedValuesOnly:!0}}),definition({dependencyValues:e}){return{newValues:{creditAchievedDependencies:e.currentCreditAchievedDependencies}}}},t.creditAchievedDependenciesAtSubmit={defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{creditAchievedDependenciesAtSubmit:{variablesToCheck:["creditAchievedDependenciesAtSubmit"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"creditAchievedDependenciesAtSubmit",value:e.creditAchievedDependenciesAtSubmit}]}}},t.justSubmitted={forRenderer:!0,returnDependencies:()=>({currentCreditAchievedDependencies:{dependencyType:"stateVariable",variableName:"creditAchievedDependencies"},creditAchievedDependenciesAtSubmit:{dependencyType:"stateVariable",variableName:"creditAchievedDependenciesAtSubmit"}}),definition:function({dependencyValues:e}){return{newValues:{justSubmitted:Wt(e.currentCreditAchievedDependencies,e.creditAchievedDependenciesAtSubmit)}}}},t.creditAchievedForSubmitButton={additionalStateVariablesDefined:[{variableName:"justSubmittedForSubmitButton",forRenderer:!0}],forRenderer:!0,returnDependencies:()=>({creditAchieved:{dependencyType:"stateVariable",variableName:"creditAchieved"},justSubmitted:{dependencyType:"stateVariable",variableName:"justSubmitted"},submitAllAnswersAtAncestor:{dependencyType:"stateVariable",variableName:"submitAllAnswersAtAncestor"},sectionAncestor:{dependencyType:"ancestor",componentType:"_sectioningcomponent",variableNames:["justSubmittedForSubmitAll","creditAchievedForSubmitAll"]}}),definition({dependencyValues:e}){if(e.submitAllAnswersAtAncestor){let n=e.sectionAncestor.stateValues;return{newValues:{creditAchievedForSubmitButton:n.creditAchievedForSubmitAll,justSubmittedForSubmitButton:n.justSubmittedForSubmitAll}}}else return{newValues:{creditAchievedForSubmitButton:e.creditAchieved,justSubmittedForSubmitButton:e.justSubmitted}}}},t.feedbacks={public:!0,componentType:"feedback",isArray:!0,entireArrayAtOnce:!0,entryPrefixes:["feedback"],returnDependencies:()=>({awardChildren:{dependencyType:"child",childLogicName:"atLeastZeroAwards",variableNames:["feedbacks"]},feedbackComponents:{dependencyType:"descendant",componentTypes:["_input"],variableNames:["feedbacks"],variablesOptional:!0}}),entireArrayDefinition:function({dependencyValues:e}){let n=[];for(let r of e.awardChildren)n.push(...r.stateValues.feedbacks);for(let r of e.feedbackComponents)Array.isArray(r.stateValues.feedbacks)&&n.push(...r.stateValues.feedbacks);return{newValues:{feedbacks:n}}}},t.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"},showCorrectnessChild:{dependencyType:"child",childLogicName:"atMostOneShowCorrectness",variableNames:["value"]}}),definition({dependencyValues:e}){let n;return e.showCorrectnessChild.length===1?n=e.showCorrectnessChild[0].stateValues.value:n=e.showCorrectnessFlag!==!1,{newValues:{showCorrectness:n}}}},t.childrenToRender={returnDependencies:()=>({inputChild:{dependencyType:"stateVariable",variableName:"inputChild"}}),definition:function({dependencyValues:e}){let n=[];return e.inputChild&&n.push(e.inputChild.componentName),{newValues:{childrenToRender:n}}}},t}actions={submitAnswer:this.submitAnswer.bind(new Proxy(this,this.readOnlyProxyHandler))};submitAnswer(){let t=this.stateValues.creditAchievedIfSubmit,e=this.stateValues.awardUsedIfSubmit,n=this.stateValues.inputUsedIfSubmit,r=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchieved",value:t},{updateType:"updateValue",componentName:this.componentName,stateVariable:"responseHasBeenSubmitted",value:!0}];this.stateValues.inputChildWithValues&&n===this.stateValues.inputChildWithValues.componentName&&"valueToRecordOnSubmit"in this.stateValues.inputChildWithValues.stateValues&&"valueRecordedAtSubmit"in this.stateValues.inputChildWithValues.stateValues&&r.push({updateType:"updateValue",componentName:this.stateValues.inputChildWithValues.componentName,stateVariable:"valueRecordedAtSubmit",value:this.stateValues.inputChildWithValues.stateValues.valueToRecordOnSubmit}),r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponses",value:this.stateValues.currentResponses}),r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"submittedResponsesComponentType",value:this.state.currentResponses.componentType}),r.push({updateType:"updateValue",componentName:this.componentName,stateVariable:"creditAchievedDependenciesAtSubmit",value:this.stateValues.creditAchievedDependencies});for(let a of this.stateValues.awardChildren){let s=a.componentName===e;r.push({updateType:"updateValue",componentName:a.componentName,stateVariable:"awarded",value:s})}let i=[];for(let a of this.stateValues.currentResponses)a.toString?i.push(a.toString()):i.push(a);this.coreFunctions.requestUpdate({updateInstructions:r,event:{verb:"submitted",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.currentResponses,responseText:i,creditAchieved:t}}})}},_f=ys;import kv from"../_snowpack/pkg/math-expressions.js";var bs=class extends R{static componentType="award";static rendererType=void 0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.credit={default:1},e.matchPartial={default:!1,propagateToDescendants:!0},e.symbolicEquality={default:!1,propagateToDescendants:!0},e.expandOnCompare={default:!1,propagateToDescendants:!0},e.simplifyOnCompare={default:"none",toLowerCase:!0,valueTransformations:{"":"full",true:"full"},validValues:["none","full","numbers","numbersepreserveorder"],propagateToDescendants:!0},e.unorderedCompare={default:!1,propagateToDescendants:!0},e.allowedErrorInNumbers={default:0,propagateToDescendants:!0},e.includeErrorInNumberExponents={default:!1,propagateToDescendants:!0},e.allowedErrorIsAbsolute={default:!1,propagateToDescendants:!0},e.nSignErrorsMatched={default:0,propagateToDescendants:!0},e.feedbackCodes={default:[]},e.feedbackText={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneWhen",componentType:"when",number:1}),r=e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1}),i=e.newLeaf({name:"exactlyOneText",componentType:"text",number:1});return e.newOperator({name:"whenXorStringXorMathXorText",operator:"xor",propositions:[n,r,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.parsedExpression={additionalStateVariablesDefined:["requireInputInAnswer"],returnDependencies:()=>({mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath"},textChild:{dependencyType:"child",childLogicName:"exactlyOneText"}}),definition:function({dependencyValues:e}){let n=null,r=!1;return(e.mathChild.length===1||e.textChild.length===1)&&(r=!0,n=kv.fromAst(["=","comp1","comp2"])),{newValues:{parsedExpression:n,requireInputInAnswer:r}}}},t.creditAchieved={additionalStateVariablesDefined:["fractionSatisfied"],returnDependencies:()=>({credit:{dependencyType:"stateVariable",variableName:"credit"},whenChild:{dependencyType:"child",childLogicName:"exactlyOneWhen",variableNames:["fractionSatisfied"]},mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath",variableNames:["value","unordered","expand","simplify"]},textChild:{dependencyType:"child",childLogicName:"exactlyOneText",variableNames:["value"]},answerInput:{dependencyType:"parentStateVariable",variableName:"inputChildWithValues"},parsedExpression:{dependencyType:"stateVariable",variableName:"parsedExpression"},matchPartial:{dependencyType:"stateVariable",variableName:"matchPartial"},symbolicEquality:{dependencyType:"stateVariable",variableName:"symbolicEquality"},expandOnCompare:{dependencyType:"stateVariable",variableName:"expandOnCompare"},simplifyOnCompare:{dependencyType:"stateVariable",variableName:"simplifyOnCompare"},unorderedCompare:{dependencyType:"stateVariable",variableName:"unorderedCompare"},allowedErrorInNumbers:{dependencyType:"stateVariable",variableName:"allowedErrorInNumbers"},includeErrorInNumberExponents:{dependencyType:"stateVariable",variableName:"includeErrorInNumberExponents"},allowedErrorIsAbsolute:{dependencyType:"stateVariable",variableName:"allowedErrorIsAbsolute"},nSignErrorsMatched:{dependencyType:"stateVariable",variableName:"nSignErrorsMatched"}}),definition:function({dependencyValues:e,usedDefault:n}){let r;if(e.whenChild.length===1)r=e.whenChild[0].stateValues.fractionSatisfied;else{if(!e.answerInput||!e.parsedExpression)return{newValues:{creditAchieved:0,fractionSatisfied:0}};r=Mv({dependencyValues:e,usedDefault:n})}let i=0;return Number.isFinite(e.credit)&&(i=Math.max(0,Math.min(1,e.credit))*Math.max(0,Math.min(1,r))),{newValues:{fractionSatisfied:r,creditAchieved:i}}}},t.awarded={public:!0,componentType:"boolean",defaultValue:!1,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{awarded:{variablesToCheck:"awarded"}}}),inverseDefinition:function({desiredStateVariableValues:e,initialChange:n}){return n?{success:!0,instructions:[{setStateVariable:"awarded",value:e.awarded}]}:{success:!1}}},t.feedbacks={public:!0,componentType:"feedback",isArray:!0,entireArrayAtOnce:!0,entryPrefixes:["feedback"],returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitions:{dependencyType:"parentStateVariable",variableName:"feedbackDefinitions"},awarded:{dependencyType:"stateVariable",variableName:"awarded"}}),entireArrayDefinition:function({dependencyValues:e}){if(!e.awarded)return{newValues:{feedbacks:[]}};let n=[];for(let r of e.feedbackCodes){let i=r.toLowerCase();for(let a of e.feedbackDefinitions)if(i===a.feedbackCode){n.push(a.feedbackText);break}}return e.feedbackText!==null&&n.push(e.feedbackText),{newValues:{feedbacks:n}}}},t.feedback={isAlias:!0,targetVariableName:"feedback1"},t}adapters=["awarded"];static standardizedFeedback={numericalerror:"Credit reduced because numbers in your answer weren't quite right.  Did you round too much?",goodjob:"Good job!",onesignerror:"Credit reduced because it appears that you made a sign error.",twosignerrors:"Credit reduced because it appears that you made two sign errors."}},Bf=bs;function Mv({dependencyValues:u,usedDefault:t}){let e={mathChildrenByCode:{},mathlistChildrenByCode:{},textChildrenByCode:{},textlistChildrenByCode:{},booleanChildrenByCode:{},booleanlistChildrenByCode:{}};Object.assign(e,u);let n=u.unorderedCompare,r=u.simplifyOnCompare,i=u.expandOnCompare,a=t.unorderedCompare,s=t.simplifyOnCompare,o=t.expandOnCompare;if(u.textChild.length===1)e.textChildrenByCode.comp2=u.textChild[0];else if(u.mathChild.length===1){let d=u.mathChild[0];e.mathChildrenByCode.comp2=d,a&&d.stateValues.unordered&&(n=!0),o&&d.stateValues.expand&&(i=!0),s&&(d.stateValues.simplify==="full"?r="full":d.stateValues.simplify==="numbers"?r!=="full"&&(r="numbers"):d.stateValues.simplify==="numberspreserveorder"&&r!=="full"&&r!=="numbers"&&(r="numberspreserveorder"))}let l=u.answerInput.stateValues.immediateValue;l===void 0&&(l=u.answerInput.stateValues.value);let c={stateValues:{value:l}};return u.answerInput.componentType==="textinput"?e.textChildrenByCode.comp1=c:e.mathChildrenByCode.comp1=c,Rt({logicTree:u.parsedExpression.tree,unorderedCompare:n,simplifyOnCompare:r,expandOnCompare:i,dependencyValues:e})}var gs=class extends B{static componentType="_input";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.collaborateGroups={default:void 0},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nValues={returnDependencies:()=>({}),definition:()=>({newValues:{nValues:1}})},t.answerAncestor={returnDependencies:()=>({answerAncestor:{dependencyType:"ancestor",componentType:"answer",variableNames:["delegateCheckWorkToInput","justSubmittedForSubmitButton","creditAchievedForSubmitButton","submitAllAnswersAtAncestor","showCorrectness"]}}),definition:function({dependencyValues:e}){return{newValues:{answerAncestor:e.answerAncestor}}}},t.includeCheckWork={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let n=!1;return e.answerAncestor&&(n=e.answerAncestor.stateValues.delegateCheckWorkToInput),{newValues:{includeCheckWork:n}}}},t.creditAchievedForSubmitButton={defaultValue:0,public:!0,componentType:"number",forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let n=0;return e.answerAncestor&&(n=e.answerAncestor.stateValues.creditAchievedForSubmitButton),{newValues:{creditAchievedForSubmitButton:n}}}},t.valueHasBeenValidated={forRenderer:!0,returnDependencies:()=>({answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition:function({dependencyValues:e}){let n=!1;return e.answerAncestor&&e.answerAncestor.stateValues.justSubmittedForSubmitButton&&(n=!0),{newValues:{valueHasBeenValidated:n}}}},t.showCorrectness={forRenderer:!0,returnDependencies:()=>({showCorrectnessFlag:{dependencyType:"flag",flagName:"showCorrectness"},answerAncestor:{dependencyType:"stateVariable",variableName:"answerAncestor"}}),definition({dependencyValues:e}){let n;return e.answerAncestor?n=e.answerAncestor.stateValues.showCorrectness:n=e.showCorrectnessFlag!==!1,{newValues:{showCorrectness:n}}}},t}},et=gs;import $n from"../_snowpack/pkg/math-expressions.js";var vs=class extends et{constructor(t){super(t);this.actions={updateImmediateValue:this.updateImmediateValue.bind(new Proxy(this,this.readOnlyProxyHandler)),updateValue:this.updateValue.bind(new Proxy(this,this.readOnlyProxyHandler))},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="mathinput";static variableForPlainMacro="value";static get stateVariablesShadowedForReference(){return["value"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.prefill={default:""},e.format={default:"text"},e.size={default:10,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneBindValueTo",componentType:"bindValueTo",comparison:"atMost",number:1,setAsBase:!0,takePropertyChildren:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({bindValueToChild:{dependencyType:"child",childLogicName:"atMostOneBindValueTo",variableNames:["value","valueForDisplay"],requireChildLogicInitiallySatisfied:!0},prefill:{dependencyType:"stateVariable",variableName:"prefill"},format:{dependencyType:"stateVariable",variableName:"format"}}),definition:function({dependencyValues:e}){return e.bindValueToChild.length===0?{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",get defaultValue(){return _v({inputString:e.prefill,format:e.format})}}}}:{newValues:{value:re(e.bindValueToChild[0].stateValues.valueForDisplay)}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.bindValueToChild.length===1?{success:!0,instructions:[{setDependency:"bindValueToChild",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t.immediateValue={public:!0,componentType:"math",forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,changes:n}){return n.value?{newValues:{immediateValue:e.value},makeEssential:["immediateValue"]}:{useEssentialOrDefaultValue:{immediateValue:{variablesToCheck:"immediateValue",defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:n,shadowedVariable:r}){let i=[{setStateVariable:"immediateValue",value:e.immediateValue}];return n||r||i.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:i}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value.toString()}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"math"}})},t}updateImmediateValue({mathExpression:t}){this.stateValues.disabled||this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:t}],transient:!0})}updateValue(){if(!this.stateValues.disabled){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:this.stateValues.immediateValue},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}],e={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.immediateValue,responseText:this.stateValues.immediateValue.toString()}};this.stateValues.answerAncestor&&(e.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.requestUpdate({updateInstructions:t,event:e})}}},Ef=vs;function _v({inputString:u,format:t}){if(!u)return $n.fromAst("\uFF3F");let e;if(t==="latex")try{e=$n.fromLatex(u)}catch(n){console.warn(`Invalid latex for mathinput: ${u}`),e=$n.fromAst("\uFF3F")}else if(t==="text")try{e=$n.fromText(u)}catch(n){console.warn(`Invalid text for mathinput: ${u}`),e=$n.fromAst("\uFF3F")}return e}var Cs=class extends et{constructor(t){super(t);this.actions={updateImmediateValue:this.updateImmediateValue.bind(new Proxy(this,this.readOnlyProxyHandler)),updateValue:this.updateValue.bind(new Proxy(this,this.readOnlyProxyHandler))},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="textinput";static variableForPlainMacro="value";static get stateVariablesShadowedForReference(){return["value"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.prefill={default:""},e.size={default:10,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneBindValueTo",componentType:"bindValueTo",comparison:"atMost",number:1,takePropertyChildren:!0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({bindValueToChild:{dependencyType:"child",childLogicName:"atMostOneBindValueTo",variableNames:["text"],requireChildLogicInitiallySatisfied:!0},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueToChild.length===0?{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",defaultValue:e.prefill}}}:{newValues:{value:e.bindValueToChild[0].stateValues.text}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.bindValueToChild.length===1?{success:!0,instructions:[{setDependency:"bindValueToChild",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t.immediateValue={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e,changes:n}){return n.value?{newValues:{immediateValue:e.value},makeEssential:["immediateValue"]}:{useEssentialOrDefaultValue:{immediateValue:{variablesToCheck:"immediateValue",defaultValue:e.value}}}},inverseDefinition:function({desiredStateVariableValues:e,initialChange:n,shadowedVariable:r}){let i=[{setStateVariable:"immediateValue",value:e.immediateValue}];return n||r||i.push({setDependency:"value",desiredValue:e.immediateValue}),{success:!0,instructions:i}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"text"}})},t}updateImmediateValue({text:t}){this.stateValues.disabled||this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",value:t}]})}updateValue(){if(!this.stateValues.disabled){let t=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:this.stateValues.immediateValue},{updateType:"executeUpdate"},{updateType:"updateValue",componentName:this.componentName,stateVariable:"immediateValue",valueOfStateVariable:"value"}],e={verb:"answered",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.immediateValue,responseText:this.stateValues.immediateValue}};this.stateValues.answerAncestor&&(e.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.requestUpdate({updateInstructions:t,event:e})}}},$f=Cs;var Ts=class extends et{constructor(t){super(t);this.updateBoolean=this.updateBoolean.bind(new Proxy(this,this.readOnlyProxyHandler)),this.actions={updateBoolean:this.updateBoolean},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="booleaninput";static variableForPlainMacro="value";static get stateVariablesShadowedForReference(){return["value"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.prefill={default:"false"},e.label={default:"",forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneBindValueTo",componentType:"bindValueTo",comparison:"atMost",number:1,setAsBase:!0,takePropertyChildren:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={public:!0,componentType:"boolean",forRenderer:!0,returnDependencies:()=>({bindValueToChild:{dependencyType:"child",childLogicName:"atMostOneBindValueTo",variableNames:["value"],requireChildLogicInitiallySatisfied:!0},prefill:{dependencyType:"stateVariable",variableName:"prefill"}}),definition:function({dependencyValues:e}){return e.bindValueToChild.length===0?{useEssentialOrDefaultValue:{value:{variablesToCheck:"value",get defaultValue(){return e.prefill.trim().toLowerCase()==="true"}}}}:{newValues:{value:e.bindValueToChild[0].stateValues.value}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){return n.bindValueToChild.length===1?{success:!0,instructions:[{setDependency:"bindValueToChild",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setStateVariable:"value",value:e.value}]}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({value:{dependencyType:"stateVariable",variableName:"value"}}),definition:function({dependencyValues:e}){return{newValues:{text:e.value?"true":"false"}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"boolean"}})},t.submittedValue={defaultValue:null,public:!0,componentType:"boolean",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submittedValue:{variablesToCheck:["submittedValue"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"submittedValue",value:e.submittedValue}]}}},t}updateBoolean({boolean:t}){let e=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t}],n={verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.toString()}};this.stateValues.answerAncestor&&(n.context={answerAncestor:this.stateValues.answerAncestor.componentName}),this.coreFunctions.requestUpdate({updateInstructions:e,event:n})}},zf=Ts;var Ns=class extends et{constructor(t){super(t);this.actions={updateSelectedIndices:this.updateSelectedIndices.bind(new Proxy(this,this.readOnlyProxyHandler))},Object.defineProperty(this.actions,"submitAnswer",{get:function(){return this.stateValues.answerAncestor!==null?this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor!==null?()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.stateValues.submitAllAnswersAtAncestor,actionName:"submitAllAnswers"}):()=>this.coreFunctions.requestAction({componentName:this.stateValues.answerAncestor.componentName,actionName:"submitAnswer"}):()=>null}.bind(this)})}static componentType="choiceinput";static variableForPlainMacro="values";static createsVariants=!0;static get stateVariablesShadowedForReference(){return["choiceOrder","allSelectedIndices","indexMatchedByBoundValue"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.selectMultiple={default:!1},e.assignPartialCredit={default:!1},e.inline={default:!1,forRenderer:!0},e.fixedOrder={default:!1},e.feedbackDefinitions={propagateToDescendants:!0,mergeArrays:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroChoices",componentType:"choice",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atMostOneBindValueTo",componentType:"bindValueTo",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"choicesAndBind",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.numberChoices={public:!0,componentType:"number",returnDependencies:()=>({choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices"}}),definition({dependencyValues:e}){return{newValues:{numberChoices:e.choiceChildren.length}}}},t.choiceOrder={returnDependencies:({sharedParameters:e})=>({choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]},fixedOrder:{dependencyType:"stateVariable",variableName:"fixedOrder"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0},variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){let n=e.choiceChildren.length,r;if(e.fixedOrder)r=[...Array(n).keys()];else{if(e.variants&&e.variants.desiredVariant!==void 0){let i=e.variants.desiredVariant.indices;if(i!==void 0)if(i.length!==n)console.warn("Ignoring indices specified for choiceinput as number of indices doesn't match number of choice children.");else{if(i=i.map(Number),!i.every(Number.isInteger))throw Error("All indices specified for choiceinput must be integers");if(!i.every(a=>a>=0&&a<n))console.warn("Ignoring indices specified for choiceinput as some indices out of range.");else return{newValues:{choiceOrder:i}}}}r=[...Array(n).keys()];for(let i=n-1;i>0;i--){let a=e.selectRng.random(),s=Math.floor(a*(i+1));[r[i],r[s]]=[r[s],r[i]]}}return{newValues:{choiceOrder:r}}}},t.selectedVariantInfo={additionalStateVariablesDefined:["isVariantComponent"],returnDependencies:({componentInfoObjects:e})=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},fixedOrder:{dependencyType:"stateVariable",variableName:"fixedOrder"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){if(e.fixedOrder)return{newValues:{isVariantComponent:!1,selectedVariantInfo:null}};let n={indices:e.choiceOrder},r=n.subvariants=[];for(let i of e.variantDescendants)i.stateValues.isVariantComponent?r.push(i.stateValues.selectedVariantInfo):i.stateValues.selectedVariantInfo&&r.push(...i.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:n,isVariantComponent:!0}}}},t.choiceChildrenOrdered={additionalStateVariablesDefined:[{variableName:"numberChoices",public:!0,componentType:"number"}],returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices"}}),definition:function({dependencyValues:e}){let n=e.choiceChildren.length;return{newValues:{choiceChildrenOrdered:e.choiceOrder.map(i=>e.choiceChildren[i]),numberChoices:n}}}},t.choiceTexts={public:!0,componentType:"text",isArray:!0,entryPrefixes:["choiceText"],forRenderer:!0,returnArraySizeDependencies:()=>({numberChoices:{dependencyType:"stateVariable",variableName:"numberChoices"}}),returnArraySize({dependencyValues:e}){return[e.numberChoices]},returnArrayDependenciesByKey(){return{globalDependencies:{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]}}}},arrayDefinitionByKey({globalDependencyValues:e}){return{newValues:{choiceTexts:e.choiceOrder.map(r=>e.choiceChildren[r]).map(r=>r.stateValues.text)}}}},t.componentType={returnDependencies:()=>({}),definition:()=>({newValues:{componentType:"text"}})},t.indexMatchedByBoundValue={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]},bindValueToChild:{dependencyType:"child",childLogicName:"atMostOneBindValueTo",variableNames:["text"],requireChildLogicInitiallySatisfied:!0}}),definition({dependencyValues:e}){let n=e.choiceOrder.map(r=>e.choiceChildren[r]);if(e.bindValueToChild.length===1){let r=n.map(a=>a.stateValues.text.toLowerCase().trim()),i=e.bindValueToChild[0];if(i.stateValues.text){let a=r.indexOf(i.stateValues.text.toLowerCase().trim());if(a!==-1)return{newValues:{indexMatchedByBoundValue:a+1}}}}return{newValues:{indexMatchedByBoundValue:null}}}},t.allSelectedIndices={defaultValue:[],returnDependencies(){return{choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["text"]},indexMatchedByBoundValue:{dependencyType:"stateVariable",variableName:"indexMatchedByBoundValue"},bindValueToChild:{dependencyType:"child",childLogicName:"atMostOneBindValueTo",variableNames:["text"]}}},definition({dependencyValues:e}){if(e.bindValueToChild.length===1){let n;return e.indexMatchedByBoundValue!==null?n=[e.indexMatchedByBoundValue]:n=[],{newValues:{allSelectedIndices:n}}}else return{useEssentialOrDefaultValue:{allSelectedIndices:{variablesToCheck:["allSelectedIndices"]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){if(n.bindValueToChild.length===0)return{success:!0,instructions:[{setStateVariable:"allSelectedIndices",value:e.allSelectedIndices}]};{let r="";if(e.allSelectedIndices.length>0){let i=e.allSelectedIndices[0]-1,s=n.choiceOrder.map(o=>n.choiceChildren[o])[i];s&&(r=s.stateValues.text)}return{success:!0,instructions:[{setDependency:"bindValueToChild",desiredValue:r,childIndex:0,variableIndex:0}]}}}},t.nSelectedIndices={returnDependencies:()=>({allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}),definition({dependencyValues:e}){return{newValues:{nSelectedIndices:e.allSelectedIndices.length}}}},t.selectedIndices={public:!0,componentType:"number",isArray:!0,entryPrefixes:["selectedIndex"],forRenderer:!0,defaultEntryValue:0,returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize({dependencyValues:e}){return[e.nSelectedIndices]},returnArrayDependenciesByKey(){return{globalDependencies:{allSelectedIndices:{dependencyType:"stateVariable",variableName:"allSelectedIndices"}}}},arrayDefinitionByKey({globalDependencyValues:e}){let n={};for(let r in e.allSelectedIndices)n[r]=e.allSelectedIndices[r];return{newValues:{selectedIndices:n}}}},t.selectedIndex={isAlias:!0,targetVariableName:"selectedIndex1"},t.selectedValues={public:!0,componentType:"text",isArray:!0,entryPrefixes:["selectedValue"],returnArraySizeDependencies:()=>({nSelectedIndices:{dependencyType:"stateVariable",variableName:"nSelectedIndices"}}),returnArraySize({dependencyValues:e}){return[e.nSelectedIndices]},returnArrayDependenciesByKey(){return{globalDependencies:{selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceTexts:{dependencyType:"stateVariable",variableName:"choiceTexts"}}}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:n}){let r={};for(let i in n)r[i]=e.choiceTexts[e.selectedIndices[i]-1];return{newValues:{selectedValues:r}}}},t.selectedValue={isAlias:!0,targetVariableName:"selectedValue1"},t.values={isAlias:!0,targetVariableName:"selectedValues"},t.nValues={isAlias:!0,targetVariableName:"nSelectedIndices"},t.childIndicesSelected={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"}}),definition({dependencyValues:e}){return{newValues:{childIndicesSelected:e.selectedIndices.map(r=>e.choiceOrder[r-1])}}}},t.creditAchievedIfSubmit={returnDependencies:()=>({choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["selected","credit"]},selectMultiple:{dependencyType:"stateVariable",variableName:"selectMultiple"},assignPartialCredit:{dependencyType:"stateVariable",variableName:"assignPartialCredit"}}),definition:function({dependencyValues:e}){let n=0;if(e.selectMultiple){let r=0,i=0,a=0;for(let s of e.choiceChildren)s.stateValues.selected?s.stateValues.credit===1?r++:i++:s.stateValues.credit===1&&a++;if(e.assignPartialCredit){let s=r+i+a;s===0?n=1:n=r/s}else i+a===0&&(n=1)}else for(let r of e.choiceChildren)if(r.stateValues.selected){n=r.stateValues.credit;break}return{newValues:{creditAchievedIfSubmit:n}}}},t.valueToRecordOnSubmit={isAlias:!0,targetVariableName:"selectedIndices"},t.submittedIndices={returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["submitted"]}}),definition({dependencyValues:e}){let n=[],r=e.choiceOrder.map(i=>e.choiceChildren[i]);for(let[i,a]of r.entries())a.stateValues.submitted&&n.push(i+1);return{newValues:{submittedIndices:n}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){let r=[];for(let[i,a]of n.choiceOrder.entries())r.push({setDependency:"choiceChildren",desiredValue:e.submittedIndices.includes(i+1),variableIndex:0,childIndex:a});return{success:!0,instructions:r}}},t.valueRecordedAtSubmit={isAlias:!0,targetVariableName:"submittedIndices"},t.feedbacks={public:!0,componentType:"feedbacktext",isArray:!0,entryPrefixes:["feedback"],entireArrayAtOnce:!0,returnDependencies:()=>({choiceOrder:{dependencyType:"stateVariable",variableName:"choiceOrder"},choiceChildren:{dependencyType:"child",childLogicName:"atLeastZeroChoices",variableNames:["feedbacks"]}}),entireArrayDefinition({dependencyValues:e}){let n=e.choiceOrder.map(i=>e.choiceChildren[i]),r=[];for(let i of n)r.push(...i.stateValues.feedbacks);return{newValues:{feedbacks:r}}}},t.childrenToRender={returnDependencies:()=>({choiceChildrenOrdered:{dependencyType:"stateVariable",variableName:"choiceChildrenOrdered"},inline:{dependencyType:"stateVariable",variableName:"inline"}}),definition:function({dependencyValues:e}){return e.inline?{newValues:{childrenToRender:[]}}:{newValues:{childrenToRender:e.choiceChildrenOrdered.map(n=>n.componentName)}}}},t}updateSelectedIndices({selectedIndices:t}){this.stateValues.disabled||this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"allSelectedIndices",value:t}],event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.map(e=>this.stateValues.choiceTexts[e-1])}}})}},jf=Ns;var xs=class extends B{static componentType="choice";static rendererType="container";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.credit={default:0},e.feedbackCodes={default:[]},e.feedbackText={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroChildren",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.text={public:!0,componentType:this.componentType,returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroChildren",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n="";for(let r of e.inlineChildren)typeof r.stateValues.text=="string"&&(n+=r.stateValues.text);return{newValues:{text:n}}}},t.selected={defaultValue:!1,public:!0,componentType:"boolean",returnDependencies:()=>({countAmongSiblings:{dependencyType:"countAmongSiblingsOfSameType"},childIndicesSelected:{dependencyType:"parentStateVariable",variableName:"childIndicesSelected"}}),definition({dependencyValues:e}){return{newValues:{selected:e.childIndicesSelected.includes(e.countAmongSiblings-1)}}},inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"selected",value:e.selected}]}}},t.submitted={defaultValue:!1,public:!0,componentType:"boolean",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{submitted:{variablesToCheck:["submitted"]}}}),inverseDefinition:function({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"submitted",value:e.submitted}]}}},t.feedbacks={public:!0,componentType:"feedbacktext",isArray:!0,entireArrayAtOnce:!0,entryPrefixes:["feedback"],returnDependencies:()=>({feedbackText:{dependencyType:"stateVariable",variableName:"feedbackText"},feedbackCodes:{dependencyType:"stateVariable",variableName:"feedbackCodes"},feedbackDefinitions:{dependencyType:"parentStateVariable",variableName:"feedbackDefinitions"},submitted:{dependencyType:"stateVariable",variableName:"submitted"}}),entireArrayDefinition({dependencyValues:e}){if(!e.submitted)return{newValues:{feedbacks:[]}};let n=[];for(let r of e.feedbackCodes){let i=r.toLowerCase();for(let a of e.feedbackDefinitions)if(i===a.feedbackCode){n.push(a.feedbackText);break}}return e.feedbackText!==null&&n.push(e.feedbackText),{newValues:{feedbacks:n}}}},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroChildren"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}static includeBlankStringChildren=!0;adapters=["submitted"]},Hf=xs;var Vs=class extends Q{static componentType="graph";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.xmin={default:-10,forRenderer:!0},e.xmax={default:10,forRenderer:!0},e.ymin={default:-10,forRenderer:!0},e.ymax={default:10,forRenderer:!0},e.width={default:300},e.height={default:300},e.displayXAxis={default:!0,forRenderer:!0},e.displayYAxis={default:!0,forRenderer:!0},e.xlabel={default:"",forRenderer:!0},e.ylabel={default:"",forRenderer:!0},e.showNavigation={default:!0,forRenderer:!0},e}static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){return n[0].state.value.includes(",")?{success:!1}:{success:!0,newChildren:[{componentType:"curve",children:n}]}};return t.push({childrenRegex:"s",replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroGraphical",componentType:"_graphical",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.graphicalDescendants={forRenderer:!0,returnDependencies:()=>({graphicalDescendants:{dependencyType:"descendant",componentTypes:["_graphical"]}}),definition:function({dependencyValues:e}){return{newValues:{graphicalDescendants:e.graphicalDescendants}}}},t.numericalWidth={forRenderer:!0,returnDependencies:()=>({width:{dependencyType:"stateVariable",variableName:"width"}}),definition:({dependencyValues:e})=>({newValues:{numericalWidth:parseInt(e.width)}})},t.numericalHeight={forRenderer:!0,returnDependencies:()=>({height:{dependencyType:"stateVariable",variableName:"height"}}),definition:({dependencyValues:e})=>({newValues:{numericalHeight:parseInt(e.height)}})},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroGraphical"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}},qf=Vs;import"../_snowpack/pkg/math-expressions.js";var ws=class extends Ze{static componentType="variables";static additionalStateVariablesForProperties=["validVariables"];static stateVariableForPropertyValue="variables";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();t.variables={public:!0,componentType:"variable",isArray:!0,entryPrefixes:["var"],returnArraySizeDependencies:()=>({nComponents:{dependencyType:"stateVariable",variableName:"nComponents"}}),returnArraySize({dependencyValues:n}){return[n.nComponents]},returnArrayDependenciesByKey({arrayKeys:n}){let r={};for(let i of n)r[i]={math:{dependencyType:"stateVariable",variableName:"math"+(Number(i)+1)}};return{dependenciesByKey:r}},arrayDefinitionByKey({dependencyValuesByKey:n,arrayKeys:r}){let i={};for(let a of r)i[a]=n[a].math;return{newValues:{variables:i}}}};let e=this.componentType;return t.validVariables={returnDependencies:()=>({variables:{dependencyType:"stateVariable",variableName:"variables"}}),definition:function({dependencyValues:n}){let r=[];for(let i of n.variables){let a=i.tree,s=!0;typeof a=="string"?a==="\uFF3F"&&(s=!1):(!Array.isArray(a)||a[0]!=="_"||typeof a[1]!="string"||typeof a[2]!="string"&&typeof a[2]!="number")&&(s=!1),s||(console.warn("Invalid value for "+e),s=!1),r.push(s)}return{newValues:{validVariables:r}}}},t}},Kf=ws;import be from"../_snowpack/pkg/math-expressions.js";var Ds=class extends G{static componentType="sequence";static acceptType=!0;static assignNamesToReplacements=!0;static get stateVariablesShadowedForReference(){return["specifiedFrom","specifiedTo","specifiedLength","specifiedStep","specifiedExclude"]}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneFrom",componentType:"from",comparison:"atMost",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"atMostOneTo",componentType:"to",comparison:"atMost",number:1,takePropertyChildren:!0}),i=e.newLeaf({name:"atMostOneStep",componentType:"step",comparison:"atMost",number:1,takePropertyChildren:!0}),a=e.newLeaf({name:"atMostOnelength",componentType:"length",comparison:"atMost",number:1,takePropertyChildren:!0}),s=e.newLeaf({name:"atMostOneExclude",componentType:"exclude",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"sequenceLogic",operator:"and",propositions:[n,r,i,a,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();t.type={returnDependencies:()=>({type:{dependencyType:"doenetAttribute",attributeName:"type"}}),definition:function({dependencyValues:n}){return n.type?{newValues:{type:n.type}}:{newValues:{type:"number"}}}},t.specifiedFrom={returnDependencies:()=>({fromChild:{dependencyType:"child",childLogicName:"atMostOneFrom",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),defaultValue:null,definition:function({dependencyValues:n}){return n.fromChild.length===0?{useEssentialOrDefaultValue:{specifiedFrom:{variablesToCheck:["from","specifiedFrom"]}}}:n.fromChild[0].stateValues.value===null?{newValues:{specifiedFrom:NaN}}:{newValues:{specifiedFrom:n.fromChild[0].stateValues.value}}}},t.specifiedTo={returnDependencies:()=>({toChild:{dependencyType:"child",childLogicName:"atMostOneTo",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),defaultValue:null,definition:function({dependencyValues:n}){return n.toChild.length===0?{useEssentialOrDefaultValue:{specifiedTo:{variablesToCheck:["to","specifiedTo"]}}}:n.toChild[0].stateValues.value===null?{newValues:{specifiedTo:NaN}}:{newValues:{specifiedTo:n.toChild[0].stateValues.value}}}},t.specifiedLength={returnDependencies:()=>({lengthChild:{dependencyType:"child",childLogicName:"atMostOnelength",variableNames:["value"],requireChildLogicInitiallySatisfied:!0}}),defaultValue:null,definition:function({dependencyValues:n}){return n.lengthChild.length===0?{useEssentialOrDefaultValue:{specifiedLength:{variablesToCheck:["length","specifiedLength"]}}}:n.lengthChild[0].stateValues.value===null?{newValues:{specifiedLength:NaN}}:{newValues:{specifiedLength:n.lengthChild[0].stateValues.value}}}},t.specifiedStep={returnDependencies:()=>({stepChild:{dependencyType:"child",childLogicName:"atMostOneStep",variableNames:["value"],requireChildLogicInitiallySatisfied:!0},type:{dependencyType:"stateVariable",variableName:"type"}}),defaultValue:null,definition:function({dependencyValues:n}){if(n.stepChild.length===0)return{useEssentialOrDefaultValue:{specifiedStep:{variablesToCheck:["step","specifiedStep"]}}};let r=n.stepChild[0].stateValues.value;return r===null?{newValues:{specifiedStep:NaN}}:{newValues:{specifiedStep:r}}}},t.specifiedExclude={returnDependencies:()=>({excludeChildren:{dependencyType:"child",childLogicName:"atMostOneExclude",variableNames:["values"],requireChildLogicInitiallySatisfied:!0}}),defaultValue:[],definition:function({dependencyValues:n}){return n.excludeChildren.length===0?{useEssentialOrDefaultValue:{specifiedExclude:{variablesToCheck:["exclude"]}}}:{newValues:{specifiedExclude:n.excludeChildren[0].stateValues.values}}}},t.lowercase={returnDependencies:()=>({specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"}}),definition:function({dependencyValues:n}){let r=/^[A-Z]*$/,i=!0;return n.specifiedFrom!==null?r.test(n.specifiedFrom)&&(i=!1):n.specifiedTo!==null&&r.test(n.specifiedTo)&&(i=!1),{newValues:{lowercase:i}}}},t.validSequence={returnDependencies:()=>({specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"}}),definition:function({dependencyValues:n}){let r=!0;if(n.specifiedLength!==null&&(!Number.isInteger(n.specifiedLength)||n.specifiedLength<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),r=!1),n.specifiedStep!==null&&n.type!=="math"){let i=he(n.specifiedStep);Number.isFinite(i)||(console.warn("Invalid step of sequence.  Must be a number for sequence of type "+n.type+"."),r=!1)}if(n.specifiedFrom!==null)if(n.type==="number"){let i=he(n.specifiedFrom);Number.isFinite(i)||(console.warn("Invalid from of number sequence.  Must be a number"),r=!1)}else Number.isNaN(n.specifiedFrom)&&(console.warn("Invalid from of sequence"),r=!1);if(n.specifiedTo!==null)if(n.type==="number"){let i=he(n.specifiedTo);Number.isFinite(i)||(console.warn("Invalid from of number sequence.  Must be a number"),r=!1)}else Number.isNaN(n.specifiedTo)&&(console.warn("Invalid to of sequence"),r=!1);return{newValues:{validSequence:r}}}};let e=this;return t.from={additionalStateVariablesDefined:["step","length","exclude"],returnDependencies:()=>({specifiedFrom:{dependencyType:"stateVariable",variableName:"specifiedFrom"},specifiedTo:{dependencyType:"stateVariable",variableName:"specifiedTo"},specifiedLength:{dependencyType:"stateVariable",variableName:"specifiedLength"},specifiedStep:{dependencyType:"stateVariable",variableName:"specifiedStep"},type:{dependencyType:"stateVariable",variableName:"type"},specifiedExclude:{dependencyType:"stateVariable",variableName:"specifiedExclude"},validSequence:{dependencyType:"stateVariable",variableName:"validSequence"}}),definition:function({dependencyValues:n}){let r=n.specifiedFrom,i=n.specifiedTo,a=n.specifiedStep,s=n.specifiedLength,o=[...n.specifiedExclude],l=n.type;if(n.type==="math")i!==null&&(i instanceof be.class||(i=be.fromAst(i))),r!==null&&(r instanceof be.class||(r=be.fromAst(r))),a!==null&&(a instanceof be.class||(a=be.fromAst(a)));else if(a!==null&&a instanceof be.class&&(a=a.evaluate_to_constant()),n.type==="letters"){r!==null&&typeof r=="string"&&(r=wt(r)),i!==null&&typeof i=="string"&&(i=wt(i));for(let[c,d]of o.entries())typeof d=="string"&&(o[c]=wt(d))}else if(n.type==="number"){i!==null&&(i instanceof be.class?i=i.evaluate_to_constant():i=Number(i)),r!==null&&(r instanceof be.class?r=r.evaluate_to_constant():r=Number(r));for(let[c,d]of o.entries())d instanceof be.class?o[c]=d.evaluate_to_constant():o[c]=Number(d)}if(n.validSequence){let c=e.calculateSequenceParameters({from:r,to:i,step:a,length:s,type:l});return c.exclude=o,{newValues:c}}return(!Number.isInteger(s)||s<0)&&(s=0),{newValues:{from:r,step:a,length:s,exclude:o}}}},t.readyToExpand={returnDependencies:()=>({from:{dependencyType:"stateVariable",variableName:"from"},length:{dependencyType:"stateVariable",variableName:"length"},step:{dependencyType:"stateVariable",variableName:"step"},type:{dependencyType:"stateVariable",variableName:"type"},exclude:{dependencyType:"stateVariable",variableName:"exclude"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{newValues:{readyToExpand:!0}}}},t}static calculateSequenceParameters({from:t,to:e,step:n,length:r,type:i}){if(t===null)e===null?(i==="math"?t=be.fromAst(1):t=1,n===null&&(i==="math"?n=be.fromAst(1):n=1),r===null&&(r=10)):(n===null&&(i==="math"?n=be.fromAst(1):n=1),r===null&&(i==="math"?r=Math.floor(e.subtract(1).divide(n).evaluate_to_constant()+1):r=Math.floor((e-1)/n+1)),i==="math"?t=e.subtract(n.multiply(r-1)).simplify():(t=e-n*(r-1),i==="letters"&&t<1&&(r=Math.floor((e-1)/n+1),t=e-n*(r-1))));else if(e===null)n===null&&(i==="math"?n=be.fromAst(1):n=1),r===null&&(r=10);else if(n===null)r===null?i==="math"?(n=be.fromAst(1),r=Math.floor(e.subtract(t).add(1).evaluate_to_constant())):(n=1,r=Math.floor(e-t+1)):i==="math"?n=e.subtract(t).divide(r-1):(n=(e-t)/(r-1),i==="letters"&&(n=Math.floor(n)));else if(r===null)i==="math"?r=Math.floor(e.subtract(t).divide(n).add(1).evaluate_to_constant()):r=Math.floor((e-t)/n+1);else throw Error("Can't define from, to, step, and length for sequence");return(!Number.isInteger(r)||r<0)&&(console.warn("Invalid length of sequence.  Must be a non-negative integer."),r=0),{from:t,step:n,length:r}}static createSerializedReplacements({component:t,workspace:e,componentInfoObjects:n}){if(t.stateValues.readyToExpand,!t.stateValues.validSequence)return e.lastReplacementParameters={from:null,length:null,step:null,type:null,exclude:null},{replacements:[]};e.lastReplacementParameters={from:t.stateValues.from,length:t.stateValues.length,step:t.stateValues.step,type:t.stateValues.type,exclude:t.stateValues.exclude};let r=[],i=t.stateValues.length;for(let s=0;s<i;s++){let o=t.stateValues.from;if(s>0&&(t.stateValues.type==="math"?o=o.add(t.stateValues.step.multiply(be.fromAst(s))).expand().simplify():o+=t.stateValues.step*s),t.stateValues.type==="math"){if(t.stateValues.exclude.some(c=>c&&c.equals(o)))continue}else if(t.stateValues.exclude.includes(o))continue;t.stateValues.type==="letters"&&(o=_t(o,t.stateValues.lowercase));let l={componentType:t.stateValues.type,state:{value:o,fixed:!0},downstreamDependencies:{[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]}};r.push(l)}return{replacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:n}).serializedComponents}}static calculateReplacementChanges({component:t,workspace:e,componentInfoObjects:n}){t.stateValues.readyToExpand;let r=e.lastReplacementParameters,i=[];if(!t.stateValues.validSequence){if(t.replacements.length>0){let a=t.replacements.length,s={changeType:"changeReplacementsToWithhold",replacementsToWithhold:a};i.push(s)}return r.length=0,i}if(r.type!==t.stateValues.type||r.exclude.length>0||t.stateValues.exclude.length>0){let a=this.createSerializedReplacements({component:t,workspace:e,componentInfoObjects:n}).replacements,s={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:a,replacementsToWithhold:0};i.push(s)}else{let a=!1;t.stateValues.type==="math"?t.stateValues.from.equals(r.from)&&t.stateValues.step.equals(r.step)||(a=!0):(t.stateValues.from!==r.from||t.stateValues.step!==r.step)&&(a=!0);let s=r.length,o=0,l=0,c=s,d;if(t.stateValues.length<s){d=t.replacements.length-t.stateValues.length;let p={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};i.push(p)}else if(t.stateValues.length>s&&(o=t.stateValues.length-s,t.replacementsToWithhold>0))if(t.replacementsToWithhold>=o){d=t.replacementsToWithhold-o,l+=o,s+=o,o=0;let p={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};i.push(p)}else o-=t.replacementsToWithhold,l+=t.replacementsToWithhold,s+=t.replacementsToWithhold,d=0;if(a===!0&&(l=s,c=0),l>0)for(let p=c;p<c+l;p++){let m=t.stateValues.from;p>0&&(t.stateValues.type==="math"?m=m.add(t.stateValues.step.multiply(be.fromAst(p))).expand().simplify():m+=t.stateValues.step*p),t.stateValues.type==="letters"&&(m=_t(m,t.stateValues.lowercase));let f={changeType:"updateStateVariables",component:t.replacements[p],stateChanges:{value:m}};i.push(f)}if(o>0){let p=[];for(let h=s;h<t.stateValues.length;h++){let y=t.stateValues.from;h>0&&(t.stateValues.type==="math"?y=y.add(t.stateValues.step.multiply(be.fromAst(h))).expand().simplify():y+=t.stateValues.step*h),t.stateValues.type==="letters"&&(y=_t(y,t.stateValues.lowercase));let b={componentType:t.stateValues.type,state:{value:y,fixed:!0},downstreamDependencies:{[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]}};p.push(b)}let m=U({assignNames:t.doenetAttributes.assignNames,serializedComponents:p,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:n,indOffset:s}),f={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:s,serializedReplacements:m.serializedComponents,replacementsToWithhold:0,assignNamesOffset:s};i.push(f)}}return r.type=t.stateValues.type,r.from=t.stateValues.from,r.length=t.stateValues.length,r.step=t.stateValues.step,r.exclude=t.stateValues.exclude,i}get allPotentialRendererTypes(){return[this.componentInfoObjects.allComponentClasses[this.stateValues.type].rendererType]}},fn=Ds;function wt(u){u=u.toUpperCase();let t=0,e=u.length,n=e;for(;(n-=1)>-1;){let r=u.charCodeAt(n)-64;if(r<1||r>26){console.warn("Cannot convert "+u+" to a number");return}t+=r*Math.pow(26,e-1-n)}return t}function _t(u,t){u--;let e=65;t&&(e=97);let n="";for(;;){let r=u%26;if(n=String.fromCharCode(e+r)+n,u<26)break;u=Math.floor(u/26)-1}return n}var As=class extends G{static componentType="map";static assignNamesToReplacements=!0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.behavior={default:"combination",trim:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneTemplate",componentType:"template",number:1}),r=e.newLeaf({name:"atLeastOneSources",componentType:"sources",comparison:"atLeast",number:1});return e.newOperator({name:"templateSources",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nSources={additionalStateVariablesDefined:["sourcesNames","sourceAliases","sourceIndexAliases"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childLogicName:"atLeastOneSources",variableNames:["alias","indexAlias"]}}),definition:function({dependencyValues:e}){return{newValues:{nSources:e.sourcesChildren.length,sourcesNames:e.sourcesChildren.map(n=>n.componentName),sourceAliases:e.sourcesChildren.map(n=>n.stateValues.alias),sourceIndexAliases:e.sourcesChildren.map(n=>n.stateValues.indexAlias)}}}},t.nIterates={additionalStateVariablesDefined:["minNIterates","sourcesChildNames"],returnDependencies:()=>({sourcesChildren:{dependencyType:"child",childLogicName:"atLeastOneSources",variableNames:["numberOfChildren","childComponentNames"]}}),definition:function({dependencyValues:e}){let n=e.sourcesChildren.map(a=>a.stateValues.numberOfChildren),r=Math.min(...n),i=e.sourcesChildren.map(a=>[...a.stateValues.childComponentNames]);return{newValues:{nIterates:n,minNIterates:r,sourcesChildNames:i}}}},t.template={returnDependencies:()=>({templateChild:{dependencyType:"child",childLogicName:"exactlyOneTemplate",variableNames:["serializedChildren","newNamespace"]}}),definition:function({dependencyValues:e}){let n=e.templateChild[0];if(!n)return{newValues:{template:null}};let r=n.stateValues.serializedChildren,i={componentType:"template",state:{rendered:!0},children:r,originalName:n.componentName};return n.stateValues.newNamespace&&(i.doenetAttributes={newNamespace:!0}),{newValues:{template:i}}}},t.validBehavior={returnDependencies:()=>({behavior:{dependencyType:"stateVariable",variableName:"behavior"},nIterates:{dependencyType:"stateVariable",variableName:"nIterates"}}),definition:function({dependencyValues:e}){let n=!0;return e.behavior==="parallel"?e.nIterates.slice(1).some(r=>r!=e.nIterates[0])&&console.warn("Warning: map with parallel behavior and different numbers of iterates in sources activeChildren. Extra iterates will be ignored."):e.behavior!=="combination"&&(console.warn("Invalid map behavior: "+e.behavior),n=!1),{newValues:{validBehavior:n}}}},t.readyToExpand={returnDependencies:()=>({validBehavior:{dependencyType:"stateVariable",variableName:"validBehavior"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{newValues:{readyToExpand:!0}}}},t}static createSerializedReplacements({component:t,workspace:e,componentInfoObjects:n}){if(t.stateValues.readyToExpand,!t.stateValues.validBehavior)return e.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0},{replacements:[]};e.lastReplacementParameters={sourcesNames:t.stateValues.sourcesNames,sourcesChildNames:t.stateValues.sourcesChildNames,behavior:t.stateValues.behavior,nIterates:t.stateValues.nIterates,minNIterates:t.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]};let r=[];if(t.stateValues.behavior==="parallel")for(let i=0;i<t.stateValues.minNIterates;i++)r.push(...this.parallelReplacement({component:t,iter:i,componentInfoObjects:n}));else r=this.recurseThroughCombinations({component:t,sourcesNumber:0,iterateNumber:-1,componentInfoObjects:n}).replacements;return{replacements:r}}static parallelReplacement({component:t,iter:e,componentInfoObjects:n}){let r=[Z(t.stateValues.template)];return r[0].downstreamDependencies={[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]},r=U({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:n,indOffset:e,addEmpties:!1}).serializedComponents,Wf(r[0],t,Array(t.stateValues.nSources).fill(e)),r}static recurseThroughCombinations({component:t,sourcesNumber:e,childnumberArray:n=[],iterateNumber:r,componentInfoObjects:i}){let a=[],s=[...n,0];for(let o=0;o<t.stateValues.nIterates[e];o++)if(s[e]=o,e>=t.stateValues.nSources-1){r++;let l=[Z(t.stateValues.template)];l[0].downstreamDependencies={[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]};let d=U({assignNames:t.doenetAttributes.assignNames,serializedComponents:l,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:i,indOffset:r,addEmpties:!1}).serializedComponents[0];Wf(d,t,s),a.push(d)}else{let l=this.recurseThroughCombinations({component:t,sourcesNumber:e+1,childnumberArray:s,iterateNumber:r,componentInfoObjects:i});a.push(...l.replacements),r=l.iterateNumber}return{replacements:a,iterateNumber:r}}static calculateReplacementChanges({component:t,components:e,workspace:n,componentInfoObjects:r}){t.stateValues.readyToExpand;let i=[];if(!t.stateValues.validBehavior){if(n.lastReplacementParameters={sourcesNames:[],sourcesChildNames:[],behavior:void 0,nIterates:void 0,minNIterates:void 0,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},t.replacements.length>0){let h={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:t.replacements.length,replacementsToWithhold:0};i.push(h)}return i}let a=n.lastReplacementParameters,s=!1,o=!0;if(t.stateValues.nSources!==a.sourcesNames.length)o=!1;else for(let h=0;h<t.stateValues.nSources;h++)if(t.stateValues.sourcesNames[h]!==a.sourcesNames[h]){o=!1;break}if(!o||a.behavior!==t.stateValues.behavior)s=!0;else{let h=!0;if(a.nIterates===void 0)s=!0;else for(let y=0;y<t.stateValues.nSources;y++){let b=t.stateValues.nIterates[y],g=a.nIterates[y];b!==g&&(h=!1);let T=Math.min(b,g);for(let N=0;N<T;N++)if(t.stateValues.sourcesChildNames[y][N]!=a.sourcesChildNames[y][N]){s=!0,h=!1;break}if(s)break}if(h)return[];t.stateValues.behavior==="combination"&&t.stateValues.nSources>1&&(s=!0)}if(s){let h=this.createSerializedReplacements({component:t,workspace:n,componentInfoObjects:r}).replacements,y={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:h,replacementsToWithhold:0};return i.push(y),n.lastReplacementParameters={sourcesNames:t.stateValues.sourcesNames,sourcesChildNames:t.stateValues.sourcesChildNames,behavior:t.stateValues.behavior,nIterates:t.stateValues.nIterates,minNIterates:t.stateValues.minNIterates,replacementsToWithhold:0,withheldSubstitutionChildNames:[]},i}let l=t.stateValues.minNIterates,c=a.minNIterates,d=0,p=t.replacementsToWithhold;p||(p=0);let m=a.withheldSubstitutionChildNames,f=!1;if(l<c){for(let h=0;h<t.stateValues.nSources;h++)for(let y=l;y<c;y++)e[a.sourcesChildNames[h][y]]===void 0&&(f=!0);if(!f)for(let h of a.withheldSubstitutionChildNames)for(let y of h)e[y]===void 0&&(f=!0)}if(f){let h=Math.min(l,c),y=t.replacements.length-h,b={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:h,numberReplacementsToDelete:y,replacementsToWithhold:0};i.push(b),m=[],p=0}if(l<c){if(!f){d=t.replacements.length-l;let h={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};i.push(h);for(let y=0;y<t.stateValues.nSources;y++){let b=a.withheldSubstitutionChildNames[y];b?b=[...b]:b=[],b=new Set([...a.sourcesChildNames[y].slice(l),...b]),m[y]=b}}}else if(l>c){let h=l-c;if(p>0){let y=p;if(y>=h){d=p-h,h=0;let b={changeType:"changeReplacementsToWithhold",replacementsToWithhold:d};i.push(b)}else h-=y,c+=y,d=0}if(h>0){let y=[];for(let T=c;T<l;T++)y.push(...this.parallelReplacement({component:t,iter:T,componentInfoObjects:r}));let b=0;t.doenetAttributes.assignNames&&(b=t.doenetAttributes.assignNames.length);let g={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:c,serializedReplacements:y,replacementsToWithhold:0,assignNamesOffset:c};i.push(g)}}return n.lastReplacementParameters={sourcesNames:t.stateValues.sourcesNames,sourcesChildNames:t.stateValues.sourcesChildNames,behavior:t.stateValues.behavior,nIterates:t.stateValues.nIterates,minNIterates:l,replacementsToWithhold:d,withheldSubstitutionChildNames:m},i}static determineNumberOfUniqueVariants({serializedComponent:t}){return{success:!1}}get allPotentialRendererTypes(){let t=[];for(let e in this.allChildren){let n=this.allChildren[e].component;for(let r of n.allPotentialRendererTypes)t.includes(r)||t.push(r)}if(this.replacements)for(let e of this.replacements)for(let n of e.allPotentialRendererTypes)t.includes(n)||t.push(n);return t}},Uf=As;function Wf(u,t,e){let n=u.doenetAttributes.addToSharedParameters=[];for(let[r,i]of t.stateValues.sourceAliases.entries())if(i){let a=t.stateValues.sourcesNames[r];n.push({parameterName:"sourceNameMappings",key:i,value:{name:a,childNumber:e[r]}})}for(let[r,i]of t.stateValues.sourceIndexAliases.entries())i&&n.push({parameterName:"sourceIndexMappings",key:i,value:e[r]+1})}var Ss=class extends R{static componentType="sources";static rendererType="container";static acceptAlias=!0;static acceptIndexAlias=!0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroChildren",componentType:"_base",excludeComponentTypes:["_composite"],comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.alias={returnDependencies:()=>({alias:{dependencyType:"doenetAttribute",attributeName:"alias"}}),definition({dependencyValues:e}){return{newValues:{alias:e.alias}}}},t.indexAlias={returnDependencies:()=>({indexAlias:{dependencyType:"doenetAttribute",attributeName:"indexAlias"}}),definition({dependencyValues:e}){return{newValues:{indexAlias:e.indexAlias}}}},t.numberOfChildren={additionalStateVariablesDefined:["childComponentNames","childIdentities"],returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"atLeastZeroChildren",requireChildLogicInitiallySatisfied:!0}}),definition:function({dependencyValues:e}){let n=e.children.length,r=e.children.map(i=>i.componentName);return{newValues:{numberOfChildren:n,childComponentNames:r,childIdentities:e.children}}}},t.childrenToRender={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"atLeastZeroChildren"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.children.map(n=>n.componentName)}}}},t}},Gf=Ss;var Is=class extends R{constructor(t){super(t);this.changeValue=this.changeValue.bind(this),this.actions={changeValue:this.changeValue}}static componentType="slider";static variableForPlainMacro="value";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.width={default:300,forRenderer:!0},e.height={default:50,forRenderer:!0},e.initialNumber={default:void 0},e.initialText={default:void 0},e.label={default:void 0,forRenderer:!0},e.showControls={default:!1,forRenderer:!0},e.showTicks={default:!0,forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroNumbers",componentType:"number",comparison:"atLeast",number:0}),r=e.newLeaf({name:"atLeastOneTexts",componentType:"text",comparison:"atLeast",number:1}),i=e.newOperator({name:"numbersXorTextsXorSequence",operator:"xor",propositions:[r,n]}),a=e.newLeaf({name:"atMostOneMarkers",componentType:"markers",comparison:"atMost",number:1});return e.newOperator({name:"SliderLogic",operator:"and",propositions:[i,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.sliderType={forRenderer:!0,returnDependencies:()=>({textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts"},numberChildren:{dependencyType:"child",childLogicName:"atLeastZeroNumbers"}}),definition:function({dependencyValues:e}){let n;return e.textChildren.length>0?n="text":n="number",{newValues:{sliderType:n}}}},t.items={forRenderer:!0,public:!0,isArray:!0,entryPrefixes:["item"],entireArrayAtOnce:!0,returnDependencies:()=>({textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts",variableNames:["value"]},numberChildren:{dependencyType:"child",childLogicName:"atLeastZeroNumbers",variableNames:["value"]},sliderType:{dependencyType:"stateVariable",variableName:"sliderType"}}),entireArrayDefinition:function({dependencyValues:e}){let n;return e.sliderType==="text"?n=e.textChildren.map(r=>r.stateValues.value):e.numberChildren.length>0?(n=e.numberChildren.map(r=>r.stateValues.value),n.sort((r,i)=>r-i)):n=[...Array(11).keys()],{newValues:{items:n},setComponentType:{items:e.sliderType}}}},t.valueToIndex={forRenderer:!0,returnDependencies:()=>({items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:e}){let n={};for(let[r,i]of e.items.entries())n[i]=r;return{newValues:{valueToIndex:n}}}},t.preliminaryValue={returnDependencies:()=>({sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},initialNumber:{dependencyType:"stateVariable",variableName:"initialNumber"},initialText:{dependencyType:"stateVariable",variableName:"initialText"}}),definition({dependencyValues:e}){return{useEssentialOrDefaultValue:{preliminaryValue:{variablesToCheck:"value",get defaultValue(){return e.sliderType==="text"?e.initialText:e.initialNumber}}}}}},t.index={forRenderer:!0,returnDependencies:()=>({sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},valueToIndex:{dependencyType:"stateVariable",variableName:"valueToIndex"},items:{dependencyType:"stateVariable",variableName:"items"},preliminaryValue:{dependencyType:"stateVariable",variableName:"preliminaryValue"}}),definition:function({dependencyValues:e}){let n=Xf(e),r=0;return n!==void 0&&(r=e.valueToIndex[n]),{newValues:{index:r}}}},t.value={forRenderer:!0,public:!0,essential:!0,returnDependencies:()=>({sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},items:{dependencyType:"stateVariable",variableName:"items"},index:{dependencyType:"stateVariable",variableName:"index"}}),definition:function({dependencyValues:e}){return{newValues:{value:e.items[e.index]},setComponentType:{value:e.sliderType}}},inverseDefinition:Bv},t.markers={forRenderer:!0,returnDependencies:()=>({markersChild:{dependencyType:"child",childLogicName:"atMostOneMarkers",variableNames:["markerType","markers"]},sliderType:{dependencyType:"stateVariable",variableName:"sliderType"},items:{dependencyType:"stateVariable",variableName:"items"}}),definition:function({dependencyValues:e}){let n=[];if(e.markersChild.length===1){let r=e.markersChild[0].stateValues.markerType;r==="empty"?n=[...e.items]:r!==e.sliderType?(console.warn("Markers type doesn't match slider type."),n=[]):n=e.markersChild[0].stateValues.markers}return{newValues:{markers:n}}}},t}changeValue({value:t,transient:e}){this.stateValues.disabled||(e?this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t}],transient:e}):this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"value",value:t}],event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:t,responseText:t.toString()}}}))}},Zf=Is;function Xf({preliminaryValue:u,valueToIndex:t,sliderType:e,items:n}){let r=u;if(t[r]!==void 0)return r;if(e==="text")return;let a=function(o=0,l=n.length-1){if(l<=o+1)return r>n[o]?l:o;let c=Math.round((l+o)/2);return r>n[c]?a(c,l):a(o,c)},s=a();if(s===0)r=n[0];else{let o=n[s-1],l=n[s],c=Math.abs(r-o),d=Math.abs(r-l);c<d?r=o:r=l}return r}function Bv({desiredStateVariableValues:u,stateValues:t}){let e=Xf({preliminaryValue:u.value,valueToIndex:t.valueToIndex,sliderType:t.sliderType,items:t.items});return e===void 0?{success:!1}:{success:!0,instructions:[{setStateVariable:"value",value:e},{setStateVariable:"preliminaryValue",value:e}]}}var Ps=class extends R{static componentType="markers";static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastOneNumbers",componentType:"number",comparison:"atLeast",number:1}),r=e.newLeaf({name:"atLeastOneTexts",componentType:"text",comparison:"atLeast",number:1}),i=e.newLeaf({name:"noTexts",componentType:"text",comparison:"exactly",number:0,allowSpillover:!1}),a=e.newLeaf({name:"noNumbers",componentType:"number",comparison:"exactly",number:0,allowSpillover:!1}),s=e.newOperator({name:"noTextAndNoNumbers",operator:"and",propositions:[a,i]});return e.newOperator({name:"MarkerLogic",operator:"xor",propositions:[n,r,s],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.markerType={public:!0,componentType:"text",returnDependencies:()=>({textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts"},numberChildren:{dependencyType:"child",childLogicName:"atLeastOneNumbers"}}),definition:function({dependencyValues:e}){let n;return e.textChildren.length>0?n="text":e.numberChildren.length>0?n="number":n="empty",{newValues:{markerType:n}}}},t.markers={public:!0,isArray:!0,entryPrefixes:["item"],returnDependencies:()=>({markerType:{dependencyType:"stateVariable",variableName:"markerType"},textChildren:{dependencyType:"child",childLogicName:"atLeastOneTexts",variableNames:["value"]},numberChildren:{dependencyType:"child",childLogicName:"atLeastOneNumbers",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n=[],r=e.markerType;return e.markerType==="text"?n=e.textChildren.map(i=>i.stateValues.value):e.markerType==="number"?(n=e.numberChildren.map(i=>i.stateValues.value),n.sort((i,a)=>i-a)):r="text",{newValues:{markers:n},setComponentType:{markers:r}}}},t}},Jf=Ps;function Dt({variables:u,applyComponentConstraint:t}){let e={},n=!1;for(let r in u){let i=t({[r]:u[r]});i.constrained&&(n=!0,e[r]=i.variables[r])}return n?{constrained:n,variables:e}:{}}var Os=class extends R{static componentType="constraints";static rendererType=void 0;static createPropertiesObject(){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroConstraints",componentType:"_constraint",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childLogicName:"atLeastZeroConstraints",variableNames:["independentComponentConstraints"]}}),definition:({dependencyValues:e})=>({newValues:{independentComponentConstraints:e.constraintChildren.every(n=>n.stateValues.independentComponentConstraints)}})},t.arrayEntryPrefixForConstraints={returnDependencies:()=>({arrayEntryPrefixForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayEntryPrefixForConstraints"}}),definition:({dependencyValues:e})=>({newValues:{arrayEntryPrefixForConstraints:e.arrayEntryPrefixForConstraints}})},t.arrayVariableForConstraints={returnDependencies:()=>({arrayVariableForConstraints:{dependencyType:"parentStateVariable",variableName:"arrayVariableForConstraints"}}),definition:({dependencyValues:e})=>({newValues:{arrayVariableForConstraints:e.arrayVariableForConstraints}})},t.nDimensions={returnDependencies:()=>({nDimensions:{dependencyType:"parentStateVariable",variableName:"nDimensionsForConstraints"}}),definition({dependencyValues:e}){return{newValues:{nDimensions:e.nDimensions}}}},t.constraintResults={additionalStateVariablesDefined:[{variableName:"constraintUsedByComponent",isArray:!0,entryPrefixes:["constraintUsedByComponent"]}],isArray:!0,entryPrefixes:["constraintResult"],stateVariablesDeterminingDependencies:["independentComponentConstraints","arrayEntryPrefixForConstraints","arrayVariableForConstraints"],returnArraySizeDependencies:()=>({nDimensions:{dependencyType:"stateVariable",variableName:"nDimensions"}}),returnArraySize({dependencyValues:e}){return[e.nDimensions]},returnArrayDependenciesByKey({arrayKeys:e,stateValues:n}){let r={constraintChildren:{dependencyType:"child",childLogicName:"atLeastZeroConstraints",variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"}},i=n.arrayEntryPrefixForConstraints,a={};if(n.independentComponentConstraints)for(let s of e)a[s]={x:{dependencyType:"parentStateVariable",variableName:i+(Number(s)+1)}};else{let s=n.arrayVariableForConstraints?n.arrayVariableForConstraints:"__null";r.xs={dependencyType:"parentStateVariable",variableName:s}}return{globalDependencies:r,dependenciesByKey:a}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){if(e.independentComponentConstraints){let i={},a={};for(let s of r){let o=Number(s)+1,l={["x"+o]:n[s].x},c=!1;for(let d of e.constraintChildren){let p=d.stateValues.applyComponentConstraint(l);p.constrained&&(l["x"+o]=p.variables["x"+o],c=!0)}i[s]=l["x"+o],a[s]=c}return{newValues:{constraintResults:i,constraintUsedByComponent:a}}}else{let i={},a=!1;for(let l in e.xs)i[`x${Number(l)+1}`]=e.xs[l];for(let l of e.constraintChildren){let c;l.stateValues.applyConstraint?c=l.stateValues.applyConstraint(i):c=Dt({variables:i,applyComponentConstraint:l.stateValues.applyComponentConstraint}),c.constrained&&(Object.assign(i,c.variables),a=!0)}let s={},o={};for(let l in e.xs)s[l]=i[`x${Number(l)+1}`],o[l]=a;return{newValues:{constraintResults:s,constraintUsedByComponent:o}}}},inverseArrayDefinitionByKey:function({desiredStateVariableValues:e,globalDependencyValues:n,dependencyValuesByKey:r,dependencyNamesByKey:i,stateValues:a,workspace:s}){if(n.independentComponentConstraints){let o=[];for(let l in e.constraintResults){let c=Number(l)+1,d={["x"+c]:re(e.constraintResults[l])};for(let p of n.constraintChildren){let m=p.stateValues.applyComponentConstraint(d);m.constrained&&(d["x"+c]=m.variables["x"+c])}o.push({setDependency:i[l].x,desiredValue:d["x"+c]})}return{success:!0,instructions:o}}else{let o={};s.desiredConstraintResults||(s.desiredConstraintResults={}),Object.assign(s.desiredConstraintResults,e.constraintResults);for(let c in a.constraintResults){let d=Number(c)+1;c in s.desiredConstraintResults?o["x"+d]=re(s.desiredConstraintResults[c]):o["x"+d]=re(a.constraintResults[c])}for(let c of n.constraintChildren){let d;c.stateValues.applyConstraint?d=c.stateValues.applyConstraint(o):d=Dt({variables:o,applyComponentConstraint:c.stateValues.applyComponentConstraint}),d.constrained&&Object.assign(o,d.variables)}let l={};for(let c in s.desiredConstraintResults)l[c]=o[`x${Number(c)+1}`];return{success:!0,instructions:[{setDependency:"xs",desiredValue:l}]}}}},t.constraintUsed={public:!0,componentType:"boolean",returnDependencies:()=>({constraintUsedByComponent:{dependencyType:"stateVariable",variableName:"constraintUsedByComponent"}}),definition:function({dependencyValues:e}){return{newValues:{constraintUsed:Object.values(e.constraintUsedByComponent).some(r=>r)}}}},t}},Yf=Os;var Ls=class extends R{static componentType="_constraint";static rendererType=void 0;static createPropertiesObject(){return{}}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{independentComponentConstraints:!1}})},t}},ge=Ls;var Rs=class extends ge{static componentType="constraintogrid";static createPropertiesObject(){return{dx:{default:1},dy:{default:1},dz:{default:1},xoffset:{default:0},yoffset:{default:0},zoffset:{default:0}}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({}),definition:()=>({newValues:{independentComponentConstraints:!0}})},t.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"}}),definition:({dependencyValues:e})=>({newValues:{applyComponentConstraint:function(n){if("x1"in n){let r=he(n.x1);if(!Number.isFinite(r))return{};let i=e.dx,a=e.xoffset,s=Math.round((n.x1-a)/i)*i+a;return Number.isFinite(s)?{constrained:!0,variables:{x1:s}}:{}}if("x2"in n){let r=he(n.x2);if(!Number.isFinite(r))return{};let i=e.dy,a=e.yoffset,s=Math.round((n.x2-a)/i)*i+a;return Number.isFinite(s)?{constrained:!0,variables:{x2:s}}:{}}if("x3"in n){let r=he(n.x3);if(!Number.isFinite(r))return{};let i=e.dz,a=e.zoffset,s=Math.round((n.x3-a)/i)*i+a;return Number.isFinite(s)?{constrained:!0,variables:{x3:s}}:{}}return{}}}})},t}},Qf=Rs;var Fs=class extends ge{static componentType="attracttogrid";static createPropertiesObject(){return{dx:{default:1},dy:{default:1},dz:{default:1},xoffset:{default:0},yoffset:{default:0},zoffset:{default:0},xthreshold:{default:.2},ythreshold:{default:.2},zthreshold:{default:.2},includeGridlines:{default:!1}}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneString",componentType:"string",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.independentComponentConstraints={returnDependencies:()=>({includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"}}),definition:({dependencyValues:e})=>({newValues:{independentComponentConstraints:e.includeGridlines}})},t.applyComponentConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"}}),definition:({dependencyValues:e})=>({newValues:{applyComponentConstraint:function(n){if("x1"in n){let r=he(n.x1);if(!Number.isFinite(r))return{};let i=e.dx,a=e.xoffset,s=Math.round((n.x1-a)/i)*i+a;return Number.isFinite(s)&&Math.abs(n.x1-s)<e.xthreshold?{constrained:!0,variables:{x1:s}}:{}}if("x2"in n){let r=he(n.x2);if(!Number.isFinite(r))return{};let i=e.dy,a=e.yoffset,s=Math.round((n.x2-a)/i)*i+a;return Number.isFinite(s)&&Math.abs(n.x2-s)<e.ythreshold?{constrained:!0,variables:{x2:s}}:{}}if("x3"in n){let r=he(n.x3);if(!Number.isFinite(r))return{};let i=e.dz,a=e.zoffset,s=Math.round((n.x3-a)/i)*i+a;return Number.isFinite(s)&&Math.abs(n.x3-s)<e.zthreshold?{constrained:!0,variables:{x3:s}}:{}}return{}}}})},t.applyConstraint={returnDependencies:()=>({dx:{dependencyType:"stateVariable",variableName:"dx"},dy:{dependencyType:"stateVariable",variableName:"dy"},dz:{dependencyType:"stateVariable",variableName:"dz"},xoffset:{dependencyType:"stateVariable",variableName:"xoffset"},yoffset:{dependencyType:"stateVariable",variableName:"yoffset"},zoffset:{dependencyType:"stateVariable",variableName:"zoffset"},xthreshold:{dependencyType:"stateVariable",variableName:"xthreshold"},ythreshold:{dependencyType:"stateVariable",variableName:"ythreshold"},zthreshold:{dependencyType:"stateVariable",variableName:"zthreshold"},includeGridlines:{dependencyType:"stateVariable",variableName:"includeGridlines"},applyComponentConstraint:{dependencyType:"stateVariable",variableName:"applyComponentConstraint"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r={},i=!1;for(let a in n){let s=e.applyComponentConstraint({[a]:n[a]});s.constrained&&(i=!0,r[a]=s.variables[a])}if(!i)return{};if(!e.includeGridlines){if(n.x1!==void 0&&r.x1===void 0)return{};if(n.x2!==void 0&&r.x2===void 0)return{};if(n.x3!==void 0&&r.x3===void 0)return{}}return{constrained:i,variables:r}}}})},t}},eh=Fs;var ks=class extends ge{static componentType="constrainto";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneGraphical",componentType:"_graphical",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childLogicName:"atLeastOneGraphical",variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.graphicalChildren){if(!r.stateValues.nearestPoint){console.warn(`cannot attract to ${r.componentName} as it doesn't have a nearestPoint state variable`);continue}n.push(r.stateValues.nearestPoint)}return{newValues:{nearestPointFunctions:n}}}},t.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r=Infinity,i={},a=!1;for(let s of e.nearestPointFunctions){let o=s(n);if(o===void 0)continue;let l={},c=0;if(n.x1!==void 0){if(o.x1===void 0)continue;l.x1=o.x1,c+=Math.pow(n.x1-o.x1,2)}if(n.x2!==void 0){if(o.x2===void 0)continue;l.x2=o.x2,c+=Math.pow(n.x2-o.x2,2)}if(n.x3!==void 0){if(o.x3===void 0)continue;l.x3=o.x3,c+=Math.pow(n.x3-o.x3,2)}c<r&&(i=l,r=c,a=!0)}return a?{constrained:a,variables:i}:{}}}})},t}},th=ks;var Ms=class extends ge{static componentType="attractto";static createPropertiesObject(){return{threshold:{default:.5}}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneGraphical",componentType:"_graphical",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nearestPointFunctions={returnDependencies:()=>({graphicalChildren:{dependencyType:"child",childLogicName:"atLeastOneGraphical",variableNames:["nearestPoint"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let r of e.graphicalChildren){if(!r.stateValues.nearestPoint){console.warn(`cannot attract to ${r.componentName} as it doesn't have a nearestPoint state variable`);continue}n.push(r.stateValues.nearestPoint)}return{newValues:{nearestPointFunctions:n}}}},t.applyConstraint={returnDependencies:()=>({nearestPointFunctions:{dependencyType:"stateVariable",variableName:"nearestPointFunctions"},threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r=Infinity,i={};for(let a of e.nearestPointFunctions){let s=a(n);if(s===void 0)continue;let o={},l=0;if(n.x1!==void 0){if(s.x1===void 0)continue;o.x1=s.x1,l+=Math.pow(n.x1-s.x1,2)}if(n.x2!==void 0){if(s.x2===void 0)continue;o.x2=s.x2,l+=Math.pow(n.x2-s.x2,2)}if(n.x3!==void 0){if(s.x3===void 0)continue;o.x3=s.x3,l+=Math.pow(n.x3-s.x3,2)}l<r&&(i=o,r=l)}return r>e.threshold*e.threshold?{}:{constrained:!0,variables:i}}}})},t}},nh=Ms;var _s=class extends ge{static componentType="constraintunion";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneConstraint",componentType:"_constraint",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.applyConstraint={returnDependencies:()=>({constraintChildren:{dependencyType:"child",childLogicName:"atLeastOneConstraint",variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r;if(e.constraintChildren.length===1){let o=e.constraintChildren[0];return o.stateValues.applyConstraint?r=o.stateValues.applyConstraint(n):r=Dt({variables:n,applyComponentConstraint:o.stateValues.applyComponentConstraint}),r}let i=Infinity,a={},s;for(let[o,l]of e.constraintChildren.entries()){if(l.stateValues.applyConstraint?r=l.stateValues.applyConstraint(n):r=Dt({variables:n,applyComponentConstraint:l.stateValues.applyComponentConstraint}),!r.constrained)continue;let c=0;for(let d in r.variables){let p=he(n[d]),m=he(r.variables[d]);if(!Number.isFinite(p)||!Number.isFinite(m)){c=Infinity;break}c+=Math.pow(p-m,2)}c<i&&(a=r,s=o+1,i=c)}return s===void 0?{}:(a.constraintIndices===void 0?a.constraintIndices=[s]:a.constraintIndices=[s,...a.constraintIndices],a)}}})},t}},rh=_s;var Bs=class extends ge{static componentType="constrainttoattractor";static createPropertiesObject(){return{threshold:{default:.5}}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"exactlyOneConstraint",componentType:"_constraint",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.applyConstraint={returnDependencies:()=>({constraintChild:{dependencyType:"child",childLogicName:"exactlyOneConstraint",variableNames:["applyConstraint","applyComponentConstraint"],variablesOptional:!0},independentComponentConstraints:{dependencyType:"stateVariable",variableName:"independentComponentConstraints"},threshold:{dependencyType:"stateVariable",variableName:"threshold"}}),definition:({dependencyValues:e})=>({newValues:{applyConstraint:function(n){let r,i=e.constraintChild[0];i.stateValues.applyConstraint?r=i.stateValues.applyConstraint(n):r=Dt({variables:n,applyComponentConstraint:i.stateValues.applyComponentConstraint});let a=0;for(let s in r.variables){let o=he(n[s]),l=he(r.variables[s]);if(!Number.isFinite(o)||!Number.isFinite(l))return{};a+=Math.pow(o-l,2)}return a>e.threshold*e.threshold?{}:r}}})},t}},ih=Bs;import Ev from"../_snowpack/pkg/math-expressions.js";var Es=class extends G{static componentType="intersection";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroLines",componentType:"line",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.lineChildren={returnDependencies:()=>({lineChildren:{dependencyType:"child",childLogicName:"atLeastZeroLines",variableNames:["numericalCoeff0","numericalCoeffvar1","numericalCoeffvar2","nDimensions"]}}),definition:({dependencyValues:e})=>({newValues:{lineChildren:e.lineChildren}})},t.readyToExpand={returnDependencies:()=>({lineChildren:{dependencyType:"stateVariable",variableName:"lineChildren"}}),markStale:()=>({updateReplacements:!0}),definition:function(){return{newValues:{readyToExpand:!0}}}},t}static createSerializedReplacements({component:t,components:e}){t.stateValues.readyToExpand;let n=t.stateValues.lineChildren.length;if(n===0)return{replacements:[]};if(n===1){let y=t.stateValues.lineChildren[0].componentName,b=e[y].serialize({forCopy:!0});return b.state||(b.state={}),b.state.draggable=!1,b.state.fixed=!0,{replacements:ke({serializedComponents:[b],componentName:t.componentName})}}if(n>2)return console.warn("Haven't implemented intersection for more than two objects"),{replacements:[]};let r=t.stateValues.lineChildren[0],i=t.stateValues.lineChildren[1];if(r.stateValues.nDimensions!==2||i.stateValues.nDimensions!==2)return console.log("Intersection of lines implemented only in 2D"),{replacements:[]};let a=r.stateValues.numericalCoeffvar1,s=r.stateValues.numericalCoeffvar2,o=r.stateValues.numericalCoeff0,l=i.stateValues.numericalCoeffvar1,c=i.stateValues.numericalCoeffvar2,d=i.stateValues.numericalCoeff0;if(!(Number.isFinite(a)&&Number.isFinite(s)&&Number.isFinite(o)&&Number.isFinite(l)&&Number.isFinite(c)&&Number.isFinite(d)))return console.log("Intersection of lines implemented only for constant coefficients"),{replacements:[]};let p=a*c-l*s;if(Math.abs(p)<1e-14){if(Math.abs(d*a-o*l)>1e-14)return{replacements:[]};if(a===0&&s===0&&o===0||l===0&&c===0&&d===0)return{replacements:[]};{let y=t.stateValues.lineChildren[0].componentName,b=e[y].serialize({forCopy:!0});return b.state||(b.state={}),b.state.draggable=!1,b.state.fixed=!0,{replacements:ke({serializedComponents:[b],componentName:t.componentName})}}}let m=(d*s-o*c)/p,f=(o*l-d*a)/p,h=Ev.fromAst(["vector",m,f]);return{replacements:[{componentType:"point",state:{coords:h,draggable:!1,fixed:!0},downstreamDependencies:{[t.componentName]:[{dependencyType:"nonShadowingReplacement"}]}}]}}static calculateReplacementChanges({component:t,components:e}){t.stateValues.readyToExpand;let n=[],r=this.createSerializedReplacements({component:t,components:e}).replacements,i=r.length,a=!0;if(i===t.replacements.length){a=!1;for(let o=0;o<i;o++){if(r[o].componentType!==t.replacements[o].componentType){a=!0;break}if(r[o].state===void 0){console.warn("No state by which to update intersection component, so recreating"),a=!0;break}let l={changeType:"updateStateVariables",component:t.replacements[o],stateChanges:r[o].state};n.push(l)}}return a===!1?n:[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:r}]}},ah=Es;var $s=class extends B{constructor(t){super(t);this.updateValue=this.updateValue.bind(new Proxy(this,this.readOnlyProxyHandler)),this.actions={updateValue:this.updateValue}}static componentType="updatevalue";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.label={default:"update value",forRenderer:!0},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneMathTarget",componentType:"mathtarget",number:1}),r=e.newLeaf({name:"exactlyOneNewMathValue",componentType:"newmathvalue",number:1});return e.newOperator({name:"updateValueLogic",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.targetedMathName={returnDependencies:()=>({mathTarget:{dependencyType:"child",childLogicName:"exactlyOneMathTarget",variableNames:["mathChildName"]}}),definition:function({dependencyValues:e}){return{newValues:{targetedMathName:e.mathTarget[0].stateValues.mathChildName}}}},t.newMathValue={returnDependencies:()=>({newMathValueChild:{dependencyType:"child",childLogicName:"exactlyOneNewMathValue",variableNames:["value"]}}),definition:function({dependencyValues:e}){return{newValues:{newMathValue:e.newMathValueChild[0].stateValues.value}}}},t}updateValue({}){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.stateValues.targetedMathName,stateVariable:"value",value:this.stateValues.newMathValue}],event:{verb:"selected",object:{componentName:this.componentName,componentType:this.componentType},result:{response:this.stateValues.newMathValue,responseText:this.stateValues.newMathValue.toString()}}})}},sh=$s;var zs=class extends R{static componentType="mathtarget";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.mathChildName={returnDependencies:()=>({mathChild:{dependencyType:"child",childLogicName:"exactlyOneMath"}}),definition:function({dependencyValues:e}){return{newValues:{mathChildName:e.mathChild[0].componentName}}}},t}},oh=zs;var js=class extends H{static componentType="newmathvalue";static rendererType="math"},lh=js;var Hs=class extends B{static componentType="panel";static rendererType="container";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.columns={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.breakpoints={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:["width"]},columns:{dependencyType:"stateVariable",variableName:"columns"}}),definition:function({dependencyValues:e}){let n=[],r=e.children.map(i=>i.stateValues.width);if(e.columns!==null){let i;if(e.columns.indexOf(",")!==-1)i=e.columns.split(",").map(Number);else if(e.columns.indexOf("-")!==-1){let[l,c]=e.columns.split("-");i=[];for(let d=Number(l);d<=c;d++)i.push(d)}else i=[Number(e.columns)];let a={},s={};for(let l of i){let c=[],d=0;for(let p=0;p<l;p++){let m=-1;for(let f=p;f<r.length;f=f+l)r[f]>m&&(m=r[f]);c.push(m),d=d+Number(m)}a[l]=c,s[l]=d}let o=-1;for(let l of i){let c=Number.POSITIVE_INFINITY,d=-1;for(let p of i)s[p]<=c&&p>o&&(c=s[p],d=p);c<Number.POSITIVE_INFINITY&&(n.push({breakpoint:c,possibleColumnNumbers:d,arrayOfWidths:a[d]}),o=d)}}return{newValues:{breakpoints:n}}}},t.childrenToRender={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.children.map(n=>n.componentName)}}}},t}},uh=Hs;var qs=class extends ge{static componentType="constraintoangles";static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:d}){let p=[];for(let m of d)p.push({createdComponent:!0,componentName:m.componentName});return{success:!0,newChildren:[{componentType:"angles",children:p}]}},r=e.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:n}),i=e.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),a=e.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),s=e.newOperator({name:"StringsAndMaths",operator:"or",propositions:[i,a],requireConsecutive:!0,isSugar:!0,replacementFunction:n}),o=e.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),l=e.newOperator({name:"Angles",operator:"xor",propositions:[r,s,o],setAsBase:!0}),c=e.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return e.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[l,c],setAsBase:!0}),e}updateState(t={}){if(super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.offset=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let r=this.childLogic.returnMatches("AtMostOneAngles");r.length===1?this.state.anglesChild=this.activeChildren[r[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let i=this.childLogic.returnMatches("AtMostOnePoint");i.length===1?this.state.pointChild=this.activeChildren[i[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles){this.unresolvedState.angles=!0;return}(n||e.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs){this.unresolvedState.offset=!0;return}if(n||e.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let r=0;r<this.state.pointChild.state.ndimensions;r++){let i=this.state.pointChild.state.xs[r].evaluate_to_constant();if(!Number.isFinite(i)){this.state.offset=NaN;break}this.state.offset.push(i)}}}}applyTheConstraint({x1:t,x2:e,x3:n,offset:r}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(t===void 0||e===void 0||n!==void 0)return{};if(t=this.findFiniteNumericalValue(t),e=this.findFiniteNumericalValue(e),!Number.isFinite(t)||!Number.isFinite(e))return{};if(r===void 0&&(r=this.state.offset),Number.isNaN(r))return{};let i=t-r[0],a=e-r[1],s=Math.atan2(a,i),o=Infinity,l,c;for(let[h,y]of this.state.angles.entries()){let b=y.state.angle.evaluate_to_constant();if(!Number.isFinite(b))continue;let g=Math.abs((b-s+Math.PI)%(2*Math.PI)-Math.PI);g<o&&(l=b,c=h,o=g)}if(l===void 0)return{};let d=Math.sqrt(i*i+a*a),p=r[0]+d*Math.cos(l),m=r[1]+d*Math.sin(l);return{variables:{x1:p,x2:m},constraintIndices:[c+1],constrained:!0}}},ch=qs;var Ks=class extends ge{static componentType="attracttoangles";static createPropertiesObject(){return{threshold:{default:.3}}}static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:d}){let p=[];for(let m of d)p.push({createdComponent:!0,componentName:m.componentName});return{success:!0,newChildren:[{componentType:"angles",children:p}]}},r=e.newLeaf({name:"AtLeastOneAngle",componentType:"angle",comparison:"atLeast",number:1,isSugar:!0,replacementFunction:n}),i=e.newLeaf({name:"AtLeastOneString",componentType:"string",comparison:"atLeast",number:1}),a=e.newLeaf({name:"AtLeastOneMath",componentType:"math",comparison:"atLeast",number:1}),s=e.newOperator({name:"StringsAndMaths",operator:"or",propositions:[i,a],requireConsecutive:!0,isSugar:!0,replacementFunction:n}),o=e.newLeaf({name:"AtMostOneAngles",componentType:"angles",comparison:"atMost",number:1}),l=e.newOperator({name:"Angles",operator:"xor",propositions:[r,s,o],setAsBase:!0}),c=e.newLeaf({name:"AtMostOnePoint",componentType:"point",comparison:"atMost",number:1});return e.newOperator({name:"AnglesAndPoint",operator:"and",propositions:[l,c],setAsBase:!0}),e}updateState(t={}){if(super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.angles=!0,this.unresolvedState.offset=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let r=this.childLogic.returnMatches("AtMostOneAngles");r.length===1?this.state.anglesChild=this.activeChildren[r[0]]:(delete this.state.anglesChild,this.state.angles=[],delete this.unresolvedState.angles);let i=this.childLogic.returnMatches("AtMostOnePoint");i.length===1?this.state.pointChild=this.activeChildren[i[0]]:(delete this.state.pointChild,this.state.offset=[0,0,0],delete this.unresolvedState.offset)}if(this.state.anglesChild){if(this.state.anglesChild.unresolvedState.angles){this.unresolvedState.angles=!0;return}(n||e.getVariableChanges({component:this.state.anglesChild,variable:"angles"}))&&(delete this.unresolvedState.angles,this.state.angles=this.state.anglesChild.state.angles)}if(this.state.pointChild){if(this.state.pointChild.unresolvedState.xs){this.unresolvedState.offset=!0;return}if(n||e.getVariableChanges({component:this.state.pointChild,variable:"xs"})){delete this.unresolvedState.offset,this.state.offset=[];for(let r=0;r<this.state.pointChild.state.ndimensions;r++){let i=this.state.pointChild.state.xs[r].evaluate_to_constant();if(!Number.isFinite(i)){this.state.offset=NaN;break}this.state.offset.push(i)}}}}applyTheConstraint({x1:t,x2:e,x3:n,offset:r}){if(this.unresolvedState.angles||this.unresolvedState.offset)return{};if(t===void 0||e===void 0||n!==void 0)return{};if(t=this.findFiniteNumericalValue(t),e=this.findFiniteNumericalValue(e),!Number.isFinite(t)||!Number.isFinite(e))return{};if(r===void 0&&(r=this.state.offset),Number.isNaN(r))return{};let i=t-r[0],a=e-r[1],s=Math.atan2(a,i),o=Infinity,l,c;for(let[y,b]of this.state.angles.entries()){let g=b.state.angle.evaluate_to_constant();if(!Number.isFinite(g))continue;let T=Math.abs((g-s+Math.PI)%(2*Math.PI)-Math.PI);T<o&&(l=g,c=y,o=T)}if(l===void 0)return{};let d=Math.sqrt(i*i+a*a),p=r[0]+d*Math.cos(l),m=r[1]+d*Math.sin(l);return Math.sqrt(Math.pow(p-t,2)+Math.pow(m-e,2))>=this.state.threshold?{}:{variables:{x1:p,x2:m},constraintIndices:[c+1],constrained:!0}}},dh=Ks;var Ws=class extends G{static componentType="conditionalcontent";static createPropertiesObject(){let t=super.createPropertiesObject();return delete t.hide,t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneCondition",componentType:"condition",comparison:"atMost",number:1,allowSpillover:!1}),r=e.newLeaf({name:"atLeastZeroAnything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"ifAndRest",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.hide={returnDependencies:()=>({conditionChild:{dependencyType:"child",childLogicName:"atMostOneCondition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n;return e.conditionChild.length===0?n=!0:n=!e.conditionChild[0].stateValues.value,{newValues:{hide:n}}}},t.readyToExpand={returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"},anyChildren:{dependencyType:"child",childLogicName:"atLeastZeroAnything"},needsReplacementsUpdatedWhenStale:{dependencyType:"stateVariable",variableName:"needsReplacementsUpdatedWhenStale"}}),definition(){return{newValues:{readyToExpand:!0}}}},t.conditionName={returnDependencies:()=>({conditionChild:{dependencyType:"child",childLogicName:"atMostOneCondition"}}),definition:function({dependencyValues:e}){let n;return e.conditionChild.length===1&&(n=e.conditionChild[0].componentName),{newValues:{conditionName:n}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,workspace:e}){if(t.stateValues.needsReplacementsUpdatedWhenStale,e.previouslyHidden=t.stateValues.hide,t.stateValues.hide)return{replacements:[]};let n=t.activeChildren.filter(r=>r.componentName!==t.stateValues.conditionName).map(r=>r.serialize({forCopy:!0}));return e.uniqueIdentifiersUsed||(e.uniqueIdentifiersUsed=[]),{replacements:ke({serializedComponents:n,componentName:t.componentName,uniqueIdentifiersUsed:e.uniqueIdentifiersUsed})}}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r}){if(t.stateValues.needsReplacementsUpdatedWhenStale,t.stateValues.hide){if(r.previouslyHidden)return[];{r.previouslyHidden=!0;let l=t.replacements.length;return[{changeType:"changeReplacementsToWithhold",replacementsToWithhold:l}]}}if(!r.previouslyHidden)return[];r.previouslyHidden=!1;let i=t.activeChildren.filter(l=>l.componentName!==t.stateValues.conditionName);if(t.replacements.length===i.length)return[{changeType:"changeReplacementsToWithhold",replacementsToWithhold:0}];let a=i.map(l=>l.serialize({forCopy:!0}));r.uniqueIdentifiersUsed||(r.uniqueIdentifiersUsed=[]);let s=ke({serializedComponents:a,componentName:t.componentName,uniqueIdentifiersUsed:r.uniqueIdentifiersUsed});return[{changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,replacementsToWithhold:0,serializedReplacements:s}]}get allPotentialRendererTypes(){let t=[];for(let e in this.allChildren){let n=this.allChildren[e].component;for(let r of n.allPotentialRendererTypes)t.includes(r)||t.push(r)}return t}},ph=Ws;var Us=class extends B{static componentType="aslist";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["hidden"]}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.filter(n=>!n.stateValues.hidden).map(n=>n.componentName)}}}},t.text={public:!0,componentType:"text",returnDependencies:()=>({inlineChildren:{dependencyType:"child",childLogicName:"atLeastZeroInline",variableNames:["text"],variablesOptional:!0}}),definition:function({dependencyValues:e}){let n=[];for(let i of e.inlineChildren)typeof i.stateValues.text=="string"?n.push(i.stateValues.text):n.push("");return{newValues:{text:n.join(", ")}}}},t}},mh=Us;import zv from"../_snowpack/pkg/math-expressions.js";function se(u){if(u!==null&&u!==""){if(Number.isFinite(Number(u)))return Number(u)-1;if(typeof u=="string")return $v(u)}}function $v(u){u=u.toUpperCase();let t=0,e=u.length,n=e;for(;(n-=1)>-1;){let r=u.charCodeAt(n)-64;if(r<1||r>26){console.warn("Cannot convert "+u+" to a number");return}t+=r*Math.pow(26,e-1-n)}return t--,t}var Gs=class extends R{static componentType="table";static rendererType="table";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.width={default:"400px"},e.minNumRows={default:1},e.minNumColumns={default:1},e.height={forRenderer:!0,dependentStateVariables:[{dependencyName:"numRows",variableName:"numRows"}],definitionForPropertyValue({dependencyValues:n,propertyChild:r}){if(r.length===0){let i;return Number.isFinite(n.numRows)&&n.numRows>=0?i=50+n.numRows*20:i=130,{newValues:{height:i}}}return{newValues:{height:r[0].stateValues.value}}}},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"zeroOrMoreCells",componentType:"cell",comparison:"atLeast",number:0}),r=e.newLeaf({name:"zeroOrMoreRows",componentType:"row",comparison:"atLeast",number:0}),i=e.newLeaf({name:"zeroOrMoreColumns",componentType:"column",comparison:"atLeast",number:0}),a=e.newLeaf({name:"zeroOrMoreCellblocks",componentType:"cellblock",comparison:"atLeast",number:0});return e.newOperator({name:"cellsRowsColumnsBlocks",operator:"and",propositions:[n,r,i,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.cellNameToRowCol={additionalStateVariablesDefined:["cellNamesByRowCol"],returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childLogicName:"cellsRowsColumnsBlocks",variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:e,componentInfoObjects:n}){let r=fh({cellRelatedChildren:e.cellRelatedChildren,componentInfoObjects:n});return{newValues:{cellNameToRowCol:r.cellNameToRowCol,cellNamesByRowCol:r.cellNamesByRowCol}}}},t.numRows={public:!0,componentType:"number",returnDependencies:()=>({minNumRows:{dependencyType:"stateVariable",variableName:"minNumRows"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"}}),definition({dependencyValues:e}){let n=e.minNumRows;return Number.isFinite(n)||(n=4),n=Math.max(n,e.cellNamesByRowCol.length),{newValues:{numRows:n}}}},t.numColumns={public:!0,componentType:"number",returnDependencies:()=>({minNumColumns:{dependencyType:"stateVariable",variableName:"minNumColumns"},cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"}}),definition({dependencyValues:e}){let n=e.minNumColumns;Number.isFinite(n)||(n=4);for(let r of e.cellNamesByRowCol)r&&(n=Math.max(n,r.length));return{newValues:{numColumns:n}}}},t.cells={public:!0,componentType:"cell",isArray:!0,entryPrefixes:["cell","row","column","range"],nDimensions:2,returnArraySizeDependencies:()=>({numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),returnArraySize({dependencyValues:e}){return[e.numRows,e.numColumns]},returnEntryDimensions:e=>e==="range"?2:1,containsComponentNamesToCopy:!0,targetPropertiesToIgnoreOnCopy:["rowNum","colNum"],returnWrappingComponents(e){return e==="cell"?[]:e==="row"?[["row"]]:e===" col"?[["column"]]:[["row"],["cellblock"]]},getArrayKeysFromVarName({arrayEntryPrefix:e,varEnding:n,arraySize:r}){if(e==="cell"){let i,a,s=/^([a-zA-Z]+)([1-9]\d*)$/,o=n.match(s);if(o)a=o[1],i=o[2];else{let d=/^\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)$/;if(o=n.match(d),o)i=o[1],a=o[2];else return[]}let l=se(i),c=se(a);return l>=0&&l<r[0]&&c>=0&&c<r[1]?[String(l)+","+String(c)]:[]}else if(e==="row"){let i=se(n);if(!(i>=0&&i<r[0]))return[];let a=[],s=String(i)+",";for(let o=0;o<r[1];o++)a.push(s+o);return a}else if(e==="column"){let i=se(n);if(!(i>=0&&i<r[1]))return[];let a=[],s=","+String(i);for(let o=0;o<r[1];o++)a.push(o+s);return a}else{let i,a,s,o,l=/^([a-zA-Z]+)([1-9]\d*)([a-zA-Z]+)([1-9]\d*)$/,c=n.match(l);if(c)a=se(c[1]),i=se(c[2]),o=se(c[3]),s=se(c[4]);else{let y=/^\(\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\),\(([a-zA-Z]+|\d+),([a-zA-Z]+|\d+)\)\)$/;if(c=n.match(y),c)i=se(c[1]),a=se(c[2]),s=se(c[3]),o=se(c[4]);else return[]}if(!(i>=0&&s>=0&&a>=0&&o>=0))return[];let d=Math.min(Math.min(i,s),r[0]-1),p=Math.min(Math.max(i,s),r[0]-1),m=Math.min(Math.min(a,o),r[1]-1),f=Math.min(Math.max(a,o),r[1]-1),h=[];for(let y=d;y<=p;y++){let b=[],g=String(y)+",";for(let T=m;T<=f;T++)b.push(g+T);h.push(b)}return h}},arrayVarNameFromArrayKey(e){return"cell("+e.split(",").map(n=>Number(n)+1).join(",")+")"},returnArrayDependenciesByKey(){return{globalDependencies:{cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"}}}},arrayDefinitionByKey({globalDependencyValues:e,arrayKeys:n}){let r={},i=e.cellNamesByRowCol;for(let a of n){let[s,o]=a.split(",");i[s]&&i[s][o]?r[a]=i[s][o]:r[a]=null}return{newValues:{cells:r}}}},t.childrenToRender={additionalStateVariablesDefined:[{variableName:"renderedChildNumberByRowCol",forRenderer:!0}],returnDependencies:()=>({cellNamesByRowCol:{dependencyType:"stateVariable",variableName:"cellNamesByRowCol"},numRows:{dependencyType:"stateVariable",variableName:"numRows"},numColumns:{dependencyType:"stateVariable",variableName:"numColumns"}}),definition:function({dependencyValues:e}){let n=[],r=[],i=0;for(let a=0;a<e.numRows;a++){let s=e.cellNamesByRowCol[a],o=[];if(s){for(let l of s)l?(n.push(l),o.push(i),i+=1):o.push(null);o.push(...Array(e.numColumns-s.length).fill(null))}else o=Array(e.numColumns).fill(null);r.push(o)}return{newValues:{childrenToRender:n,renderedChildNumberByRowCol:r}}}},t}addCell({cell:t,rowNum:e,colNum:n}){if(Array.isArray(this.state.cells[e])||(this.state.cells[e]=[]),Array.isArray(this.state.cellComponents[e])||(this.state.cellComponents[e]=[]),e<0)throw Error("RowNum position has to be 1 or greater");if(n<0)throw Error("ColNum position has to be 1 or greater");if(t.unresolvedState.text?this.unresolvedState.cells==null?this.unresolvedState.cells={isArray:!0,arrayComponents:{[[e,n]]:!0}}:this.unresolvedState.cells.arrayComponents[[e,n]]=!0:this.state.cells[e][n]=t.state.text,this.state.cellComponents[e][n]===void 0)this.state.cellComponents[e][n]=t;else throw Error(`Cell row ${e+1} column ${n+1} is already defined above.`);return this.state.cellNameToRowCol[t.componentName]={row:e,col:n},{rowNum:e,colNum:n}}getCellPoints(t,e){if(this.unresolvedState.points)return;if(this.state.pointsFoundInCells!==void 0)return this.state.pointsFoundInCells[e];this.currentTracker.trackChanges.logPotentialChange({component:this,variable:"points",oldValue:this.state.pointsFoundInCells}),this.state.pointsFoundInCells=[],this._state.pointsFoundInCells.indices=[];let n=this.state.numRows,r=this.state.numColumns;for(let i=0;i<r;i++)for(let a=0;a<n;a++){let s=this.state.cells[a][i];if(!s)continue;let o;try{o=zv.fromText(s)}catch(l){continue}Array.isArray(o.tree)&&o.tree[0]==="tuple"&&(this.state.pointsFoundInCells.push(o),this._state.pointsFoundInCells.indices.push([a,i]))}return console.log("logging points change"),this.state.pointsFoundInCells[e]}},Ar=Gs;function fh({cellRelatedChildren:u,rowOffset:t=0,colOffset:e=0,cellNameToRowCol:n={},cellNamesByRowCol:r=[],componentInfoObjects:i}){var a=t,s=e,o=e,l=t,c=e,d=t,p=e;for(let m of u)if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"cell"})){let f=m,h=se(f.stateValues.rowNum),y=se(f.stateValues.colNum);h===void 0?(h=a,y===void 0?y=o:y=y+e):(h=h+t,y===void 0?y=s:y=y+e),Xs({cell:f,rowIndex:h,colIndex:y,cellNameToRowCol:n,cellNamesByRowCol:r}),d=Math.max(h,d),p=Math.max(y,p),a=h,s=y,o=y+1}else if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"row"})){let f=m,h=se(f.stateValues.rowNum);h===void 0?h=l:h=h+t;let y=f.stateValues.prescribedCellsWithColNum,b=e;for(let g of y){let T=se(g.stateValues.colNum);T===void 0?T=b:T=T+e,Xs({cell:g,rowIndex:h,colIndex:T,cellNameToRowCol:n,cellNamesByRowCol:r}),b=T+1,d=Math.max(h,d),p=Math.max(T,p)}l=h+1,a=h+1,s=e,o=s}else if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"column"})){let f=m,h=se(f.stateValues.colNum);h===void 0?h=c:h=h+e;let y=f.stateValues.prescribedCellsWithRowNum,b=t;for(let g of y){let T=se(g.stateValues.rowNum);T===void 0?T=b:T=T+t,Xs({cell:g,rowIndex:T,colIndex:h,cellNameToRowCol:n,cellNamesByRowCol:r}),b=T+1,d=Math.max(T,d),p=Math.max(h,p)}c=h+1,a=t,s=h+1,o=s}else if(i.isInheritedComponentType({inheritedComponentType:m.componentType,baseComponentType:"cellblock"})){let f=m,h=se(f.stateValues.rowNum),y=se(f.stateValues.colNum);h===void 0?(h=a,y===void 0?y=o:y=y+e):(h=h+t,y===void 0?y=s:y=y+e);let b=fh({cellRelatedChildren:f.stateValues.prescribedCellsRowsColumnsBlocks,rowOffset:h,colOffset:y,cellNameToRowCol:n,cellNamesByRowCol:r,componentInfoObjects:i});d=Math.max(b.maxRowIndex,d),p=Math.max(b.maxColIndex,p),a=h,s=y,o=b.maxColIndex+1}return{maxRowIndex:d,maxColIndex:p,cellNameToRowCol:n,cellNamesByRowCol:r}}function Xs({cell:u,rowIndex:t,colIndex:e,cellNameToRowCol:n,cellNamesByRowCol:r}){if(n[u.componentName]=[t,e],r[t]===void 0&&(r[t]=[]),r[t][e]!==void 0){console.warn(`Cell is overwriting previous cell at rowNum=${t+1}, colNum=${e+1}`);let i=r[t][e];n[i]=null}r[t][e]=u.componentName}var Zs=class extends Ar{constructor(t){super(t);this.onChange=this.onChange.bind(this)}static componentType="spreadsheet";static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["cells"]}onChange(t,e){if(e!=="loadData"){let n={};for(let r of t){let[i,a,s,o]=r;this.state.cells[i][a]=s,n[[i,a]]=o}this.coreFunctions.requestUpdate({updateType:"updateValue",updateInstructions:[{componentName:this.componentName,variableUpdates:{cells:{isArray:!0,changes:{arrayComponents:n}}}}]})}}initializeRenderer({}){if(this.renderer!==void 0){this.updateRenderer();return}let t={onChange:this.onChange};this.renderer=new this.availableRenderers.spreadsheet({key:this.componentName,actions:t,cells:this.state.cells,width:this.state.width,height:this.state.height})}updateRenderer(){this.renderer.updateSpreadsheet({cells:this.state.cells,width:this.state.width,height:this.state.height})}},hh=Zs;import Js from"../_snowpack/pkg/math-expressions.js";var Ys=class extends R{static componentType="cell";static rendererType="container";static primaryStateVariableForDefinition="placeholder";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.rowNum={default:null},e.colNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneMath",componentType:"math",number:1}),r=e.newLeaf({name:"nothingElse",componentType:"_base",number:0,allowSpillover:!1}),i=e.newOperator({name:"oneMathAndNothingElse",operator:"and",propositions:[n,r],requireConsecutive:!0}),a=e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"mathXorAnything",operator:"xor",propositions:[i,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.onlyMathChild={returnDependencies:()=>({mathChild:{dependencyType:"child",childLogicName:"oneMathAndNothingElse"}}),definition:({dependencyValues:e})=>({newValues:{onlyMathChild:e.mathChild.length===1}})},t.text={public:!0,componentType:"text",defaultValue:"",returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"mathXorAnything",variableNames:["text"],variablesOptional:!0}}),definition({dependencyValues:e}){if(e.children.length===0)return{useEssentialOrDefaultValue:{text:{variablesToCheck:["text"]}}};let n="";for(let r of e.children)r.stateValues.text&&(n+=r.stateValues.text);return{newValues:{text:n}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.children.length===0?{success:!0,instructions:[{setStateVariable:"text",value:e.text}]}:n.children.length===1?n.children[0].stateValues.text===void 0?{success:!1}:{success:!0,instructions:[{setDependency:"children",desiredValue:e.text,childIndex:0,variableIndex:0}]}:{success:!1}}},t.math={public:!0,componentType:"math",stateVariablesDeterminingDependencies:["onlyMathChild"],returnDependencies({stateValues:e}){return e.onlyMathChild?{mathChild:{dependencyType:"child",childLogicName:"oneMathAndNothingElse",variableNames:["value"]}}:{text:{dependencyType:"stateVariable",variableName:"text"}}},definition({dependencyValues:e}){if(e.mathChild)return{newValues:{math:e.mathChild[0].stateValues.value}};{let n;try{n=Js.fromText(e.text)}catch(r){n=Js.fromAst("\uFF3F")}return{newValues:{math:n}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.mathChild?{success:!0,instructions:[{setDependency:"mathChild",desiredValue:e.math,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setDependency:"text",desiredValue:e.math.toString()}]}}},t.number={public:!0,componentType:"number",returnDependencies:()=>({math:{dependencyType:"stateVariable",variableName:"math"}}),definition({dependencyValues:e}){let n=e.math.evaluate_to_constant();return Number.isFinite(n)||(n=NaN),{newValues:{number:n}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setDependency:"math",desiredValue:Js.fromAst(e.number)}]}}},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"mathXorAnything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t.placeholder={returnDependencies:()=>({}),definition:()=>({newValues:{placeholder:null}})},t}adapters=["text","math","number"]},yh=Ys;var Qs=class extends R{static componentType="row";static rendererType="container";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.rowNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroCells",componentType:"cell",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.prescribedCellsWithColNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childLogicName:"atLeastZeroCells",variableNames:["colNum"]}}),definition({dependencyValues:e}){return{newValues:{prescribedCellsWithColNum:e.cellChildren}}}},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroCells"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}},bh=Qs;var eo=class extends R{static componentType="column";static rendererType="container";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.colNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroCells",componentType:"cell",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.prescribedCellsWithRowNum={returnDependencies:()=>({cellChildren:{dependencyType:"child",childLogicName:"atLeastZeroCells",variableNames:["rowNum"]}}),definition({dependencyValues:e}){return{newValues:{prescribedCellsWithRowNum:e.cellChildren}}}},t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"atLeastZeroCells"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}},gh=eo;var to=class extends R{static componentType="cellblock";static rendererType="container";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.rowNum={default:null},e.colNum={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"zeroOrMoreCells",componentType:"cell",comparison:"atLeast",number:0}),r=e.newLeaf({name:"zeroOrMoreRows",componentType:"row",comparison:"atLeast",number:0}),i=e.newLeaf({name:"zeroOrMoreColumns",componentType:"column",comparison:"atLeast",number:0}),a=e.newLeaf({name:"zeroOrMoreCellblocks",componentType:"cellblock",comparison:"atLeast",number:0});return e.newOperator({name:"cellsRowsColumnsBlocks",operator:"and",propositions:[n,r,i,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.prescribedCellsRowsColumnsBlocks={returnDependencies:()=>({cellRelatedChildren:{dependencyType:"child",childLogicName:"cellsRowsColumnsBlocks",variableNames:["rowNum","colNum","prescribedCellsWithColNum","prescribedCellsWithRowNum","prescribedCellsRowsColumnsBlocks"],variablesOptional:!0}}),definition({dependencyValues:e}){return{newValues:{prescribedCellsRowsColumnsBlocks:e.cellRelatedChildren}}}},t}},vh=to;var no=class extends B{static componentType="seeds";static rendererType=void 0;static returnSugarInstructions(){let t=super.returnSugarInstructions(),e=function({matchedChildren:n}){let r=n.reduce(function(i,a){return a.componentType==="string"?[...i,...a.state.value.split(/\s+/).filter(s=>s).map(s=>({componentType:"seed",state:{value:s}}))]:[...i,a]},[]);return{success:!0,newChildren:r}};return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroSeeds",componentType:"seed",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nSeeds={public:!0,componentType:"number",returnDependencies:()=>({seedChildren:{dependencyType:"child",childLogicName:"atLeastZeroSeeds"}}),definition:function({dependencyValues:e}){return{newValues:{nSeeds:e.seedChildren.length}}}},t.seeds={public:!0,componentType:"seed",isArray:!0,entryPrefixes:["seed"],returnArraySizeDependencies:()=>({nSeeds:{dependencyType:"stateVariable",variableName:"nSeeds"}}),returnArraySize({dependencyValues:e}){return[e.nSeeds]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={seedChild:{dependencyType:"child",childLogicName:"atLeastZeroSeeds",variableNames:["value"],childIndices:[r]}};return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)e[i].seedChild.length===1&&(r[i]=e[i].seedChild[0].stateValues.value);return{newValues:{seeds:r}}}},t}},Ch=no;var ro=class extends R{static componentType="variantcontrol";static rendererType=void 0;static createsVariants=!0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.nVariants={default:100},e.uniqueVariants={default:!1},delete e.variants,e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneSeeds",componentType:"seeds",comparison:"atMost",number:1,takePropertyChildren:!0}),r=e.newLeaf({name:"atMostOneVariants",componentType:"variants",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"seedsAndVariants",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nVariantsSpecified={returnDependencies:({sharedParameters:e})=>({uniqueVariants:{dependencyType:"stateVariable",variableName:"uniqueVariants"},numberOfVariantsFromSharedParameters:{dependencyType:"value",value:e.numberOfVariantsFromSharedParameters},nVariants:{dependencyType:"stateVariable",variableName:"nVariants"}}),definition:function({dependencyValues:e}){let n=e.nVariants;return n<1&&(n=1),e.uniqueVariants&&(e.numberOfVariantsFromSharedParameters!==void 0?n=e.numberOfVariantsFromSharedParameters:console.log("Restricting to unique variants was not successful")),{newValues:{nVariantsSpecified:n}}}},t.nSeeds={public:!0,componentType:"number",returnDependencies:()=>({seedsChild:{dependencyType:"child",childLogicName:"atMostOneSeeds",variableNames:["nSeeds"]}}),definition:function({dependencyValues:e}){return e.seedsChild.length===1?{newValues:{nSeeds:e.seedsChild[0].stateValues.nSeeds}}:{newValues:{nSeeds:0}}}},t.seeds={public:!0,componentType:"seed",isArray:!0,entryPrefixes:["seed"],returnArraySizeDependencies:()=>({nSeeds:{dependencyType:"stateVariable",variableName:"nSeeds"}}),returnArraySize({dependencyValues:e}){return[e.nSeeds]},returnArrayDependenciesByKey({arrayKeys:e}){let n={};for(let r of e)n[r]={seedsChild:{dependencyType:"child",childLogicName:"atMostOneSeeds",variableNames:["seed"+(Number(r)+1)]}};return{dependenciesByKey:n}},arrayDefinitionByKey:function({dependencyValuesByKey:e,arrayKeys:n}){let r={};for(let i of n)e[i].seedsChild.length===1&&(r[i]=e[i].seedsChild[0].stateValues["seed"+(Number(i)+1)]);return{newValues:{seeds:r}}}},t.originalVariants={returnDependencies:()=>({variantsChild:{dependencyType:"child",childLogicName:"atMostOneVariants",variableNames:["variants"]}}),definition:function({dependencyValues:e}){let n=[];return e.variantsChild.length===1&&(n=e.variantsChild[0].stateValues.variants),{newValues:{originalVariants:n}}}},t.variants={public:!0,componentType:"variant",isArray:!0,entryPrefixes:["variant"],returnArraySizeDependencies:()=>({nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}),returnArraySize({dependencyValues:e}){return[e.nVariantsSpecified]},returnArrayDependenciesByKey({arrayKeys:e}){return{globalDependencies:{originalVariants:{dependencyType:"stateVariable",variableName:"originalVariants"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"}}}},arrayDefinitionByKey:function({globalDependencyValues:e,arrayKeys:n}){let r=[...e.originalVariants],i=r.length,a=i-1,s;for(;i<e.nVariantsSpecified;){for(i++,a++,s=Th(a);e.originalVariants.includes(s);)a++,s=Th(a);r.push(s)}return{newValues:{variants:r}}}},t.selectedVariantNumber={public:!0,componentType:"number",immutable:!0,returnDependencies:({sharedParameters:e})=>({variantsObject:{dependencyType:"variants"},originalVariants:{dependencyType:"stateVariable",variableName:"originalVariants"},variants:{dependencyType:"stateVariable",variableName:"variants"},nVariantsSpecified:{dependencyType:"stateVariable",variableName:"nVariantsSpecified"},hashStringToInteger:{dependencyType:"value",value:e.hashStringToInteger},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){if(e.variantsObject!==void 0){if(e.variantsObject.desiredVariantNumber!==void 0){let i=Number(e.variantsObject.desiredVariantNumber);if(Number.isInteger(i)){let a=i%e.nVariantsSpecified;return a<0&&(a+=e.nVariantsSpecified),{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:a}}}else throw Error("Variant number "+e.variantsObject.desiredVariantNumber+" must be an integer")}if(e.variantsObject.desiredVariant!==void 0){if(typeof e.variantsObject.desiredVariant=="string"){let a=e.originalVariants.map(l=>l.toLowerCase()),o=[...a,...e.variants.slice(a.length)].indexOf(e.variantsObject.desiredVariant.toLowerCase());if(o!==-1)return{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:o}}}console.log("Variant "+e.variantsObject.desiredVariant+" is not valid, convert to variant index");let i=Math.abs(e.hashStringToInteger(JSON.stringify(e.variantsObject.desiredVariant))%e.nVariantsSpecified);return{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:i}}}}let n=e.selectRng.random(),r=Math.floor(n*e.nVariantsSpecified);return{makeEssential:["selectedVariantNumber"],newValues:{selectedVariantNumber:r}}}},t.selectedVariant={public:!0,componentType:"text",returnDependencies:()=>({variants:{dependencyType:"stateVariable",variableName:"variants"},selectedVariantNumber:{dependencyType:"stateVariable",variableName:"selectedVariantNumber"}}),definition:function({dependencyValues:e}){return{newValues:{selectedVariant:e.variants[e.selectedVariantNumber]}}}},t.selectedSeed={returnDependencies:()=>({selectedVariantNumber:{dependencyType:"stateVariable",variableName:"selectedVariantNumber"},seeds:{dependencyType:"stateVariable",variableName:"seeds"}}),definition:function({dependencyValues:e}){if(e.selectedVariantNumber<e.seeds.length)return{newValues:{selectedSeed:e.seeds[e.selectedVariantNumber]}};let n=e.seeds.length-1,r=n+1,i;for(;n<e.selectedVariantNumber;)for(n++,r++,i=r.toString();e.seeds.includes(i);)r++,i=r.toString();return{newValues:{selectedSeed:i}}}},t.convertedSeed={returnDependencies:({sharedParameters:e})=>({selectedSeed:{dependencyType:"stateVariable",variableName:"selectedSeed"},hashStringToInteger:{dependencyType:"value",value:e.hashStringToInteger}}),definition:({dependencyValues:e})=>({newValues:{convertedSeed:e.hashStringToInteger(e.selectedSeed)}})},t.selectRng={returnDependencies:({sharedParameters:e})=>({convertedSeed:{dependencyType:"stateVariable",variableName:"convertedSeed"},rngClass:{dependencyType:"value",value:e.rngClass,doNotProxy:!0}}),definition:({dependencyValues:e})=>({newValues:{selectRng:new e.rngClass(e.convertedSeed)}})},t}},Nh=ro;function Th(u){let t="";for(;;){let e=u%26;if(t=String.fromCharCode(97+e)+t,u<26)break;u=Math.floor(u/26)-1}return t}import zn from"../_snowpack/pkg/math-expressions.js";var io=class extends fn{static componentType="selectfromsequence";static assignNamesToReplacements=!0;static createsVariants=!0;static get stateVariablesShadowedForReference(){return[...super.stateVariablesShadowedForReference,"excludedCombinations"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.numberToSelect={default:1},e.withReplacement={default:!1},e.sortResults={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.baseLogic,r=e.newLeaf({name:"atMostOneExcludeCombinations",componentType:"excludecombinations",comparison:"atMost",number:1,takePropertyChildren:!0});return e.newOperator({name:"selectFromSequenceLogic",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();t.excludedCombinations={returnDependencies:()=>({excludeCombinationsChild:{dependencyType:"child",childLogicName:"atMostOneExcludeCombinations",variableNames:["lists"]}}),definition:function({dependencyValues:n}){return n.excludeCombinationsChild.length===1?{newValues:{excludedCombinations:n.excludeCombinationsChild[0].stateValues.lists}}:{newValues:{excludedCombinations:[]}}}},t.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:n}){return{newValues:{variants:n.variants}}}},t.selectedValues={immutable:!0,additionalStateVariablesDefined:["selectedIndices"],returnDependencies:({sharedParameters:n})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},length:{dependencyType:"stateVariable",variableName:"length"},from:{dependencyType:"stateVariable",variableName:"from"},step:{dependencyType:"stateVariable",variableName:"step"},exclude:{dependencyType:"stateVariable",variableName:"exclude"},excludedCombinations:{dependencyType:"stateVariable",variableName:"excludedCombinations"},type:{dependencyType:"stateVariable",variableName:"type"},lowercase:{dependencyType:"stateVariable",variableName:"lowercase"},sortResults:{dependencyType:"stateVariable",variableName:"sortResults"},variants:{dependencyType:"stateVariable",variableName:"variants"},selectRng:{dependencyType:"value",value:n.selectRng,doNotProxy:!0}}),definition:jv},t.isVariantComponent={returnDependencies:()=>({}),definition:()=>({newValues:{isVariantComponent:!0}})},t.isVariantComponent={returnDependencies:()=>({}),definition:()=>({newValues:{isVariantComponent:!0}})},t.selectedVariantInfo={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition({dependencyValues:n}){return{newValues:{selectedVariantInfo:{indices:n.selectedIndices}}}}};let e=t.readyToExpand.returnDependencies;return t.readyToExpand.returnDependencies=function(){let n=e();return n.selectedValues={dependencyType:"stateVariable",variableName:"selectedValues"},n},t}static createSerializedReplacements({component:t,componentInfoObjects:e}){let n=[];for(let i of t.stateValues.selectedValues){let a={value:i};t.stateValues.hide&&(a.hide=!0),n.push({componentType:t.stateValues.type,state:a})}return{replacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:n,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:e}).serializedComponents}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:t}){let e=1,n=!1;if(t.state!==void 0&&(t.state.numberToSelect!==void 0&&(e=t.state.numberToSelect),t.state.withReplacement!==void 0&&(n=t.state.withReplacement),t.state.type!==void 0&&(sequenceType=t.state.type)),t.children===void 0)return{succes:!1};let r,i={},a=[];for(let d of t.children){let p=d.componentType;if(p==="numberToSelect"){let m=!1;if(d.state!==void 0&&d.state.value!==void 0&&(e=Math.round(Number(d.state.value)),m=!0),d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){e=Math.round(Number(f.state.value)),m=!0;break}}if(!m)return{success:!1}}else if(p==="withReplacement"){let m=!1;if(d.state!==void 0&&(d.state.implicitValue!==void 0&&(n=d.state.implicitValue,m=!0),d.state.value!==void 0&&(n=d.state.value,m=!0)),d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){m=!0,f.state.value.trim().toLowerCase()==="true"?n=!0:n=!1;break}}if(!m)return{success:!1}}else if(["type","to","from","step","length"].includes(p)){let m=!1;if(d.state!==void 0&&d.state.value!==void 0&&(i[p]=d.state.value,m=!0),d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){i[p]=f.state.value,m=!0;break}}if(!m)return{success:!1}}else if(p==="exclude"){let m=!1;if(d.children!==void 0){for(let f of d.children)if(f.componentType==="string"){m=!0;let h=f.state.value.split(",").map(y=>y.trim());a.push(...h);break}}if(!m)return{success:!1}}else p==="string"&&(r=d)}if(r!==void 0){if(i.to!==void 0||i.from!==void 0)return{success:!1};let d=r.state.value.split(",");if(d.length===1)i.to=d[0].trim();else if(d.length===2)i.from=d[0].trim(),i.to=d[1].trim();else return{success:!1}}for(let d of["to","from","step"])if(i[d]!==void 0){if(i.type==="math"){if(typeof i[d]=="string")i[d]=zn.fromText(i[d]);else if(i[d].tree===void 0)return{success:!1}}else if(i.type==="letters"&&d!=="step"){if(i[d]=wt(i[d]),i[d]===void 0)return{success:!1}}else if(i[d]=Number(i[d]),!Number.isFinite(i[d]))return{success:!1}}if(i.length!==void 0&&(typeof i.length=="string"&&(i.length=Number(i.length)),!Number.isInteger(i.length)||i.length<0))return{success:!1};for(let[d,p]of a.entries()){if(i.type==="math"){if(typeof p=="string")p=zn.fromText(p);else if(p.tree===void 0)return{success:!1}}else if(i.type==="letters"&&par!=="step"){if(p=wt(p),p===void 0)return{success:!1}}else if(p=Number(p),!Number.isFinite(p))return{success:!1};a[d]=p}this.calculateSequenceParameters(i);let s=i.length,o=[];if(a.length>0&&i.type!==math){a.sort(),a=a.filter((d,p,m)=>d!=m[p-1]);for(let d of a){if(d<i.from)continue;let p=(d-i.from)/i.step;if(p>i.length-1+1e-10)break;Math.abs(p-Math.round(p))<1e-10&&(s--,o.push(p))}}if(s<=0)return{success:!1};let l={excludeIndices:o,nOptions:s,numberToSelect:e,withReplacement:n};if(n||e===1){let d=Math.pow(s,e);return{success:!0,numberOfVariants:d,uniqueVariantData:l}}let c=s;for(let d=s-1;d>s-e;d--)c*=d;return{success:!0,numberOfVariants:c,uniqueVariantData:l}}static getUniqueVariant({serializedComponent:t,variantNumber:e}){if(t.variants===void 0)return{succes:!1};let n=t.variants.numberOfVariants;if(n===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=n)return{success:!1};let r=t.variants.uniqueVariantData,i=r.excludeIndices,a=r.nOptions,s=r.numberToSelect,o=r.withReplacement,l=function(p){let m=p;for(let f of i)m===f&&m++;return m};if(s===1)return{success:!0,desiredVariant:{indices:[l(e)]}};let d=Bn({numberOfIndices:s,numberOfOptions:a,maxNumber:e+1,withReplacement:o})[e].map(l);return{success:!0,desiredVariant:{indices:d}}}},At=io;function jv({dependencyValues:u}){if(u.numberToSelect<1)return{makeEssential:["selectedValues","selectedIndices"],newValues:{selectedValues:[],selectedIndices:[]}};let t=1;if(u.withReplacement||(t=u.numberToSelect),t>u.length)throw Error("Cannot select "+t+" values from a sequence of length "+u.length);if(u.variants&&u.variants.desiredVariant!==void 0){let i=u.variants.desiredVariant.indices;if(i!==void 0){if(i.length!==u.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(i=i.map(Number),!i.every(Number.isInteger))throw Error("All indices specified for select must be integers");let a=u.length;i=i.map(l=>(l%a+a)%a);let s=!0,o=[];for(let l of i){let c=u.from;if(l>0&&(u.type==="math"?c=c.add(u.step.multiply(zn.fromAst(l))).expand().simplify():c+=u.step*l),u.type==="letters"&&(c=_t(c,u.lowercase)),u.type==="math"){if(u.exclude.some(p=>p.equals(c)))throw Error("Specified index of selectfromsequence that was excluded")}else if(u.exclude.includes(c))throw Error("Specified index of selectfromsequence that was excluded");let d=!1;u.type==="math"?u.excludedCombinations.some(p=>[p,l].equals(c))&&(d=!0):u.excludedCombinations.some(p=>p[l]===c)&&(d=!0),d||(s=!1),o.push(c)}if(s)throw Error("Specified indices of selectfromsequence that was an excluded combination");return{makeEssential:["selectedValues","selectedIndices"],newValues:{selectedValues:o,selectedIndices:i}}}}let e=u.excludedCombinations.length,n,r;if(e===0){let i=xh({stateValues:u,numberUniqueRequired:t,numberToSelect:u.numberToSelect,withReplacement:u.withReplacement,rng:u.selectRng});n=i.selectedValues,r=i.selectedIndices}else{let i=u.length-u.exclude.length;if(u.withReplacement)i=Math.pow(i,u.numberToSelect);else{let s=i;for(let o=1;o<u.numberToSelect;o++)i*=s-o}if(e>.7*i)throw Error("Excluded over 70% of combinations in selectFromSequence");let a=!1;for(let s=0;s<200;s++){let o=xh({stateValues:u,numberUniqueRequired:t,numberToSelect:u.numberToSelect,withReplacement:u.withReplacement,rng:u.selectRng});if(n=o.selectedValues,r=o.selectedIndices,u.type==="math"){if(u.excludedCombinations.some(l=>l.every((c,d)=>c.equals(n[d]))))continue}else if(u.excludedCombinations.some(l=>l.every((c,d)=>c===n[d])))continue;a=!0;break}if(!a)throw Error("By extremely unlikely fluke, couldn't select combination of random values")}if(u.sortResults){let i=[];for(let[a,s]of n.entries())i.push({value:s,index:r[a]});u.type==="number"?i.sort((a,s)=>a.value-s.value):u.type==="letters"&&i.sort((a,s)=>wt(a.value)-wt(s.value)),n=i.map(a=>a.value),r=i.map(a=>a.index)}return{makeEssential:["selectedValues","selectedIndices"],newValues:{selectedValues:n,selectedIndices:r}}}function xh({stateValues:u,numberUniqueRequired:t=1,numberToSelect:e=1,withReplacement:n=!1,rng:r}){let i=[],a=[];if(u.exclude.length+t<.5*u.length){for(let c=0;c<e;c++){let d=!1,p,m;for(let f=0;f<100;f++){let h=r.random();if(m=Math.floor(h*u.length),!(!n&&a.includes(m))){if(p=u.from,m>0&&(u.type==="math"?p=p.add(u.step.multiply(zn.fromAst(m))).expand().simplify():p+=u.step*m),u.type==="math"){if(u.exclude.some(y=>y.equals(p)))continue}else if(u.exclude.includes(p))continue;d=!0;break}}if(!d)throw Error("By extremely unlikely fluke, couldn't select random value");u.type==="letters"&&(p=_t(p,u.lowercase)),i.push(p),a.push(m)}return{selectedValues:i,selectedIndices:a}}let s=[];for(let c=0;c<u.length;c++){let d=u.from;if(c>0&&(u.type==="math"?d=d.add(u.step.multiply(zn.fromAst(c))).expand().simplify():d+=u.step*c),u.type==="math"){if(u.exclude.some(p=>p.equals(d)))continue}else if(u.exclude.includes(d))continue;u.type==="letters"&&(d=_t(d,u.lowercase)),s.push(d)}let o=s.length;if(t>o)throw Error("Cannot select "+t+" unique values from sequence of length "+o);if(t===1){for(let c=0;c<e;c++){let d=r.random(),p=Math.floor(d*o);a.push(p),i.push(s[p])}return{selectedValues:i,selectedIndices:a}}let l=[...Array(s.length).keys()];for(let c=s.length-1;c>0;c--){let d=r.random(),p=Math.floor(d*(c+1));[s[c],s[p]]=[s[p],s[c]],[l[c],l[p]]=[l[p],l[c]]}return i=s.slice(0,e),a=l.slice(0,e),{selectedValues:i,selectedIndices:a}}import Hv from"../_snowpack/pkg/math-expressions.js";var ao=class extends G{static componentType="select";static assignNamesToReplacements=!0;static createsVariants=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["selectedIndices"]}static acceptType=!0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.numberToSelect={default:1},e.withReplacement={default:!1},e}static returnSugarInstructions(){let t=super.returnSugarInstructions();function e({matchedChildren:n,componentProps:r}){let i;r.type?i=r.type:i="math",["math","text","number"].includes(i)||(console.warn(`Invalid type ${i}`),i="math");let a=n.reduce(function(s,o){return o.componentType==="string"?[...s,...o.state.value.split(/\s+/).filter(l=>l).map(l=>i==="math"?Hv.fromText(l):i==="number"?Number(l):l).map(l=>({componentType:"option",children:[{componentType:i,state:{value:l}}]}))]:[...s,o]},[]);return{success:!0,newChildren:a}}return t.push({replacementFunction:e}),t}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastZeroOptions",componentType:"option",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.variants={returnDependencies:()=>({variants:{dependencyType:"variants"}}),definition:function({dependencyValues:e}){return{newValues:{variants:e.variants}}}},t.currentVariantName={returnDependencies:({sharedParameters:e})=>({variant:{dependencyType:"value",value:e.variant}}),definition:({dependencyValues:e})=>({newValues:{currentVariantName:e.variant}})},t.allPossibleVariants={returnDependencies:({sharedParameters:e})=>({allPossibleVariants:{dependencyType:"value",value:e.allPossibleVariants}}),definition:({dependencyValues:e})=>({newValues:{allPossibleVariants:e.allPossibleVariants}})},t.nOptions={additionalStateVariablesDefined:["optionChildren"],returnDependencies:()=>({optionChildren:{dependencyType:"child",childLogicName:"atLeastZeroOptions",variableNames:["selectForVariants","selectWeight"]}}),definition({dependencyValues:e}){return{newValues:{optionChildren:e.optionChildren,nOptions:e.optionChildren.length}}}},t.availableVariants={returnDependencies:()=>({optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},allPossibleVariants:{dependencyType:"stateVariable",variableName:"allPossibleVariants"}}),definition:function({dependencyValues:e}){let n={};for(let[r,i]of e.optionChildren.entries())for(let a of i.stateValues.selectForVariants){let s=a.toLowerCase();n[s]===void 0&&(n[s]=[]),n[s].push(r)}for(let r in n)if(n[r].length!==e.numberToSelect)throw Error("Invalid variant for select.  Variant "+r+" appears in "+n[r].length+" options but number to select is "+numberToSelect);if(Object.keys(n).length>0){for(let r of e.allPossibleVariants)if(!(r in n))throw Error("Some variants are specified for select but no options are specified for possible variant: "+r);for(let r in n)if(!e.allPossibleVariants.includes(r))throw Error("Variant "+r+" that is specified for select is not a possible variant.")}return{newValues:{availableVariants:n}}}},t.selectedIndices={returnDependencies:({sharedParameters:e})=>({numberToSelect:{dependencyType:"stateVariable",variableName:"numberToSelect"},withReplacement:{dependencyType:"stateVariable",variableName:"withReplacement"},optionChildren:{dependencyType:"stateVariable",variableName:"optionChildren"},nOptions:{dependencyType:"stateVariable",variableName:"nOptions"},currentVariantName:{dependencyType:"stateVariable",variableName:"currentVariantName"},variants:{dependencyType:"stateVariable",variableName:"variants"},availableVariants:{dependencyType:"stateVariable",variableName:"availableVariants"},selectRng:{dependencyType:"value",value:e.selectRng,doNotProxy:!0}}),definition:function({dependencyValues:e}){if(e.numberToSelect<1||e.nOptions===0)return{makeEssential:["selectedIndices"],newValues:{selectedIndices:[]},makeImmutable:["selectedIndices"]};if(Number.isNaN(e.numberToSelect))return{newValues:{selectedIndices:null}};if(e.variants&&e.variants.desiredVariant!==void 0){let c=e.variants.desiredVariant.indices;if(c!==void 0){if(c.length!==e.numberToSelect)throw Error("Number of indices specified for select must match number to select");if(c=c.map(Number),!c.every(Number.isInteger))throw Error("All indices specified for select must be integers");let d=e.nOptions;return c=c.map(p=>(p%d+d)%d),{makeEssential:["selectedIndices"],newValues:{selectedIndices:c},makeImmutable:["selectedIndices"]}}}let n=e.availableVariants[e.currentVariantName];if(n!==void 0){if(e.numberToSelect>1){n=[...n];for(let c=e.numberToSelect-1;c>0;c--){let d=e.selectRng.random(),p=Math.floor(d*(c+1));[n[c],n[p]]=[n[p],n[c]]}}return{makeEssential:["selectedIndices"],newValues:{selectedIndices:n},makeImmutable:["selectedIndices"]}}let r=[],i=1;if(e.withReplacement||(i=e.numberToSelect),i>e.nOptions)throw Error("Cannot select "+i+" components from only "+e.nOptions);let a=e.optionChildren.map(c=>c.stateValues.selectWeight),s=a.reduce((c,d)=>c+d);a=a.map(c=>c/s);let o=a.reduce((c,d,p)=>[...c,d+(c[p-1]||0)],[]),l=[...Array(o.length).keys()];for(let c=0;c<e.numberToSelect;c++){let d=e.selectRng.random(),p=-1,m=o.length-1;for(;p<m-1;){let h=Math.floor((p+m)/2);o[h]>d?m=h:p=h}let f=l[m];r.push(f),!e.withReplacement&&c<e.numberToSelect-1&&(a.splice(m,1),l.splice(m,1),s=a.reduce((h,y)=>h+y),a=a.map(h=>h/s),o=a.reduce((h,y,b)=>[...h,y+(h[b-1]||0)],[]))}return{makeEssential:["selectedIndices"],newValues:{selectedIndices:r},makeImmutable:["selectedIndices"]}}},t.isVariantComponent={returnDependencies:()=>({}),definition:()=>({newValues:{isVariantComponent:!0}})},t.selectedVariantInfo={returnDependencies:({componentInfoObjects:e})=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"},variantDescendants:{dependencyType:"descendant",componentTypes:Object.keys(e.componentTypeWithPotentialVariants),variableNames:["isVariantComponent","selectedVariantInfo"],useReplacementsForComposites:!0,recurseToMatchedChildren:!1,variablesOptional:!0,includeNonActiveChildren:!0,ignoreReplacementsOfMatchedComposites:!0,definingChildrenFirst:!0}}),definition({dependencyValues:e}){let n={indices:e.selectedIndices},r=n.subvariants=[];for(let i of e.variantDescendants)i.stateValues.isVariantComponent?r.push(i.stateValues.selectedVariantInfo):i.stateValues.selectedVariantInfo&&r.push(...i.stateValues.selectedVariantInfo.subvariants);return{newValues:{selectedVariantInfo:n}}}},t.readyToExpand={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition:function({dependencyValues:e}){return{newValues:{readyToExpand:e.selectedIndices!==null}}}},t}static createSerializedReplacements({component:t,components:e,componentInfoObjects:n}){let r=[];for(let a of t.stateValues.selectedIndices){let s=t.stateValues.optionChildren[a].componentName,o=e[s],l=Z(o.state.serializedChildren.value),c={componentType:"option",state:{rendered:!0},doenetAttributes:Object.assign({},o.doenetAttributes),children:l,originalName:s};o.variants&&(c.variants=Z(o.variants)),t.stateValues.hide&&(c.state||(c.state={}),c.state.hide=!0),r.push(c)}if(t.variants&&t.variants.desiredVariant!==void 0){let a=t.variants.desiredVariant;if(a!==void 0&&a.subvariants!==void 0&&t.variants.descendantVariantComponents!==void 0){let s=[];for(let o of r)o.variants!==void 0&&(o.variants.isVariantComponent?s.push(o):o.variants.descendantVariantComponents&&s.push(...o.variants.descendantVariantComponents));for(let o in a.subvariants){let l=a.subvariants[o],c=s[o];if(c===void 0)break;c.variants.desiredVariant=l}}}return{replacements:U({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:n}).serializedComponents}}static calculateReplacementChanges(){return[]}static determineNumberOfUniqueVariants({serializedComponent:t}){let e=1,n=!1,r=[],i=[];if(t.state!==void 0&&(t.state.numberToSelect!==void 0&&(e=t.state.numberToSelect),t.state.withReplacement!==void 0&&(n=t.state.withReplacement)),t.children===void 0)return{succes:!1};let a;for(let p of t.children){let m=p.componentType;if(m==="numberToSelect"){let f=!1;if(p.state!==void 0&&p.state.value!==void 0&&(e=Math.round(Number(p.state.value)),f=!0),p.children!==void 0){for(let h of p.children)if(h.componentType==="string"){e=Math.round(Number(h.state.value)),f=!0;break}}if(!f)return{success:!1}}else if(m==="withReplacement"){let f=!1;if(p.state!==void 0&&(p.state.implicitValue!==void 0&&(n=p.state.implicitValue,f=!0),p.state.value!==void 0&&(n=p.state.value,f=!0)),p.children!==void 0){for(let h of p.children)if(h.componentType==="string"){f=!0,h.state.value.trim().toLowerCase()==="true"?n=!0:n=!1;break}}if(!f)return{success:!1}}else{if(m==="selectWeight")return{succes:!1};if(m!=="hide"&&m!=="modifyIndirectly"){m==="string"&&(a=p);let f=1;p.variants!==void 0&&p.variants.numberOfVariants!==void 0&&(f=p.variants.numberOfVariants),r.push(f),i.push(p)}}}if(r.length===0)return{success:!1};if(a!==void 0&&r.length===1){let p=a.state.value.split(/s+/).length;r=Array(p).fill(1)}let s={numberOfVariantsByChild:r,numberToSelect:e,withReplacement:n,childrenToSelect:i};if(n||e===1){let p=r.reduce((f,h)=>f+h),m=Math.pow(p,e);return{success:!0,numberOfVariants:m,uniqueVariantData:s}}let o=r.length;if(e>o)return{success:!1};let l=r[0];if(r.slice(1).every(p=>p===l)){let p=o;for(let f=o-1;f>o-e;f--)p*=f;let m=p*Math.pow(l,e);return{success:!0,numberOfVariants:m,uniqueVariantData:s}}let d=Vh(r,e);return{success:!0,numberOfVariants:d,uniqueVariantData:s}}static getUniqueVariant({serializedComponent:t,variantNumber:e,allComponentClasses:n}){if(t.variants===void 0)return{succes:!1};let r=t.variants.numberOfVariants;if(r===void 0)return{success:!1};if(!Number.isInteger(e)||e<0||e>=r)return{success:!1};let i=t.variants.uniqueVariantData,a=i.numberOfVariantsByChild,s=i.numberToSelect,o=i.withReplacement,l=a.length,c=i.childrenToSelect,d=Bn({numberOfIndices:s,numberOfOptions:l,maxNumber:e+1,withReplacement:o}),p=d.length,m=d.map(w=>({combination:w,numberOfPossibilities:w.reduce((D,I)=>D*a[I],1)})),f=[...Array(p).keys()],h=0,y=f.length,b,g,T=e;for(;y>0;){let D=f.map(I=>m[I]).reduce((I,A)=>Math.min(I,A.numberOfPossibilities),Infinity)-h;if(T<D*y){b=f[T%y],g=h+Math.floor(T/y);break}else h+=D,T-=D*y,f=f.filter(I=>m[I].numberOfPossibilities>h),y=f.length}let N=d[b],v=on({numberOfOptionsByIndex:N.map(w=>a[w]),maxNumber:g+1})[g],C=[],x=!1;for(let[w,D]of N.entries())if(a[D]>1){let I=c[D];if(I.variants.isVariantComponent){let S=n[I.componentType].getUniqueVariant({serializedComponent:I,variantNumber:v[w],allComponentClasses:n});if(!S.success)return{success:!1};C.push(S.desiredVariant)}else{let A=ln({variantNumber:v[w],serializedComponent:I,allComponentClasses:n});if(!A.success)return{success:!1};C.push(...A.desiredVariants)}x=!0}else C.push({});let V={indices:N};return x&&(V.subvariants=C),{success:!0,desiredVariant:V}}},wh=ao,Vh=function(u,t){if(t===0)return 0;if(t===1)return u.reduce((n,r)=>n+r);let e=0;for(let n in u){let r=u[n],i=[...u];i.splice(n,1),e+=r*Vh(i,t-1)}return e};var so=class extends Mt{static componentType="group";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.rendered.default=!0,e}},Dh=so;import Ah from"../_snowpack/pkg/math-expressions.js";var oo=class extends fn{static componentType="animatefromsequence";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.animationOn={default:!1},e.animationMode={default:"increase"},e.animationInterval={default:1e3},e.initialSelectedIndex={default:0},e}updateState(t={}){if(super.updateState(t),t.init&&(this.makePublicStateVariable({variableName:"selectedIndex",componentType:"number"}),this.makePublicStateVariable({variableName:"value",componentType:this.state.type}),this.makePublicStateVariable({variableName:"currentAnimationDirection",componentType:"text"}),this.advanceAnimation=this.advanceAnimation.bind(this)),!(!this.childLogicSatisfied||Object.keys(this.unresolvedState).length>0)){if(this.currentTracker.trackChanges.checkIfVariableChanged(this)){this.state.possibleValues=[];for(let e=0;e<this.state.count;e++){let n=this.state.from;if(e>0&&(this.state.type==="math"?n=n.add(this.state.step.multiply(Ah.fromAst(e))).expand().simplify():n+=this.state.step*e),this.state.type==="math"){if(this.state.exclude.some(r=>r.equals(n)))continue}else if(this.state.exclude.includes(n))continue;this.state.type==="letters"&&(n=this.constructor.numberToLetters(n,this.state.lowercase)),this.state.possibleValues.push(n)}this.state.numberValues=this.state.possibleValues.length}this.state.selectedIndex===void 0?(this.state.selectedIndex=Math.min(this.state.numberValues-1,Math.max(0,this.state.initialselectedindex)),this._state.selectedIndex.essential=!0):this.state.selectedIndex=Ah.math.mod(this.state.selectedIndex,this.state.numberValues),this.state.value=this.state.possibleValues[this.state.selectedIndex],this.state.animationMode=this.state.animationMode.toLowerCase(),this.state.animationMode==="oscillate"?this.state.currentAnimationDirection===void 0&&(this.state.currentAnimationDirection="increase"):this.state.animationMode.substring(0,8)=="decrease"?(this.state.currentAnimationDirection="decrease",this.state.animationMode!=="decrease once"&&(this.state.animationMode="decrease")):(this.state.currentAnimationDirection="increase",this.state.animationMode!=="increase once"&&(this.state.animationMode="increase")),this._state.currentAnimationDirection.essential=!0,this.state.animationOn?this.state.animationPreviouslyOn||(this.state.currentAnimationDirection==="increase"?this.state.selectedIndex===this.state.numberValues-1&&(this.state.animationMode==="increase once"?(this.state.selectedIndex=0,this.state.value=this.state.possibleValues[this.state.selectedIndex]):this.state.animationMode==="oscillate"&&(this.state.currentAnimationDirection="decrease")):this.state.currentAnimationDirection==="decrease"&&this.state.selectedIndex===0&&(this.state.animationMode==="decrease once"?(this.state.selectedIndex=this.state.numberValues-1,this.state.value=this.state.possibleValues[this.state.selectedIndex]):this.state.animationMode==="oscillate"&&(this.state.currentAnimationDirection="inccrease")),this.state.animationID=this.coreFunctions.requestAnimationFrame(this.advanceAnimation,this.state.animationInterval),this.state.animationPreviouslyOn=!0):(this.state.animationPreviouslyOn&&this.coreFunctions.cancelAnimationFrame(this.state.animationID),this.state.animationPreviouslyOn=!1)}}advanceAnimation(){let t,e=!0,n;this.state.currentAnimationDirection==="decrease"?(t=this.state.selectedIndex-1,t<=0&&(this.state.animationMode==="decrease once"?e=!1:this.state.animationMode==="oscillate"&&(n="increase"))):(t=this.state.selectedIndex+1,t>=this.state.numberValues-1&&(this.state.animationMode==="increase once"?e=!1:this.state.animationMode==="oscillate"&&(n="decrease")));let r={selectedIndex:{changes:t}};e||(r.animationOn={changes:!1}),n!==void 0&&(r.currentAnimationDirection={changes:n}),this.coreFunctions.requestUpdate({updateType:"updateValue",updateInstructions:[{componentName:this.componentName,variableUpdates:r}]}),e&&(this.state.animationID=this.coreFunctions.requestAnimationFrame(this.advanceAnimation,this.state.animationInterval))}static createSerializedReplacements(t){let e=[];return t.state.value!==void 0&&e.push({componentType:t.state.type,state:{value:t.state.value,hide:t.state.hide}}),e}static calculateReplacementChanges({component:t}){let e=[];if(t.state.value===void 0){if(t.replacements[0]!==void 0){let r={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToDelete:t.replacements.length};e.push(r)}return e}if(t.replacements[0]===void 0||t.state.type!==t.replacements[0].componentType){let r={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:t.constructor.createSerializedReplacements(t)};return e.push(r),e}let n={changeType:"updateStateVariables",component:t.replacements[0],stateChanges:{value:t.state.value}};return e.push(n),e}allowDownstreamUpdates(t){return t.initialChange||this.state.modifyIndirectly}get variablesUpdatableDownstream(){return["value","selectedIndex","animationOn","currentAnimationDirection"]}calculateDownstreamChanges({stateVariablesToUpdate:t,stateVariableChangesToSave:e,dependenciesToUpdate:n}){let r={};if("selectedIndex"in t&&(r.selectedIndex=t.selectedIndex),"animationOn"in t&&(r.animationOn=t.animationOn),"currentAnimationDirection"in t&&(r.currentAnimationDirection=t.currentAnimationDirection),"value"in t)if(this.state.type==="number"){let o=t.value.changes;if(typeof o!="number"&&(o=o.evaluate_to_constant()),typeof o!="number")return!1;let l=this.state.step,c=-1,d=this.state.possibleValues.length-1;for(;c<d-1;){let m=Math.floor((c+d)/2);l*(this.state.possibleValues[m]-o)>0?d=m:c=m}let p=d;c!==-1&&Math.abs(o-this.state.possibleValues[c])<Math.abs(o-this.state.possibleValues[d])&&(p=c),r.selectedIndex={changes:p}}else{let o=t.value,l=this.state.possibleValues.indexOf(o);if(l===-1)return!1;r.selectedIndex={changes:l}}this.updatePropertySources({newStateVariables:r,dependenciesToUpdate:n});let i=this.updateShadowSources({newStateVariables:r,dependenciesToUpdate:n}),a=i.shadowedStateVariables,s=i.isReplacement;for(let o in r)this._state[o].essential===!0&&!a.has(o)&&!s&&(e[o]=r[o]);return!0}},Sh=oo;var F2=Kt(Zh());import yo from"../_snowpack/pkg/math-expressions.js";var bo=class extends H{static componentType="evaluate";static rendererType="math";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.forceSymbolic={default:!1},e.forceNumeric={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=e.newLeaf({name:"atLeastZeroFunctions",componentType:"function",comparison:"atLeast",number:0,requireConsecutive:!0}),r=e.newLeaf({name:"atMostOneInput",componentType:"input",comparison:"atMost",number:1});return e.newOperator({name:"FunctionsAndMaths",operator:"or",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return delete t.codePre,delete t.expressionWithCodes,delete t.codesAdjacentToStrings,delete t.mathChildrenByArrayComponent,t.canBeModified={returnDependencies:()=>({}),definition:()=>({newValues:{canBeModified:!1}})},t.nResults={returnDependencies:()=>({functionChildren:{dependencyType:"child",childLogicName:"atLeastZeroFunctions"},inputChild:{dependencyType:"child",childLogicName:"atMostOneInput",variableNames:["nComponents"]}}),definition:function({dependencyValues:e}){let n;return e.functionChildren.length>0&&e.inputChild.length===1&&e.inputChild[0].stateValues.nComponents>0?n=e.functionChildren.length:n=0,{newValues:{nResults:n}}}},t.evaluatedResults={isArray:!0,entryPrefixes:["evaluatedResult"],public:!0,componentType:"math",returnArraySizeDependencies:()=>({nResults:{dependencyType:"stateVariable",variableName:"nResults"}}),returnArraySize({dependencyValues:e}){return[e.nResults]},returnArrayDependenciesByKey({arrayKeys:e}){let n={inputChild:{dependencyType:"child",childLogicName:"atMostOneInput",variableNames:["nComponents","maths"]},forceSymbolic:{dependencyType:"stateVariable",variableName:"forceSymbolic"},forceNumeric:{dependencyType:"stateVariable",variableName:"forceNumeric"}},r={};for(let i of e)r[i]={functionChild:{dependencyType:"child",childLogicName:"atLeastZeroFunctions",variableNames:["symbolicf","numericalf","symbolic"],childIndices:[i]}};return{globalDependencies:n,dependenciesByKey:r}},arrayDefinitionByKey({globalDependencyValues:e,dependencyValuesByKey:n,arrayKeys:r}){let i={};if(e.inputChild.length===1&&e.inputChild[0].stateValues.nComponents>0){let a=e.inputChild[0].stateValues.maths[0],s=!1,o;for(let l of r){let c=n[l].functionChild[0];c&&(!e.forceNumeric&&(c.stateValues.symbolic||e.forceSymbolic)?i[l]=c.stateValues.symbolicf(a):(s||(s=!0,o=a.evaluate_to_constant(),o===null&&(o=NaN)),i[l]=yo.fromAst(c.stateValues.numericalf(o))))}}return{newValues:{evaluatedResults:i}}}},t.evaluatedResult={isAlias:!0,targetVariableName:"evaluatedResult1"},t.unnormalizedValue={public:!0,componentType:this.componentType,returnDependencies:()=>({evaluatedResults:{dependencyType:"stateVariable",variableName:"evaluatedResults"}}),definition:function({dependencyValues:e}){return e.evaluatedResults.length===1?{newValues:{unnormalizedValue:e.evaluatedResults[0]}}:e.evaluatedResults.length>1?{newValues:{unnormalizedValue:yo.fromAst(["tuple",...e.evaluatedResults.map(n=>n.tree)])}}:{newValues:{unnormalizedValue:yo.fromAst("\uFF3F")}}}},t}},Jh=bo;import Yh from"../_snowpack/pkg/math-expressions.js";var go=class extends ${static componentType="randomnumber";static previewSerializedComponent({sharedParameters:t}){t.typeForSelectableType="number",t.defaultToPrescribedParameters=!0}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.type={default:"discrete"},e.mean={default:null},e.standarddeviation={default:null},e.variance={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();function n({activeChildrenMatched:p,sharedParameters:m}){let f=p[0],h=f.state.value.split(",");if(h.length===1){let y={componentType:"to",children:[{componentType:"number",children:[{createdComponent:!0,componentName:f.componentName}]}]};return{success:!0,newChildren:[y]}}else if(h.length===2){let y={componentType:"from",children:[{componentType:"number",children:[{componentType:"string",state:{value:h[0].trim()}}]}]},b={componentType:"to",children:[{componentType:"number",children:[{componentType:"string",state:{value:h[1].trim()}}]}]};return{success:!0,newChildren:[y,b],toDelete:[f.componentName]}}else return{success:!1}}let r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),i=e.newLeaf({name:"atMostOneFrom",componentType:"from",comparison:"atMost",number:1}),a=e.newLeaf({name:"atMostOneTo",componentType:"to",comparison:"atMost",number:1}),s=e.newOperator({name:"toFrom",operator:"and",propositions:[i,a]}),o=e.newOperator({name:"sugarXorToFrom",operator:"xor",propositions:[r,s]}),l=e.newLeaf({name:"atMostOneStep",componentType:"step",comparison:"atMost",number:1}),c=e.newLeaf({name:"atMostOneCount",componentType:"count",comparison:"atMost",number:1}),d=e.newLeaf({name:"atLeastZeroExcludes",componentType:"exclude",comparison:"atLeast",number:0});return e.newOperator({name:"sequenceLogic",operator:"and",propositions:[o,l,c,d],setAsBase:!0}),e}updateState(t={}){if(t.init&&(this.state.rng=new this.sharedParameters.rngClass,this._state.from===void 0&&(this._state.from={trackChanges:!0}),this._state.to===void 0&&(this._state.to={trackChanges:!0}),this._state.step===void 0&&(this._state.step={trackChanges:!0}),this._state.count===void 0&&(this._state.count={trackChanges:!0}),this._state.exclude===void 0&&(this._state.exclude={trackChanges:!0,value:[]})),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.number=!0,this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0;return}if(delete this.unresolvedState.number,delete this.unresolvedState.value,delete this.unresolvedState.latex,delete this.unresolvedState.text,this.constructor.getRandomNumberParametersFromChildren(this),Object.keys(this.unresolvedState).length>0){this.unresolvedState.number=!0,this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0;return}if(this._state.value.essential)this._state.number.essential||(this.state.number=this.state.value.evaluate_to_constant());else if(!this._state.number.essential)if(this.state.type==="gaussian")if(this.state.mean===null&&(this.state.mean=0),this.state.variance===null?(this.state.standarddeviation===null&&(this.state.standarddeviation=1),this.state.variance=this.state.standarddeviation**2):this.state.standarddeviation===null?this.state.standarddeviation=Math.sqrt(this.state.variance):this.state.variance=this.state.standarddeviation**2,!(this.state.standarddeviation>0)||!Number.isFinite(this.state.mean)){let n="Invalid mean ("+this.state.mean+") or standard deviation ("+this.state.standarddeviation+") for a gaussian random variable.";console.warn(n),this.state.number=NaN}else{let n=0,r=0;for(;n===0;)n=this.state.rng.random();for(;r===0;)r=this.state.rng.random();let i=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*r);this.state.number=this.state.mean+this.state.standarddeviation*i}else this.state.type==="uniform"?(this.state.from===void 0&&(this.state.from=0),this.state.to===void 0&&(this.state.to=1),this.state.number=this.state.from+this.state.rng.random()*(this.state.to-this.state.from)):this.state.validParameters?(this.state.basedOnFrom||(this.state.from=void 0),this.state.basedOnTo||(this.state.to=void 0),this.state.basedOnStep||(this.state.step=void 0),this.state.basedOnCount||(this.state.count=void 0),!this.state.excludeChildren&&!this._state.exclude.essential&&(this.state.exclude=[]),At.calculateSequenceParameters(this.state),this.state.number=At.selectValues({stateObj:this.state,rng:this.state.rng})[0]):this.state.number=NaN;Number.isFinite(this.state.number)?this.state.value=Yh.fromAst(this.state.number):this.state.value=Yh.fromAst("\uFF3F");let e=this.state.value.round_numbers_to_precision(this.state.displaydigits);this.state.latex=e.toLatex(),this.state.text=e.toString()}static getRandomNumberParametersFromChildren(t){if(t.state.validParameters=!0,t.state.parameterChanged=!1,t.state.type==="gaussian")return;let e=t.currentTracker.trackChanges;e.getVariableChanges({component:t,variable:"type"})&&(["uniform","discrete"].includes(t.state.type)||(console.warn("Unrecognized type ("+t.state.type+") for random number, setting to discrete."),t.state.type="discrete"));let n=e.childrenChanged(t.componentName);if(n){let r=t.childLogic.returnMatches("atMostOneFrom");r.length===1?(t.state.fromChild=t.activeChildren[r[0]],t.state.basedOnFrom=!0):(delete t.state.fromChild,t._state.from.essential&&(t.state.basedOnFrom=!0));let i=t.childLogic.returnMatches("atMostOneTo");i.length===1?(t.state.toChild=t.activeChildren[i[0]],t.state.basedOnTo=!0):(delete t.state.toChild,t._state.to.essential&&(t.state.basedOnTo=!0))}if(t.state.fromChild?t.state.fromChild.unresolvedState.value?t.unresolvedState.from=!0:(n||e.getVariableChanges({component:t.state.fromChild,variable:"value"}))&&(t.state.from=t.state.fromChild.state.value,t.state.parameterChanged=!0):t._state.from.essential&&e.getVariableChanges({component:t,variable:"from"})&&(t.state.parameterChanged=!0),t.state.toChild?t.state.toChild.unresolvedState.value?t.unresolvedState.to=!0:(n||e.getVariableChanges({component:t.state.toChild,variable:"value"}))&&(t.state.to=t.state.toChild.state.value,t.state.parameterChanged=!0):t._state.to.essential&&e.getVariableChanges({component:t,variable:"to"})&&(t.state.parameterChanged=!0),t.state.type!=="uniform"){if(n){let r=t.childLogic.returnMatches("atMostOneStep");r.length===1?(t.state.stepChild=t.activeChildren[r[0]],t.state.basedOnStep=!0):(delete t.state.stepChild,t._state.step.essential&&(t.basedOnStep=!0));let i=t.childLogic.returnMatches("atMostOneCount");i.length===1?(t.state.countChild=t.activeChildren[i[0]],t.state.basedOnCount=!0):(delete t.state.countChild,t._state.count.essential&&(t.state.basedOnCount=!0));let a=t.childLogic.returnMatches("atLeastZeroExcludes");a.length>0?t.state.excludeChildren=a.map(s=>t.activeChildren[s]):delete t.state.excludeChildren}t.state.stepChild?t.state.stepChild.unresolvedState.value?(t.unresolvedState.step=!0,t.state.step=void 0):(n||e.getVariableChanges({component:t.state.stepChild,variable:"value"}))&&(t.state.step=t.state.stepChild.state.value,t.state.parameterChanged=!0):t._state.step.essential&&e.getVariableChanges({component:t,variable:"step"})&&(t.state.parameterChanged=!0),t.state.countChild?t.state.countChild.unresolvedState.value?(t.unresolvedState.count=!0,t.state.count=void 0):(n||e.getVariableChanges({component:t.state.countChild,variable:"number"}))&&(t.state.count=t.state.countChild.state.number,t.state.parameterChanged=!0):t._state.count.essential&&e.getVariableChanges({component:t,variable:"count"})&&(t.state.parameterChanged=!0),t.state.excludeChildren?t.state.excludeChildren.some(r=>r.unresolvedState.value)?t.unresolvedState.exclude=!0:(n||t.state.excludeChildren.some(r=>e.getVariableChanges({component:r,variable:"values"})))&&(t.state.exclude=t.state.excludeChildren.reduce((r,i)=>[...r,...i.state.values],[]),t.state.parameterChanged=!0):t._state.exclude.essential&&e.getVariableChanges({component:t,variable:"exclude"})&&(t.state.parameterChanged=!0),t.state.count!==void 0&&(!Number.isInteger(t.state.count)||t.state.count<0)&&(console.log("Invalid count for discrete uniform random number.  Must be a non-negative integer."),t.state.validParameters=!1),t.state.step!==void 0&&(Number.isFinite(t.state.step)||(t.state.step.evaluate_to_constant&&(t.state.step=t.state.step.evaluate_to_constant()),Number.isFinite(t.state.step)||(console.log("Invalid step for discrete uniform random number.  Must be a number."),t.state.validParameters=!1)))}}},bn=go;var vo=class extends G{static componentType="generaterandomnumbers";static assignNamesToReplacements=!0;static previewSerializedComponent=bn.previewSerializedComponent;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.numberOfSamples={default:1},e.withreplacement={default:!1},e}static returnChildLogic=bn.returnChildLogic;updateState(t={}){if(t.init&&(this.state.seed!==void 0?this.state.rng=new this.sharedParameters.rngClass(this.state.seed):this.state.rng=new this.sharedParameters.rngClass,this._state.from===void 0&&(this._state.from={trackChanges:!0}),this._state.to===void 0&&(this._state.to={trackChanges:!0}),this._state.step===void 0&&(this._state.step={trackChanges:!0}),this._state.count===void 0&&(this._state.count={trackChanges:!0}),this._state.exclude===void 0&&(this._state.exclude={trackChanges:!0,value:[]}),this.replacementsToWithhold=0),super.updateState(t),!this.childLogicSatisfied){this.state.randomResults=[];return}if(bn.getRandomNumberParametersFromChildren(this),Object.keys(this.unresolvedState).length>0){this.state.randomResults=[];return}if(this.state.randomResults=[],this.state.type==="gaussian")if(this.state.mean===null&&(this.state.mean=0),this.state.variance===null?(this.state.standarddeviation===null&&(this.state.standarddeviation=1),this.state.variance=this.state.standarddeviation**2):this.state.standarddeviation===null&&(this.state.standarddeviation=Math.sqrt(this.state.variance)),!(this.state.standarddeviation>0)||!Number.isFinite(this.state.mean)){let n="Invalid mean ("+this.state.mean+") or standard deviation ("+this.state.standarddeviation+") for a gaussian random variable.";console.warn(n)}else for(let n=0;n<this.state.numberOfSamples;n++){let r=0,i=0;for(;r===0;)r=this.state.rng.random();for(;i===0;)i=this.state.rng.random();let a=Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*i);this.state.randomResults.push(this.state.mean+this.state.standarddeviation*a)}else if(this.state.type==="uniform"){this.state.from===void 0&&(this.state.from=0),this.state.to===void 0&&(this.state.to=1);let n=this.state.to-this.state.from;for(let r=0;r<this.state.numberOfSamples;r++)this.state.randomResults.push(this.state.from+this.state.rng.random()*n)}else if(this.state.validParameters){this.state.basedOnFrom||(this.state.from=void 0),this.state.basedOnTo||(this.state.to=void 0),this.state.basedOnStep||(this.state.step=void 0),this.state.basedOnCount||(this.state.count=void 0),!this.state.excludeChildren&&!this._state.exclude.essential&&(this.state.exclude=[]),At.calculateSequenceParameters(this.state);let n=1;this.state.withreplacement||(n=this.state.numberOfSamples),n>this.state.count?console.warn("Cannot randomly sample "+n+" values from a sequence of length "+this.state.count):this.state.randomResults=At.selectValues({stateObj:this.state,numberUniqueRequired:n,numberToSelect:this.state.numberOfSamples,withReplacement:this.state.withreplacement,rng:this.state.rng})}let e=this.doenetAttributes.componentName;e!==void 0&&(this.doenetAttributes.newNamespace===!0?this.state.randomNumberNamespace=e+"/":this.state.randomNumberNamespace=e.substring(0,e.lastIndexOf("/")+1))}static createSerializedReplacements({component:t}){let e=[],n=t.doenetAttributes.assignNames;for(let[r,i]of t.state.randomResults.entries()){let a;n!==void 0&&r<n.length?a=n[r]:a="_"+t.componentName+"_"+r,t.state.randomNumberNamespace!==void 0&&(a=t.state.randomNumberNamespace+a),e.push({componentType:"number",doenetAttributes:{componentName:a},state:{value:i}})}return{replacements:e}}static calculateReplacementChanges({component:t}){let e=[],n=0;t.doenetAttributes.assignNames!==void 0&&(n=t.doenetAttributes.assignNames.length);let r=t.replacements.length-t.replacementsToWithhold;if(r>t.state.randomResults.length){let a=t.replacementsToWithhold;if(t.replacementsToWithhold===0){let s=Math.max(t.state.randomResults.length,n),o=Math.max(0,t.replacements.length-s);if(a=Math.max(0,n-t.state.randomResults.length),o>0){let l={changeType:"delete",changeTopLevelReplacements:!0,firstReplacementInd:s,numberReplacementsToDelete:o};e.push(l)}}else a=t.replacements.length-t.state.randomResults.length;if(a!==t.replacementsToWithhold){let s={changeType:"changeReplacementsToWithhold",replacementsToWithhold:a};e.push(s)}}else if(r<t.state.randomResults.length){let a=[],s=t.doenetAttributes.assignNames,o=Math.max(0,t.replacements.length-t.state.randomResults.length);if(o!==t.replacementsToWithhold){let c={changeType:"changeReplacementsToWithhold",replacementsToWithhold:o};e.push(c)}for(let c=t.replacements.length;c<t.state.randomResults.length;c++){let d;s!==void 0&&c<s.length?d=s[c]:d="_"+t.componentName+"_"+c,t.state.randomNumberNamespace!==void 0&&(d=t.state.randomNumberNamespace+d),a.push({componentType:"number",doenetAttributes:{componentName:d},state:{value:t.state.randomResults[c]}})}let l={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:t.replacements.length,numberReplacementsToReplace:0,serializedReplacements:a};e.push(l)}let i=Math.min(t.replacements.length,t.state.randomResults.length);for(let a=0;a<i;a++){let s={changeType:"updateStateVariables",component:t.replacements[a],stateChanges:{value:t.state.randomResults[a]}};e.push(s)}return e}},Qh=vo;import zr from"../_snowpack/pkg/math-expressions.js";var Co=class extends G{static componentType="substitute";static defaultType="number";static previewSerializedComponent({serializedComponent:t,sharedParameters:e,components:n}){if(t.children===void 0)return;let r;for(let[s,o]of t.children.entries())if(o.componentType==="type"||o.createdComponent&&n[o.componentName].componentType==="type"){r=s;break}let i;for(let[s,o]of t.children.entries())if(o.componentType==="simplify"||o.createdComponent&&n[o.componentName].componentType==="simplify"){i=s;break}let a=[];return r!==void 0&&a.push({createChildren:[r]}),i!==void 0&&a.push({createChildren:[i]}),a.push({callMethod:"setUpTypeSimplify"}),a}static setUpTypeSimplify({sharedParameters:t,definingChildrenSoFar:e,serializedComponent:n}){let r;for(let a of e)if(a!==void 0&&a.componentType==="type"){r=a;break}if(r!==void 0){if(!["math","text"].includes(r.state.value))throw Error("Substitute type must be text or math");t.defaultType=r.state.value}let i;for(let a of e)if(a!==void 0&&a.componentType==="simplify"){i=a;break}i!==void 0&&(t.simplify=i.state.value)}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.type={default:void 0},e.format={default:"text"},e.simplify={default:"full"},e.displaydigits={default:10},e.rendermode={default:"inline"},e.matchwholeword={default:!1},e.casesensitive={default:!1},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=function({activeChildrenMatched:o,sharedParameters:l}){let c=Gt({childrenList:o});if(!c.success)return{success:!1};let d=c.toDelete,p="math";l.defaultType==="text"&&(p="text");let m={componentType:p};p==="math"&&l.simplify!==void 0&&(m.state={simplify:l.simplify});let f=Object.assign({},m);f.children=c.pieces[0];let h=[{componentType:"pattern",children:[f]}],y=c.pieces.slice(1);for(let b of y){let g=cr(b);if(!g.foundVector)return{sucess:!1};d.push(...g.toDelete);let T=[],N=Object.assign({},m);N.children=g.vectorComponents[0],T.push(N),N=Object.assign({},m),N.children=g.vectorComponents[1],T.push(N),h.push({componentType:"replace",children:T})}return{success:!0,newChildren:h,toDelete:d}},r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),i=e.newLeaf({name:"exactlyOnePattern",componentType:"pattern",number:1}),a=e.newLeaf({name:"atLeastZeroReplaces",componentType:"replace",comparison:"atLeast",number:0}),s=e.newOperator({name:"substitutionChildren",operator:"and",propositions:[i,a]});return e.newOperator({name:"sugarXorSubstitutionChildren",operator:"xor",propositions:[r,s],setAsBase:!0}),e}updateState(t={}){if(super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.originalValue=!0,this.unresolvedState.value=!0;return}let e=this.currentTracker.trackChanges,n=e.childrenChanged(this.componentName);if(n){let a=this.childLogic.returnMatches("exactlyOnePattern");this.state.patternParent=this.activeChildren[a[0]]}if(!this.state.patternParent.childLogicSatisfied){this.unresolvedState.originalValue=!0,this.unresolvedState.value=!0;return}let r=!1,i=e.getVariableChanges({component:this,variable:"type"});if(n||i||e.childrenChanged(this.state.patternParent))if(r=!0,this.state.patternChild=this.state.patternParent.activeChildren[0],this.state.patternChild instanceof this.componentInfoObjects.allComponentClasses.math)this.state.type="math",this.state.patternClass="math";else if(this.state.patternChild instanceof this.componentInfoObjects.allComponentClasses.text)this.state.type="text",this.state.patternClass="text";else if(this.state.patternChild instanceof this.componentInfoObjects.allComponentClasses.string)this.state.patternClass="string";else{console.warn("Substitute must have a math, text or string pattern."),this.unresolvedState.value=!0,this.state.patternClass="invalid";return}if(this.state.patternClass==="invalid"){console.warn("Substitute must have a math, text or string pattern.");return}if(this.state.patternChild.unresolvedState.value){this.unresolvedState.originalValue=!0,this.unresolvedState.value=!0;return}if(this.state.patternClass==="string"?(n||e.getVariableChanges({component:this.state.patternChild,variable:"value"})||e.getVariableChanges({component:this,variable:"type"}))&&(r=!0,this.state.type==="text"?this.state.originalValue=this.state.patternChild.state.value:(this.state.type="math",this.state.originalValue=this.parseMathString(this.state.patternChild.state.value)),delete this.unresolvedState.originalValue):(n||e.getVariableChanges({component:this.state.patternChild,variable:"value"}))&&(r=!0,this.state.originalValue=this.state.patternChild.state.value,delete this.unresolvedState.originalValue),n){let a=this.childLogic.returnMatches("atLeastZeroReplaces");this.state.replaceChildren=a.map(s=>this.activeChildren[s])}if(this.state.replaceChildren.some(a=>!a.childLogicSatisfied||a.activeChildren.some(s=>s.unresolvedState.value))){this.unresolvedState.value=!0;return}if(n||i||this.state.replaceChildren.some(a=>e.childrenChanged(a)||a.activeChildren.some(s=>e.getVariableChanges({component:s,variable:"value"})))){r=!0,this.state.replaces=[];for(let a of this.state.replaceChildren){let s=[];for(let o of a.activeChildren)if(this.state.type==="math")if(o instanceof this.componentInfoObjects.allComponentClasses.math)s.push(o.state.value);else if(o instanceof this.componentInfoObjects.allComponentClasses.string)s.push(this.parseMathString(o.state.value));else{console.warn("Substitute of math type must have math or string replaces"),this.unresolvedState.value=!0;return}else if(this.state.type==="text")if(o instanceof this.componentInfoObjects.allComponentClasses.text||o instanceof this.componentInfoObjects.allComponentClasses.string)s.push(o.state.value);else{console.warn("Substitute of text type must have text or string replaces"),this.unresolvedState.value=!0;return}this.state.replaces.push(s)}}if(e.getVariableChanges({component:this,variable:"simplify"})&&(r=!0),!!r)if(delete this.unresolvedState.value,this.state.numSubstitutions=this.state.replaces.length,this.state.type==="text"){let a=function(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};this.state.value=this.state.originalValue;for(let s=0;s<this.state.numSubstitutions;s++){let o,l="g";this.state.casesensitive||(l="gi"),this.state.matchwholeword?o=new RegExp("\\b"+a(this.state.replaces[s][0])+"\\b",l):o=new RegExp(a(this.state.replaces[s][0]),l);let c=this.state.replaces[s][1];this.state.value=this.state.value.replace(o,c)}}else{this.state.value=this.state.originalValue.subscripts_to_strings();for(let a=0;a<this.state.numSubstitutions;a++)this.state.value=this.state.value.substitute({[this.state.replaces[a][0].subscripts_to_strings().tree]:this.state.replaces[a][1].subscripts_to_strings()});this.state.value=this.state.value.strings_to_subscripts(),this.state.value=Ge({value:this.state.value,simplify:this.state.simplify})}}parseMathString(t){if(this.state.format==="text")try{return zr.fromText(t)}catch(e){return console.log("Invalid value for a math of text format: "+t),zr.fromAst("\uFF3F")}else if(this.state.format==="latex")try{return zr.fromLatex(t)}catch(e){return console.log("Invalid value for a math of latex format: "+t),zr.fromAst("\uFF3F")}else throw Error("Unrecongized math format")}static createSerializedReplacements({component:t}){if(Object.keys(t.unresolvedState).length>0)return{replacements:[]};let e={componentType:t.state.type,state:{value:t.state.value}};if(t.state.type==="math")for(let n of["simplify","displaydigits","rendermode"])t._state[n].usedDefault||(e.state[n]=t.state.item);return{replacements:[e]}}static calculateReplacementChanges({component:t}){let e=[];if(t.state.type!==t.replacements[0].componentType){let n=this.createSerializedReplacements({component:t}).replacements,r={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:1,serializedReplacements:n};e.push(r)}else{let n={value:t.state.value};if(t.state.type==="math")for(let i of["simplify","displaydigits","rendermode"])t._state[i].usedDefault||(n[i]=t.state.item);let r={changeType:"updateStateVariables",component:t.replacements[0],stateChanges:n};e.push(r)}return e}},ey=Co;var To=class extends Ze{static componentType="offsets";updateState(t={}){if(t.init===!0&&(this.makePublicStateVariableArray({variableName:"offsets",componentType:"offset"}),this.makePublicStateVariableArrayEntry({entryName:"offset",arrayVariableName:"offsets"})),super.updateState(t),this.unresolvedState.maths){this.unresolvedState.offsets=!0;return}if(this.currentTracker.trackChanges.getVariableChanges({component:this,variable:"maths"})){this.state.offsets=[];for(let e=1;e<=this.state.ncomponents;e++){let n=this.state.maths[e-1];this.state.offsets.push(n)}}}},ty=To;import de from"../_snowpack/pkg/math-expressions.js";var No=class extends H{static componentType="discreteinfiniteset";static previewSerializedComponent({serializedComponent:t,sharedParameters:e,components:n}){if(t.children===void 0)return;let r;for(let[a,s]of t.children.entries())if(s.componentType==="simplify"||s.createdComponent&&n[s.componentName].componentType==="simplify"){r=a;break}let i=[];return r!==void 0&&i.push({createChildren:[r]}),i.push({callMethod:"setUpSimplify"}),i}static setUpSimplify({sharedParameters:t,definingChildrenSoFar:e,serializedComponent:n}){let r;for(let i of e)if(i!==void 0&&i.componentType==="simplify"){r=i;break}r!==void 0&&(t.simplifyChild=r)}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.minindex={default:de.fromAst(["-",Infinity])},e.maxindex={default:de.fromAst(Infinity)},e}static returnChildLogic(t){let e=super.returnChildLogic(t);e.deleteAllLogic();let n=function({activeChildrenMatched:o,sharedParameters:l}){let c=Gt({childrenList:o});if(!c.success||c.pieces.length!==2)return{success:!1};let d=c.toDelete,p=[],m=[],f=cr(c.pieces[0]);if(f.foundVector)for(let y of f.vectorComponents){let b={componentType:"offset",children:y};l.simplifyChild!==void 0&&b.children.push({componentType:"ref",children:[{componentType:"reftarget",state:{targetName:l.simplifyChild.componentName}}]}),m.push(b)}else m=c.pieces[0];p.push({componentType:"offsets",children:m});let h=result.pieces[1];return l.simplifyChild!==void 0&&(h.push({componentType:"ref",children:[{componentType:"reftarget",state:{targetName:l.simplifyChild.componentName}}]}),p.push({componentType:"period",children:h})),{success:!0,newChildren:p,toDelete:d}},r=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,replacementFunction:n}),i=e.newLeaf({name:"atMostOneOffsets",componentType:"offsets",comparison:"atMost",number:1}),a=e.newLeaf({name:"atMostOnePeriod",componentType:"period",comparison:"atMost",number:1}),s=e.newOperator({name:"offsetsAndPeriod",operator:"and",propositions:[i,a]});return e.newOperator({name:"SugarXorOffsetsPeriod",operator:"xor",propositions:[r,s],setAsBase:!0}),e}updateState(t={}){if(t.init&&(this.makePublicStateVariable({variableName:"offsets",componentType:"offsets"}),this.makePublicStateVariable({variableName:"period",componentType:"period"}),this.makePublicStateVariable({variableName:"redundantoffsets",componentType:"boolean"})),super.updateState(t),!this.childLogicSatisfied){this.unresolvedState.offsets=!0,this.unresolvedState.period=!0,this.unresolvedState.redundantoffsets=!0;return}let e=!1,n=!1,r=this.currentTracker.trackChanges,i=r.childrenChanged(this.componentName);if(i){e=!0;let s=this.childLogic.returnMatches("atMostOneOffsets");s.length===1?this.state.offsetsChild=this.activeChildren[s[0]]:(delete this.state.offsetsChild,this._state.value.essential?r.getVariableChanges({component:this,variable:"value"})&&(e=!0):(n=!0,this.state.offsets=[],this.state.nOffsets=0,this.state.value=de.fromAst("\uFF3F")));let o=this.childLogic.returnMatches("atMostOnePeriod");o.length===1?this.state.periodChild=this.activeChildren[o[0]]:(delete this.state.periodChild,this._state.value.essential?r.getVariableChanges({component:this,variable:"value"})&&(e=!0):(n=!0,this.state.period=de.fromAst("\uFF3F"),this.state.value=de.fromAst("\uFF3F")))}if(n){delete this.unresolvedState.value,delete this.unresolvedState.latex,delete this.unresolvedState.text,delete this.unresolvedState.offsets,delete this.unresolvedState.period,delete this.unresolvedState.redundantoffsets;return}if(this.state.offsetsChild){if(this.state.offsetsChild.unresolvedState.maths){this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0,this.unresolvedState.offsets=!0,this.unresolvedState.period=!0,this.unresolvedState.redundantoffsets=!0;return}(i||r.getVariableChanges({component:this.state.offsetsChild,variable:"maths"}))&&(e=!0,this.state.offsets=this.state.offsetsChild.state.maths,this.state.nOffsets=this.state.offsetsChild.state.ncomponents)}if(this.state.periodChild){if(this.state.periodChild.unresolvedState.value){this.unresolvedState.value=!0,this.unresolvedState.latex=!0,this.unresolvedState.text=!0,this.unresolvedState.offsets=!0,this.unresolvedState.period=!0,this.unresolvedState.redundantoffsets=!0;return}(i||r.getVariableChanges({component:this.state.periodChild,variable:"value"}))&&(e=!0,this.state.period=this.state.periodChild.state.value)}if(!e&&(!this._state.value.essential||!r.getVariableChanges({component:this,variable:"value"})))return;if(delete this.unresolvedState.value,delete this.unresolvedState.latex,delete this.unresolvedState.text,delete this.unresolvedState.offsets,delete this.unresolvedState.period,delete this.unresolvedState.redundantoffsets,this._state.value.essential)if(Array.isArray(this.state.value.tree)&&this.state.value.tree[0]==="discrete_infinite_set"){let s=this.state.value.tree[1];this.state.offsets=[de.fromAst(s[1])],this.state.period=de.fromAst(s[2]),this.state.minindex=de.fromAst(s[3]),this.state.maxindex=de.fromAst(s[4]);for(let o=2;o<this.state.value.tree.length;o++)s=this.state.value.tree[o],this.state.offsets.push(de.fromAst(s[1])),this.state.period.equals(de.fromAst(s[2]))||console.warn("Have not implemented discrete infinite set with different periods."),this.state.minindex.equals(de.fromAst(s[3]))||console.warn("Have not implemented discrete infinite set with different minindices."),this.state.maxindex.equals(de.fromAst(s[4]))||console.warn("Have not implemented discrete infinite set with different maxindices.");this.state.nOffsets=this.state.value.tree.length-1}else this.state.value=de.fromAst("\uFF3F"),this.state.period=de.fromAst("uFF3F"),this.state.offsets=[];else if(this.state.nOffsets===0||this.state.period.tree==="\uFF3F")this.state.value=de.fromAst("\uFF3F");else if(this.state.nOffsets===1)this.state.value=de.create_discrete_infinite_set({offsets:this.state.offsets[0],periods:this.state.period,min_index:this.state.minindex,max_index:this.state.maxindex});else{let s=de.fromAst(["list",...this.state.offsets.map(o=>o.tree)]);this.state.value=de.create_discrete_infinite_set({offsets:s,periods:this.state.period,min_index:this.state.minindex,max_index:this.state.maxindex})}this.state.redundantoffsets=!1;let a=this.state.period.evaluate_to_constant();if(a!==null)for(let s=0;s<this.state.nOffsets;s++){for(let o=0;o<s;o++){let l=this.state.offsets[s].subtract(this.state.offsets[o]).evaluate_to_constant();if(l!==null&&Math.abs(l%a)<1e-10*a){this.state.redundantoffsets=!0;break}}if(this.state.redundantoffsets)break}this.state.latex=""}},ny=No;var xo=class extends Q{static componentType="image";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.width={default:null,forRenderer:!0},e.height={default:null,forRenderer:!0},e.description={default:null,forRenderer:!0},e.source={required:!0,forRenderer:!0},e}},ry=xo;var Vo=class extends Q{static componentType="video";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.width={default:500,forRenderer:!0},e.height={default:500,forRenderer:!0},e.youtube={default:null,forRenderer:!0},e.source={default:null,forRenderer:!0},e}actions={recordVideoStarted:this.recordVideoStarted.bind(this),recordVideoWatched:this.recordVideoWatched.bind(this),recordVideoPaused:this.recordVideoPaused.bind(this),recordVideoSkipped:this.recordVideoSkipped.bind(this),recordVideoCompleted:this.recordVideoCompleted.bind(this)};recordVideoStarted({beginTime:t,duration:e,rate:n}){this.coreFunctions.requestRecordEvent({verb:"played",object:{componentName:this.componentName,componentType:this.componentType,duration:e},context:{startingPoint:t,rate:n}})}recordVideoWatched({beginTime:t,endTime:e,duration:n,rates:r}){this.coreFunctions.requestRecordEvent({verb:"watched",object:{componentName:this.componentName,componentType:this.componentType,duration:n},context:{startingPoint:t,endingPoint:e,rates:r}})}recordVideoPaused({endTime:t,duration:e}){this.coreFunctions.requestRecordEvent({verb:"paused",object:{componentName:this.componentName,componentType:this.componentType,duration:e},context:{endingPoint:t}})}recordVideoSkipped({beginTime:t,endTime:e,duration:n}){this.coreFunctions.requestRecordEvent({verb:"skipped",object:{componentName:this.componentName,componentType:this.componentType,duration:n},context:{startingPoint:t,endingPoint:e}})}recordVideoCompleted({duration:t}){this.coreFunctions.requestRecordEvent({verb:"completed",object:{componentName:this.componentName,componentType:this.componentType,duration:t}})}},iy=Vo;var wo=class extends Q{static componentType="embed";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.width={default:500,forRenderer:!0},e.height={default:500,forRenderer:!0},e.geogebra={default:null,forRenderer:!0},e.fromMathInsight={default:null,forRenderer:!0},e.encodedGeogebraContent={default:null,forRenderer:!0},e}},ay=wo;var Do=class extends R{static componentType="meta";static createPropertiesObject(){return{keywords:{isArray:!0,singularName:"keyword"}}}},sy=Do;var Ao=class extends Q{static componentType="hint";static includeBlankStringChildren=!0;static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneTitle",componentType:"title",comparison:"atMost",number:1}),r=e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroBlock",componentType:"_block",comparison:"atLeast",number:0}),a=e.newOperator({name:"inlineOrBlock",operator:"or",propositions:[r,i]});return e.newOperator({name:"titleAndContent",operator:"and",propositions:[n,a],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.showHints={forRenderer:!0,returnDependencies:()=>({hide:{dependencyType:"stateVariable",variableName:"hide"},showHintsFlag:{dependencyType:"flag",flagName:"showHints"}}),definition({dependencyValues:e}){return{newValues:{showHints:e.showHintsFlag&&!e.hide}}}},t.open={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!1,returnDependencies:()=>({}),definition(){return{useEssentialOrDefaultValue:{open:{variablesToCheck:["open"]}}}},inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"open",value:e.open}]}}},t.titleDefinedByChildren={forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle"}}),definition({dependencyValues:e}){return{newValues:{titleDefinedByChildren:e.titleChild.length===1}}}},t.title={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({titleChild:{dependencyType:"child",childLogicName:"atMostOneTitle",variableNames:["text"]}}),definition({dependencyValues:e}){return e.titleChild.length===0?{newValues:{title:"Hint"}}:{newValues:{title:e.titleChild[0].stateValues.text}}}},t.childrenToRender={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"titleAndContent"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.children.map(n=>n.componentName)}}}},t}revealHint(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!0}],event:{verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}})}closeHint(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}actions={revealHint:this.revealHint.bind(this),closeHint:this.closeHint.bind(this)}},oy=Ao;var So=class extends Q{constructor(t){super(t);this.revealSolution=this.revealSolution.bind(this),this.revealSolutionCallBack=this.revealSolutionCallBack.bind(this)}static componentType="solution";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return delete e.hide,e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneHide",componentType:"hide",comparison:"atMost",number:1}),r=e.newLeaf({name:"atLeastZeroInline",componentType:"_inline",comparison:"atLeast",number:0}),i=e.newLeaf({name:"atLeastZeroBlock",componentType:"_block",comparison:"atLeast",number:0});return e.newOperator({name:"inlineOrBlock",operator:"or",propositions:[n,r,i],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.hide={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!1,returnDependencies:()=>({hideChild:{dependencyType:"child",childLogicName:"atMostOneHide",variableNames:["value"]},displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:e}){return e.displayMode==="none"?{newValues:{hide:!0}}:e.hideChild.length===1?{newValues:{hide:e.hideChild[0].stateValues.value}}:{useEssentialOrDefaultValue:{hide:{variablesToCheck:["hide"]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.displayMode==="none"?{success:!1}:n.hideChild.length===1?{success:!0,instructions:[{setDependency:"hideChild",desiredValue:e.hide,childIndex:0,variableIndex:0}]}:{success:!0,instructions:[{setSetVariable:"hide",value:e.hide}]}}},t.open={public:!0,componentType:"boolean",forRenderer:!0,defaultValue:!1,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:e}){return e.displayMode==="displayed"?{newValues:{open:!0}}:e.displayMode==="none"?{newValues:{open:!1}}:{useEssentialOrDefaultValue:{open:{variablesToCheck:["open"]}}}},inverseDefinition({desiredStateVariableValues:e,dependencyValues:n}){return n.displayMode==="displayed"||n.displayMode==="none"?{success:!1}:{success:!0,instructions:[{setStateVariable:"open",value:e.open}]}}},t.canBeClosed={forRenderer:!0,returnDependencies:()=>({displayMode:{dependencyType:"flag",flagName:"solutionDisplayMode"}}),definition({dependencyValues:e}){return e.displayMode==="button"?{newValues:{canBeClosed:!0}}:{newValues:{canBeClosed:!1}}}},t.message={public:!0,componentType:"text",forRenderer:!0,defaultValue:"",returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{message:{variablesToCheck:["message"]}}}),inverseDefinition({desiredStateVariableValues:e}){return{success:!0,instructions:[{setStateVariable:"message",value:e.message}]}}},t.childrenToRender={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"inlineOrBlock"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.children.map(n=>n.componentName)}}}},t}revealSolutionCallBack({allowView:t,message:e,scoredComponent:n}){let r=[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:t},{updateType:"updateValue",componentName:this.componentName,stateVariable:"message",value:e}],i;t&&(r.push({updateType:"updateValue",componentName:n,stateVariable:"viewedSolution",value:!0}),i={verb:"viewed",object:{componentName:this.componentName,componentType:this.componentType}}),this.coreFunctions.requestUpdate({updateInstructions:r,event:i})}revealSolution(){let{scoredItemNumber:t,scoredComponent:e}=this.coreFunctions.calculateScoredItemNumberOfContainer(this.componentName);this.coreFunctions.recordSolutionView({itemNumber:t,scoredComponent:e,callBack:this.revealSolutionCallBack})}closeSolution(){this.coreFunctions.requestUpdate({updateInstructions:[{updateType:"updateValue",componentName:this.componentName,stateVariable:"open",value:!1}],event:{verb:"closed",object:{componentName:this.componentName,componentType:this.componentType}}})}actions={revealSolution:this.revealSolution.bind(this),closeSolution:this.closeSolution.bind(this)};static includeBlankStringChildren=!0},ly=So;var Io=class extends z{static componentType="intcomma";static rendererType="text";static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.originalValue=t.value,st({stateVariableDefinitions:t,oldName:"value",newName:"originalValue"}),t.value={public:!0,componentType:this.componentType,forRenderer:!0,returnDependencies:()=>({originalValue:{dependencyType:"stateVariable",variableName:"originalValue"}}),definition:function({dependencyValues:e}){let n=e.originalValue,r=/^(-?\d+)(\d{3})/,i=n.match(r);for(;i!==null;)n=n.replace(r,"$1,$2"),i=n.match(r);return{newValues:{value:n}}}},t}},uy=Io;function St(u){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?St=function(t){return typeof t}:St=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(u)}function Ae(u,t){if(!(u instanceof t))throw new TypeError("Cannot call a class as a function")}function cy(u,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(u,n.key,n)}}function qe(u,t,e){return t&&cy(u.prototype,t),e&&cy(u,e),u}function tt(u,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(t&&t.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),t&&Po(u,t)}function jr(u){return jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},jr(u)}function Po(u,t){return Po=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},Po(u,t)}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(u){return!1}}function aC(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function sC(u,t){return t&&(typeof t=="object"||typeof t=="function")?t:aC(u)}function nt(u){var t=iC();return function(){var n=jr(u),r;if(t){var i=jr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return sC(this,r)}}var dy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split("");function oC(u){u=u||"_";for(var t=u+"-",e=0;e<7;e++)t+=dy[Math.floor(Math.random()*dy.length)];return t}var py=oC,my={"!":"\xA1","?":"\xBF\u0241",'"':'\u201C\u201D"\u275D\u275E',"'":"\u2018\u201B\u275B\u275C","-":"\u2014\u2013",a:"\xAA\xC0\xC1\xC2\xC3\xC4\xC5\xE0\xE1\xE2\xE3\xE4\xE5\u0100\u0101\u0102\u0103\u0104\u0105\u01CD\u01CE\u01DE\u01DF\u01E0\u01E1\u01FA\u01FB\u0200\u0201\u0202\u0203\u0226\u0227\u023A\u0386\u0391\u0394\u039B\u03AC\u03B1\u03BB\u0410\u0430\u0434\u0466\u0467\u04D0\u04D1\u04D2\u04D3\u019B\u0245\xE6",b:"\xDF\xFE\u0180\u0181\u0182\u0183\u0184\u0185\u0243\u0392\u03B2\u03D0\u03E6\u0411\u0412\u042A\u042C\u0432\u044A\u044C\u0462\u0463\u048C\u048D",c:"\xA2\xA9\xC7\xE7\u0106\u0107\u0108\u0109\u010A\u010B\u010C\u010D\u0186\u0187\u0188\u023B\u023C\u037B\u037C\u037D\u03F2\u03F9\u03FD\u03FE\u0421\u0441\u0454\u0480\u0481\u04AA\u04AB",d:"\xD0\u010E\u010F\u0110\u0111\u0189\u018A\u0221\u018B\u018C\u01F7",e:"\xC8\xC9\xCA\xCB\xE8\xE9\xEA\xEB\u0112\u0113\u0114\u0115\u0116\u0117\u0118\u0119\u011A\u011B\u018E\u018F\u0190\u01DD\u0204\u0205\u0206\u0207\u0228\u0229\u0246\u0247\u0388\u0395\u039E\u03A3\u03AD\u03B5\u03BE\u03F1\u03F5\u03F6\u0400\u0401\u0415\u042D\u0435\u0450\u0451\u04BC\u04BD\u04BE\u04BF\u04D6\u04D7\u04D8\u04D9\u04DA\u04DB\u04EC\u04ED",f:"\u0191\u0192\u03DC\u03DD\u04FA\u04FB\u0492\u0493\u017F",g:"\u011C\u011D\u011E\u011F\u0120\u0121\u0122\u0123\u0193\u01E4\u01E5\u01E6\u01E7\u01F4\u01F5",h:"\u0124\u0125\u0126\u0127\u0195\u01F6\u021E\u021F\u0389\u0397\u0402\u040A\u040B\u041D\u043D\u0452\u045B\u04A2\u04A3\u04A4\u04A5\u04BA\u04BB\u04C9\u04CA",I:"\xCC\xCD\xCE\xCF",i:"\xEC\xED\xEE\xEF\u0128\u0129\u012A\u012B\u012C\u012D\u012E\u012F\u0130\u0131\u0196\u0197\u0208\u0209\u020A\u020B\u038A\u0390\u03AA\u03AF\u03B9\u03CA\u0406\u0407\u0456\u0457",j:"\u0134\u0135\u01F0\u0237\u0248\u0249\u03F3\u0408\u0458",k:"\u0136\u0137\u0138\u0198\u0199\u01E8\u01E9\u039A\u03BA\u040C\u0416\u041A\u0436\u043A\u045C\u049A\u049B\u049C\u049D\u049E\u049F\u04A0\u04A1",l:"\u0139\u013A\u013B\u013C\u013D\u013E\u013F\u0140\u0141\u0142\u019A\u01AA\u01C0\u01CF\u01D0\u0234\u023D\u0399\u04C0\u04CF",m:"\u039C\u03FA\u03FB\u041C\u043C\u04CD\u04CE",n:"\xD1\xF1\u0143\u0144\u0145\u0146\u0147\u0148\u0149\u014A\u014B\u019D\u019E\u01F8\u01F9\u0220\u0235\u039D\u03A0\u03AE\u03B7\u03DE\u040D\u0418\u0419\u041B\u041F\u0438\u0439\u043B\u043F\u045D\u048A\u048B\u04C5\u04C6\u04E2\u04E3\u04E4\u04E5\u03C0",o:"\xD2\xD3\xD4\xD5\xD6\xD8\xF0\xF2\xF3\xF4\xF5\xF6\xF8\u014C\u014D\u014E\u014F\u0150\u0151\u019F\u01A0\u01A1\u01D1\u01D2\u01EA\u01EB\u01EC\u01ED\u01FE\u01FF\u020C\u020D\u020E\u020F\u022A\u022B\u022C\u022D\u022E\u022F\u0230\u0231\u038C\u0398\u039F\u03B8\u03BF\u03C3\u03CC\u03D5\u03D8\u03D9\u03EC\u03ED\u03F4\u041E\u0424\u043E\u0472\u0473\u04E6\u04E7\u04E8\u04E9\u04EA\u04EB",p:"\u01A4\u01BF\u03A1\u03C1\u03F7\u03F8\u03FC\u0420\u0440\u048E\u048F\xDE",q:"\u024A\u024B",r:"\u0154\u0155\u0156\u0157\u0158\u0159\u01A6\u0210\u0211\u0212\u0213\u024C\u024D\u0403\u0413\u042F\u0433\u044F\u0453\u0490\u0491",s:"\u015A\u015B\u015C\u015D\u015E\u015F\u0160\u0161\u01A7\u01A8\u0218\u0219\u023F\u0405\u0455",t:"\u0162\u0163\u0164\u0165\u0166\u0167\u01AB\u01AC\u01AD\u01AE\u021A\u021B\u0236\u023E\u0393\u03A4\u03C4\u03EE\u0422\u0442",u:"\xB5\xD9\xDA\xDB\xDC\xF9\xFA\xFB\xFC\u0168\u0169\u016A\u016B\u016C\u016D\u016E\u016F\u0170\u0171\u0172\u0173\u01AF\u01B0\u01B1\u01B2\u01D3\u01D4\u01D5\u01D6\u01D7\u01D8\u01D9\u01DA\u01DB\u01DC\u0214\u0215\u0216\u0217\u0244\u03B0\u03BC\u03C5\u03CB\u03CD",v:"\u03BD\u0474\u0475\u0476\u0477",w:"\u0174\u0175\u019C\u03C9\u03CE\u03D6\u03E2\u03E3\u0428\u0429\u0448\u0449\u0461\u047F",x:"\xD7\u03A7\u03C7\u03D7\u03F0\u0425\u0445\u04B2\u04B3\u04FC\u04FD\u04FE\u04FF",y:"\xDD\xFD\xFF\u0176\u0177\u0178\u01B3\u01B4\u0232\u0233\u024E\u024F\u038E\u03A5\u03AB\u03B3\u03C8\u03D2\u03D3\u03D4\u040E\u0423\u0443\u0447\u045E\u0470\u0471\u04AE\u04AF\u04B0\u04B1\u04EE\u04EF\u04F0\u04F1\u04F2\u04F3",z:"\u0179\u017A\u017B\u017C\u017D\u017E\u01A9\u01B5\u01B6\u0224\u0225\u0240\u0396\u03B6"},Oo={};Object.keys(my).forEach(function(u){my[u].split("").forEach(function(t){Oo[t]=u})});var lC=function(t){var e=t.split("");return e.forEach(function(n,r){Oo[n]&&(e[r]=Oo[n])}),e.join("")},Lo=lC,uC=/([A-Z]\.)+[A-Z]?,?$/,cC=/^[A-Z]\.,?$/,dC=/[A-Z]{2,}('s|,)?$/,pC=/([a-z]\.)+[a-z]\.?$/,mC=function(t){return uC.test(t)===!0||pC.test(t)===!0||cC.test(t)===!0||dC.test(t)===!0},fy=mC,fC=/[a-z\u00C0-\u00FF] ?\/ ?[a-z\u00C0-\u00FF]/,hC=function(t){t=t||"",t=t.toLowerCase(),t=t.trim();var e=t;return t=Lo(t),fC.test(t)===!0&&(t=t.replace(/\/.*/,"")),t=t.replace(/^[#@]/,""),t=t.replace(/[,;.!?]+$/,""),t=t.replace(/[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]+/g,"'"),t=t.replace(/[\u0022\u00AB\u00BB\u201C\u201D\u201E\u201F\u2033\u2034\u2036\u2037\u2E42\u301D\u301E\u301F\uFF02]+/g,'"'),t=t.replace(/\u2026/g,"..."),t=t.replace(/\u2013/g,"-"),t=t.replace(/([aeiou][ktrp])in$/,"$1ing"),/^(re|un)-?[^aeiou]./.test(t)===!0&&(t=t.replace("-","")),fy(t)&&(t=t.replace(/\./g,"")),/^[:;]/.test(t)===!1&&(t=t.replace(/\.{3,}$/g,""),t=t.replace(/[",\.!:;\?\)]+$/g,""),t=t.replace(/^['"\(]+/g,"")),t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.trim(),t===""&&(t=e),t=t.replace(/([0-9]),([0-9])/g,"$1$2"),t},yC=hC,bC=function(t){return t=t.replace(/['’]s$/,""),t=t.replace(/s['’]$/,"s"),t},gC=bC,vC=/^[ \n\t\.\[\](){}⟨⟩:,،、‒–—―…!‹›«»‐\-?‘’;\/⁄·&*•^†‡°¡¿※№÷×ºª%‰+−=‱¶′″‴§~\|‖¦©℗®℠™¤₳฿\u0022\uFF02\u0027\u201C\u201F\u201B\u201E\u2E42\u201A\u2035\u2036\u2037\u301D\u0060\u301F]+/,CC=/[ \n\t\.'\[\](){}⟨⟩:,،、‒–—―…!‹›«»‐\-?‘’;\/⁄·&*@•^†‡°¡¿※#№÷×ºª‰+−=‱¶′″‴§~\|‖¦©℗®℠™¤₳฿\u0022\uFF02\u201D\u00B4\u301E]+$/,hy=/\//,Ro=/['’]/,TC=/^[a-z]\.([a-z]\.)+/i,NC=/^[-+\.][0-9]/,xC=/^'[0-9]{2}/,VC=function(t){var e=t,n="",r="";t=t.replace(vC,function(s){return n=s,(n==="-"||n==="+"||n===".")&&NC.test(t)||n==="'"&&xC.test(t)?(n="",s):""}),t=t.replace(CC,function(s){return r=s,Ro.test(s)&&/[sn]['’]$/.test(e)&&Ro.test(n)===!1?(r=r.replace(Ro,""),"'"):TC.test(t)===!0?(r=r.replace(/\./,""),"."):""}),t===""&&(e=e.replace(/ *$/,function(s){return r=s||"",""}),t=e,n="",r=r);var i=yC(t),a={text:t,clean:i,reduced:gC(i),pre:n,post:r};return hy.test(t)&&t.split(hy).forEach(function(s){a.alias=a.alias||{},a.alias[s.trim()]=!0}),a},yy=VC;function Ee(u){var t={exports:{}};return u(t,t.exports),t.exports}var wC=Ee(function(u,t){var e=/^[A-Z][a-z'\u00C0-\u00FF]/,n=/^[A-Z]+s?$/;t.toUpperCase=function(){return this.text=this.text.toUpperCase(),this},t.toLowerCase=function(){return this.text=this.text.toLowerCase(),this},t.toTitleCase=function(){return this.text=this.text.replace(/^ *[a-z\u00C0-\u00FF]/,function(r){return r.toUpperCase()}),this},t.isUpperCase=function(){return n.test(this.text)},t.isTitleCase=function(){return e.test(this.text)},t.titleCase=t.isTitleCase}),DC=Ee(function(u,t){var e=/(\u0022|\uFF02|\u0027|\u201C|\u2018|\u201F|\u201B|\u201E|\u2E42|\u201A|\u00AB|\u2039|\u2035|\u2036|\u2037|\u301D|\u0060|\u301F)/,n=/(\u0022|\uFF02|\u0027|\u201D|\u2019|\u201D|\u2019|\u201D|\u201D|\u2019|\u00BB|\u203A|\u2032|\u2033|\u2034|\u301E|\u00B4|\u301E)/;t.hasPost=function(r){return this.post.indexOf(r)!==-1},t.hasPre=function(r){return this.pre.indexOf(r)!==-1},t.hasQuote=function(){return e.test(this.pre)||n.test(this.post)},t.hasQuotation=t.hasQuote,t.hasComma=function(){return this.hasPost(",")},t.hasPeriod=function(){return this.hasPost(".")===!0&&this.hasPost("...")===!1},t.hasExclamation=function(){return this.hasPost("!")},t.hasQuestionMark=function(){return this.hasPost("?")||this.hasPost("\xBF")},t.hasEllipses=function(){return this.hasPost("..")||this.hasPost("\u2026")||this.hasPre("..")||this.hasPre("\u2026")},t.hasSemicolon=function(){return this.hasPost(";")},t.hasSlash=function(){return/\//.test(this.text)},t.hasHyphen=function(){var r=/^(-|–|—)$/;return r.test(this.post)||r.test(this.pre)},t.hasDash=function(){var r=/ (-|–|—) /;return r.test(this.post)||r.test(this.pre)},t.hasContraction=function(){return Boolean(this.implicit)},t.addPunctuation=function(r){return(r===","||r===";")&&(this.post=this.post.replace(r,"")),this.post=r+this.post,this}}),AC=function(t,e){var n=t.length,r=e.length;if(n===0)return r;if(r===0)return n;var i=(r>n?r:n)+1;if(Math.abs(n-r)>(i||100))return i||100;for(var a=[],s=0;s<i;s++)a[s]=[s],a[s].length=i;for(var o=0;o<i;o++)a[0][o]=o;for(var l,c,d,p,m,f,h=1;h<=n;++h)for(c=t[h-1],l=1;l<=r;++l){if(h===l&&a[h][l]>4)return n;d=e[l-1],p=c===d?0:1,m=a[h-1][l]+1,(f=a[h][l-1]+1)<m&&(m=f),(f=a[h-1][l-1]+p)<m&&(m=f);var y=h>1&&l>1&&c===e[l-2]&&t[h-2]===d&&(f=a[h-2][l-2]+p)<m;y?a[h][l]=f:a[h][l]=m}return a[n][r]},SC=function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3;if(t===e)return 1;if(t.length<n||e.length<n)return 0;var r=AC(t,e),i=Math.max(t.length,e.length),a=i===0?0:r/i,s=1-a;return s},by=SC,Hr=function(){},IC=function(t,e,n,r){if(e.id===t.id||e.anything===!0)return!0;if(e.start===!0&&n!==0||e.end===!0&&n!==r-1)return!1;if(e.word!==void 0){if(t.implicit!==null&&t.implicit===e.word||t.alias!==void 0&&t.alias.hasOwnProperty(e.word)||e.soft===!0&&e.word===t.root)return!0;if(e.fuzzy!==void 0){var i=by(e.word,t.reduced);if(i>e.fuzzy||e.soft===!0&&(i=by(e.word,t.root),i>e.fuzzy))return!0}return e.word===t.clean||e.word===t.text||e.word===t.reduced}return e.tag!==void 0?t.tags[e.tag]===!0:e.method!==void 0?typeof t[e.method]=="function"&&t[e.method]()===!0:e.regex!==void 0?e.regex.test(t.clean):e.fastOr!==void 0?t.implicit&&e.fastOr.hasOwnProperty(t.implicit)===!0?!0:e.fastOr.hasOwnProperty(t.reduced)||e.fastOr.hasOwnProperty(t.text):e.choices!==void 0?e.operator==="and"?e.choices.every(function(a){return Hr(t,a,n,r)}):e.choices.some(function(a){return Hr(t,a,n,r)}):!1};Hr=function(t,e,n,r){var i=IC(t,e,n,r);return e.negative===!0?!i:i};var PC=Hr,OC={},LC=function(t,e,n){return PC(this,t,e,n)},RC=function(){return fy(this.text)},FC=function(){return this.text===""&&Boolean(this.implicit)},kC=function(){return Object.keys(this.tags).some(function(t){return OC[t]!==!0})},MC=function(t){var e=t.transforms,n=this.implicit||this.clean;if(this.tags.Plural&&(n=e.toSingular(n,t)),this.tags.Verb&&!this.tags.Negative&&!this.tags.Infinitive){var r=null;this.tags.PastTense?r="PastTense":this.tags.Gerund?r="Gerund":this.tags.PresentTense?r="PresentTense":this.tags.Participle?r="Participle":this.tags.Actor&&(r="Actor"),n=e.toInfinitive(n,t,r)}this.root=n},_C={doesMatch:LC,isAcronym:RC,isImplicit:FC,isKnown:kC,setRoot:MC},BC=/[\s-]/,EC=/^[A-Z-]+$/,$C=function(t,e,n){t=t||{};var r=this.text,i=this.pre,a=this.post;return t.reduced===!0&&(r=this.reduced||""),t.root===!0&&(r=this.root||""),t.implicit===!0&&this.implicit&&(r=this.implicit||""),t.normal===!0&&(r=this.clean||this.text||""),t.root===!0&&(r=this.root||this.reduced||""),t.unicode===!0&&(r=Lo(r)),t.titlecase===!0&&(this.tags.ProperNoun&&!this.titleCase()||(this.tags.Acronym?r=r.toUpperCase():EC.test(r)&&!this.tags.Acronym&&(r=r.toLowerCase()))),t.lowercase===!0&&(r=r.toLowerCase()),t.acronyms===!0&&this.tags.Acronym&&(r=r.replace(/\./g,"")),(t.whitespace===!0||t.root===!0)&&(i="",a=" ",(BC.test(this.post)===!1||t.last)&&!this.implicit&&(a="")),t.punctuation===!0&&!t.root&&(this.hasPost(".")===!0?a="."+a:this.hasPost("?")===!0?a="?"+a:this.hasPost("!")===!0?a="!"+a:this.hasPost(",")===!0?a=","+a:this.hasEllipses()===!0&&(a="..."+a)),e!==!0&&(i=""),n!==!0&&(a=""),t.abbreviations===!0&&this.tags.Abbreviation&&(a=a.replace(/^\./,"")),i+r+a},zC={textOut:$C},jC={Auxiliary:1,Possessive:1},HC=function(t,e){var n=Object.keys(t.tags),r=e.tags;return n=n.sort(function(i,a){return jC[a]||!r[a]?-1:r[a]?r[i]?r[i].lineage.length>r[a].lineage.length?1:r[i].isA.length>r[a].isA.length?-1:0:0:1}),n},qC=HC,KC={text:!0,tags:!0,implicit:!0,whitespace:!0,clean:!1,id:!1,index:!1,offset:!1,bestTag:!1},WC=function(t,e){t=t||{},t=Object.assign({},KC,t);var n={};return t.text&&(n.text=this.text),t.normal&&(n.normal=this.clean),t.tags&&(n.tags=Object.keys(this.tags)),t.clean&&(n.clean=this.clean),(t.id||t.offset)&&(n.id=this.id),t.implicit&&this.implicit!==null&&(n.implicit=this.implicit),t.whitespace&&(n.pre=this.pre,n.post=this.post),t.bestTag&&(n.bestTag=qC(this,e)[0]),n},UC={json:WC},GC=Object.assign({},wC,DC,_C,zC,UC);function gy(){return typeof window!="undefined"&&window.document}var gn=function(t,e){for(t=t.toString();t.length<e;)t+=" ";return t},XC=function(t,e,n){if(gy()){console.log("%c"+gn(t.clean,3)+"  + "+e+" ","color: #6accb2;");return}var r="[33m"+gn(t.clean,15)+"[0m + [32m"+e+"[0m ";n&&(r=gn(r,35)+" "+n+""),console.log(r)},ZC=function(t,e,n){if(gy()){console.log("%c"+gn(t.clean,3)+"  - "+e+" ","color: #AB5850;");return}var r="[33m"+gn(t.clean,3)+" [31m - #"+e+"[0m ";n&&(r=gn(r,35)+" "+n),console.log(r)},JC=function(t){return Object.prototype.toString.call(t)==="[object Array]"},YC=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},jn={logTag:XC,logUntag:ZC,isArray:JC,titleCase:YC},vy=function(t,e,n,r){var i=r.tags;if(!(e===""||e==="."||e==="-")&&(e[0]==="#"&&(e=e.replace(/^#/,"")),e=jn.titleCase(e),t.tags[e]!==!0)){var a=r.isVerbose();a===!0&&jn.logTag(t,e,n),t.tags[e]=!0,i.hasOwnProperty(e)===!0&&(i[e].isA.forEach(function(s){t.tags[s]=!0,a===!0&&jn.logTag(t,"\u2192 "+s)}),t.unTag(i[e].notA,"\u2190",r))}},QC=function(t,e,n,r){if(typeof e!="string")for(var i=0;i<e.length;i++)vy(t,e[i],n,r);else vy(t,e,n,r)},Cy=QC,eT=/^[a-z]/,tT=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},Ty=function(t,e,n,r){var i=r.isVerbose();if(e==="*")return t.tags={},t;e=e.replace(/^#/,""),eT.test(e)===!0&&(e=tT(e)),t.tags[e]===!0&&(delete t.tags[e],i===!0&&jn.logUntag(t,e,n));var a=r.tags;if(a[e])for(var s=a[e].lineage,o=0;o<s.length;o++)t.tags[s[o]]===!0&&(delete t.tags[s[o]],i===!0&&jn.logUntag(t," - "+s[o]));return t},nT=function(t,e,n,r){if(typeof e!="string"&&e){for(var i=0;i<e.length;i++)Ty(t,e[i],n,r);return}Ty(t,e,n,r)},rT=nT,iT=function u(t,e,n){var r=n.tags;if(e[0]==="#"&&(e=e.replace(/^#/,"")),r[e]===void 0)return!0;for(var i=r[e].notA||[],a=0;a<i.length;a++)if(t.tags[i[a]]===!0)return!1;return r[e].isA!==void 0?u(t,r[e].isA,n):!0},Ny=iT,aT=function(t,e,n){return Cy(this,t,e,n),this},sT=function(t,e,n){return Ny(this,t,n)&&Cy(this,t,e,n),this},oT=function(t,e,n){return rT(this,t,e,n),this},lT=function(t,e){return Ny(this,t,e)},uT={tag:aT,tagSafe:sT,unTag:oT,canBe:lT},Hn=function(){function u(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";Ae(this,u),t=String(t);var e=yy(t);this.text=e.text||"",this.clean=e.clean,this.reduced=e.reduced,this.root=null,this.implicit=null,this.pre=e.pre||"",this.post=e.post||"",this.tags={},this.prev=null,this.next=null,this.id=py(e.clean),this.isA="Term",e.alias&&(this.alias=e.alias)}return qe(u,[{key:"set",value:function(e){var n=yy(e);return this.text=n.text,this.clean=n.clean,this}}]),u}();Hn.prototype.clone=function(){var u=new Hn(this.text);return u.pre=this.pre,u.post=this.post,u.clean=this.clean,u.reduced=this.reduced,u.root=this.root,u.implicit=this.implicit,u.tags=Object.assign({},this.tags),u};Object.assign(Hn.prototype,GC);Object.assign(Hn.prototype,uT);var Fo=Hn,cT=function(t){if(this.length===0)return[];if(this.cache.terms)return t!==void 0?this.cache.terms[t]:this.cache.terms;for(var e=[this.pool.get(this.start)],n=0;n<this.length-1;n+=1){var r=e[e.length-1].next;if(r===null){console.error("Compromise error: Linked list broken in phrase '"+this.start+"'");break}var i=this.pool.get(r);if(e.push(i),t!==void 0&&t===n)return e[t]}return t===void 0&&(this.cache.terms=e),t!==void 0?e[t]:e},dT=function(t){var e=this;if(t){var n=this.buildFrom(this.start,this.length);return n.cache=this.cache,n}var r=this.terms(),i=r.map(function(a){return a.clone()});return i.forEach(function(a,s){e.pool.add(a),i[s+1]&&(a.next=i[s+1].id),i[s-1]&&(a.prev=i[s-1].id)}),this.buildFrom(i[0].id,i.length)},pT=function(){var t=this.terms();return t[t.length-1]},mT=function(t){if(this.length===0||!t)return!1;if(this.start===t)return!0;if(this.cache.terms){for(var e=this.cache.terms,n=0;n<e.length;n++)if(e[n].id===t)return!0;return!1}for(var r=this.start,i=0;i<this.length-1;i+=1){var a=this.pool.get(r);if(a===void 0)return console.error("Compromise error: Linked list broken. Missing term '".concat(r,"' in phrase '").concat(this.start,`'
`)),!1;if(a.next===t)return!0;r=a.next}return!1},fT=function(){return this.terms().filter(function(t){return t.text!==""}).length},hT=function(){for(var t=this.terms(0);t.prev;)t=this.pool.get(t.prev);for(var e=t.id,n=1;t.next;)t=this.pool.get(t.next),n+=1;return this.buildFrom(e,n)},yT={terms:cT,clone:dT,lastTerm:pT,hasId:mT,wordCount:fT,fullSentence:hT},bT=function(t){return t.replace(/ +$/,"")},gT=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;typeof t=="string"&&(t==="normal"?t={whitespace:!0,unicode:!0,lowercase:!0,punctuation:!0,acronyms:!0,abbreviations:!0,implicit:!0,normal:!0}:t==="clean"?t={titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,normal:!0}:t==="reduced"?t={punctuation:!1,titlecase:!1,lowercase:!0,whitespace:!0,unicode:!0,implicit:!0,reduced:!0}:t==="implicit"?t={punctuation:!0,implicit:!0,whitespace:!0,trim:!0}:t==="root"?t={titlecase:!1,lowercase:!0,punctuation:!0,whitespace:!0,unicode:!0,implicit:!0,root:!0}:t={});var r=this.terms(),i=!1;r[0]&&r[0].prev===null&&r[r.length-1].next===null&&(i=!0);var a=r.reduce(function(s,o,l){if(l===0&&o.text===""&&o.implicit!==null&&!t.implicit)return s;t.last=n&&l===r.length-1;var c=!0,d=!0;i===!1&&(l===0&&e&&(c=!1),l===r.length-1&&n&&(d=!1));var p=o.textOut(t,c,d);return s+p},"");return i===!0&&n&&(a=bT(a)),t.trim===!0&&(a=a.trim()),a},vT={text:gT},CT=function(){var t=this.terms();if(t.length>0){t[0].pre=t[0].pre.replace(/^\s+/,"");var e=t[t.length-1];e.post=e.post.replace(/\s+$/,"")}return this},TT={trim:CT},NT=/[.?!]\s*$/,xT=function(t,e){if(NT.test(e)){var n=t.match(/\s*$/);return e+n}return t},VT=function(t,e){e[0].pre=t[0].pre;var n=t[t.length-1],r=e[e.length-1];r.post=xT(n.post,r.post),n.post="",n.post===""&&(n.post+=" ")},wT=function(t,e,n){var r=t[t.length-1],i=e[e.length-1],a=r.next;if(r.next=e[0].id,i.next=a,a){var s=n.get(a);s.prev=i.id}var o=t[0].id;if(o){var l=e[0];l.prev=o}},DT=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})},AT=function(t,e,n){var r=t.terms(),i=e.terms();VT(r,i),wT(r,i,t.pool);var a=[t],s=t.start,o=[n];return o=o.concat(n.parents()),o.forEach(function(l){var c=l.list.filter(function(d){return d.hasId(s)});a=a.concat(c)}),a=DT(a),a.forEach(function(l){l.length+=e.length}),t.cache={},t},xy=AT,ST=/ /,IT=function(t){var e=t[t.length-1];ST.test(e.post)===!1&&(e.post+=" ")},PT=function(t,e,n){var r=n[n.length-1];r.next=t.start;var i=t.pool,a=i.get(t.start);if(a.prev){var s=i.get(a.prev);s.next=e.start}n[0].prev=t.terms(0).prev,t.terms(0).prev=r.id},OT=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})},LT=function(t,e,n){var r=t.start,i=e.terms();IT(i),PT(t,e,i);var a=[t],s=[n];return s=s.concat(n.parents()),s.forEach(function(o){var l=o.list.filter(function(c){return c.hasId(r)||c.hasId(e.start)});a=a.concat(l)}),a=OT(a),a.forEach(function(o){o.length+=e.length,o.start===r&&(o.start=e.start),o.cache={}}),t},RT=LT,FT=function(t,e,n,r){var i=t.parents();i.push(t),i.forEach(function(a){var s=a.list.find(function(o){return o.hasId(e)});!s||(s.length-=n,s.start===e&&(s.start=r.id),s.cache={})}),t.list=t.list.filter(function(a){return!(!a.start||!a.length)})},kT=function(t,e){var n=e.pool(),r=t.terms(),i=n.get(r[0].prev)||{},a=n.get(r[r.length-1].next)||{};r[0].implicit&&i.implicit&&(i.set(i.implicit),i.post+=" "),FT(e,t.start,t.length,a),i&&(i.next=a.id),a&&(a.prev=i.id)},Vy=kT,MT=function(t,e){return xy(this,t,e),this},_T=function(t,e){return RT(this,t,e),this},BT=function(t){return Vy(this,t),this},ET=function(t,e){var n=this.length;xy(this,t,e);var r=this.buildFrom(this.start,this.length);r.length=n,Vy(r,e)},$T=function(t){var e=this.terms(),n={before:null,match:null,after:null},r=e.findIndex(function(o){return o.id===t.start});if(r===-1)return n;var i=e.slice(0,r);i.length>0&&(n.before=this.buildFrom(i[0].id,i.length));var a=e.slice(r,r+t.length);a.length>0&&(n.match=this.buildFrom(a[0].id,a.length));var s=e.slice(r+t.length,e.length);return s.length>0&&(n.after=this.buildFrom(s[0].id,s.length,this.pool)),n},zT={append:MT,prepend:_T,delete:BT,replace:ET,splitOn:$T},jT=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n={};return t.text&&(n.text=this.text()),t.normal&&(n.normal=this.text("normal")),t.clean&&(n.clean=this.text("clean")),t.reduced&&(n.reduced=this.text("reduced")),t.implicit&&(n.implicit=this.text("implicit")),t.root&&(n.root=this.text("root")),t.trim&&(n.text&&(n.text=n.text.trim()),n.normal&&(n.normal=n.normal.trim()),n.reduced&&(n.reduced=n.reduced.trim())),t.terms&&(t.terms===!0&&(t.terms={}),n.terms=this.terms().map(function(r){return r.json(t.terms,e)})),n},HT={json:jT},qT=function(t){t||(t=".*");var e=this.pool,n=[],r=function o(l){var c=e.get(l);!c||(n.push(c),c.prev&&o(c.next))},i=this.terms(),a=i[i.length-1];if(r(a.next),n.length===0)return[];var s=this.buildFrom(n[0].id,n.length);return s.match(t)},KT=function(t){t||(t=".*");var e=this.pool,n=[],r=function s(o){var l=e.get(o);!l||(n.push(l),l.prev&&s(l.prev))},i=e.get(this.start);if(r(i.prev),n.length===0)return[];var a=this.buildFrom(n[n.length-1].id,n.length);return a.match(t)},WT={lookAhead:qT,lookBehind:KT},UT=Object.assign({},yT,vT,TT,zT,HT,WT),GT=function(t,e){if(e.length===0)return!0;for(var n=0;n<e.length;n+=1){var r=e[n];if(r.optional!==!0&&r.negative!==!0&&r.start===!0&&n>0||r.anything===!0&&r.negative===!0)return!0}return!1},XT=GT,ut=Ee(function(u,t){t.getGreedy=function(e,n){for(var r=Object.assign({},e.regs[e.r],{start:!1,end:!1}),i=e.t;e.t<e.terms.length;e.t+=1){if(n&&e.terms[e.t].doesMatch(n,e.start_i+e.t,e.phrase_length))return e.t;var a=e.t-i+1;if(r.max!==void 0&&a===r.max)return e.t;if(e.terms[e.t].doesMatch(r,e.start_i+e.t,e.phrase_length)===!1)return r.min!==void 0&&a<r.min?null:e.t}return e.t},t.greedyTo=function(e,n){var r=e.t;if(!n)return e.terms.length;for(;r<e.terms.length;r+=1)if(e.terms[r].doesMatch(n,e.start_i+r,e.phrase_length)===!0)return r;return null},t.isEndGreedy=function(e,n){if(e.end===!0&&e.greedy===!0&&n.start_i+n.t<n.phrase_length-1){var r=Object.assign({},e,{end:!1});if(n.terms[n.t].doesMatch(r,n.start_i+n.t,n.phrase_length)===!0)return!0}return!1},t.doOrBlock=function(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=e.regs[e.r],i=!1,a=0;a<r.choices.length;a+=1){var s=r.choices[a];if(i=s.every(function(o,l){var c=0,d=e.t+l+n+c;if(e.terms[d]===void 0)return!1;var p=e.terms[d].doesMatch(o,d+e.start_i,e.phrase_length);if(p===!0&&o.greedy===!0)for(var m=1;m<e.terms.length;m+=1){var f=e.terms[d+m];if(f){var h=f.doesMatch(o,e.start_i+m,e.phrase_length);if(h===!0)c+=1;else break}}return n+=c,p}),i){n+=s.length;break}}return i&&r.greedy===!0?t.doOrBlock(e,n):n},t.doAndBlock=function(e){var n=0,r=e.regs[e.r],i=r.choices.every(function(a){var s=a.every(function(o,l){var c=e.t+l;return e.terms[c]===void 0?!1:e.terms[c].doesMatch(o,c,e.phrase_length)});return s===!0&&a.length>n&&(n=a.length),s});return i===!0?n:!1},t.getGroup=function(e,n,r){if(e.groups[e.groupId])return e.groups[e.groupId];var i=e.terms[n].id;return e.groups[e.groupId]={group:String(r),start:i,length:0},e.groups[e.groupId]}}),ZT=function(t,e,n,r){for(var i={t:0,terms:t,r:0,regs:e,groups:{},start_i:n,phrase_length:r,hasGroup:!1,groupId:null,previousGroup:null};i.r<e.length;i.r+=1){var a=e[i.r];if(i.hasGroup=typeof a.named=="string"||typeof a.named=="number",i.hasGroup===!0){var s=e[i.r-1];s&&s.named===a.named&&i.previousGroup?i.groupId=i.previousGroup:(i.groupId=py(a.named),i.previousGroup=i.groupId)}if(!i.terms[i.t]){var o=e.slice(i.r).some(function(x){return!x.optional});if(o===!1)break;return null}if(a.anything===!0&&a.greedy===!0){var l=ut.greedyTo(i,e[i.r+1]);if(a.min!==void 0&&l-i.t<a.min)return null;if(a.max!==void 0&&l-i.t>a.max){i.t=i.t+a.max;continue}if(l===null)return null;if(i.hasGroup===!0){var c=ut.getGroup(i,i.t,a.named);c.length=l-i.t}i.t=l;continue}if(a.choices!==void 0&&a.operator==="or"){var d=ut.doOrBlock(i);if(d){if(a.negative===!0)return null;if(i.hasGroup===!0){var p=ut.getGroup(i,i.t,a.named);p.length+=d}i.t+=d;continue}else if(!a.optional)return null}if(a.choices!==void 0&&a.operator==="and"){var m=ut.doAndBlock(i);if(m){if(a.negative===!0)return null;if(i.hasGroup===!0){var f=ut.getGroup(i,i.t,a.named);f.length+=m}i.t+=m;continue}else if(!a.optional)return null}var h=i.terms[i.t],y=h.doesMatch(a,i.start_i+i.t,i.phrase_length);if(a.anything===!0||y===!0||ut.isEndGreedy(a,i)){var b=i.t;if(a.optional&&e[i.r+1]&&a.negative)continue;if(a.optional&&e[i.r+1]){var g=h.doesMatch(e[i.r+1],i.start_i+i.t,i.phrase_length);if(a.negative||g){var T=i.terms[i.t+1];(!T||!T.doesMatch(e[i.r+1],i.start_i+i.t,i.phrase_length))&&(i.r+=1)}}if(i.t+=1,a.end===!0&&i.t!==i.terms.length&&a.greedy!==!0||a.greedy===!0&&(i.t=ut.getGreedy(i,e[i.r+1]),i.t===null||a.min&&a.min>i.t||a.end===!0&&i.start_i+i.t!==r))return null;if(i.hasGroup===!0){var N=ut.getGroup(i,b,a.named);i.t>1&&a.greedy?N.length+=i.t-b:N.length++}continue}if(a.negative){var v=Object.assign({},a);v.negative=!1;var C=i.terms[i.t].doesMatch(v,i.start_i+i.t,i.phrase_length);if(C===!0)return null}if(a.optional!==!0){if(i.terms[i.t].isImplicit()&&e[i.r-1]&&i.terms[i.t+1]){if(i.terms[i.t-1]&&i.terms[i.t-1].implicit===e[i.r-1].word)return null;if(i.terms[i.t+1].doesMatch(a,i.start_i+i.t,i.phrase_length)){i.t+=2;continue}}return null}}return{match:i.terms.slice(0,i.t),groups:i.groups}},wy=ZT,JT=function(t,e,n){if(!n||n.length===0)return n;var r=e.some(function(a){return a.end});if(r){var i=t[t.length-1];n=n.filter(function(a){var s=a.match;return s.indexOf(i)!==-1})}return n},qr=JT,YT=/(?:^|\s)([\!\[\^]*(?:<[^<]*>)?\/.*?[^\\\/]\/[\?\]\+\*\$~]*)(?:\s|$)/,QT=/([\!\[\^]*(?:<[^<]*>)?\([^\)]+[^\\\)]\)[\?\]\+\*\$~]*)(?:\s|$)/,eN=/ /g,tN=function(t){return/^[\!\[\^]*(<[^<]*>)?\(/.test(t)&&/\)[\?\]\+\*\$~]*$/.test(t)},Dy=function(t){return/^[\!\[\^]*(<[^<]*>)?\//.test(t)&&/\/[\?\]\+\*\$~]*$/.test(t)},Ay=function(t){return t=t.map(function(e){return e.trim()}),t=t.filter(function(e){return e}),t},nN=function(t){var e=t.split(YT),n=[];e.forEach(function(i){if(Dy(i)){n.push(i);return}n=n.concat(i.split(QT))}),n=Ay(n);var r=[];return n.forEach(function(i){tN(i)||Dy(i)?r.push(i):r=r.concat(i.split(eN))}),r=Ay(r),r},rN=nN,Sy=/\{([0-9]+,?[0-9]*)\}/,Iy=/&&/,iN=new RegExp(/^<\s*?(\S+)\s*?>/),aN=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},ct=function(t){return t[t.length-1]},rt=function(t){return t[0]},vn=function(t){return t.substr(1)},Cn=function(t){return t.substr(0,t.length-1)},Py=function(t){return t=vn(t),t=Cn(t),t},sN=function u(t){for(var e={},n=0;n<2;n+=1){if(ct(t)==="$"&&(e.end=!0,t=Cn(t)),rt(t)==="^"&&(e.start=!0,t=vn(t)),(rt(t)==="["||ct(t)==="]")&&(e.named=!0,rt(t)==="["?e.groupType=ct(t)==="]"?"single":"start":e.groupType="end",t=t.replace(/^\[/,""),t=t.replace(/\]$/,""),rt(t)==="<")){var r=iN.exec(t);r.length>=2&&(e.named=r[1],t=t.replace(r[0],""))}if(ct(t)==="+"&&(e.greedy=!0,t=Cn(t)),t!=="*"&&ct(t)==="*"&&t!=="\\*"&&(e.greedy=!0,t=Cn(t)),ct(t)==="?"&&(e.optional=!0,t=Cn(t)),rt(t)==="!"&&(e.negative=!0,t=vn(t)),rt(t)==="("&&ct(t)===")"){Iy.test(t)?(e.choices=t.split(Iy),e.operator="and"):(e.choices=t.split("|"),e.operator="or"),e.choices[0]=vn(e.choices[0]);var i=e.choices.length-1;e.choices[i]=Cn(e.choices[i]),e.choices=e.choices.map(function(a){return a.trim()}),e.choices=e.choices.filter(function(a){return a}),e.choices=e.choices.map(function(a){return a.split(/ /g).map(u)}),t=""}if(rt(t)==="/"&&ct(t)==="/")return t=Py(t),e.regex=new RegExp(t),e;if(rt(t)==="~"&&ct(t)==="~")return t=Py(t),e.soft=!0,e.word=t,e}return Sy.test(t)===!0&&(t=t.replace(Sy,function(a,s){var o=s.split(/,/g);return o.length===1?(e.min=Number(o[0]),e.max=Number(o[0])):(e.min=Number(o[0]),e.max=Number(o[1]||999)),e.greedy=!0,e.optional=!0,""})),rt(t)==="#"?(e.tag=vn(t),e.tag=aN(e.tag),e):rt(t)==="@"?(e.method=vn(t),e):t==="."?(e.anything=!0,e):t==="*"?(e.anything=!0,e.greedy=!0,e.optional=!0,e):(t&&(t=t.replace("\\*","*"),t=t.replace("\\.","."),e.word=t.toLowerCase()),e)},oN=sN,lN=function(t){for(var e=!1,n=-1,r,i=0;i<t.length;i++){var a=t[i];if(a.groupType==="single"&&a.named===!0){n+=1,a.named=n;continue}a.groupType==="start"&&(e=!0,typeof a.named=="string"||typeof a.named=="number"?r=a.named:(n+=1,r=n)),e&&(a.named=r),a.groupType==="end"&&(e=!1)}return t},uN=function(t){return t.map(function(e){if(e.choices!==void 0){var n=e.choices.every(function(i){if(i.length!==1)return!1;var a=i[0];return a.word!==void 0&&a.negative!==!0&&a.optional!==!0&&a.method!==!0});if(n===!0){var r={};e.choices.forEach(function(i){r[i[0].word]=!0}),e.fastOr=r,delete e.choices}}return e})},cN=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.filter(function(r){return r.groupType}).length;return n>0&&(t=lN(t)),e.fuzzy||(t=uN(t)),t},dN=cN,pN=function(t){return Object.prototype.toString.call(t)==="[object Array]"},mN=function(t){var e=t.map(function(n){return[{word:n}]});return[{choices:e,operator:"or"}]},fN=function(t){if(!t||!t.list||!t.list[0])return[];var e=[];return t.list.forEach(function(n){var r=[];n.terms().forEach(function(i){r.push(i.id)}),e.push(r)}),[{idBlocks:e}]},hN=function(t,e){return e.fuzzy===!0&&(e.fuzzy=.85),typeof e.fuzzy=="number"&&(t=t.map(function(n){return e.fuzzy>0&&n.word&&(n.fuzzy=e.fuzzy),n.choices&&n.choices.forEach(function(r){r.forEach(function(i){i.fuzzy=e.fuzzy})}),n})),t},yN=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||t==="")return[];if(St(t)==="object"){if(pN(t)){if(t.length===0||!t[0])return[];if(St(t[0])==="object")return t;if(typeof t[0]=="string")return mN(t)}return t&&t.isA==="Doc"?fN(t):[]}typeof t=="number"&&(t=String(t));var n=rN(t);return n=n.map(function(r){return oN(r)}),n=dN(n,e),n=hN(n,e),n},xe=yN,bN=function(t,e){for(var n=[],r=e[0].idBlocks,i=function(o){r.forEach(function(l){if(l.length===0){a=o;return}var c=l.every(function(d,p){return a=o,t[o+p].id===d});c&&(n.push({match:t.slice(o,o+l.length)}),o+=l.length-1)}),a=o},a=0;a<t.length;a+=1)i(a);return n},gN=bN,vN=function(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof e=="string"&&(e=xe(e)),XT(t,e)===!0)return[];var r=e.filter(function(d){return d.optional!==!0&&d.negative!==!0}).length,i=t.terms(),a=[];if(e[0].idBlocks){var s=gN(i,e);if(s&&s.length>0)return qr(i,e,s)}if(e[0].start===!0){var o=wy(i,e,0,i.length);return o&&o.match&&o.match.length>0&&(o.match=o.match.filter(function(d){return d}),a.push(o)),qr(i,e,a)}for(var l=0;l<i.length&&!(l+r>i.length);l+=1){var c=wy(i.slice(l),e,l,i.length);if(c&&c.match&&c.match.length>0&&(l+=c.match.length-1,c.match=c.match.filter(function(d){return d}),a.push(c),n===!0))return qr(i,e,a)}return qr(i,e,a)},ko=vN,CN=function(t,e){var n={},r=ko(t,e);r.forEach(function(o){var l=o.match;l.forEach(function(c){n[c.id]=!0})});var i=t.terms(),a=[],s=[];return i.forEach(function(o){if(n[o.id]===!0){s.length>0&&(a.push(s),s=[]);return}s.push(o)}),s.length>0&&a.push(s),a},TN=CN,NN=function(t){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=ko(this,t,n);return r=r.map(function(i){var a=i.match,s=i.groups,o=e.buildFrom(a[0].id,a.length,s);return o.cache.terms=a,o}),r},xN=function(t){var e=ko(this,t,!0);return e.length>0},VN=function(t){var e=this,n=TN(this,t);return n=n.map(function(r){return e.buildFrom(r[0].id,r.length)}),n},wN=function(t,e){for(var n=this,r=[],i=this.terms(),a=!1,s=0;s<i.length;s+=1){var o=i[s].canBe(t,e);o===!0&&(a===!0?r[r.length-1].push(i[s]):r.push([i[s]]),a=o)}return r=r.filter(function(l){return l.length>0}).map(function(l){return n.buildFrom(l[0].id,l.length)}),r},DN={match:NN,has:xN,not:VN,canBe:wN},Bt=function u(t,e,n){Ae(this,u),this.start=t,this.length=e,this.isA="Phrase",Object.defineProperty(this,"pool",{enumerable:!1,writable:!0,value:n}),Object.defineProperty(this,"cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"groups",{enumerable:!1,writable:!0,value:{}})};Bt.prototype.buildFrom=function(u,t,e){var n=new Bt(u,t,this.pool);return e&&Object.keys(e).length>0?n.groups=e:n.groups=this.groups,n};Object.assign(Bt.prototype,DN);Object.assign(Bt.prototype,UT);var Oy={term:"terms"};Object.keys(Oy).forEach(function(u){return Bt.prototype[u]=Bt.prototype[Oy[u]]});var Mo=Bt,_o=function(){function u(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ae(this,u),Object.defineProperty(this,"words",{enumerable:!1,value:t})}return qe(u,[{key:"add",value:function(e){return this.words[e.id]=e,this}},{key:"get",value:function(e){return this.words[e]}},{key:"remove",value:function(e){delete this.words[e]}},{key:"merge",value:function(e){return Object.assign(this.words,e.words),this}},{key:"stats",value:function(){return{words:Object.keys(this.words).length}}}]),u}();_o.prototype.clone=function(){var u=this,t=Object.keys(this.words),e=t.reduce(function(n,r){var i=u.words[r].clone();return n[i.id]=i,n},{});return new _o(e)};var Bo=_o,AN=function(t){t.forEach(function(e,n){n>0&&(e.prev=t[n-1].id),t[n+1]&&(e.next=t[n+1].id)})},Ly=AN,SN=/(\S.+?[.!?\u203D\u2E18\u203C\u2047-\u2049])(?=\s+|$)/g,Ry=/\S/,IN=/[ .][A-Z]\.? *$/i,PN=/(?:\u2026|\.{2,}) *$/,ON=/((?:\r?\n|\r)+)/,LN=/[a-z0-9\u00C0-\u00FF\u00a9\u00ae\u2000-\u3300\ud000-\udfff]/i,Fy=/^\s+/,RN=function(t){for(var e=[],n=t.split(ON),r=0;r<n.length;r++)for(var i=n[r].split(SN),a=0;a<i.length;a++)e.push(i[a]);return e},FN=function(t,e){if(IN.test(t)===!0||PN.test(t)===!0||LN.test(t)===!1)return!1;var n=t.replace(/[.!?\u203D\u2E18\u203C\u2047-\u2049] *$/,""),r=n.split(" "),i=r[r.length-1].toLowerCase();return!e.hasOwnProperty(i)},kN=function(t,e){var n=e.cache.abbreviations;t=t||"",t=String(t);var r=[],i=[];if(!t||typeof t!="string"||Ry.test(t)===!1)return r;t=t.replace("\xA0"," ");for(var a=RN(t),s=0;s<a.length;s++){var o=a[s];if(!(o===void 0||o==="")){if(Ry.test(o)===!1){if(i[i.length-1]){i[i.length-1]+=o;continue}else if(a[s+1]){a[s+1]=o+a[s+1];continue}}i.push(o)}}for(var l=0;l<i.length;l++){var c=i[l];i[l+1]&&FN(c,n)===!1?i[l+1]=c+(i[l+1]||""):c&&c.length>0&&(r.push(c),i[l]="")}if(r.length===0)return[t];for(var d=1;d<r.length;d+=1){var p=r[d].match(Fy);p!==null&&(r[d-1]+=p[0],r[d]=r[d].replace(Fy,""))}return r},MN=kN,_N=/\S/,BN=/^[!?.]+$/,EN=/(\S+)/,$N=/[a-z] ?\/ ?[a-z]*$/,Eo=[".","?","!",":",";","-","\u2013","\u2014","--","...","(",")","[","]",'"',"'","`"];Eo=Eo.reduce(function(u,t){return u[t]=!0,u},{});var zN=function(t){if(/^(re|un)-?[^aeiou]./.test(t)===!0)return!1;var e=/^([a-z\u00C0-\u00FF`"'/]+)(-|–|—)([a-z0-9\u00C0-\u00FF].*)/i;if(e.test(t)===!0)return!0;var n=/^([0-9]{1,4})(-|–|—)([a-z\u00C0-\u00FF`"'/-]+$)/i;return n.test(t)===!0},jN=function(t){for(var e=1;e<t.length-1;e++)$N.test(t[e])&&(t[e-1]+=t[e]+t[e+1],t[e]=null,t[e+1]=null);return t},HN=function(t){var e=[],n=t.split(/[-–—]/),r="-",i=t.match(/[-–—]/);i&&i[0]&&(r=i);for(var a=0;a<n.length;a++)a===n.length-1?e.push(n[a]):e.push(n[a]+r);return e},qN=function(t){return Object.prototype.toString.call(t)==="[object Array]"},KN=function(t){var e=[],n=[];if(t=t||"",typeof t=="number"&&(t=String(t)),qN(t))return t;for(var r=t.split(EN),i=0;i<r.length;i++){if(zN(r[i])===!0){n=n.concat(HN(r[i]));continue}n.push(r[i])}for(var a="",s=0;s<n.length;s++){var o=n[s];_N.test(o)===!0&&Eo.hasOwnProperty(o)===!1&&BN.test(o)===!1?(e.length>0?(e[e.length-1]+=a,e.push(o)):e.push(a+o),a=""):a+=o}return a&&(e.length===0&&(e[0]=""),e[e.length-1]+=a),e=jN(e),e=e.filter(function(l){return l}),e},WN=KN,UN=function(t){return Object.prototype.toString.call(t)==="[object Array]"},GN=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=null;typeof t!="string"&&(typeof t=="number"?t=String(t):UN(t)&&(r=t)),r=r||MN(t,e),r=r.map(function(a){return WN(a)}),n=n||new Bo;var i=r.map(function(a){a=a.map(function(o){var l=new Fo(o);return n.add(l),l}),Ly(a);var s=new Mo(a[0].id,a.length,n);return s.cache.terms=a,s});return i},dt=GN,XN=function(t,e){var n=new Bo,r=t.map(function(i,a){var s=i.terms.map(function(o,l){var c=new Fo(o.text);return c.pre=o.pre!==void 0?o.pre:"",o.post===void 0&&(o.post=" ",l>=i.terms.length-1&&(o.post=". ",a>=i.terms.length-1&&(o.post="."))),c.post=o.post!==void 0?o.post:" ",o.tags&&o.tags.forEach(function(d){return c.tag(d,"",e)}),n.add(c),c});return Ly(s),new Mo(s[0].id,s.length,n)});return r},ZN=XN,JN="13.10.6",Kr=["Person","Place","Organization"],YN={Noun:{notA:["Verb","Adjective","Adverb"]},Singular:{isA:"Noun",notA:"Plural"},ProperNoun:{isA:"Noun"},Person:{isA:["ProperNoun","Singular"],notA:["Place","Organization","Date"]},FirstName:{isA:"Person"},MaleName:{isA:"FirstName",notA:["FemaleName","LastName"]},FemaleName:{isA:"FirstName",notA:["MaleName","LastName"]},LastName:{isA:"Person",notA:["FirstName"]},NickName:{isA:"Person",notA:["FirstName","LastName"]},Honorific:{isA:"Noun",notA:["FirstName","LastName","Value"]},Place:{isA:"Singular",notA:["Person","Organization"]},Country:{isA:["Place","ProperNoun"],notA:["City"]},City:{isA:["Place","ProperNoun"],notA:["Country"]},Region:{isA:["Place","ProperNoun"]},Address:{isA:"Place"},Organization:{isA:["Singular","ProperNoun"],notA:["Person","Place"]},SportsTeam:{isA:"Organization"},School:{isA:"Organization"},Company:{isA:"Organization"},Plural:{isA:"Noun",notA:["Singular"]},Uncountable:{isA:"Noun"},Pronoun:{isA:"Noun",notA:Kr},Actor:{isA:"Noun",notA:Kr},Activity:{isA:"Noun",notA:["Person","Place"]},Unit:{isA:"Noun",notA:Kr},Demonym:{isA:["Noun","ProperNoun"],notA:Kr},Possessive:{isA:"Noun"}},QN={Verb:{notA:["Noun","Adjective","Adverb","Value"]},PresentTense:{isA:"Verb",notA:["PastTense","FutureTense"]},Infinitive:{isA:"PresentTense",notA:["PastTense","Gerund"]},Imperative:{isA:"Infinitive"},Gerund:{isA:"PresentTense",notA:["PastTense","Copula","FutureTense"]},PastTense:{isA:"Verb",notA:["FutureTense"]},FutureTense:{isA:"Verb"},Copula:{isA:"Verb"},Modal:{isA:"Verb",notA:["Infinitive"]},PerfectTense:{isA:"Verb",notA:"Gerund"},Pluperfect:{isA:"Verb"},Participle:{isA:"PastTense"},PhrasalVerb:{isA:"Verb"},Particle:{isA:"PhrasalVerb"},Auxiliary:{notA:["Noun","Adjective","Value"]}},e0={Value:{notA:["Verb","Adjective","Adverb"]},Ordinal:{isA:"Value",notA:["Cardinal"]},Cardinal:{isA:"Value",notA:["Ordinal"]},Fraction:{isA:"Value",notA:["Noun"]},RomanNumeral:{isA:"Cardinal",notA:["Ordinal","TextValue"]},TextValue:{isA:"Value",notA:["NumericValue"]},NumericValue:{isA:"Value",notA:["TextValue"]},Money:{isA:"Cardinal"},Percent:{isA:"Value"}},$o=["Noun","Verb","Adjective","Adverb","Value","QuestionWord"],t0={Adjective:{notA:["Noun","Verb","Adverb","Value"]},Comparable:{isA:["Adjective"]},Comparative:{isA:["Adjective"]},Superlative:{isA:["Adjective"],notA:["Comparative"]},NumberRange:{isA:["Contraction"]},Adverb:{notA:["Noun","Verb","Adjective","Value"]},Date:{notA:["Verb","Adverb","Preposition","Adjective"]},Month:{isA:["Date","Singular"],notA:["Year","WeekDay","Time"]},WeekDay:{isA:["Date","Noun"]},Timezone:{isA:["Date","Noun"],notA:["Adjective","ProperNoun"]},Time:{isA:["Date"],notA:["AtMention"]},Determiner:{notA:$o},Conjunction:{notA:$o},Preposition:{notA:$o},QuestionWord:{notA:["Determiner"]},Currency:{isA:["Noun"]},Expression:{notA:["Noun","Adjective","Verb","Adverb"]},Abbreviation:{},Url:{notA:["HashTag","PhoneNumber","Verb","Adjective","Value","AtMention","Email"]},PhoneNumber:{notA:["HashTag","Verb","Adjective","Value","AtMention","Email"]},HashTag:{},AtMention:{isA:["Noun"],notA:["HashTag","Verb","Adjective","Value","Email"]},Emoji:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Emoticon:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Email:{notA:["HashTag","Verb","Adjective","Value","AtMention"]},Acronym:{notA:["Plural","RomanNumeral"]},Negative:{notA:["Noun","Adjective","Value"]},Condition:{notA:["Verb","Adjective","Noun","Value"]}},Wr={Noun:"blue",Verb:"green",Negative:"green",Date:"red",Value:"red",Adjective:"magenta",Preposition:"cyan",Conjunction:"cyan",Determiner:"cyan",Adverb:"cyan"},n0=function(t){return Object.keys(t).forEach(function(e){if(t[e].color){t[e].color=t[e].color;return}if(Wr[e]){t[e].color=Wr[e];return}t[e].isA.some(function(n){return Wr[n]?(t[e].color=Wr[n],!0):!1})}),t},r0=n0,i0=function(t){return t.filter(function(e,n,r){return r.indexOf(e)===n})},a0=function(t){return Object.keys(t).forEach(function(e){for(var n=t[e],r=n.isA.length,i=0;i<r;i++){var a=n.isA[i];t[a]&&(n.isA=n.isA.concat(t[a].isA))}n.isA=i0(n.isA)}),t},s0=a0,o0=function(t){return t.filter(function(e,n,r){return r.indexOf(e)===n})},l0=function(t){var e=Object.keys(t);return e.forEach(function(n){var r=t[n];r.notA=r.notA||[],r.isA.forEach(function(s){if(t[s]&&t[s].notA){var o=typeof t[s].notA=="string"?[t[s].isA]:t[s].notA||[];r.notA=r.notA.concat(o)}});for(var i=0;i<e.length;i++){var a=e[i];t[a].notA.indexOf(n)!==-1&&r.notA.push(a)}r.notA=o0(r.notA)}),t},u0=l0,c0=function(t){var e=Object.keys(t);return e.forEach(function(n){var r=t[n];r.lineage=[];for(var i=0;i<e.length;i++)t[e[i]].isA.indexOf(n)!==-1&&r.lineage.push(e[i])}),t},d0=c0,p0=function(t){return Object.keys(t).forEach(function(e){var n=t[e];n.isA=n.isA||[],typeof n.isA=="string"&&(n.isA=[n.isA]),n.notA=n.notA||[],typeof n.notA=="string"&&(n.notA=[n.notA])}),t},m0=function(t){return t=p0(t),t=s0(t),t=u0(t),t=r0(t),t=d0(t),t},ky=m0,Ur=function(t,e){Object.keys(t).forEach(function(n){e[n]=t[n]})},f0=function(){var t={};return Ur(YN,t),Ur(QN,t),Ur(e0,t),Ur(t0,t),t=ky(t),t},h0=f0(),My={Comparative:"true\xA6better",Superlative:"true\xA6earlier",PresentTense:"true\xA6is,sounds",Value:"true\xA6a few",Noun:"true\xA6a5b4c2f1here,ie,lit,m0no doubt,pd,tce;a,d;t,y;a,ca,o0;l,rp;a,l;d,l,rc",Copula:"true\xA6a1is,w0;as,ere;m,re",PastTense:"true\xA6be3came,d2had,lied,meant,sa2taken,w0;as,e0;nt,re;id;en,gan",Condition:"true\xA6if,lest,unless",Preposition:"true\xA6'o,-,aLbIcHdGexcept,fFiDmidQnotwithstandiRoBpSqua,sAt6u3vi2w0;/o,hereNith0;!in,oR;a,s-a-vis;n1p0;!on;like,til;h0ill,owards;an,r0;ough0u;!oJ;ans,ince,o that;',f0n2ut;!f;f,n0;!to;or,rom;espite,own,u3;hez,irca;ar1e0oAy;sides,tween;ri6;',bo7cross,ft6lo5m3propos,round,s1t0;!op;! long 0;as;id0ong0;!st;ng;er;ut",Gerund:"true\xA6accord0be0develop0go0result0stain0;ing",Negative:"true\xA6n0;ever,o0;!n,t",QuestionWord:"true\xA6how3wh0;at,e1ich,o0y;!m,se;n,re; come,'s",Plural:"true\xA6records",Conjunction:"true\xA6&,aFbBcuz,how9in caEno8o7p5supposing,t2v1wh0yet;eth9ile;ers4s;h0o;eref9o0;!uC;l0rovided that;us;r,therwi6; matt1r;!ev0;er;e0ut;cau1f0;ore;se;lthou1nd,s 0;far as,if;gh",Abbreviation:"true\xA6a0Jb0Gc0Ad08e05f02g01h00iYjWkanVlTmNnKoJpFque,rDs8t6u5v2w0;is0r,y0B;!c;a,b,e1i0ol,s,t;tro,vo;r,t;niv,safa,t;ce,e0;l,mp,nn,x;ask,e2fc,gt,i1q,r,s,t,u0;pt,rg;r,tu;c,nJp0;!t;b,d,e0;pGs,v;a,d,ennNhd,l,p,r1s0vt;!eud;ef,o0;b,f,n;ct,kla,nt;e0ov;b0e;!r;a4d,essrs,i1lle,me,r7s0t;!tr;n1s0;c,ter;!n;!j,r,sc;at,it,lb,ng,t0;!d;!s;an,d,r,u0;l,n;a,da,e,n0;c,f;on,wy;a,en,ov;e1ig,l0m,r,t,y;!a;b,m;a,g,ng,s1tc,x0;!p;p,q,t;ak,e0ist,r;c,f,pt,t;a3ca,l,m2o0pl,res,yn;!l0m1nn,rp;!o;dr;!l0pt;!if;a,c,l1r0;ig,os;!dg,vd;d4l3p2r1ss0tty,ug,ve;n,t;c,iz;prox,r,t;!ta;!j,m,v",Pronoun:"true\xA6'em,elle,h4i3me,ourselves,she5th1us,we,you0;!rself;e0ou;m,y;!l,t;e0im;!'s",Singular:"true\xA60:15;1:12;2:18;a15b0Sc0Jd0Ce09f04gZhViUjel0kitty,lSmOnNoMpHquestionGrEs9t6u4w3;ay,om02;nc0Zs 3;doll0Kst0M; rex,a4h3ic,ragedy,v show;ere,i2;l0x return;i6ky,omeoMt3uper bowl,yst14;ep4ri2u3;de0Xff;faSmoS;st1ze;al0i2o3;om,se;! mark;a6i1la5r4u3;dPrpoH;eroga00ie0Gobl0U;te,y1;rt,te0N;bjWceJthers,verview;othi2umb1;a5ee08o3;del,m3nopo0rni2th1;!my;n,yf0;i3unch;ne;ci2nsect;ead start,o3uman right;l0me4u3;se;! run;adf0entlem6irl02laci1od,rand4u3;l0y; slam,fa3mo3;th1;an;a6ella,ly,ol0r4un3;di2;ee market,iWo3;nti1sP;mi0th1;conomy,gg,ner7ven4x3;ampTecu9;i2t;ad8e5inn1o3ragonf0ude;cumentGg3i0l0or;gy;ath,t3;ec3;tive;!dy;a9eili2h7i5o3redit card;ttage,u3;ri1sin;ty,vil w3;ar;andeli1ocol3;ate;n3rF;ary;aCel0lesJo8r5u3;n3tterf0;ti2;eakfa4o3;!th1;st;dy,tt5y3;!fri3;end;le;nki2r3;ri1;er;d5l0noma0u3;nt;ly; homin5verti3;si2;ng;em",FemaleName:"true\xA60:J3;1:J7;2:IG;3:IF;4:IX;5:IK;6:JO;7:H0;8:JG;9:JK;A:HN;B:HY;C:IT;D:IP;E:JD;F:HC;G:I0;aGRbFLcDPdCYeBOfB4gADh9Ti9Gj8Gk7Gl60m49n3No3Jp37qu36r2Ds16t0Eu0Cv02wVxiTyOzH;aLeIineb,oHsof2;e3Uf2la,ra;h3iKlIna,ynH;ab,ep;da,ma;da,h3iHra;nab;aKeJi0Fol5BuIvH;etAonDO;i0na;le0sen2;el,gm3Jn,rGJs8W;aoHme0nyi;m62yAE;aMendDYhiDFiH;dele8lJnH;if48niHo0;e,f47;a,helmi0lHma;a,ow;ka0nB;aNeKiHusa5;cIktoriBMlAole7viH;anC3enJ0;kF9tor2;da,lA9nus,rHs0;a,nHoniH4;a,iFQ;leHnesH4;nIHrH;i1y;g8rHxH5;su5te;aYeUhRiNoLrIuHy3;i,la;acIZiHu0L;c2na,sH;hBPta;nHr0H;iBNya;aJffaEOnHs6;a,gtiH;ng;!nFQra;aIeHomasi0;a,l9Po8Ares1;l2ndolwethu;g9Go88rIssH;!a,ie;eHi,ri9;sa,za;bPlNmLnJrIs6tHwa0;ia0um;a63yn;iHya;a,ka,s6;arB6e3iHmEDra;!ka;a,iH;a,t6;at6it6;a0Fcarlet3We0BhXiTkye,neza0oRtNuIyH;bIBlvi1;e,ha,mayIEni7sIzH;an3MetAie,y;anHi9;!a,e,nH;aDe;aJeH;fHl5GphH;an4;cHZr5;b2fiA8m0OnHphi1;d3ia,ja,ya;er3lJmon1nIobh8PtH;a,i;dy;lEPv2;aMeIirHo0risF7y5;a,lDK;ba,e0i5lJrH;iHrDOyl;!d8Hfa;ia,lDX;hd,iMki3nJrIu0w0yH;la,ma,na;i,le8on,ron;aIda,ia,nHon;a,on;!ya;k6mH;!aa;lJrItaye81vH;da,inj;e0ife;en1i0ma;anA5bNd3Nh1RiBkMlLmJndIrHs6vannaD;aDi0;ra,y;aHi3;nt6ra;lDKma,ome;ee0in8Ru3;in1ri0;a05e00hYiVoIuH;by,thDH;bScRghQl2KnPsJwIxH;anAXie,y;an,e0;aIeHie,lE; merBLann9ll1marDBt7;!lHnn1;iHyn;e,nH;a,d9K;da,i,na;ayy8D;hel62io;bDKer7yn;a,cIkHmas,n9Fta,ya;ki,o;helGki;ea,iannGDoH;da,n1K;an0bJem9Agi0iInHta,y0;a88ee;han83na;a,eH;cEAkaD;bi0chIe,i0mo0nHquEKvCy0;di,ia;aEIelHiB;!e,le;een4ia0;aNeMhKipaluk,oJrHute66;iHudenCQ;scil3LyamvaB;lly,rt2;ilome0oebe,ylH;is,lis;arl,ggy,nelope,r5t3;ige,m0TnKo5rvaDGtIulH;a,etAin1;ricHsy,tBY;a,e,ia;do3i06;ctav2dIfCZis6lHphCZumC3yunbileg;a,ga,iv2;eHvAC;l2tA;aWeUiMoIurHy5;!ay,ul;a,eJor,rIuH;f,r;aDeCma;ll1mi;aNcLhariBOkKlaJna,sHta,vi;anHha;ur;!y;a,iDTki;hoGk9VolH;a,eDJ;!mh;hir,lHna,risFsreC;!a,lBT;asuLdKh2i6CnJomi9rgEPtHzanin zah3;aHhal4;li1s6;cy,etA;a,e8iEV;nngu30;a09ckenz4e01iMoJrignayani,uriDDyH;a,rH;a,lNna,tG;bi0i3llBInH;a,iH;ca,ka,qD3;a,cTkaSlNmi,nLrItzi,yH;ar;aIiam,lH;anEO;!l,nB;dy,eHh,n4;nhGrva;aKdJiCPlH;iHy;cent,e;red;!gros;!e5;ae5hH;ae5el3Z;ag5EgNi,lKrH;edi79iIjem,on,yH;em,l;em,sF;an4iHliF;nHsCE;a,da;!an,han;b0DcASd0Be,g09ha,i08ja,l06n04rLsoum60tKuIv82x9IyHz4;a,bell,ra,soB9;de,rH;a,eC;h8Fild1t4;a,cYgUiKjor4l7Sn4s6tJwa,yH;!aHbe6Wja8lAE;m,nBH;a,ha,in1;!aJbCBeIja,lEna,sHt64;!a,ol,sa;!l1H;! Jh,mInH;!a,e,n1;!awit,i;aliAHcJeduarBfernIjHlui5Y;o6Ful2;anB;ecil2la3;arJeIie,oHr44ueriA;!t;!ry;et42i37;el4Ui76y;dHon,ue5;akran7y;ak,en,iHk,lo3O;a,ka,nB;a,re,s4te;daHg4;!l3A;alEd4elHge,isDBon0;ei8in1yn;el,le;a0Ne0CiYoQuLyH;d2la,nH;!a,dIeBGnHsCL;!a,eBF;a,sCJ;aCWcJel0PiFlIna,pHz;e,i7;a,u,wa;iHy;a0Se,ja,l2JnB;is,l1SrJttIuHvel4;el5is1;e,ie;aKeIi9na,rH;a86i9;lHn1t7;ei;!in1;aSbb9CdRepa,lMnJsIv2zH;!a,be5LetAz4;a,etA;!a,dH;a,sHy;ay,ey,i,y;a,iJja,lHy;iHy;aA0e;!aH;!n5F;ia,ya;!nH;!a,ne;aPda,e0iNjYla,nMoKsJtHx4y5;iHt4;c2t2;e2LlCG;la,nHra;a,ie,o3;a,or1;a,gh,laH;!ni;!h,nH;a,d3e,n5P;cOdon97iNkes6mi9Ana,rMtJurIvHxmi,y5;ern1in2;a,e54ie,yn;as6iIoH;nya,ya;fa,s6;a,isF;a,la;ey,ie,y;a04eZhXiOlAKoNrJyH;lHra;a,ee,ie;istHy6D;a,en,iIyH;!na;!e,n59;nul,ri,urtnB0;aOerNlAZmJrHzzy;a,stH;en,in;!berlImernH;aq;eHi,y;e,y;a,stC;!na,ra;aHei3ongordzol;dij1w5;el7QiKjsi,lJnIrH;a,i,ri;d3na,za;ey,i,lBDs4y;ra,s6;bi7cAJdiat7IeB2iRlQmPnyakuma19rNss6KtKvi7yH;!e,lH;a,eH;e,i8L;a6DeIhHi4NlEri0y;ar6Ber6Bie,leCrB2y;!lyn8Gri0;a,en,iHl5Soli0yn;!ma,n3VsF;a5il1;ei8Ei,l4;a,tl6L;a07eYiVoNuH;anLdKliHst63;a8HeHsF;!n8tH;!a,te;e5Ji3Jy;a,i7;!anNcelEd6RelGhan7RlLni,sIva0yH;a,ce;eHie;fHlEph5U;a,in1;eHie;en,n1;!a,e,n41;lHng;!i1ClH;!i1B;anMle0nJrIsH;i8Csi8C;i,ri;!a,elGif2CnH;a,etAiHy;!e,f2A;a,e8EiInH;a,e8DiH;e,n1;cMd1mi,nIque4Xsmin3Ovie3y8zH;min9;a9eIiH;ce,e,n1s;!lHsFt0F;e,le;inIk4lEquelH;in1yn;da,ta;lRmPnOo0rNsIvaHzaro;!a0lu,na;aJiIlaHob84;!n9N;do3;!belHdo3;!a,e,l39;a77en1i0ma;a,di3es,gr6Yji;a8elBogH;en1;a,e8iHo0se;a0na;aSeOiJoHusFyacin2B;da,ll4rten23snH;a,i9Q;lImaH;ri;aIdHlaI;a,egard;ry;ath1CiJlInriet7rmi8sH;sa,t1B;en2Sga,mi;di;bi2Dil8IlNnMrJsItHwa,yl8Iz7H;i5St4;n5Yti;iHmo51ri52;etH;!te;aDnaD;a,ey,l4;a03eXiSlQoOrKunJwH;enHyne1Q;!dolE;ay,el;acIetHiselB;a,chC;e,ieH;!la;ld1AogooH;sh;adys,enHor2yn2H;a,da,na;aKgi,lIna,ov89selHta;a,e,le;da,liH;an;!n0;mLnJorgIrH;ald3Pi,m3Ctru8B;etAi4W;a,eHna;s26vieve;ma;bIil,le,mHrnet,yG;al5Ni5;i5FrielH;a,l1;aVeSiRloOoz2rH;anJeIiH;da,eB;da,ja;!cH;esIiHoi0O;n1s61;!ca;!rH;a,encH;e,ia;en,o0;lIn0rnH;!anB;ec2ic2;jr,n7rKtHy9;emIiHma,ouma7;ha,ma,n;eh;ah,iBrah,za0;cr4Nd0Ne0Mi0Lk7l04mWn4YrTsNtMuLvH;aJelIiH;!e,ta;in0Gyn;!ngel2S;geni1la,ni45;h5Sta;mLperanKtH;eIhHrel5;er;l30r9;za;a,eralB;iHma,nest2Jyn;cHka,n;a,ka;a,eMiJmH;aHie,y;!li8;lHn1;ee,iHy;a,e,ja;lHrald;da,y;aWeUiNlMma,no3oKsJvH;a,iH;na,ra;a,ie;iHuiH;se;a,en,ie,y;a0c2da,f,nMsJzaH;!betHve7;e,h;aHe,ka;!beH;th;!a,or;anor,nH;!a;!in1na;leCs6;vi;eIiHna,wi0;e,th;l,n;aYeMh2iLjeneKoHul30;lor5Tminiq4In3FrHtt4;a,eCis,la,othHthy;ea,y;ba;an0AnaDon8x4ya;anQbPde,eOiMja,lJmetr2nHsir5K;a,iH;ce,se;a,iIla,orHphi8;es,is;a,l6D;dHrdH;re;!d5Cna;!b2HoraDra;a,d3nH;!a,e;hl2i0l0HmNnLphn1rIvi1XyH;le,na;a,by,cIia,lH;a,en1;ey,ie;a,etAiH;!ca,el1Cka,z;arHia;is;a0Se0Oh05i03lVoKrIynH;di,th2;istHy05;al,i0;lPnMrIurH;tn1E;aJd2NiHn2Nri8;!nH;a,e,n1;!l1X;cepci59n4sH;tanHuelo;ce,za;eHleC;en,tA;aJeoIotH;il51;!pat3;ir9rJudH;etAiH;a,ne;a,e,iH;ce,sZ;a3er3ndH;i,y;aReNloe,rH;isJyH;stH;al;sy,tH;a1Ren,iHy;!an1e,n1;deJlseIrH;!i9yl;a,y;li8;nMrH;isKlImH;ai8;a,eHotA;n1tA;!sa;d3elGtH;al,elG;cIlH;esAi44;el2ilH;e,ia,y;itlZlYmilXndWrOsMtHy5;aKeJhHri0;erHleCrEy;in1;ri0;li0ri0;a33sH;a32ie;a,iNlLmeJolIrH;ie,ol;!e,in1yn;lHn;!a,la;a,eHie,o7y;ne,y;na,sF;a0Hi0H;a,e,l1;is7l4;in,yn;a0Ie02iZlXoUrH;andSeQiJoIyH;an0nn;nwEok9;an3DdgLg0XtH;n2XtH;!aInH;ey,i,y;ny;etH;!t9;an0e,nH;da,na;i9y;bbi9glarIlo05nH;i7n4;ka;ancHossom,ythe;a,he;an17lja0nHsm3I;i7tH;ou;aUcky,linTni7rPssOtJulaDvH;!erlH;ey,y;hJsy,tH;e,iHy9;e,na;!anH;ie,y;!ie;nHt6yl;adIiH;ce;etAi8;ay,da;!triH;ce,z;rbJyaH;rmH;aa;a3ie,o3ra;a2Sb2Md23g1Zi1Qj5l16m0Xn09oi,r04sUtTuPvOwa,yIzH;ra,u0;aKes6gJlIseH;!l;in;un;!nH;a,na;a,i2Ir2J;drJgus1RrIsteH;ja;el2;a,ey,i,y;aahua,he0;hIi2Gja,mi7s2DtrH;id;aMlIraqHt21;at;eIi9yH;!n;e,iHy;gh;!nH;ti;iJleIo6pi7;ta;en,n1tA;aHelG;!n1J;a00dje5eYgUiSjQnJohito,toHya;inetAnH;el5ia;!aKeIiHmJ;e,ka;!mHtA;ar4;!belIliFmU;sa;!le;a,eliH;ca;ka,sHta;a,sa;elHie;a,iH;a,ca,n1qH;ue;!tA;te;! JbImHstasiNya;ar2;el;cla3jul2pau5;aLberKeliJiHy;e,l2naH;!ta;a,ja;!ly;hGiIl2nB;da;a,ra;le;aWba,ePiMlKma,thJyH;a,c2sH;a,on,sa;ea;iHys0N;e,s0M;a,cIn1sHza;a,e,ha,on,sa;e,ia,ja;c2is6jaKksaKna,sJxH;aHia;!nd3;ia,saH;nd3;ra;ia;i0nIyH;ah,na;a,is,naDoud;la;c6da,leCmNnLsH;haDlH;inHyY;g,n;!h;a,o,slH;ey;ee;en;at6g4nIusH;ti0;es;ie;aWdiTelMrH;eJiH;anMenH;a,e,ne;an0;na;!aLeKiIyH;nn;a,n1;a,e;!ne;!iH;de;e,lEsH;on;yn;!lH;i8yn;ne;aKbIiHrL;!gaK;ey,i9y;!e;gaH;il;dKliyJradhIs6;ha;ya;ah;a,ya",Actor:"true\xA6aJbGcFdCengineIfAgardenIh9instructPjournalLlawyIm8nurse,opeOp5r3s1t0;echnCherapK;ailNcientJecretary,oldiGu0;pervKrgeon;e0oofE;ceptionGsearC;hotographClumbColi1r0sychologF;actitionBogrammB;cem6t5;echanic,inist9us4;airdress8ousekeep8;arm7ire0;fight6m2;eputy,iet0;ici0;an;arpent2lerk;ricklay1ut0;ch0;er;ccoun6d2ge7r0ssis6ttenda7;chitect,t0;ist;minist1v0;is1;rat0;or;ta0;nt",Honorific:"true\xA6a01bYcQdPeOfiJgIhon,jr,king,lHmCoffic00p7queen,r3s0taoiseach,vice6;e1fc,gt,ir,r,u0;ltRpt,rg;cond liInBrgeaJ;abbi,e0;ar1p9s,v0;!erend; admirX;astOhd,r0vt;esideDi1of0;!essM;me mini4nce0;!ss;a3essrs,i2lle,me,r1s0;!tr;!s;stK;gistrate,j,r6yF;i3lb,t;en,ov;eld mar3rst l0;ady,i0;eutena0;nt;shG;sq,xcellency;et,oct6r,utchess;apt6hance4mdr,o0pl;lonel,m2ngress0unci3;m0wom0;an;dr,mand5;ll0;or;!ain;ldg,rig0;!adi0;er;d0sst,tty,yatullah;j,m0v;!ir0;al",SportsTeam:"true\xA60:1A;1:1H;2:1G;a1Eb16c0Td0Kfc dallas,g0Ihouston 0Hindiana0Gjacksonville jagua0k0El0Bm01newToQpJqueens parkIreal salt lake,sAt5utah jazz,vancouver whitecaps,w3yW;ashington 3est ham0Rh10;natio1Oredski2wizar0W;ampa bay 6e5o3;ronto 3ttenham hotspur;blue ja0Mrapto0;nnessee tita2xasC;buccanee0ra0K;a7eattle 5heffield0Kporting kansas0Wt3;. louis 3oke0V;c1Frams;marine0s3;eah15ounG;cramento Rn 3;antonio spu0diego 3francisco gJjose earthquak1;char08paA; ran07;a8h5ittsburgh 4ortland t3;imbe0rail blaze0;pirat1steele0;il3oenix su2;adelphia 3li1;eagl1philNunE;dr1;akland 3klahoma city thunder,rlando magic;athle0Mrai3;de0; 3castle01;england 7orleans 6york 3;city fc,g4je0FknXme0Fred bul0Yy3;anke1;ian0D;pelica2sain0C;patrio0Brevolut3;ion;anchester Be9i3ontreal impact;ami 7lwaukee b6nnesota 3;t4u0Fvi3;kings;imberwolv1wi2;rewe0uc0K;dolphi2heat,marli2;mphis grizz3ts;li1;cXu08;a4eicesterVos angeles 3;clippe0dodDla9; galaxy,ke0;ansas city 3nE;chiefs,roya0E; pace0polis colU;astr06dynamo,rockeTtexa2;olden state warrio0reen bay pac3;ke0;.c.Aallas 7e3i05od5;nver 5troit 3;lio2pisto2ti3;ge0;broncZnuggeM;cowbo4maver3;ic00;ys; uQ;arCelKh8incinnati 6leveland 5ol3;orado r3umbus crew sc;api5ocki1;brow2cavalie0india2;bengaWre3;ds;arlotte horAicago 3;b4cubs,fire,wh3;iteB;ea0ulR;diff3olina panthe0; c3;ity;altimore 9lackburn rove0oston 5rooklyn 3uffalo bilN;ne3;ts;cel4red3; sox;tics;rs;oriol1rave2;rizona Ast8tlanta 3;brav1falco2h4u3;nited;aw9;ns;es;on villa,r3;os;c5di3;amondbac3;ks;ardi3;na3;ls",Uncountable:"true\xA60:1I;1:16;2:1X;a1Rb1Jc1Ad17e10f0Ug0Nh0Ii0Ej0Dknowled1Ql08mYnews,oXpTrOsDt8vi7w3;a5ea0Bi4oo3;d,l;ldlife,ne;rmth,t0;neg17ol0Ctae;e6h5oothpaste,r3una;affTou3;ble,sers,t;ermod1Mund0;a,nnis;aBcene0Aeri1hAil9kittl1now,o8p6t4u3;g10nshi0Q;ati1Le3;am,el;ace1Ee3;ci1ed;ap,cc0;k,v0;eep,ingl1;d0Dfe18l3nd,tish;m11t;a6e4ic3;e,ke0M;c3laxa0Isearch;ogni0Hrea0H;bi1in;aPe5hys2last9o3ress04;l3rk,w0;it2yA;a12trZ;bstetr2il,xygen;aAe8ilk,o5u3;mps,s3;ic;n3o0I;ey,o3;gamy;a3chan2;sl1t;chine3il,themat2; learn0Bry;aught0e5i4ogi0Su3;ck,g0I;ce,ghtn08ngui0QteratN;a3isM;th0;ewelAusti0L;ce,mp3nformaUtself;a3ortan0J;ti3;en0H;a6isto5o3;ck3mework,n3spitali0B;ey;ry;ir,libut,ppiD;ene6o4r3um,ymna0D;aCound;l3ssip;d,f; 3t2;editQpo3;ol;i7lour,o4urnit3;ure;od,rgive3uri0wl;ne3;ss;c9sh;conom2duca8lectr7n5quip6th2very3;body,o3thH;ne;joy3tertain3;ment;iciPon2;tiI;ar4iabet1raugh4;es;ts;aAelcius,h6iv2l5o3urrency;al,ld w3nfusiDttD;ar;ass2oth5;aos,e3;e4w3;ing;se;r7sh;a7eef,i4lood,owls,read,utt0;er;lliar4s3;on;ds;g3ss;ga3;ge;c8dvi7ero5ir4mnes3rt,thlet2;ty;craft;b2d3naut2;ynam2;ce;id,ou3;st2;ics",Infinitive:"true\xA60:6S;1:76;2:5C;3:74;4:73;5:67;6:6F;7:6Y;8:6Q;9:72;A:70;B:5X;C:6X;D:6L;E:77;F:5B;a6Kb66c57d4De3Xf3Jg3Dh37i2Uj2Sk2Ql2Hm26n23o1Yp1Jr0Rs06tYuTvOwHyG;awn,ield;aJe1Zhist6iIoGre6D;nd0rG;k,ry;pe,sh,th0;lk,nHrGsh,tDve;n,raE;d0t;aJiHoG;te,w;eGsC;!w;l6Jry;nHpGr4se;gra4Pli41;dGi9lo5Zpub3Q;erGo;mi5Cw1I;aMeLhKig5SoJrHuGwi7;ne,rn;aGe0Mi5Uu7y;de,in,nsf0p,v5J;r2ZuD;ank,reatB;nd,st;lk,rg1Qs9;aZcWeVhTi4Dkip,lSmRnee3Lo52pQtJuGwitD;bmCck,ff0gge7ppHrGspe5;ge,pri1rou4Zvi3;ly,o36;aLeKoJrHuG;dy,mb6;aFeGi3;ngthBss,tD;p,re;m,p;in,ke,r0Qy;la58oil,rink6;e1Zi6o3J;am,ip;a2iv0oG;ck,rtBut;arDem,le5n1r3tt6;aHo2rG;atDew;le,re;il,ve;a05eIisk,oHuG;in,le,sh;am,ll;a01cZdu8fYgXje5lUmTnt,pQquPsKtJvGwa5V;eGiew,o36;al,l,rG;se,t;aFi2u44;eJi7oItG;!o2rG;i5uc20;l3rt;mb6nt,r3;e7i2;air,eHlGo43r0K;a8y;at;aFemb0i3Zo3;aHeGi3y;a1nt;te,x;a5Dr0J;act1Yer,le5u1;a13ei3k5PoGyc6;gni2Cnci6rd;ch,li2Bs5N;i1nG;ge,k;aTerSiRlOoMrIuG;b21ll,mp,rGsh;cha1s4Q;ai1eIiEoG;cGdu8greAhibCmi1te7vi2W;eAlaim;di5pa2ss,veE;iEp,rtr46sGur;e,t;aHead,uG;g,n4;n,y;ck,le;fo34mCsi7;ck,iErt4Mss,u1;bJccur,ff0pera9utweIverGwe;co47lap,ta22u1wG;helm;igh;ser3taF;eHotG;e,i8;ed,gle5;aMeLiIoHuG;ltip3Grd0;nit13ve;nHrr12sreprG;eseE;d,g6us;asu2lt,n0Nr4;intaFna4rHtG;ch,t0;ch,kGry;et;aMeLiJoGu1C;aHck,oGve;k,sB;d,n;ft,g35ke,mCnk,st2YveG;!n;a2Fc0Et;b0Nck,uG;gh,nD;iGno34;ck,ll,ss;am,oFuG;d4mp;gno2mQnGss3H;cOdica9flu0MhNsKtIvG;eGol3;nt,st;erGrodu8;a5fe2;i7tG;aGru5;ll;abCibC;lu1Fr1D;agi24pG;lemeEo22ro3;aKeIi2oHuG;nt,rry;n02pe,st;aGlp;d,t;nd6ppBrm,te;aKloAove1PrIuG;arGeAi15;ant39d;aGip,ow,umb6;b,sp;in,th0ze;aReaQiOlMoJrHuncG;ti3J;acGeshB;tu2;cus,lHrG;ce,eca7m,s30;d,l24;a1ZoG;at,od,w;gu2lGni1Xt,x;e,l;r,tu2;il,stBvG;or;a15cho,le5mSnPstNvalua9xG;a0AcLerKi7pGte19;a18eHi2laFoGreA;rt,se;ct,riG;en8;ci1t;el,han4;abGima9;li1J;ab6couXdHfor8ga4han8j03riDsu2t0vG;isi2Vy;!u2;body,er4pG;hasiGow0;ze;a07eUiLoKrHuG;mp;aHeAiG;ft;g,in;d4ubt;ff0p,re5sHvG;iZor8;aKcHliGmiApl1Btingui14;ke;oGuA;uGv0;ra4;gr1YppG;ear,ro3;cOeNfLliv0ma0Fny,pKsHterG;mi0G;cribe,er3iHtrG;oy;gn,re;a0Be0Ai5osC;eGi0By;at,ct;m,pB;iIlHrG;ea1;a2i06;de;ma4n8rGte;e,kB;a0Ae09h06i9l04oJrG;aHeGoAu0Hy;a9dC;ck,ve;llZmSnHok,py,uGv0;gh,nt;cePdu5fMsKtIvG;eGin8;rt,y;aFin0VrG;a7ibu9ol;iGtitu9;d0st;iHoGroE;rm;gu2rm;rn;biLfoKmaJpG;a2laF;in;re;nd;rt;ne;ap1e5;aGip,o1;im,w;aHeG;at,ck,w;llen4n4r4se;a1nt0;ll,ncIrGt0u1;eGry;!en;el;aSePloOoMrIuG;lGry;ly;igHuG;sh;htB;en;a7mb,o7rrGth0un8;ow;ck;ar,lHnefCtrG;ay;ie3ong;ng,se;band0Jc0Bd06ffo05gr04id,l01mu1nYppTrQsKttGvoid,waC;acIeHra5;ct;m0Fnd;h,k;k,sG;eIiHocia9uG;me;gn,st;mb6rt;le;chHgGri3;ue;!i3;eaJlIroG;aDve;ch;aud,y;l,r;noun8sw0tG;icipa9;ce;lHt0;er;e4ow;ee;rd;aRdIju7mCoR;it;st;!reA;ss;cJhie3knowled4tiva9;te;ge;ve;eIouEu1;se;nt;pt;on",Unit:"true\xA60:19;a14b12c0Od0Ne0Lf0Gg0Ch09in0Hjoule0k02l00mNnMoLpIqHsqCt7volts,w6y4z3\xB02\xB51;g,s;c,f,n;b,e2;a0Nb,d0Dears old,o1;tt0H;att0b;able4b3d,e2on1sp;!ne0;a2r0D;!l,sp;spo04; ft,uare 1;c0Id0Hf3i0Fkilo0Jm1ya0E;e0Mil1;e0li0H;eet0o0D;t,uart0;ascals,e2i1ou0Pt;c0Mnt0;rcent,t02;hms,uYz;an0JewtT;/s,b,e9g,i3l,m2p1\xB2,\xB3;h,s;!\xB2;!/h,cro5l1;e1li08;! pFs1\xB2;! 1;anEpD;g06s0B;gQter1;! 2s1;! 1;per second;b,i00m,u1x;men0x0;b,elvin0g,ilo2m1nR;!/h,ph,\xB2;byZgXmeter1;! p2s1;! p1;er1; hour;e1g,r0z;ct1rtz0;aXogQ;al2b,igAra1;in0m0;!l1;on0;a4emtPl2t1;\xB2,\xB3; oz,uid ou1;nce0;hrenheit0rad0;b,x1;abyH;eciCg,l,mA;arat0eAg,m9oulomb0u1;bic 1p0;c5d4fo3i2meAya1;rd0;nch0;ot0;eci2;enti1;me4;!\xB2,\xB3;lsius0nti1;g2li1me1;ter0;ram0;bl,y1;te0;c4tt1;os1;eco1;nd0;re0;!s",Organization:"true\xA60:46;a3Ab2Qc2Ad21e1Xf1Tg1Lh1Gi1Dj19k17l13m0Sn0Go0Dp07qu06rZsStFuBv8w3y1;amaha,m0Xou1w0X;gov,tu2S;a3e1orld trade organizati41;lls fargo,st1;fie22inghou16;l1rner br3D;-m11gree31l street journ25m11;an halNeriz3Wisa,o1;dafo2Gl1;kswagLvo;bs,kip,n2ps,s1;a tod2Rps;es35i1;lev2Xted natio2Uv; mobi2Kaco bePd bMeAgi frida9h3im horto2Tmz,o1witt2W;shiba,y1;ota,s r Y;e 1in lizzy;b3carpen33daily ma2Xguess w2holli0rolling st1Ms1w2;mashing pumpki2Ouprem0;ho;ea1lack eyed pe3Fyrds;ch bo1tl0;ys;l2s1;co,la m12;efoni07us;a6e4ieme2Gnp,o2pice gir5ta1ubaru;rbucks,to2N;ny,undgard1;en;a2Rx pisto1;ls;few25insbu26msu1X;.e.m.,adiohead,b6e3oyal 1yan2X;b1dutch she4;ank;/max,aders dige1Ed 1vl32;bu1c1Uhot chili peppe2Klobst28;ll;c,s;ant2Vizno2F;an5bs,e3fiz24hilip morrBi2r1;emier27octer & gamb1Rudenti14;nk floyd,zza hut;psi28tro1uge08;br2Qchina,n2Q; 2ason1Xda2G;ld navy,pec,range juli2xf1;am;us;a9b8e5fl,h4i3o1sa,wa;kia,tre dame,vart1;is;ke,ntendo,ss0K;l,s;c,st1Etflix,w1; 1sweek;kids on the block,york08;a,c;nd1Us2t1;ional aca2Fo,we0Q;a,cYd0O;aAcdonald9e5i3lb,o1tv,yspace;b1Nnsanto,ody blu0t1;ley crue,or0O;crosoft,t1;as,subisO;dica3rcedes2talli1;ca;!-benz;id,re;'s,s;c's milk,tt13z1Y;'ore09a3e1g,ittle caesa1Ktd;novo,x1;is,mark; pres5-z-boy,bour party;atv,fc,kk,m1od1K;art;iffy lu0Lo3pmorgan1sa;! cha1;se;hnson & johns1Sy d1R;bm,hop,n1tv;c,g,te1;l,rpol; & m,asbro,ewlett-packaTi3o1sbc,yundai;me dep1n1J;ot;tac1zbollah;hi;eneral 6hq,l5mb,o2reen d0Iu1;cci,ns n ros0;ldman sachs,o1;dye1g0B;ar;axo smith kliZencore;electr0Im1;oto0V;a3bi,da,edex,i1leetwood mac,oGrito-l0A;at,nancial1restoV; tim0;cebook,nnie mae;b06sa,u3xxon1; m1m1;ob0H;!rosceptics;aiml0Ae5isney,o3u1;nkin donuts,po0Wran dur1;an;j,w j1;on0;a,f leppa3ll,p2r spiegZstiny's chi1;ld;eche mode,t;rd;aEbc,hBi9nn,o3r1;aigsli5eedence clearwater reviv1ossra05;al;!ca c5l4m1o0Ast05;ca2p1;aq;st;dplMgate;ola;a,sco1tigroup;! systems;ev2i1;ck fil-a,na daily;r0Hy;dbury,pital o1rl's jr;ne;aGbc,eCfAl6mw,ni,o2p,r1;exiteeWos;ei3mbardiJston 1;glo1pizza;be;ng;ack & deckFo2ue c1;roX;ckbuster video,omingda1;le; g1g1;oodriN;cht3e ge0n & jer2rkshire hathaw1;ay;ryH;el;nana republ3s1xt5y5;f,kin robbi1;ns;ic;bXcSdidRerosmith,ig,lLmFnheuser-busEol,ppleAr7s3t&t,v2y1;er;is,on;hland2s1;n,ociated F; o1;il;by4g2m1;co;os; compu2bee1;'s;te1;rs;ch;c,d,erican3t1;!r1;ak; ex1;pre1;ss; 4catel2t1;air;!-luce1;nt;jazeera,qae1;da;as;/dc,a3er,t1;ivisi1;on;demy of scienc0;es;ba,c",Demonym:"true\xA60:16;1:13;a0Wb0Nc0Cd0Ae09f07g04h02iYjVkTlPmLnIomHpDqatari,rBs7t5u4v3wel0Rz2;am0Fimbabwe0;enezuel0ietnam0H;g9krai1;aiwThai,rinida0Iu2;ni0Qrkmen;a4cot0Ke3ingapoOlovak,oma0Tpa05udRw2y0X;edi0Kiss;negal0Br08;mo0uU;o6us0Lw2;and0;a3eru0Hhilipp0Po2;li0Ertugu06;kist3lesti1na2raguay0;ma1;ani;amiZi2orweP;caragu0geri2;an,en;a3ex0Mo2;ngo0Erocc0;cedo1la2;gasy,y08;a4eb9i2;b2thua1;e0Dy0;o,t02;azakh,eny0o2uwaiti;re0;a2orda1;ma0Bp2;anN;celandic,nd4r2sraeli,ta02vo06;a2iT;ni0qi;i0oneV;aiDin2ondur0unN;di;amDe2hanai0reek,uatemal0;or2rm0;gi0;i2ren7;lipino,n4;cuadoVgyp6ngliJsto1thiopi0urope0;a2ominXut4;niH;a9h6o4roa3ub0ze2;ch;ti0;lom2ngol5;bi0;a6i2;le0n2;ese;lifor1m2na3;bo2eroo1;di0;angladeshi,el8o6r3ul2;gaG;aziBi2;ti2;sh;li2s1;vi0;aru2gi0;si0;fAl7merBngol0r5si0us2;sie,tr2;a2i0;li0;gent2me1;ine;ba1ge2;ri0;ni0;gh0r2;ic0;an",Possessive:"true\xA6anyAh5its,m3noCo1sometBthe0yo1;ir1mselves;ur0;!s;i8y0;!se4;er1i0;mse2s;!s0;!e0;lf;o1t0;hing;ne",Currency:"true\xA6$,aud,bScQdLeurKfJgbp,hkd,iIjpy,kGlEp8r7s3usd,x2y1z0\xA2,\xA3,\xA5,\u0434\u0435\u043D,\u043B\u0432,\u0440\u0443\u0431,\u0E3F,\u20A1,\u20A8,\u20AC,\u20AD,\uFDFC;lotyS\u0142;en,uanR;af,of;h0t5;e0il5;k0q0;elM;iel,oubleLp,upeeL;e2ound st0;er0;lingI;n0soH;ceGn0;ies,y;e0i8;i,mpi7;n,r0wanzaCyatC;!onaBw;ls,nr;ori7ranc9;!o8;en3i2kk,o0;b0ll2;ra5;me4n0rham4;ar3;ad,e0ny;nt1;aht,itcoin0;!s",City:"true\xA60:73;1:61;2:6G;3:5U;4:5R;a68b54c4Id4Ae46f3Yg3Jh38i2Zj2Uk2Dl22m1Kn19o16p0Uq0Sr0Ls01tPuOvLwDxiBy9z5;a7h5i4Muri4O;a5e5ongsh0;ng3J;greb,nzib5G;ang2e5okoha3Uunfu;katerin3Jrev0;a5n0O;m5Hn;arsBeAi6roclBu5;h0xi,zh5P;c7n5;d5nipeg,terth4;hoek,s1K;hi5Zkl3C;l63xford;aw;a6ern2i5ladivost5Molgogr6K;en3lni6R;lenc6Dncouv2Yr3ughn;lan bat1Drumqi,trecht;aDbilisi,eCheBi9o8r7u5;l21n63r5;in,ku;ipoli,ondh62;kyo,m34ron1QulouS;an5jua3l2Zmisoa6Era3;j4Xshui; hag65ssaloni2L;gucigal28hr0l av1W;briz,i6llinn,mpe5Ang5rtu,shk2X;i2Msh0;an,chu1n0p2Iyu0;aEeDh8kopje,owe1It7u5ydney;ra5zh51;ba0Jt;aten is59ockholm,rasbou6Auttga31;an8e6i5;jiazhua1llo1m60y0;f54n5;ya1zh4L;gh3Ot4U;att4Ao1Yv49;cramen18int DlBn5o paulo,ppo3Wrajevo; 7aa,t5;a 5ia3Io domin3I;a3fe,m1O;antonCdie3Gfrancisco,j5ped3Ssalv8;o5u0;se;em,v5z2B;ad0I;lou59peters29;aAe9i7o5;me,sar5t5A;io;ga,o5yadh;! de janei3I;cife,ykjavik;b4Uip4lei2Mnc2Swalpindi;ingdao,u5;ez2i0Q;aEeDhCiBo8r7u6yong5;ya1;eb5Aya1;ag54etor53;rt5zn0; 5la4Fo;au prin0Nelizabe29sa05;ls3Srae5Ctts2B;iladelph4Ynom pe1Doenix;r26tah tik3I;ler00naji,r4Pt5;na,r36;ak47des0Lm1Rr6s5ttawa;a3Ylo;an,d07;a8ew6i5ovosibir1Oyc;ng2Hs; 5cast39;del27orlea46taip16york;g8iro4Xn5pl2Zshv36v0;ch6ji1t5;es,o1;a1o1;a6o5p4;ya;no,sa0Y;aFeCi9o6u5;mb2Cni28sc40;gadishu,nt6s5;c17ul;evideo,re31;ami,l6n18s5;kolc,sissauga;an,waukee;cca,d5lbour2Pmph41;an,ell5i3;in,\xEDn;cau,drAkass2Tl9n8r5shh4A;aca6ib5rakesh,se2N;or;i1Ty;a4EchEdal12i47;mo;id;aCeiAi8o6u5vRy2;anLckn0Rdhia3;n5s angel28;d2g bea1O;brev2De3Kma5nz,sb2verpo2A;!ss29;c5pzig;est0C; p6g5ho2Yn0Gusan27;os;az,la35;aHharFiClaipeBo9rak0Hu7y5;iv,o5;to;ala lump4n5;mi1sh0;be,hi0Llka2Zpavog4si5wlo2;ce;da;ev,n5rkuk;gSsha5;sa;k5toum;iv;bIdu3llakuric0Tmpa3Gn6ohsiu1ra5un1Lwaguc0T;c0Sj;d5o,p4;ah1Vy;a7e6i5ohannesZ;l1Xn0;dd37rusalem;ip4k5;ar2J;bad0mph1QnBrkutYs8ta01z5\u0307zm7;m6tapala5;pa;ir;fah0l6tanb5;ul;am2Zi2I;che2d5;ianap2Lo21;aBe8o5yder2W; chi mi6ms,nolulu,u5;st2;nh;f6lsin5rakli2;ki;ei;ifa,lifax,m7n5rb1Dva3;gAnov5oi;er;bu2Wilt2;aFdanEenDhCiPlasgBo9raz,u5;a5jr21;dal6ng5yaquil;zh1H;aja2Lupe;ld coa18then5;bu2P;ow;ent;e0Toa;sk;lw7n5za;dhi5gt1C;nag0S;ay;aisal26es,o8r6ukuya5;ma;ankfu5esno;rt;rt5sh0; wor6ale5;za;th;d5indhov0Nl paso;in5mont2;bur5;gh;aAe8ha0Visp4o7resd0Ju5;b5esseldorf,rb0shanbe;ai,l0G;ha,nggu0rtmu11;hradRl5troit;hi;donghHe5k08li0masc1Xr es sala1HugavpiY;gu,je2;aKebu,hAo5raio03uriti1P;lo7n6penhag0Ar5;do1Nk;akLst0V;gVm5;bo;aBen8i6ongqi1ristchur5;ch;ang m7ca5ttago1;go;g6n5;ai;du,zho1;n5ttogr12;digarh,g5;ch8sha,zh06;i9lga8mayenJn6pe town,r5;acCdiff;ber18c5;un;ry;ro;aUeMhJirmingh0ToIr9u5;chareRdapeRenos air7r5s0tu0;g5sa;as;es;a9is6usse5;ls;ba6t5;ol;ne;sil0Mtisla7zzav5;il5;le;va;goZst2;op6ubaneshw5;ar;al;iBl9ng8r5;g6l5n;in;en;aluru,hazi;fa5grade,o horizonte;st;ji1rut;ghd0BkGnAot9r7s6yan n4;ur;el,r07;celo3ranquil09;na;ou;du1g6ja lu5;ka;alo6k5;ok;re;ng;ers5u;field;a04b01cc00ddis abaZgartaYhmedWizawl,lQmNnHqaZrEsBt7uck5;la5;nd;he7l5;an5;ta;ns;h5unci2;dod,gab5;at;li5;ngt2;on;a6chora5kaNtwerp;ge;h7p5;ol5;is;eim;aravati,m0s5;terd5;am; 8buquerq7e5giers,maty;ppo,xandr5;ia;ue;basrah al qadim5mawsil al jadid5;ah;ab5;ad;la;ba;ra;idj0u dha5;bi;an;lbo6rh5;us;rg",Country:"true\xA60:39;1:2M;a2Xb2Ec22d1Ye1Sf1Mg1Ch1Ai14j12k0Zl0Um0Gn05om3DpZqat1KrXsKtCu6v4wal3yemTz2;a25imbabwe;es,lis and futu2Y;a2enezue32ietnam;nuatu,tican city;.5gTkraiZnited 3ruXs2zbeE;a,sr;arab emirat0Kkingdom,states2;! of am2Y;k.,s.2; 28a.;a7haBimor-les0Bo6rinidad4u2;nis0rk2valu;ey,me2Ys and caic1U; and 2-2;toba1K;go,kel0Znga;iw2Wji2nz2S;ki2U;aCcotl1eBi8lov7o5pa2Cri lanka,u4w2yr0;az2ed9itzerl1;il1;d2Rriname;lomon1Wmal0uth 2;afr2JkLsud2P;ak0en0;erra leoEn2;gapo1Xt maart2;en;negKrb0ychellY;int 2moa,n marino,udi arab0;hele25luc0mart20;epublic of ir0Dom2Duss0w2;an26;a3eHhilippinTitcairn1Lo2uerto riM;l1rtugE;ki2Cl3nama,pua new0Ura2;gu6;au,esti2;ne;aAe8i6or2;folk1Hth3w2;ay; k2ern mariana1C;or0N;caragua,ger2ue;!ia;p2ther19w zeal1;al;mib0u2;ru;a6exi5icro0Ao2yanm05;ldova,n2roc4zamb9;a3gol0t2;enegro,serrat;co;c9dagasc00l6r4urit3yot2;te;an0i15;shall0Wtin2;ique;a3div2i,ta;es;wi,ys0;ao,ed01;a5e4i2uxembourg;b2echtenste11thu1F;er0ya;ban0Hsotho;os,tv0;azakh1Ee3iriba03o2uwait,yrgyz1E;rWsovo;eling0Jnya;a2erF;ma15p1B;c6nd5r3s2taly,vory coast;le of m19rael;a2el1;n,q;ia,oI;el1;aiSon2ungary;dur0Mg kong;aAermany,ha0Pibralt9re7u2;a5ern4inea2ya0O;!-biss2;au;sey;deloupe,m,tema0P;e2na0M;ce,nl1;ar;bTmb0;a6i5r2;ance,ench 2;guia0Dpoly2;nes0;ji,nl1;lklandTroeT;ast tim6cu5gypt,l salv5ngl1quatorial3ritr4st2thiop0;on0; guin2;ea;ad2;or;enmark,jibou4ominica3r con2;go;!n B;ti;aAentral african 9h7o4roat0u3yprQzech2; 8ia;ba,racao;c3lo2morPngo-brazzaville,okFsta r03te d'ivoiK;mb0;osD;i2ristmasF;le,na;republic;m2naTpe verde,yman9;bod0ero2;on;aFeChut00o8r4u2;lgar0r2;kina faso,ma,undi;azil,itish 2unei;virgin2; is2;lands;liv0nai4snia and herzegoviGtswaGuvet2; isl1;and;re;l2n7rmuF;ar2gium,ize;us;h3ngladesh,rbad2;os;am3ra2;in;as;fghaFlCmAn5r3ustr2zerbaijH;al0ia;genti2men0uba;na;dorra,g4t2;arct6igua and barbu2;da;o2uil2;la;er2;ica;b2ger0;an0;ia;ni2;st2;an",Region:"true\xA60:2M;1:2S;2:2J;a2Pb2Cc1Yd1Tes1Sf1Qg1Kh1Gi1Bj17k12l0Zm0On07o05pZqWrTsKtFuCv9w5y3zacatec2T;akut0o0Du3;cat2k07;a4est 3isconsin,yomi1L;bengal,vi6;rwick2Ashington3;! dc;er4i3;rgin0;acruz,mont;dmurt0t3;ah,tar3; 2Ka0W;a5e4laxca1Qripu1Wu3;scaDva;langa1nnessee,x2E;bas0Um3smNtar24;aulip2Cil nadu;a8i6o4taf10u3ylh1E;ffYrr03s19;me1Bno1Puth 3;cVdU;ber0c3kkim,naloa;hu2ily;n4skatchew2xo3;ny; luis potosi,ta catari1;a3hode9;j3ngp06;asth2shahi;ingh24u3;e3intana roo;bec,en5reta0Q;ara7e5rince edward3unjab; i3;sl0A;i,nnsylv3rnambu0A;an0;!na;axa0Xdisha,h3klaho1Zntar3reg6ss0Ax0F;io;aIeDo5u3;evo le3nav0V;on;r3tt16va scot0;f8mandy,th3; 3ampton15;c5d4yo3;rk13;ako1M;aroli1;olk;bras1Lva0Bw3; 4foundland3;! and labrador;brunswick,hamp0Wjers3mexiRyork state;ey;galOyarit;a9eghala0Mi5o3;nta1r3;dov0elos;ch5dlanCn4ss3zor11;issippi,ouri;as geraOneso18;ig2oac2;dhy12harasht0Gine,ni4r3ssachusetts;anhao,i el,ylF;p3toba;ur;anca0Ie3incoln0IouisH;e3iR;ds;a5e4h3omi;aka06ul1;ntucky,ra01;bardino,lmyk0ns0Qr3;achay,el0nata0X;alis5har3iangxi;kh3;and;co;daho,llino6n3owa;d4gush3;et0;ia1;is;a5ert4i3un2;dalFm0D;fordZ;mpYrya1waii;ansu,eorg0lou7oa,u3;an4erre3izhou,jarat;ro;ajuato,gdo3;ng;cesterS;lori3uji2;da;sex;ageTe6o4uran3;go;rs3;et;lawaLrbyK;aEeaDh8o3rimea ,umbr0;ahui6l5nnectic4rsi3ventry;ca;ut;i02orado;la;e4hattisgarh,i3uvash0;apQhuahua;chn4rke3;ss0;ya;ra;lFm3;bridge6peche;a8ihar,r7u3;ck3ryat0;ingham3;shi3;re;emen,itish columb0;h0ja cal7lk6s3v6;hkorto3que;st2;an;ar0;iforn0;ia;dygea,guascalientes,lAndhr8r4ss3;am;izo1kans4un3;achal 6;as;na;a 3;pradesh;a5ber4t3;ai;ta;ba4s3;ka;ma",Place:"true\xA6a0Eb0Bc04d03e02f00gVhUiRjfk,kOlMmJneGoFpBque,rd,s9t6u5v4w1y0;akutOyz;ake isFis1y0;!o;!c;a,ostok,t;laanbaatar,p02safa,t;ahiti,e1he 0;bronx,hamptons;nn,x;a0fo,oho,t,under7yd;khalNsk;a2e1h0itcairn;l,x;k,nnN;!cif04;kla,nt,rd;b1w eng0;land;!r;a1co,i0t,uc;dNnn;gadZlibu,nhattZ;a0gw,hr;s,x;an1osrae,rasnoyar0ul;sk;!s;a1cn,da,nd0st;ianRochina;!x;arlem,kg,nd,oHwy;a3re0;at 0enwich;brita0lakH;in;!y village;co,l0ra;!a;urope,vergladC;ak,en,fw,ist,own4xb;al5dg,gk,h2l1o0rA;lo,nn;!t;a1ina0uuk;town;morro,tham;!if;cn,e1kk,l0rooklyn;vd;l air,verly hills;frica,lta,m7n3r2sia,tl1ve,zor0;es;!ant2;ct1iz;adyr,tarct0;ic0; oce0;an;ericas,s",MaleName:"true\xA60:E5;1:D6;2:DO;3:AY;4:D2;5:CG;6:B6;7:CW;8:C8;9:DK;A:DL;B:A6;C:C2;aCObBLcAJd9He8Nf85g7Ih6Ui6Ej5Ek52l4Dm35n2To2Np2Fqu2Dr1Ls11t0Eu0Dv07wTxSyIzD;aDor0;cDh9Tkaria,n5W;hEkD;!aCM;ar5WeCL;aLoFuD;sDu2KvBY;if,uf;nFsEusD;ouf,sD;ef;aDg;s,tD;an,h0;hli,nBMssX;avi3ho4;aMeKiFoDyaC2;jcie8Clfgang,odrow,utD;!er;lDnst1;bFey,frD1lD;aBDiD;am,e,s;e9Fur;i,nde6sD;!l8t1;de,lErrAyD;l1ne;lDt3;aAAy;aGiDladimir,ojte7Z;cEha0kt69nceDrgAJva0;!nt;e3Vt67;lentDnA5;in4Y;ghBVlyss5Cnax,sm0;aXeShOiMoHrFuEyD;!l3ro7s1;n9r5C;avAWeDist0oy,um0;ntAOv5Zy;bGdFmDny;!as,mDoharu;aCTie,y;!d;iBy;mDt5;!my,othy;adFeoEia8GomD;!as;!do8P;!de5;dGrD;en9LrD;an9KeDy;ll,n9J;!dy;dgh,ha,iDnn3req,tsu4T;cB5ka;aTcotRePhLiJoHpenc3tDur1Vylve9Kzym1;anFeDua8D;f0phBTvDwa8C;e62ie;!islaw,l8;lom1nBFuD;leyma7ta;dDlBm1yabonga;!dhart7Bn8;aFeD;lDrm0;d1t1;h7Une,qu10un,wn,y7;aDbasti0k2Al4Rrg4Oth,ymoAU;m5n;!tD;!ie,y;lEmDnti2Eq5Bul;!ke5MmCu4;ik,vato7X;aYeUheAAiQoHuEyD;an,ou;b7NdEf5pe7SssD;!elBZ;ol3Fy;an,bKcJdIel,geHh0landBQmGnFry,sEyD;!ce;coe,s;!aAHnC;an,eo;l47r;e5Og3n8olfo,ri7A;co,ky;bCeB7;cDl8;ar6Pc6OhEkDo;!ey,ie,y;a99ie;gEid,ubAx,yDza;an1InY;gA8iD;naA4s;ch70fa4lHmGndFpha4sEul,wi2HyD;an,mo82;h7Vm5;alBDol2Uy;iATon;f,ph;ent2inD;cy,t1;aIeGhilFier72ol,rD;aka16eD;m,st1;!ip,lip;dALrcy,tD;ar,e3Gr1X;b4Kdra7Ft4ZulD;!o17;ctav3Fi3liv3mAFndrej,rHsEtDum9wA;is,to;aEc9k9m0vD;al5Z;ma;i,l53vL;aLeJiFoDu3A;aDel,j5l0ma0r3K;h,m;cEg4i49kD;!au,h7Uola;holBkDolB;!olB;al,d,il,ls1vD;il8Y;hom,thD;anDy;!a4i4;aZeWiMoHuEyD;l2Jr1;hamEr6XstaD;fa,p5C;ed,mH;di0We,hamFis2FntEsDussa;es,he;e,y;ad,ed,mD;ad,ed;cIgu4hai,kGlFnEtchD;!e6;a8Aik;house,o0Bt1;ae5YeA4olD;aj;ah,hDk8;aEeD;al,l;el,l;hElv2rD;le,ri6v2;di,met;ay0ck,hTjd,ks2DlRmadWnQrKs1tFuricExD;!imilian9Nwe6;e,io;eGhEiBtDus,yB;!eo,hew,ia;eDis;us,w;j,o;cHio,kGlFqu7Dsha6tDv2;iDy;!m,n;in,on;!el,oPus;!el9IoOus;iGu4;achDcolm,ik;ai,y;amEdi,eDmoud;sh;adDm5T;ou;aXeQiOlo3EoKuEyD;le,nd1;cGiFkDth3uk;aDe;!s;gi,s,z;as,iaD;no;g0nn7SrenFuDv8Jwe6;!iD;e,s;!zo;am,oD;n4r;a8Cevi,la5JnIoGst3thaFvD;eDi;nte;bo;!nD;!a6Sel;!ny;mFnErDur5Hwr5H;ry,s;ce,d1;ar,o5A;aLeGhaled,iDrist5Iu4Vy6X;er0p,rD;by,k,ollD;os;en0iGnDrmit,v44;!dEnDt5Z;e1Ay;a6ri59;r,th;cp3j5m66na73rEsp9them,uD;ri;im,l;a02eUiSoGuD;an,lDst2;en,iD;an,en,o,us;aNeLhnKkubBnIrGsD;eEhDi8Bue;!ua;!ph;dDge;an,i,on;!aDny;h,s,th5I;!ath5Hie,nC;!l,sDy;ph;o,qu2;an,mD;!mC;d,ffIrFsD;sDus;!e;a6BemEmai7oDry;me,ni0Y;i7Ty;!e60rD;ey,y;cKdAkImHrFsEvi3yD;!dAs1;on,p3;ed,od,rDv56;e5Nod;al,es4Xis1;a,e,oDub;b,v;k,ob,quD;es;aWbQchiPgNkeMlija,nuLonut,rJsFtDv0;ai,suD;ki;aEha0i7DmaDsac;el,il;ac,iaD;h,s;a,vinDw2;!g;k,nngu5S;!r;nacDor;io;ka;ai,rahD;im;aPeJoIuDyd9;be2KgGmber4WsD;eyEsD;a2e2;in,n;h,o;m3ra3Gsse2wa4B;aHctGitGnrErD;be2Dm0;iDy;!q11;or;th;bMlLmza,nKo,rFsEyD;a4JdA;an,s0;lGo50rFuDv8;hi4Gki,tD;a,o;is1y;an,ey;k,s;!im;ib;aVeRiPlenOoLrHuD;ilEsD;!tavo;herme,lerD;mo;aFegDov3;!g,orD;io,y;dy,h5Wnt;nzaErD;an,d1;lo;!n;lbe5Ano,oD;rg3Hvan5A;ne,oFrD;aDry;ld,rd5H;ffr8rge;brElArDv2;la28r3Sth,y;e3EielD;!i5;aTePiNlLorr0NrD;anFedDitz;!dCeDri2B;ri2A;cFkD;!ie,lD;in,yn;esLisD;!co,z36;etch3oD;yd;d4lDnn,onn;ip;deriFliEng,rnD;an06;pe,x;co;bi0di,hd;ar04dZfrYit0lSmKnHo2rFsteb0th0uge7vDymAzra;an,eD;ns,re36;gi,i0DnDrol,v2w2;est4Pie;oEriqDzo;ue;ch;aJerIiEmD;aIe2Z;lErD;!h0;!iD;o,s;s1y;nu4;be0Cd1iGliFmEt1viDwood;n,s;er,o;ot1Ys;!as,j4NsD;ha;a2en;!dCg9mGoEuEwD;a2Din;arD;do;o0Wu0W;l,nD;est;a01eRiOoHrGuFwEylD;an,l0;ay7ight;a7dl8nc0st2;ag0ew;minGnEri0ugDvydBy2D;!lB;!a2MnDov0;e6ie,y;go,iDykB;cDk;!k;armuEeDll1on,rk;go;id;anKj0lbeJmetri5nHon,rGsFvEwDxt3;ay7ey;en,in;hawn,mo0B;ek,ri0I;is,nDv3;is,y;rt;!dD;re;an,lNmLnKrGvD;e,iD;! lucDd;as,ca;en,iFne6rDyl;eDin,yl;l3Bn;n,o,us;!e,i4ny;iDon;an,en,on;e,lB;as;a09e07hYiar0lNoIrGuEyrD;il,us;rtD;!is;aDistob0U;ig;dy,lGnErD;ey,neli5y;or,rD;ad;by,e,in,l2t1;aIeFiDyK;fDnt;fo0Ft1;meEt5velaD;nd;nt;rFuEyD;!t1;de;enD;ce;aIeGrisEuD;ck;!tD;i0oph3;st3;er;d,rDs;b4leD;s,y;cDdric,s9;il;lGmer1rD;ey,lEro6y;ll;!os,t1;eb,v2;a07eZiVlaUoRrEuDyr1;ddy,rtK;aLeGiFuEyD;an,ce,on;ce,no;an,ce;nEtD;!t;dEtD;!on;an,on;dEndD;en,on;!foDl8y;rd;bErDyd;is;!by;i7ke;bFlEshD;al;al,lC;ek;nHrDshoi;at,nEtD;!r1C;aDie;rd14;!edict,iEjam2nC;ie,y;to;kaMlazs,nHrD;n8rDt;eDy;tt;ey;dDeE;ar,iD;le;ar17b0Vd0Rf0Pgust2hm0Mi0Jja0Il04m00nSputsiRrIsaHuFveEyDziz;a0kh0;ry;gust5st2;us;hi;aKchJiIjun,maHnFon,tDy0;hDu09;ur;av,oD;ld;an,nd0H;!el,ki;ie;ta;aq;as,dIgel0CtD;hoGoD;i7nD;!i09y;ne;ny;er,reDy;!as,i,s,w;iFmaDos;nu4r;el;ne,r,t;an,bePdAeJfHi,lGonFphXt1vD;aNin;on;so,zo;an,en;onTrD;edU;c,jaGksandFssaGxD;!andD;er,ru;ar,er;ndD;ro;rtN;ni;dAm9;ar;en;ad,eD;d,t;in;onD;so;aEi,olfDri0vik;!o;mDn;!a;dHeGraEuD;!bakr,lfazl;hDm;am;!l;allIelFoulaye,ulD;!lDrF;ah,o;! rD;ahm0;an;ah;av,on",LastName:"true\xA60:9F;1:9V;2:9H;3:9X;4:9N;5:8J;6:9K;7:A0;8:9E;9:88;A:6E;B:77;C:6J;a9Ub8Lc7Kd6Xe6Rf6Dg5Vh58i54j4Pk45l3Nm2Rn2Eo26p1Nquispe,r17s0Ft05vVwOxNyGzD;aytsADhD;aDou,u;ng,o;aGeun7ZiDoshiA9un;!lD;diDmaz;rim,z;maDng;da,guc97mo6UsDzaB;aBhiA7;iao,u;aHeGiEoDright,u;jc8Sng;lDmm0nkl0sniewsB;liA1s3;b0iss,lt0;a5Rgn0lDng,tanabe;k0sh;aHeGiEoDukA;lk5roby5;dAllalDnogr2Zr0Zss0val37;ba,obos;lasEsel7N;lGn dFrg8EsEzD;qu7;ily9Oqu7silj9O;en b35ijk,yk;enzue95verde;aLeix1JhHi4j6ka3IoGrFsui,uD;om4ZrD;c4n0un1;an,embl8TynisB;dor95lst31m2rr9th;at5Mi7LoD;mErD;are6Ylaci64;ps3s0Y;hirAkah8Dnaka;a00chWeThPiNmKoItFuEvDzabo;en8Aobod34;ar7bot2lliv4zuB;aEein0oD;i67j3Lyan8V;l6rm0;kol5lovy5re6Psa,to,uD;ng,sa;iDy5Z;rn5tD;!h;l5YmDngh,rbu;mo6Do6J;aFeDimizu;hu,vchD;en7Cuk;la,r17;gu8mDoh,pulve8Trra4R;jDyD;on5;evi6Filtz,miDneid0roed0ulz,warz;dEtD;!z;!t;ar42h6ito,lFnDr2saBto,v2;ch7d0AtDz;a4Pe,os;as,ihAm3Zo0Q;aOeNiKoGuEyD;a66oo,u;bio,iz,sD;so,u;bEc7Bdrigue57g03j73mDosevelt,ssi,ta7Nux,w3Z;a4Be0O;ertsDins3;!on;bei0LcEes,vDzzo;as,e8;ci,hards3;ag4es,it0ut0y9;dFmEnDsmu7Zv5F;tan1;ir7os;ic,u;aSeLhJiGoErDut6;asad,if5Zochazk1W;lishc24pDrti62u55we66;e2Tov48;cEe09nD;as,to;as60hl0;aDillips;k,m,n5K;de3AetIna,rGtD;ersErovDtersC;!a,ic;en,on;eDic,ry,ss3;i8ra,tz,z;ers;h71k,rk0tEvD;ic,l3T;el,t2O;bJconnor,g2ClGnei5PrEzD;demir,turk;ella3MtDwe5N;ega,iz;iDof6GsC;vDyn1F;ei8;aPri1;aLeJguy1iFoDune44ym4;rodahl,vDwak;ak3Uik5otn56;eEkolDlsCx3;ic,ov6X;ls1miD;!n1;ils3mD;co42ec;gy,kaEray4varD;ro;jiDmu8shiD;ma;aXcVeQiPoIuD;lGnFrDssoli5T;atDpUr68;i,ov2;oz,te4B;d0l0;h4lIo0HrEsDza0Z;er,s;aFeEiDoz5r3Ete4B;!n6F;au,i8no,t4M;!l9;i2Rl0;crac5Ohhail5kke3Qll0;hmeGij0j2ElFndErci0ssiDyer19;!er;e3Bo2Z;n0Io;dAti;cartDlaughl6;hy;dMe6Dgnu5Ei0jer34kLmJnci59rFtEyD;er,r;ei,ic,su1N;iEkAqu9roqu6tinD;ez,s;a54c,nD;!o;a52mD;ad5;e5Oin1;rig4Ns1;aSeMiIoGuEyD;!nch;k2nDo;d,gu;mbarDpe2Rvr2;di;!nDu,yana1R;coln,dD;bDholm;erg;bed5TfeGhtFitn0kaEn6rDw2G;oy;!j;in1on1;bvDvD;re;iDmmy,rsCu,voie;ne,t11;aTennedy,h4iSlQnez46oJrGuEvar4woD;k,n;cerDmar58znets5;a,o2G;aDem0i2Zyeziu;sni3PvD;ch3U;bay4Frh0Jsk0TvaFwalDzl5;czDsB;yk;cFlD;!cDen3Q;huk;!ev2ic,s;e6uiveD;rt;eff0l2mu8nnun1;hn,lloe,minsBrEstra31to,ur,yDzl5;a,s0;j0GlsC;aMenLha2Pim0QoEuD;ng,r2;e2JhFnErge2Ju2NvD;anA;es,ss3;anEnsD;en,on,t3;nesDsC;en,s1;ki26s1;cGkob3RnsDrv06;en,sD;enDon;!s;ks3obs1;brahimAglesi3Ake4Ll0CnoZoneFshikEto,vanoD;u,v4A;awa;scu;aPeIitchcock,jaltal6oFrist46uD;!aDb0gh9ynh;m4ng;a23dz2fEjga2Sk,rDx3B;ak0Yvat;er,fm3B;iGmingw3NnErD;nand7re8;dDriks1;ers3;kkiEnD;on1;la,n1;dz2g1lvoLmJnsCqIrr0SsFuEyD;as36es;g1ng;anEhiD;mo0Q;i,ov08;ue;alaD;in1;rs1;aMeorgLheorghe,iJjonIoGrEuDw3;o,staf2Utierr7zm4;ayDg2iffitUub0;li1G;lub3Rme0JnD;calv9zale0I;aj,i;l,mDordaL;en7;iev3B;gnJlGmaFnd2No,rDs2Nuthi0;cDza;ia;ge;eaElD;agh0i,o;no;e,on;ab0erMiIjeldsted,lor9oGrFuD;cDent9ji3F;hs;an1Wiedm4;ntaDrt6st0urni0;na;lipEsD;ch0;ovD;!ic;hatAnandeVrD;arDei8;a,i;ov2;dHinste6riksCsDva0D;cob2ZpDtra2X;inoDosiM;za;en,s3;er,is3wards;aUeMiKjurhuJoHrisco0YuEvorakD;!oQ;arte,boEmitru,rDt2U;and,ic;is;g4he0Hmingu7n2Ord19tD;to;us;aDmitr29ssanayake;s,z; GbnaFlEmirDrvis1Lvi,w4;!ov2;gado,ic;th;bo0groot,jo03lEsilDvri9;va;a cruz,e3uD;ca;hl,mcevsBnErw6t2EviD;d5es,s;ieDku1S;ls1;ki;a05e00hNiobMlarkLoFrD;ivDuz;elli;h1lGntFop0rDs26x;byn,reD;a,ia;i,rer0O;em4liD;ns;!e;anu;aLeIiu,oGriDuJwe;stD;eDiaD;ns1;i,ng,uFwDy;!dhury;!n,onEuD;ng;!g;kEnDtterjee,v7;!d,g;ma,raboD;rty;bGl09ng2rD;eghetEnD;a,y;ti;an,ota0M;cer9lder3mpbeIrFstDvadi08;iDro;llo;doEt0uDvalho;so;so,zo;ll;es;a09eXhUiSlNoGrFyD;rne,tyD;qi;ank5iem,ooks,yant;gdan5nFruya,su,uchEyHziD;c,n5;ard;darDik;enD;ko;ov;aEondD;al;nEzD;ev2;co;ancRshwD;as;a01oDuiy4;umDwmD;ik;ckNethov1gu,ktLnJrD;gGisFnD;ascoDds1;ni;ha;er,mD;ann;gtDit7nett;ss3;asD;hi;er,ham;b2ch,ez,hMiley,kk0nHrDu0;bEnDua;es,i0;ieDosa;ri;dDik;a8yopadhyD;ay;ra;er;k,ng;ic;cosZdYguilXkhtXlSnJrGsl4yD;aEd6;in;la;aEsl4;an;ujo,ya;dFgelD;ovD;!a;ersGov,reD;aDjL;ss1;en;en,on,s3;on;eksejGiyGmeiFvD;ar7es;ez;da;ev;ar;ams;ta",WeekDay:"true\xA6fri2mon2s1t0wednesd3;hurs1ues1;aturd1und1;!d0;ay0;!s",Month:"true\xA6aBdec9feb7j2mar,nov9oct1sep0;!t8;!o8;an3u0;l1n0;!e;!y;!u1;!ru0;ary;!em0;ber;pr1ug0;!ust;!il",Date:"true\xA6ago,t2week0yesterd4; e0e0;nd;mr2o0;d0morrow;ay;!w",FirstName:"true\xA6aKblair,cGdevFgabrieEhinaDjBk8l7m3nelly,quinn,re2sh0;ay,e0iloh;a,lby;g6ne;a1el0ina,org5;!okuh9;naia,r0;ion,lo;ashawn,uca;asCe1ir0rE;an;lsAnyat2rry;am0ess6ie,ude;ie,m5;ta;le;an,on;as2h0;arl0eyenne;ie;ey,sidy;lex2ndr1ubr0;ey;a,ea;is",Person:"true\xA6ashton kutchTbScNdLeJgastOhHinez,jFkEleDmCnettKoBp9r4s3t2v0;a0irgin maH;lentino rossi,n go3;aylor,heresa may,iger woods,yra banks;addam hussain,carlett johanssKlobodan milosevic,uC;ay romano,e3o1ush limbau0;gh;d stewart,nald0;inho,o;ese witherspoFilly;a0ipJ;lmIris hiltD;prah winfrFra;essiaen,itt romnEubarek;bron james,e;anye west,iefer sutherland,obe bryant;aime,effers8k rowli0;ng;alle ber0itlBulk hogan;ry;ff0meril lagasse,zekiel;ie;a0enzel washingt2ick wolf;lt1nte;ar1lint0;on;dinal wols1son0;! palm2;ey;arack obama,rock;er",Verb:"true\xA6awak9born,cannot,fr8g7h5k3le2m1s0wors9;e8h3;ake sure,sg;ngth6ss6;eep tabs,n0;own;as0e2;!t2;iv1onna;ight0;en",PhrasalVerb:"true\xA60:7E;1:72;2:7Q;3:7G;4:6V;5:7T;6:7I;7:6O;8:71;9:6P;A:5T;B:7C;C:7J;D:6Q;E:7L;F:7D;G:7S;H:46;a7Yb6Jc5Sd5Oe5Mf4Lg43h3Miron0j3Ik3Dl2Xm2Ln2Jo2Hp1ZquietDr1Ms0FtVuTvacuum 1wLyammerBzI;eroAip JonI;e0k0;by,up;aOeLhKiJorIrit5H;d 1k35;mp0n2Xpe0r7s7;eel Fip G;aJiIn2L;gh 0Crd0;n Fr 3S;it 60k7lk6rm 6Bsh 7Lt6Ov53;rgeBsI;e 9herA;aXeVhTiPoNrKuIype 68;ckArn I;d2in,o3Vup;aJiIot0y 2L;ckleDp G;ckDde 02;neDp Is4Q;d2o71up;ck KdJe Igh69me0p o0Kre0;aw3ba4d2in,up;e 60y 1;by,oC;ink Irow 6B;ba4ov8up;aIe 4Vll52;m 1r 01;ckBke Jlk I;ov8u53;aIba4d2in,o3Fup;ba4ft8p58w3;a0Nc0Me0Gh0Ci09l05m04n03o02pXquare WtOuMwI;earKiI;ngJtch I;aw3ba4o75; by;ck Iit 1m 1ss0;in,up;aNe10iMoKrIucH;aigh1ZiI;ke 6En3C;p Irm22;by,in,oC;nHr 1tc3V;cHmp0nd Ir6Xve6y 1;ba4d2up;d2oCup;arHeLiKlJrIurB;ingBuc7;a3Hit 47;l16n 1;e5Qll0;be4Prt0;ap 4Row F;ash 5Doke0;eep JiIow 9;c3Yp 1;in,oI;ff,v8;gn 4WngJt Iz7;d2o5up; al52le0;aKoIu4S;ot Iut0w 6B;aw3ba4f3IoC;cHdeAk56ve6;e Mll0nd LtI; Itl4G;d2in,o5upI;!on;aw3ba4d2in,o2Aup;o5to;al4Zout0rap4Z;il6v7;aTeQiPoLuI;b 4Sle0n Istl7;aIba4d2in5Ho3Tt3Bu3R;c29w3;ll Kot JuI;g2Vnd6;a29f32o5;arEin,o5;ng 51p6;aIel6inAnt0;c5Bd I;o33u0L;cHt0;aVeUiTlRoPrMsyc2JuI;ll Kt I;aIba4d2in,o1Rt3Fup;p3Kw3;ap3Jd2in,o5t3Dup;attleBess JiLoI;p 1;ah1Ron;iIp 5Fr3XurDwer 5F;nt0;ay4BuI;gAmp 9;ck Gg0leBn 9p48;el 4JncilA;c41ir 2Rn0ss KtJy I;ba4oC; d2c27;aw3ba4o1C;pIw3W;e3Vt F;arrowDerd0oI;d6teD;aQeNiMoKuI;ddl7lI;l 3I;cHp 1uth6ve I;al3Md2in,o5up;ss0x 1;asur7lJss I;a1Jup;t 9;ke Jn 9rIs1Sx0;k 9ry6;do,o47up;aVeTiOoIuck0;aMc3Gg LoIse0;k Ise3E;aft8ba4d2forw2Jin45ov8uI;nd8p;in,o0Q;d 9;e LghtKnJsIv1Y;ten G;e 1k 1; 1e36;arEd2;av1Mt 36velI; o3T;c7p 1sh ItchBugh6y20;in3To5;eJick6nock I;d2o3P;eIyA;l 2Pp I;aw3ba4d2fXin,o0Bto,up;aKoJuI;ic7mpA;ke30tD;c39zz 1;aUePiMoJuI;nkerDrry 1s0Z;lIneArse2W;d Ie 1;ba4d2fast,o05up;de Jt I;ba4on,up;aw3o5;aIlp0;d Kl 2Ar It 1;fIof;rom;in,oXu1H;cHm 1nJve Iz25;it,to;d Ig 2EkerK;d2in,o5;aWeQive Oloss 22oKrJunI; f0Q;in3Gow 2A; Iof 0Y;aJb1Dit,oIrEt0Su18;ff,n,v8;bo5ft8hOw3;aw3ba4d2in,oIup,w3;ff,n,ut;a1Dek0t I;aJb17d2oIrEup;ff,n,ut,v8;cJhIl1WrEt,w3;ead;ross;d aJnI;g 1;bo5;a0Ce05iWlSoOrKuI;cHel 1;k 1;eJighten IownBy 1;aw3oC;eIshe1N; 1z7;lKol I;aIwi1G;bo5rE;d 9low 1;aJeIip0;sh0;g 9ke0mIrI;e G;gPlNnLrJsIzzle0;h G;e Im 1;aw3ba4up;d0isI;h 1;e Il 19;aw3fN;ht ba4ure0;eNnJsI;s 1;cKd I;fIoC;or;e F;dWl 1;cMll Irm0t0W;ap05bKd2in,oJtI;hrough;ff,ut,v8;a4ehi20;e J;at0dge0nd Iy7;oCup;oKrI;ess 9op I;aw3bUin,o1D; 0Eubl7;aYhVlean 9oIross Fut 10;me LoJuntI; o1T;k 1l I;d2oC;aObNforLin,oKtJuI;nd8;ogeth8;ut,v8;th,wI;ard;a4y;pIrEw3;art;eIipA;ck FeI;r 1;lOncel0rLsKtch JveA; in;o1Cup;h Ft6;ry JvI;e 01;aw3o18;l ImD;aIba4d2o16up;rEw3;a0Ne0El07oYrNuI;bblKcklZil05lk 9ndlZrn 0Bst JtIy Gzz6;t F;in,o5up;e I;ov8;anReaPiIush6;ghMng I;aJba4d2forIin,o5up;th;bo5lIrEw3;ong;teI;n 1;k I;d2in,o5up;ch0;arPgDil 9n7oLssKttlJunce Ix F;aw3ba4;e 9; arE;k Ft 1;e 1;d2up; d2;d 1;aNeed0oIurt0;cKw I;aw3ba4d2o5up;ck;k I;in,oP;ck0nk0st6; oOaLef 1nd I;d2ov8up;er;up;r0t I;d2in,oIup;ff,ut;ff,nI;to;ck Oil0nKrgJsI;h F;ainBe F;g FkB; on;in,o5; o5;aw3d2o5up;ay;cRdNsk Kuction6; oC;ff;arEo5;ouI;nd;d I;d2oIup;ff,n;own;t G;o5up;ut",Modal:"true\xA6c5lets,m4ought3sh1w0;ill,o5;a0o4;ll,nt;! to,a;ay,ight,ust;an,o0;uld",Adjective:"true\xA60:7P;1:84;2:83;3:8A;4:7W;5:5S;6:4N;7:4O;8:58;9:6I;A:81;a6Wb6Gc63d5Je54f4Hg49h3Wi39j37k36l2Vm2Ln2Bo1Wp1Dquack,r12s0Ft07uMvJwByear5;arp0eFholeEiDoB;man5oBu6P;d6Rzy;despr7Ls5S;!sa7;eClBste2A;co1Nl o4W;!k5;aCiBola4M;b89ce versa,ol5H;ca3gabo6Gnilla;ltUnHpCrb5Msu4tterB;!mo7G; Eb1SpDsBti1M;ca7etBide dKtairs;!ti2;er,i3U;f36to da1;aLbeco75convin29deIeHfair,ivers4knGprecedVrEsCwB;iel3Nritt6A;i1XuB;pervis0spec3Y;eBu5;cognHgul6Tl6T;own;ndi2v64xpect0;cid0rB;!grou5ZsB;iz0tood;b7pp0Dssu6UuthorB;iz0;i26ra;aGeEhDi6AoCrB;i1oubl0us3M;geth8p,rp6Vuc67;ough4Wril33;en60l32mpBrr2X;o6Ati2;boo,lBn;ent0;aWcVeThSiQmug,nobbi3LoOpNqueami3LtFuBymb6H;bDi gener5DpBrpri6D;erBre0N;! dup8b,i2C;du0seq52;anda77eGiFrBunni2y3F;aightCiB;ki2p0; fBfB;or5K;ll,r5S;aBreotyp0;dfa6Cmi2;a55ec2Gir1Hlend6Cot on; call0le,mb8phist1XrBu0Vvi48;d6Ary;gnifica3nB;ce51g7;am2Re8ocki2ut;cBda1em5lfi32ni1Wpa6Jre6;o1Er42;at5Gient28reec5G;cr0me;aJeEiCoB;bu60tt51uQy4;ghtBv4;!-2Bf9;ar,bel,condi1du6Dfres5AlEpublic42sCtard0vB;ea26;is4CoB;lu1na3;aQe1Cuc4A;b5TciBllyi2;al,st;aOeLicayu6lac5Ropuli5QrCuB;bl5Jmp0n51;eGiDoB;!b07fu5RmiBp8;ne3si2;mCor,sBva1;ti6;a53e;ci5MmB;a0EiB;er,um;ac20rBti1;feAma2XpleBv38;xi2;rBst;allelDtB;-tiBi4;me;!ed;bLffJkIld fashion0nHpGrg1Eth8utFvB;al,erB;!all,niCt,wB;eiBrouB;ght;do0Ter,g2Qsi4B;en,posi1; boa5Og2Oli6;!ay; gua5MbBli6;eat;eDsB;cBer0Eole1;e6u3O;d2Xse;aJeIiHoBua4X;nFrCtB;ab7;thB;!eB;rn;chala3descri58stop;ght5;arby,cessa44ighbor5xt;k0usia1A;aIeGiDoBultip7;bi7derBl0Vnth5ot,st;a1n;nBx0;dblo0RiaBor;tu37;ande3Qdi4NnaBre;ci2;cBgenta,in,j01keshift,le,mmoth,ny,sculi6;ab33ho;aKeFiCoBu15;uti14vi2;mCteraB;l,te;it0;ftEgBth4;al,eCitiB;ma1;nda3K;!-0C;ngu3Zst,tt8;ap1Xind5no0A;agg0uB;niMstifi0veni7;de4gno4Klleg4mQnEpso 20rB;a1rB;eleBita0J;va3; KaJbr0corIdGfluenQiQnFsEtCviB;go0Fti2;aAen3SoxB;ic3B;a6i2Vul0D;a1er,oce3;iCoB;or;reA;deq3Qppr33;fBsitu,vitro;ro3;mFpB;arDerfeAoBrop8;li1rtB;a3ed;ti4;eBi0S;d2Vn3C;aIeFiDoBumdr3I;ne36ok0rrBs08ur5;if2Z;ghfalut1QspB;an2X;aClB;liYpf9;li2;lEnDrB;d04roB;wi2;dy;f,low0;ainf9ener2Oiga24lHoGraDuB;ilBng ho;ty;cCtB;ef9is;ef9;ne,od;ea2Iob4;aTeNinMlKoFrB;a1VeDoz1MustB;raB;ti2;e2Gq10tf9;oDrB; keeps,eBm8tuna1;g03ign;liB;sh;aBue3;g31tte1P;al,i1;dFmCrB;ti7;a7ini6;ne;le; up;bl0i3l27r Cux,voB;ri1uri1;oBreac1E;ff;aLfficie3lKmHnFreAthere4veExB;aAcess,pe1QtraCuB;be2Nl0E;!va1E;n,ryday; BcouraEti0O;rou1sui1;erCiB;ne3;gi2;abo23dMe17i1;g8sB;t,ygB;oi2;er;aReJiDoBrea14ue;mina3ne,ubB;le,tf9;dact1Bfficu1OsCvB;er1K;creDeas0gruntl0hone1FordCtB;a3ressM;er5;et; HadpGfFgene1PliDrang0spe1PtCvoB;ut;ail0ermin0;be1Mca1ghB;tf9;ia3;an;facto;i5magBngeroUs0G;ed,i2;ly;ertaMhief,ivil,oDrB;aBowd0u0G;mp0vZz0;loImGnCrrBve0P;eAu1I;cre1fu0LgrDsCtB;empo0Dra0E;ta3;ue3;mer08pleB;te,x;ni4ss4;in;aNeIizarHlFoCrB;and new,isk,okN;gCna fiUttom,urgeoB;is;us;ank,indB;!i2;re;autif9hiDloCnBst,yoD;eUt;v0w;nd;ul;ckCnkru0WrrB;en;!wards; priori,b0Mc0Jd09fra08g04h03lYmWntiquVppSrMsIttracti06utheHvEwB;aCkB;wa0T;ke,re;ant garCerB;age;de;ntU;leep,piDsuDtonB;isB;hi2;ri2;ab,bitEroDtiB;fiB;ci4;ga3;raB;ry;are3etiNrB;oprB;ia1;at0;aJuB;si2;arEcohCeBiIl,oof;rt;olB;ic;mi2;ead;ainDgressiConiB;zi2;ve;st;id; IeGuFvB;aCerB;se;nc0;ed;lt;pt,qB;ua1;hoc,infinitB;um;cuCtu4u1;al;ra1;erLlKoIruHsCuB;nda3;e3oCtraA;ct;lu1rbi2;ng;te;pt;aBve;rd;aze,e;ra3;nt",Comparable:"true\xA60:41;1:4I;2:45;3:2Y;4:4B;5:3X;a4Ob44c3Od3De35f2Rg2Fh24i1Vj1Uk1Rl1Jm1Dn17o15p0Vqu0Tr0KsTtMuIvFw7y6za13;ell27ou4;aBe9hi1Yi7r6;o4y;ck0Ode,l6n1ry,se;d,y;a6i4Mt;k,ry;n1Tr6sK;m,y;a7e6ulgar;nge5rda2xi4;g9in,st;g0n6pco3Mse5;like0t6;i1r6;ue;aAen9hi8i7ough,r6;anqu2Oen1ue;dy,g3Sme0ny,r09;ck,n,rs2P;d40se;ll,me,rt,s6wd45;te5;aVcarUeThRiQkin0FlMmKoHpGqua1FtAu7w6;eet,ift;b7dd13per0Gr6;e,re2H;sta2Ft3;aAe9iff,r7u6;pXr1;a6ict,o4;ig3Fn0U;a1ep,rn;le,rk;e22i3Fright0;ci28ft,l7o6re,ur;n,thi4;emn,id;a6el0ooth;ll,rt;e8i6ow,y;ck,g35m6;!y;ek,nd3D;ck,l0mp3;a6iTort,rill,y;dy,ll0Xrp;cu0Rve0Rxy;ce,ed,y;d,fe,int0l1Vv14;aBe9i8o6ude;mantic,o1Isy,u6;gh,nd;ch,pe,tzy;a6d,mo0H;dy,l;gg7ndom,p6re,w;id;ed;ai2i6;ck,et;aEhoDi1QlCoBr8u6;ny,r6;e,p3;egna2ic7o6;fouYud;ey,k0;li04or,te1B;ain,easa2;ny;in5le;dd,f6i0ld,ranQ;fi10;aAe8i7o6;b3isy,rm15sy;ce,mb3;a6w;r,t;ive,rr01;aAe8ild,o7u6;nda19te;ist,o1;a6ek,llX;n,s0ty;d,tuQ;aBeAi9o6ucky;f0Un7o1Du6ve0w17y0T;d,sy;e0g;g1Tke0tt3ve0;an,wd;me,r6te;ge;e7i6;nd;en;ol0ui1P;cy,ll,n6;sBt6;e6ima8;llege2r6;es7media6;te;ti4;ecu6ta2;re;aEeBiAo8u6;ge,m6ng1R;b3id;ll6me0t;ow;gh,l0;a6f04sita2;dy,v6;en0y;nd1Hppy,r6te5;d,sh;aGenFhDiClBoofy,r6;a9e8is0o6ue1E;o6ss;vy;at,en,y;nd,y;ad,ib,ooI;a2d1;a6o6;st0;t3uiY;u1y;aIeeb3iDlat,oAr8u6;ll,n6r14;!ny;aHe6iend0;e,sh;a7r6ul;get5mG;my;erce8n6rm;an6e;ciC;! ;le;ir,ke,n0Fr,st,t,ulA;aAerie,mp9sse7v6xtre0Q;il;nti6;al;ty;r7s6;tern,y;ly,th0;aFeCi9r7u6;ll,mb;u6y;nk;r7vi6;ne;e,ty;a6ep,nD;d6f,r;!ly;mp,pp03rk;aHhDlAo8r7u6;dd0r0te;isp,uel;ar6ld,mmon,ol,st0ward0zy;se;e6ou1;a6vW;n,r;ar8e6il0;ap,e6;sy;mi4;gey,lm8r6;e5i4;ful;!i4;aNiLlIoEr8u6;r0sy;ly;aAi7o6;ad,wn;ef,g7llia2;nt;ht;sh,ve;ld,r7un6;cy;ed,i4;ng;a7o6ue;nd,o1;ck,nd;g,tt6;er;d,ld,w1;dy;bsu9ng8we6;so6;me;ry;rd",TextOrdinal:"true\xA6bGeDf9hundredHmGnin7qu6s4t0zeroH;enGh1rFwe0;lfFn9;ir0ousandE;d,t4;e0ixt9;cond,ptAvent8xtA;adr9int9;et0th;e6ie8;i2o0;r0urt3;tie5;ft1rst;ight0lev1;e0h,ie2;en1;illion0;th",Cardinal:"true\xA6bHeEf8hundred,mHnineAone,qu6s4t0zero;en,h2rGw0;e0o;lve,n8;irt9ousandEree;e0ix5;pt1ven4xt1;adr0int0;illion;i3o0;r1ur0;!t2;ty;ft0ve;e2y;ight0lev1;!e0y;en;illion0;!s",Expression:"true\xA6a02b01dXeVfuck,gShLlImHnGoDpBshAtsk,u7voi04w3y0;a1eLu0;ck,p;!a,hoo,y;h1ow,t0;af,f;e0oa;e,w;gh,h0;! 0h,m;huh,oh;eesh,hh,it;ff,hew,l0sst;ease,z;h1o0w,y;h,o,ps;!h;ah,ope;eh,mm;m1ol0;!s;ao,fao;a4e2i,mm,oly1urr0;ah;! mo6;e,ll0y;!o;ha0i;!ha;ah,ee,o0rr;l0odbye;ly;e0h,t cetera,ww;k,p;'oh,a0uh;m0ng;mit,n0;!it;ah,oo,ye; 1h0rgh;!em;la",Adverb:"true\xA6a08by 06d02eYfShQinPjustOkinda,mMnJoEpCquite,r9s5t2up1very,well,ye0;p,s; to,wards5;h1iny bit,o0wiO;o,t6ward;en,us;everal,o0uch;!me1rt0; of;hYtimes,w09;a1e0;alT;ndomSthN;ar excellDer0oint blank; Nhaps;f3n0;ce0ly;! 0;ag02moW; courIten;ewKo0; longEt 0;onIwithstanding;aybe,eanwhiAore0;!ovB;! aboU;deed,steV;en0;ce;or2u0;lArther0;!moJ; 0ev3;examp0good,suH;le;n1v0;er; mas0ough;se;e0irect1; 1finite0;ly;ju8trop;far,n0;ow; DbroCd nauseam,gBl6ny3part,s2t 0w4;be6l0mo6wor6;arge,ea5; soon,ide;mo1w0;ay;re;l 1mo0one,ready,so,ways;st;b1t0;hat;ut;ain;ad;lot,posteriori",Determiner:"true\xA6aAboth,d8e5few,l3mu7neiCown,plenty,some,th2various,wh0;at0ich0;evB;at,e3is,ose;a,e0;!ast,s;a1i6l0very;!se;ch;e0u;!s;!n0;!o0y;th0;er"},zo="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",_y=zo.split("").reduce(function(u,t,e){return u[t]=e,u},{}),y0=function(t){if(zo[t]!==void 0)return zo[t];for(var e=1,n=36,r="";t>=n;t-=n,e++,n*=36);for(;e--;){var i=t%36;r=String.fromCharCode((i<10?48:55)+i)+r,t=(t-i)/36}return r},b0=function(t){if(_y[t]!==void 0)return _y[t];for(var e=0,n=1,r=36,i=1;n<t.length;e+=r,n++,r*=36);for(var a=t.length-1;a>=0;a--,i*=36){var s=t.charCodeAt(a)-48;s>10&&(s-=7),e+=s*i}return e},jo={toAlphaCode:y0,fromAlphaCode:b0},g0=function(t){for(var e=new RegExp("([0-9A-Z]+):([0-9A-Z]+)"),n=0;n<t.nodes.length;n++){var r=e.exec(t.nodes[n]);if(!r){t.symCount=n;break}t.syms[jo.fromAlphaCode(r[1])]=jo.fromAlphaCode(r[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)},v0=function(t,e,n){var r=jo.fromAlphaCode(e);return r<t.symCount?t.syms[r]:n+r+1-t.symCount},C0=function(t){var e=[],n=function r(i,a){var s=t.nodes[i];s[0]==="!"&&(e.push(a),s=s.slice(1));for(var o=s.split(/([A-Z0-9,]+)/g),l=0;l<o.length;l+=2){var c=o[l],d=o[l+1];if(!!c){var p=a+c;if(d===","||d===void 0){e.push(p);continue}var m=v0(t,d,i);r(m,p)}}};return n(0,""),e},T0=function(t){var e={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&g0(e),C0(e)},N0=T0,x0=function(t){var e=t.split("|").reduce(function(r,i){var a=i.split("\xA6");return r[a[0]]=a[1],r},{}),n={};return Object.keys(e).forEach(function(r){var i=N0(e[r]);r==="true"&&(r=!0);for(var a=0;a<i.length;a++){var s=i[a];n.hasOwnProperty(s)===!0?Array.isArray(n[s])===!1?n[s]=[n[s],r]:n[s].push(r):n[s]=r}}),n},V0=x0,w0={"20th century fox":"Organization","7 eleven":"Organization","motel 6":"Organization",g8:"Organization",vh1:"Organization",q1:"Date",q2:"Date",q3:"Date",q4:"Date",her:["Possessive","Pronoun"],his:["Possessive","Pronoun"],their:["Possessive","Pronoun"],themselves:["Possessive","Pronoun"],your:["Possessive","Pronoun"],our:["Possessive","Pronoun"],my:["Possessive","Pronoun"],its:["Possessive","Pronoun"]},By={Unit:function(t,e){t[e]=["Abbreviation","Unit"]},Cardinal:function(t,e){t[e]=["TextValue","Cardinal"]},TextOrdinal:function(t,e){t[e]=["Ordinal","TextValue"],t[e+"s"]=["TextValue","Fraction"]},Singular:function(t,e,n){t[e]="Singular";var r=n.transforms.toPlural(e,n);t[r]=t[r]||"Plural"},Infinitive:function(t,e,n){t[e]="Infinitive";for(var r=n.transforms.conjugate(e,n),i=Object.keys(r),a=0;a<i.length;a++){var s=r[i[a]];t[s]=t[s]||i[a]}},Comparable:function(t,e,n){t[e]="Comparable";for(var r=n.transforms.adjectives(e),i=Object.keys(r),a=0;a<i.length;a++){var s=r[i[a]];t[s]=t[s]||i[a]}},PhrasalVerb:function(t,e,n){t[e]=["PhrasalVerb","Infinitive"];for(var r=e.split(" "),i=n.transforms.conjugate(r[0],n),a=Object.keys(i),s=0;s<a.length;s++){var o=i[a[s]]+" "+r[1];t[o]=t[o]||["PhrasalVerb",a[s]],n.hasCompound[i[a[s]]]=!0}},Demonym:function(t,e,n){t[e]="Demonym";var r=n.transforms.toPlural(e,n);t[r]=t[r]||["Demonym","Plural"]}},Ey=function(t,e,n){Object.keys(t).forEach(function(r){var i=t[r];(i==="Abbreviation"||i==="Unit")&&(n.cache.abbreviations[r]=!0);var a=r.split(" ");if(a.length>1&&(n.hasCompound[a[0]]=!0),By[i]!==void 0){By[i](e,r,n);return}if(e[r]===void 0){e[r]=i;return}typeof e[r]=="string"&&(e[r]=[e[r]]),typeof i=="string"?e[r].push(i):e[r]=e[r].concat(i)})},D0=function(t){var e=Object.assign({},w0);return Object.keys(My).forEach(function(n){var r=V0(My[n]);Object.keys(r).forEach(function(i){r[i]=n}),Ey(r,e,t)}),e},$y={buildOut:D0,addWords:Ey},A0=function(t){for(var e=t.irregulars.nouns,n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];t.words[i]="Singular",t.words[e[i]]="Plural"}for(var a=t.irregulars.verbs,s=Object.keys(a),o=function(d){var p=s[d];t.words[p]=t.words[p]||"Infinitive";var m=t.transforms.conjugate(p,t);m=Object.assign(m,a[p]),Object.keys(m).forEach(function(f){t.words[m[f]]=t.words[m[f]]||f,t.words[m[f]]==="Participle"&&(t.words[m[f]]=f)})},l=0;l<s.length;l++)o(l)},S0=A0,I0={addendum:"addenda",alga:"algae",alumna:"alumnae",alumnus:"alumni",analysis:"analyses",antenna:"antennae",appendix:"appendices",avocado:"avocados",axis:"axes",bacillus:"bacilli",barracks:"barracks",beau:"beaux",bus:"buses",cactus:"cacti",chateau:"chateaux",child:"children",circus:"circuses",clothes:"clothes",corpus:"corpora",criterion:"criteria",curriculum:"curricula",database:"databases",deer:"deer",diagnosis:"diagnoses",echo:"echoes",embargo:"embargoes",epoch:"epochs",foot:"feet",formula:"formulae",fungus:"fungi",genus:"genera",goose:"geese",halo:"halos",hippopotamus:"hippopotami",index:"indices",larva:"larvae",leaf:"leaves",libretto:"libretti",loaf:"loaves",man:"men",matrix:"matrices",memorandum:"memoranda",modulus:"moduli",mosquito:"mosquitoes",mouse:"mice",nebula:"nebulae",nucleus:"nuclei",octopus:"octopi",opus:"opera",ovum:"ova",ox:"oxen",parenthesis:"parentheses",person:"people",phenomenon:"phenomena",prognosis:"prognoses",quiz:"quizzes",radius:"radii",referendum:"referenda",rodeo:"rodeos",sex:"sexes",shoe:"shoes",sombrero:"sombreros",stimulus:"stimuli",stomach:"stomachs",syllabus:"syllabi",synopsis:"synopses",tableau:"tableaux",thesis:"theses",thief:"thieves",tooth:"teeth",tornado:"tornados",tuxedo:"tuxedos",vertebra:"vertebrae"},P0={g:"Gerund",prt:"Participle",perf:"PerfectTense",pst:"PastTense",fut:"FuturePerfect",pres:"PresentTense",pluperf:"Pluperfect",a:"Actor"},qn={act:{a:"_or"},ache:{pst:"ached",g:"aching"},age:{g:"ageing",pst:"aged",pres:"ages"},aim:{a:"_er",g:"_ing",pst:"_ed"},arise:{prt:"_n",pst:"arose"},babysit:{a:"_ter",pst:"babysat"},ban:{a:"",g:"_ning",pst:"_ned"},be:{a:"",g:"am",prt:"been",pst:"was",pres:"is"},beat:{a:"_er",g:"_ing",prt:"_en"},become:{prt:"_"},begin:{g:"_ning",prt:"begun",pst:"began"},being:{g:"are",pst:"were",pres:"are"},bend:{prt:"bent"},bet:{a:"_ter",prt:"_"},bind:{pst:"bound"},bite:{g:"biting",prt:"bitten",pst:"bit"},bleed:{pst:"bled",prt:"bled"},blow:{prt:"_n",pst:"blew"},boil:{a:"_er"},brake:{prt:"broken"},break:{pst:"broke"},breed:{pst:"bred"},bring:{pst:"brought",prt:"brought"},broadcast:{pst:"_"},budget:{pst:"_ed"},build:{pst:"built",prt:"built"},burn:{prt:"_ed"},burst:{prt:"_"},buy:{pst:"bought",prt:"bought"},can:{a:"",fut:"_",g:"",pst:"could",perf:"could",pluperf:"could",pres:"_"},catch:{pst:"caught"},choose:{g:"choosing",prt:"chosen",pst:"chose"},cling:{prt:"clung"},come:{prt:"_",pst:"came",g:"coming"},compete:{a:"competitor",g:"competing",pst:"_d"},cost:{pst:"_"},creep:{prt:"crept"},cut:{prt:"_"},deal:{pst:"_t",prt:"_t"},develop:{a:"_er",g:"_ing",pst:"_ed"},die:{g:"dying",pst:"_d"},dig:{g:"_ging",pst:"dug",prt:"dug"},dive:{prt:"_d"},do:{pst:"did",pres:"_es"},draw:{prt:"_n",pst:"drew"},dream:{prt:"_t"},drink:{prt:"drunk",pst:"drank"},drive:{g:"driving",prt:"_n",pst:"drove"},drop:{g:"_ping",pst:"_ped"},eat:{a:"_er",g:"_ing",prt:"_en",pst:"ate"},edit:{pst:"_ed",g:"_ing"},egg:{pst:"_ed"},fall:{prt:"_en",pst:"fell"},feed:{prt:"fed",pst:"fed"},feel:{a:"_er",pst:"felt"},fight:{pst:"fought",prt:"fought"},find:{pst:"found"},flee:{g:"_ing",prt:"fled"},fling:{prt:"flung"},fly:{prt:"flown",pst:"flew"},forbid:{pst:"forbade"},forget:{g:"_ing",prt:"forgotten",pst:"forgot"},forgive:{g:"forgiving",prt:"_n",pst:"forgave"},free:{a:"",g:"_ing"},freeze:{g:"freezing",prt:"frozen",pst:"froze"},get:{pst:"got",prt:"gotten"},give:{g:"giving",prt:"_n",pst:"gave"},go:{prt:"_ne",pst:"went",pres:"goes"},grow:{prt:"_n"},guide:{pst:"_d"},hang:{pst:"hung",prt:"hung"},have:{g:"having",pst:"had",prt:"had",pres:"has"},hear:{pst:"_d",prt:"_d"},hide:{prt:"hidden",pst:"hid"},hit:{prt:"_"},hold:{pst:"held",prt:"held"},hurt:{pst:"_",prt:"_"},ice:{g:"icing",pst:"_d"},imply:{pst:"implied",pres:"implies"},is:{a:"",g:"being",pst:"was",pres:"_"},keep:{prt:"kept"},kneel:{prt:"knelt"},know:{prt:"_n"},lay:{pst:"laid",prt:"laid"},lead:{pst:"led",prt:"led"},leap:{prt:"_t"},leave:{pst:"left",prt:"left"},lend:{prt:"lent"},lie:{g:"lying",pst:"lay"},light:{pst:"lit",prt:"lit"},log:{g:"_ging",pst:"_ged"},loose:{prt:"lost"},lose:{g:"losing",pst:"lost"},make:{pst:"made",prt:"made"},mean:{pst:"_t",prt:"_t"},meet:{a:"_er",g:"_ing",pst:"met",prt:"met"},miss:{pres:"_"},name:{g:"naming"},patrol:{g:"_ling",pst:"_led"},pay:{pst:"paid",prt:"paid"},prove:{prt:"_n"},puke:{g:"puking"},put:{prt:"_"},quit:{prt:"_"},read:{pst:"_",prt:"_"},ride:{prt:"ridden"},reside:{pst:"_d"},ring:{pst:"rang",prt:"rung"},rise:{fut:"will have _n",g:"rising",prt:"_n",pst:"rose",pluperf:"had _n"},rub:{g:"_bing",pst:"_bed"},run:{g:"_ning",prt:"_",pst:"ran"},say:{pst:"said",prt:"said",pres:"_s"},seat:{pst:"sat",prt:"sat"},see:{g:"_ing",prt:"_n",pst:"saw"},seek:{prt:"sought"},sell:{pst:"sold",prt:"sold"},send:{prt:"sent"},set:{prt:"_"},sew:{prt:"_n"},shake:{prt:"_n"},shave:{prt:"_d"},shed:{g:"_ding",pst:"_",pres:"_s"},shine:{pst:"shone",prt:"shone"},shoot:{pst:"shot",prt:"shot"},show:{pst:"_ed"},shut:{prt:"_"},sing:{prt:"sung",pst:"sang"},sink:{pst:"sank",pluperf:"had sunk"},sit:{pst:"sat"},ski:{pst:"_ied"},slay:{prt:"slain"},sleep:{prt:"slept"},slide:{pst:"slid",prt:"slid"},smash:{pres:"_es"},sneak:{prt:"snuck"},speak:{fut:"will have spoken",prt:"spoken",pst:"spoke",perf:"have spoken",pluperf:"had spoken"},speed:{prt:"sped"},spend:{prt:"spent"},spill:{prt:"_ed",pst:"spilt"},spin:{g:"_ning",pst:"spun",prt:"spun"},spit:{prt:"spat"},split:{prt:"_"},spread:{pst:"_"},spring:{prt:"sprung"},stand:{pst:"stood"},steal:{a:"_er",pst:"stole"},stick:{pst:"stuck"},sting:{pst:"stung"},stink:{pst:"stunk",prt:"stunk"},stream:{a:"_er"},strew:{prt:"_n"},strike:{g:"striking",pst:"struck"},suit:{a:"_er",g:"_ing",pst:"_ed"},sware:{prt:"sworn"},swear:{pst:"swore"},sweep:{prt:"swept"},swim:{g:"_ming",pst:"swam"},swing:{pst:"swung"},take:{fut:"will have _n",pst:"took",perf:"have _n",pluperf:"had _n"},teach:{pst:"taught",pres:"_es"},tear:{pst:"tore"},tell:{pst:"told"},think:{pst:"thought"},thrive:{prt:"_d"},tie:{g:"tying",pst:"_d"},undergo:{prt:"_ne"},understand:{pst:"understood"},upset:{prt:"_"},wait:{a:"_er",g:"_ing",pst:"_ed"},wake:{pst:"woke"},wear:{pst:"wore"},weave:{prt:"woven"},wed:{pst:"wed"},weep:{prt:"wept"},win:{g:"_ning",pst:"won"},wind:{prt:"wound"},withdraw:{pst:"withdrew"},wring:{prt:"wrung"},write:{g:"writing",prt:"written",pst:"wrote"}},zy=Object.keys(qn),O0=function(t){var e=zy[t],n={};Object.keys(qn[e]).forEach(function(r){var i=qn[e][r];i=i.replace("_",e);var a=P0[r];n[a]=i}),qn[e]=n};for(var Ho=0;Ho<zy.length;Ho++)O0(Ho);var L0=qn,R0={b:[{reg:/([^aeiou][aeiou])b$/i,repl:{pr:"$1bs",pa:"$1bbed",gr:"$1bbing"}}],d:[{reg:/(end)$/i,repl:{pr:"$1s",pa:"ent",gr:"$1ing",ar:"$1er"}},{reg:/(eed)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing",ar:"$1er"}},{reg:/(ed)$/i,repl:{pr:"$1s",pa:"$1ded",ar:"$1der",gr:"$1ding"}},{reg:/([^aeiou][ou])d$/i,repl:{pr:"$1ds",pa:"$1dded",gr:"$1dding"}}],e:[{reg:/(eave)$/i,repl:{pr:"$1s",pa:"$1d",gr:"eaving",ar:"$1r"}},{reg:/(ide)$/i,repl:{pr:"$1s",pa:"ode",gr:"iding",ar:"ider"}},{reg:/(t|sh?)(ake)$/i,repl:{pr:"$1$2s",pa:"$1ook",gr:"$1aking",ar:"$1$2r"}},{reg:/w(ake)$/i,repl:{pr:"w$1s",pa:"woke",gr:"waking",ar:"w$1r"}},{reg:/m(ake)$/i,repl:{pr:"m$1s",pa:"made",gr:"making",ar:"m$1r"}},{reg:/(a[tg]|i[zn]|ur|nc|gl|is)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/([bd]l)e$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}},{reg:/(om)e$/i,repl:{pr:"$1es",pa:"ame",gr:"$1ing"}}],g:[{reg:/([^aeiou][ou])g$/i,repl:{pr:"$1gs",pa:"$1gged",gr:"$1gging"}}],h:[{reg:/(..)([cs]h)$/i,repl:{pr:"$1$2es",pa:"$1$2ed",gr:"$1$2ing"}}],k:[{reg:/(ink)$/i,repl:{pr:"$1s",pa:"unk",gr:"$1ing",ar:"$1er"}}],m:[{reg:/([^aeiou][aeiou])m$/i,repl:{pr:"$1ms",pa:"$1mmed",gr:"$1mming"}}],n:[{reg:/(en)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],p:[{reg:/(e)(ep)$/i,repl:{pr:"$1$2s",pa:"$1pt",gr:"$1$2ing",ar:"$1$2er"}},{reg:/([^aeiou][aeiou])p$/i,repl:{pr:"$1ps",pa:"$1pped",gr:"$1pping"}},{reg:/([aeiu])p$/i,repl:{pr:"$1ps",pa:"$1p",gr:"$1pping"}}],r:[{reg:/([td]er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(er)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}}],s:[{reg:/(ish|tch|ess)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}],t:[{reg:/(ion|end|e[nc]t)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/(.eat)$/i,repl:{pr:"$1s",pa:"$1ed",gr:"$1ing"}},{reg:/([aeiu])t$/i,repl:{pr:"$1ts",pa:"$1t",gr:"$1tting"}},{reg:/([^aeiou][aeiou])t$/i,repl:{pr:"$1ts",pa:"$1tted",gr:"$1tting"}}],w:[{reg:/(.llow)$/i,repl:{pr:"$1s",pa:"$1ed"}},{reg:/(..)(ow)$/i,repl:{pr:"$1$2s",pa:"$1ew",gr:"$1$2ing",prt:"$1$2n"}}],y:[{reg:/(i|f|rr)y$/i,repl:{pr:"$1ies",pa:"$1ied",gr:"$1ying"}}],z:[{reg:/([aeiou]zz)$/i,repl:{pr:"$1es",pa:"$1ed",gr:"$1ing"}}]},Gr=R0,F0={pr:"PresentTense",pa:"PastTense",gr:"Gerund",prt:"Participle",ar:"Actor"},k0=function(t,e){for(var n={},r=Object.keys(e.repl),i=0;i<r.length;i+=1){var a=r[i];n[F0[a]]=t.replace(e.reg,e.repl[a])}return n},M0=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=t[t.length-1];if(Gr.hasOwnProperty(e)===!0)for(var n=0;n<Gr[e].length;n+=1){var r=Gr[e][n].reg;if(r.test(t)===!0)return k0(t,Gr[e][n])}return{}},_0=M0,jy=/[bcdfghjklmnpqrstvwxz]y$/,B0={Gerund:function(t){return t.charAt(t.length-1)==="e"?t.replace(/e$/,"ing"):t+"ing"},PresentTense:function(t){return t.charAt(t.length-1)==="s"?t+"es":jy.test(t)===!0?t.slice(0,-1)+"ies":t+"s"},PastTense:function(t){return t.charAt(t.length-1)==="e"?t+"d":t.substr(-2)==="ed"?t:jy.test(t)===!0?t.slice(0,-1)+"ied":t+"ed"}},qo=B0,E0=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n={};return e&&e.irregulars&&e.irregulars.verbs.hasOwnProperty(t)===!0&&(n=Object.assign({},e.irregulars.verbs[t])),n=Object.assign({},_0(t),n),n.Gerund===void 0&&(n.Gerund=qo.Gerund(t)),n.PastTense===void 0&&(n.PastTense=qo.PastTense(t)),n.PresentTense===void 0&&(n.PresentTense=qo.PresentTense(t)),n},$0=E0,Hy=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/oud$/,/...p$/],qy=[/ary$/],Ky={nice:"nicest",late:"latest",hard:"hardest",inner:"innermost",outer:"outermost",far:"furthest",worse:"worst",bad:"worst",good:"best",big:"biggest",large:"largest"},Xr=[{reg:/y$/i,repl:"iest"},{reg:/([aeiou])t$/i,repl:"$1ttest"},{reg:/([aeou])de$/i,repl:"$1dest"},{reg:/nge$/i,repl:"ngest"},{reg:/([aeiou])te$/i,repl:"$1test"}],z0=function(t){if(Ky.hasOwnProperty(t))return Ky[t];for(var e=0;e<Xr.length;e++)if(Xr[e].reg.test(t))return t.replace(Xr[e].reg,Xr[e].repl);for(var n=0;n<qy.length;n++)if(qy[n].test(t)===!0)return null;for(var r=0;r<Hy.length;r++)if(Hy[r].test(t)===!0)return t.charAt(t.length-1)==="e"?t+"st":t+"est";return t+"est"},j0=z0,Wy=[/ght$/,/nge$/,/ough$/,/ain$/,/uel$/,/[au]ll$/,/ow$/,/old$/,/oud$/,/e[ae]p$/],Uy=[/ary$/,/ous$/],Gy={grey:"greyer",gray:"grayer",green:"greener",yellow:"yellower",red:"redder",good:"better",well:"better",bad:"worse",sad:"sadder",big:"bigger"},Zr=[{reg:/y$/i,repl:"ier"},{reg:/([aeiou])t$/i,repl:"$1tter"},{reg:/([aeou])de$/i,repl:"$1der"},{reg:/nge$/i,repl:"nger"}],H0=function(t){if(Gy.hasOwnProperty(t))return Gy[t];for(var e=0;e<Zr.length;e++)if(Zr[e].reg.test(t)===!0)return t.replace(Zr[e].reg,Zr[e].repl);for(var n=0;n<Uy.length;n++)if(Uy[n].test(t)===!0)return null;for(var r=0;r<Wy.length;r++)if(Wy[r].test(t)===!0)return t+"er";return/e$/.test(t)===!0?t+"r":t+"er"},q0=H0,Xy={toSuperlative:j0,toComparative:q0},K0=function(t){var e={},n=Xy.toSuperlative(t);n&&(e.Superlative=n);var r=Xy.toComparative(t);return r&&(e.Comparative=r),e},W0=K0,U0={a:[[/(antenn|formul|nebul|vertebr|vit)a$/i,"$1ae"],[/([ti])a$/i,"$1a"]],e:[[/(kn|l|w)ife$/i,"$1ives"],[/(hive)$/i,"$1s"],[/([m|l])ouse$/i,"$1ice"],[/([m|l])ice$/i,"$1ice"]],f:[[/^(dwar|handkerchie|hoo|scar|whar)f$/i,"$1ves"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)f$/i,"$1ves"]],i:[[/(octop|vir)i$/i,"$1i"]],m:[[/([ti])um$/i,"$1a"]],n:[[/^(oxen)$/i,"$1"]],o:[[/(al|ad|at|er|et|ed|ad)o$/i,"$1oes"]],s:[[/(ax|test)is$/i,"$1es"],[/(alias|status)$/i,"$1es"],[/sis$/i,"ses"],[/(bu)s$/i,"$1ses"],[/(sis)$/i,"ses"],[/^(?!talis|.*hu)(.*)man$/i,"$1men"],[/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,"$1i"]],x:[[/(matr|vert|ind|cort)(ix|ex)$/i,"$1ices"],[/^(ox)$/i,"$1en"]],y:[[/([^aeiouy]|qu)y$/i,"$1ies"]],z:[[/(quiz)$/i,"$1zes"]]},Jr=U0,G0=/(x|ch|sh|s|z)$/,X0=function(t){var e=t[t.length-1];if(Jr.hasOwnProperty(e)===!0)for(var n=0;n<Jr[e].length;n+=1){var r=Jr[e][n][0];if(r.test(t)===!0)return t.replace(r,Jr[e][n][1])}return null},Z0=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,n=e.irregulars.nouns;if(n.hasOwnProperty(t))return n[t];var r=X0(t);return r!==null?r:G0.test(t)?t+"es":t+"s"},J0=Z0,Yr=[[/([^v])ies$/i,"$1y"],[/ises$/i,"isis"],[/(kn|[^o]l|w)ives$/i,"$1ife"],[/^((?:ca|e|ha|(?:our|them|your)?se|she|wo)l|lea|loa|shea|thie)ves$/i,"$1f"],[/^(dwar|handkerchie|hoo|scar|whar)ves$/i,"$1f"],[/(antenn|formul|nebul|vertebr|vit)ae$/i,"$1a"],[/(octop|vir|radi|nucle|fung|cact|stimul)(i)$/i,"$1us"],[/(buffal|tomat|tornad)(oes)$/i,"$1o"],[/(eas)es$/i,"$1e"],[/(..[aeiou]s)es$/i,"$1"],[/(vert|ind|cort)(ices)$/i,"$1ex"],[/(matr|append)(ices)$/i,"$1ix"],[/(x|ch|ss|sh|z|o)es$/i,"$1"],[/men$/i,"man"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/([m|l])ice$/i,"$1ouse"],[/(cris|ax|test)es$/i,"$1is"],[/(alias|status)es$/i,"$1"],[/(ss)$/i,"$1"],[/(ics)$/i,"$1"],[/s$/i,""]],Y0=function(t){return Object.keys(t).reduce(function(e,n){return e[t[n]]=n,e},{})},Q0=function(t,e){var n=e.irregulars.nouns,r=Y0(n);if(r.hasOwnProperty(t))return r[t];for(var i=0;i<Yr.length;i++)if(Yr[i][0].test(t)===!0)return t=t.replace(Yr[i][0],Yr[i][1]),t;return t},ex=Q0,tx={Participle:[{reg:/own$/i,to:"ow"},{reg:/(.)un([g|k])$/i,to:"$1in$2"}],Actor:[{reg:/(er)er$/i,to:"$1"}],PresentTense:[{reg:/(..)(ies)$/i,to:"$1y"},{reg:/(tch|sh)es$/i,to:"$1"},{reg:/(ss|zz)es$/i,to:"$1"},{reg:/([tzlshicgrvdnkmu])es$/i,to:"$1e"},{reg:/(n[dtk]|c[kt]|[eo]n|i[nl]|er|a[ytrl])s$/i,to:"$1"},{reg:/(ow)s$/i,to:"$1"},{reg:/(op)s$/i,to:"$1"},{reg:/([eirs])ts$/i,to:"$1t"},{reg:/(ll)s$/i,to:"$1"},{reg:/(el)s$/i,to:"$1"},{reg:/(ip)es$/i,to:"$1e"},{reg:/ss$/i,to:"ss"},{reg:/s$/i,to:""}],Gerund:[{reg:/(..)(p|d|t|g){2}ing$/i,to:"$1$2"},{reg:/(ll|ss|zz)ing$/i,to:"$1"},{reg:/([^aeiou])ying$/i,to:"$1y"},{reg:/([^ae]i.)ing$/i,to:"$1e"},{reg:/(ea[dklnrtv])ing$/i,to:"$1"},{reg:/(ch|sh)ing$/i,to:"$1"},{reg:/(z)ing$/i,to:"$1e"},{reg:/(a[gdkvtc])ing$/i,to:"$1e"},{reg:/(u[rtcbn])ing$/i,to:"$1e"},{reg:/([^o]o[bdknprv])ing$/i,to:"$1e"},{reg:/([tbckg]l)ing$/i,to:"$1e"},{reg:/(c|s)ing$/i,to:"$1e"},{reg:/(..)ing$/i,to:"$1"}],PastTense:[{reg:/(ued)$/i,to:"ue"},{reg:/a([^aeiouy])ed$/i,to:"a$1e"},{reg:/([aeiou]zz)ed$/i,to:"$1"},{reg:/(e|i)lled$/i,to:"$1ll"},{reg:/(.)(sh|ch)ed$/i,to:"$1$2"},{reg:/(tl|gl)ed$/i,to:"$1e"},{reg:/(um?pt?)ed$/i,to:"$1"},{reg:/(ss)ed$/i,to:"$1"},{reg:/pped$/i,to:"p"},{reg:/tted$/i,to:"t"},{reg:/(..)gged$/i,to:"$1g"},{reg:/(..)lked$/i,to:"$1lk"},{reg:/([^aeiouy][aeiou])ked$/i,to:"$1ke"},{reg:/(.[aeiou])led$/i,to:"$1l"},{reg:/(..)(h|ion|n[dt]|ai.|[cs]t|pp|all|ss|tt|int|ail|ld|en|oo.|er|k|pp|w|ou.|rt|ght|rm)ed$/i,to:"$1$2"},{reg:/(.ut)ed$/i,to:"$1e"},{reg:/(.pt)ed$/i,to:"$1"},{reg:/(us)ed$/i,to:"$1e"},{reg:/(dd)ed$/i,to:"$1"},{reg:/(..[^aeiouy])ed$/i,to:"$1e"},{reg:/(..)ied$/i,to:"$1y"},{reg:/(.o)ed$/i,to:"$1o"},{reg:/(..i)ed$/i,to:"$1"},{reg:/(.a[^aeiou])ed$/i,to:"$1"},{reg:/([aeiou][^aeiou])ed$/i,to:"$1e"},{reg:/([rl])ew$/i,to:"$1ow"},{reg:/([pl])t$/i,to:"$1t"}]},Ko=tx,Qr={Gerund:["ing"],Actor:["erer"],Infinitive:["ate","ize","tion","rify","then","ress","ify","age","nce","ect","ise","ine","ish","ace","ash","ure","tch","end","ack","and","ute","ade","ock","ite","ase","ose","use","ive","int","nge","lay","est","ain","ant","ent","eed","er","le","own","unk","ung","en"],PastTense:["ed","lt","nt","pt","ew","ld"],PresentTense:["rks","cks","nks","ngs","mps","tes","zes","ers","les","acks","ends","ands","ocks","lays","eads","lls","els","ils","ows","nds","ays","ams","ars","ops","ffs","als","urs","lds","ews","ips","es","ts","ns"]};Qr=Object.keys(Qr).reduce(function(u,t){return Qr[t].forEach(function(e){return u[e]=t}),u},{});var ei=Qr,nx=function(t){var e=t.substr(t.length-3);if(ei.hasOwnProperty(e)===!0)return ei[e];var n=t.substr(t.length-2);if(ei.hasOwnProperty(n)===!0)return ei[n];var r=t.substr(t.length-1);return r==="s"?"PresentTense":null},rx=function(t,e,n){if(!t)return"";if(e.words.hasOwnProperty(t)===!0){for(var r=e.irregulars.verbs,i=Object.keys(r),a=0;a<i.length;a++)for(var s=Object.keys(r[i[a]]),o=0;o<s.length;o++)if(t===r[i[a]][s[o]])return i[a]}if(n=n||nx(t),n&&Ko[n])for(var l=0;l<Ko[n].length;l++){var c=Ko[n][l];if(c.reg.test(t)===!0)return t.replace(c.reg,c.to)}return t},ix=rx,ax={nouns:I0,verbs:L0},sx={conjugate:$0,adjectives:W0,toPlural:J0,toSingular:ex,toInfinitive:ix},Zy=!1,Wo=function(){function u(){Ae(this,u),Object.defineProperty(this,"words",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"hasCompound",{enumerable:!1,value:{},writable:!0}),Object.defineProperty(this,"irregulars",{enumerable:!1,value:ax,writable:!0}),Object.defineProperty(this,"tags",{enumerable:!1,value:Object.assign({},h0),writable:!0}),Object.defineProperty(this,"transforms",{enumerable:!1,value:sx,writable:!0}),Object.defineProperty(this,"taggers",{enumerable:!1,value:[],writable:!0}),Object.defineProperty(this,"cache",{enumerable:!1,value:{abbreviations:{}}}),this.words=$y.buildOut(this),S0(this)}return qe(u,[{key:"verbose",value:function(e){return Zy=e,this}},{key:"isVerbose",value:function(){return Zy}},{key:"addWords",value:function(e){var n={};Object.keys(e).forEach(function(r){var i=e[r];r=r.toLowerCase().trim(),n[r]=i}),$y.addWords(n,this.words,this)}},{key:"addConjugations",value:function(e){return Object.assign(this.irregulars.verbs,e),this}},{key:"addPlurals",value:function(e){return Object.assign(this.irregulars.nouns,e),this}},{key:"addTags",value:function(e){return e=Object.assign({},e),this.tags=Object.assign(this.tags,e),this.tags=ky(this.tags),this}},{key:"postProcess",value:function(e){return this.taggers.push(e),this}},{key:"stats",value:function(){return{words:Object.keys(this.words).length,plurals:Object.keys(this.irregulars.nouns).length,conjugations:Object.keys(this.irregulars.verbs).length,compounds:Object.keys(this.hasCompound).length,postProcessors:this.taggers.length}}}]),u}(),Jy=function(t){return JSON.parse(JSON.stringify(t))};Wo.prototype.clone=function(){var u=new Wo;return u.words=Object.assign({},this.words),u.hasCompound=Object.assign({},this.hasCompound),u.irregulars=Jy(this.irregulars),u.tags=Jy(this.tags),u.transforms=this.transforms,u.taggers=this.taggers,u};var ox=Wo,lx=Ee(function(u,t){t.all=function(){return this.parents()[0]||this},t.parent=function(){return this.from?this.from:this},t.parents=function(e){var n=[],r=function i(a){a.from&&(n.push(a.from),i(a.from))};return r(this),n=n.reverse(),typeof e=="number"?n[e]:n},t.clone=function(e){var n=this.list.map(function(i){return i.clone(e)}),r=this.buildFrom(n);return r},t.wordCount=function(){return this.list.reduce(function(e,n){return e+=n.wordCount(),e},0)},t.wordcount=t.wordCount}),ux=Ee(function(u,t){t.first=function(r){return r===void 0?this.get(0):this.slice(0,r)},t.last=function(r){if(r===void 0)return this.get(this.list.length-1);var i=this.list.length;return this.slice(i-r,i)},t.slice=function(r,i){var a=this.list.slice(r,i);return this.buildFrom(a)},t.eq=function(r){var i=this.list[r];return i===void 0?this.buildFrom([]):this.buildFrom([i])},t.get=t.eq,t.firstTerms=function(){return this.match("^.")},t.firstTerm=t.firstTerms,t.lastTerms=function(){return this.match(".$")},t.lastTerm=t.lastTerms,t.termList=function(r){for(var i=[],a=0;a<this.list.length;a++)for(var s=this.list[a].terms(),o=0;o<s.length;o++)if(i.push(s[o]),r!==void 0&&i[r]!==void 0)return i[r];return i};var e=function(i){for(var a={},s={},o=function(f){for(var h=i.list[f],y=Object.keys(h.groups).map(function(C){return h.groups[C]}),b=0;b<y.length;b++){var g=y[b],T=g.group,N=g.start,v=g.length;s[T]||(s[T]=[]),s[T].push(h.buildFrom(N,v))}},l=0;l<i.list.length;l++)o(l);for(var c=Object.keys(s),d=0;d<c.length;d++){var p=c[d];a[p]=i.buildFrom(s[p])}return a},n=function(i,a){for(var s=[],o=function(d){var p=i.list[d],m=Object.keys(p.groups);m=m.filter(function(f){return p.groups[f].group===a}),m.forEach(function(f){s.push(p.buildFrom(p.groups[f].start,p.groups[f].length))})},l=0;l<i.list.length;l++)o(l);return i.buildFrom(s)};t.groups=function(r){return r===void 0?e(this):(typeof r=="number"&&(r=String(r)),n(this,r)||this.buildFrom([]))},t.group=t.groups,t.sentences=function(r){var i=[];return this.list.forEach(function(a){i.push(a.fullSentence())}),typeof r=="number"?this.buildFrom([i[r]]):this.buildFrom(i)},t.sentence=t.sentences}),cx=function(t){var e=[],n=[];return t.forEach(function(r){r.optional===!0||r.negative===!0||(r.tag!==void 0&&e.push(r.tag),r.word!==void 0&&n.push(r.word))}),{tags:e,words:n}},dx=function(t,e){if(t._cache&&t._cache.set===!0){for(var n=cx(e),r=n.words,i=n.tags,a=0;a<r.length;a++)if(t._cache.words[r[a]]===void 0)return!1;for(var s=0;s<i.length;s++)if(t._cache.tags[i[s]]===void 0)return!1}return!0},Kn=dx,px=Ee(function(u,t){t.match=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(typeof n=="string"||typeof n=="number"||n===null)&&(n={group:n});var r=xe(e,n);if(r.length===0)return this.buildFrom([]);if(Kn(this,r)===!1)return this.buildFrom([]);var i=this.list.reduce(function(a,s){return a.concat(s.match(r))},[]);return n.group!==void 0&&n.group!==null&&n.group!==""?this.buildFrom(i).groups(n.group):this.buildFrom(i)},t.not=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n);if(r.length===0||Kn(this,r)===!1)return this;var i=this.list.reduce(function(a,s){return a.concat(s.not(r))},[]);return this.buildFrom(i)},t.matchOne=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n);if(Kn(this,r)===!1)return this.buildFrom([]);for(var i=0;i<this.list.length;i++){var a=this.list[i].match(r,!0);return this.buildFrom(a)}return this.buildFrom([])},t.if=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n);if(Kn(this,r)===!1)return this.buildFrom([]);var i=this.list.filter(function(a){return a.has(r)===!0});return this.buildFrom(i)},t.ifNo=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n),i=this.list.filter(function(a){return a.has(r)===!1});return this.buildFrom(i)},t.has=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n);return Kn(this,r)===!1?!1:this.list.some(function(i){return i.has(r)===!0})},t.lookAhead=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=".*");var r=xe(e,n),i=[];return this.list.forEach(function(a){i=i.concat(a.lookAhead(r))}),i=i.filter(function(a){return a}),this.buildFrom(i)},t.lookAfter=t.lookAhead,t.lookBehind=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=".*");var r=xe(e,n),i=[];return this.list.forEach(function(a){i=i.concat(a.lookBehind(r))}),i=i.filter(function(a){return a}),this.buildFrom(i)},t.lookBefore=t.lookBehind,t.before=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n),i=this.if(r).list,a=i.map(function(s){var o=s.terms().map(function(d){return d.id}),l=s.match(r)[0],c=o.indexOf(l.start);return c===0||c===-1?null:s.buildFrom(s.start,c)});return a=a.filter(function(s){return s!==null}),this.buildFrom(a)},t.after=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=xe(e,n),i=this.if(r).list,a=i.map(function(s){var o=s.terms(),l=o.map(function(f){return f.id}),c=s.match(r)[0],d=l.indexOf(c.start);if(d===-1||!o[d+c.length])return null;var p=o[d+c.length].id,m=s.length-d-c.length;return s.buildFrom(p,m)});return a=a.filter(function(s){return s!==null}),this.buildFrom(a)},t.hasAfter=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.filter(function(r){return r.lookAfter(e,n).found})},t.hasBefore=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.filter(function(r){return r.lookBefore(e,n).found})}}),mx=function(t,e,n,r){var i=[];typeof t=="string"&&(i=t.split(" ")),e.list.forEach(function(a){var s=a.terms();n===!0&&(s=s.filter(function(o){return o.canBe(t,e.world)})),s.forEach(function(o,l){i.length>1?i[l]&&i[l]!=="."&&o.tag(i[l],r,e.world):o.tag(t,r,e.world)})})},Yy=mx,fx=function(t,e){return t?(Yy(t,this,!1,e),this):this},hx=function(t,e){return t?(Yy(t,this,!0,e),this):this},yx=function(t,e){var n=this;return this.list.forEach(function(r){r.terms().forEach(function(i){return i.unTag(t,e,n.world)})}),this},bx=function(t){if(!t)return this;var e=this.world,n=this.list.reduce(function(r,i){return r.concat(i.canBe(t,e))},[]);return this.buildFrom(n)},gx={tag:fx,tagSafe:hx,unTag:yx,canBe:bx},vx=function(t){var e=this;if(!t)return this;var n=this.list.map(function(r,i){var a=e.buildFrom([r]);a.from=null;var s=t(a,i);return s&&s.list&&s.list[0]?s.list[0]:s});return n=n.filter(function(r){return r}),n.length===0?this.buildFrom(n):St(n[0])!=="object"||n[0].isA!=="Phrase"?n:this.buildFrom(n)},Cx=function(t,e){var n=this;return t?(this.list.forEach(function(r,i){var a=n.buildFrom([r]);e===!0&&(a.from=null),t(a,i)}),this):this},Tx=function(t){var e=this;if(!t)return this;var n=this.list.filter(function(r,i){var a=e.buildFrom([r]);return a.from=null,t(a,i)});return this.buildFrom(n)},Nx=function(t){var e=this;if(!t)return this;var n=this.list.find(function(r,i){var a=e.buildFrom([r]);return a.from=null,t(a,i)});if(n)return this.buildFrom([n])},xx=function(t){var e=this;return t?this.list.some(function(n,r){var i=e.buildFrom([n]);return i.from=null,t(i,r)}):this},Vx=function(t){if(!this.found)return this;var e=Math.floor(Math.random()*this.list.length);if(t===void 0){var n=[this.list[e]];return this.buildFrom(n)}return e+t>this.length&&(e=this.length-t,e=e<0?0:e),this.slice(e,e+t)},wx={map:vx,forEach:Cx,filter:Tx,find:Nx,some:xx,random:Vx},Dx=function(t){return t.split(/[ -]/g)},Ax=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n={};return t.forEach(function(r,i){var a=!0;e[i]!==void 0&&(a=e[i]),r=(r||"").toLowerCase(),r=r.replace(/[,;.!?]+$/,"");var s=Dx(r).map(function(o){return o.trim()});n[s[0]]=n[s[0]]||{},s.length===1?n[s[0]].value=a:(n[s[0]].more=n[s[0]].more||[],n[s[0]].more.push({rest:s.slice(1),value:a}))}),n},Sx=function(t,e,n){for(var r=Ax(t,e),i=[],a=function(l){for(var c=n.list[l],d=c.terms(),p=d.map(function(h){return h.reduced}),m=function(y){r[p[y]]!==void 0&&(r[p[y]].more!==void 0&&r[p[y]].more.forEach(function(b){if(p[y+b.rest.length]!==void 0){var g=b.rest.every(function(T,N){return T===p[y+N+1]});g===!0&&i.push({id:c.terms()[y].id,value:b.value,length:b.rest.length+1})}}),r[p[y]].value!==void 0&&i.push({id:c.terms()[y].id,value:r[p[y]].value,length:1}))},f=0;f<p.length;f++)m(f)},s=0;s<n.list.length;s++)a(s);return i},Ix=Sx,Px=Ee(function(u,t){var e=function(r){return r&&Object.prototype.toString.call(r)==="[object Object]"};t.lookup=function(n){var r=this,i=[],a=e(n);a===!0&&(n=Object.keys(n).map(function(c){return i.push(n[c]),c})),typeof n=="string"&&(n=[n]),this._cache.set!==!0&&this.cache();var s=Ix(n,i,this),o=this.list[0];if(a===!0){var l={};return s.forEach(function(c){l[c.value]=l[c.value]||[],l[c.value].push(o.buildFrom(c.id,c.length))}),Object.keys(l).forEach(function(c){l[c]=r.buildFrom(l[c])}),l}return s=s.map(function(c){return o.buildFrom(c.id,c.length)}),this.buildFrom(s)},t.lookUp=t.lookup}),Ox=function(t){var e=this;t=t||{};var n={},r={};return this._cache.words=n,this._cache.tags=r,this._cache.set=!0,this.list.forEach(function(i,a){i.cache=i.cache||{};var s=i.terms();s.forEach(function(o){n[o.reduced]&&!n.hasOwnProperty(o.reduced)||(n[o.reduced]=n[o.reduced]||[],n[o.reduced].push(a),Object.keys(o.tags).forEach(function(l){r[l]=r[l]||[],r[l].push(a)}),t.root&&(o.setRoot(e.world),n[o.root]=[a]))})}),this},Lx=function(){return this._cache={},this.list.forEach(function(t){t.cache={}}),this.parents().forEach(function(t){t._cache={},t.list.forEach(function(e){e.cache={}})}),this},Rx={cache:Ox,uncache:Lx},Fx=function(t){return t.charAt(0).toUpperCase()+t.substr(1)},kx=function(t){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t?(n===!0&&(n={keepTags:!0}),n===!1&&(n={keepTags:!1}),n=n||{},this.uncache(),this.list.forEach(function(r){var i=t;typeof t=="function"&&(i=t(r));var a;if(i&&St(i)==="object"&&i.isA==="Doc")a=i.list,e.pool().merge(i.pool());else if(typeof i=="string"){n.keepCase!==!1&&r.terms(0).isTitleCase()&&(i=Fx(i)),a=dt(i,e.world,e.pool());var s=e.buildFrom(a);s.tagger(),a=s.list}else return;if(n.keepTags===!0){var o=r.json({terms:{tags:!0}}).terms;a[0].terms().forEach(function(l,c){o[c]&&l.tagSafe(o[c].tags,"keptTag",e.world)})}r.replace(a[0],e)}),this):this.delete()},Mx=function(t,e,n){return e===void 0?this.replaceWith(t,n):(this.match(t).replaceWith(e,n),this)},_x={replaceWith:kx,replace:Mx},Bx=Ee(function(u,t){var e=function(i){return i&&Object.prototype.toString.call(i)==="[object Object]"},n=function(i,a){var s=dt(i,a.world)[0],o=a.buildFrom([s]);return o.tagger(),a.list=o.list,a};t.append=function(){var r=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return i?this.found?(this.uncache(),this.list.forEach(function(a){var s;e(i)&&i.isA==="Doc"?s=i.list[0].clone():typeof i=="string"&&(s=dt(i,r.world,r.pool())[0]);var o=r.buildFrom([s]);o.tagger(),a.append(s,r)}),this):n(i,this):this},t.insertAfter=t.append,t.insertAt=t.append,t.prepend=function(r){var i=this;return r?this.found?(this.uncache(),this.list.forEach(function(a){var s;e(r)&&r.isA==="Doc"?s=r.list[0].clone():typeof r=="string"&&(s=dt(r,i.world,i.pool())[0]);var o=i.buildFrom([s]);o.tagger(),a.prepend(s,i)}),this):n(r,this):this},t.insertBefore=t.prepend,t.concat=function(){this.uncache();for(var r=this.list.slice(0),i=0;i<arguments.length;i++){var a=arguments[i];if(typeof a=="string"){var s=dt(a,this.world);r=r.concat(s)}else a.isA==="Doc"?r=r.concat(a.list):a.isA==="Phrase"&&r.push(a)}return this.buildFrom(r)},t.delete=function(r){var i=this;this.uncache();var a=this;return r&&(a=this.match(r)),a.list.forEach(function(s){return s.delete(i)}),this},t.remove=t.delete}),Ex={clean:!0,reduced:!0,root:!0},$x=function(t){var e=this;t=t||{};var n=!1;this.parents().length===0&&(n=!0),(t==="root"||St(t)==="object"&&t.root)&&this.list.forEach(function(i){i.terms().forEach(function(a){a.root===null&&a.setRoot(e.world)})});var r=this.list.reduce(function(i,a,s){var o=!n&&s===0,l=!n&&s===e.list.length-1;return i+a.text(t,o,l)},"");return(Ex[t]===!0||t.reduced===!0||t.clean===!0||t.root===!0)&&(r=r.trim()),r},zx={text:$x},jx=function(t){var e=0,n=0,r={};return t.termList().forEach(function(i){r[i.id]={index:n,start:e+i.pre.length,length:i.text.length},e+=i.pre.length+i.text.length+i.post.length,n+=1}),r},Hx=function(t,e,n){var r=jx(t.all());(n.terms.index||n.index)&&e.forEach(function(i){i.terms.forEach(function(a){a.index=r[a.id].index}),i.index=i.terms[0].index}),(n.terms.offset||n.offset)&&e.forEach(function(i){i.terms.forEach(function(a){a.offset=r[a.id]||{}}),i.offset={index:i.terms[0].offset.index,start:i.terms[0].offset.start-i.text.indexOf(i.terms[0].text),length:i.text.length}})},qx=Hx,Kx=Ee(function(u,t){var e={text:!0,terms:!0,trim:!0},n=function(i){return i=Object.assign({},e,i),i.unique&&(i.reduced=!0),i.offset&&(i.text=!0,(!i.terms||i.terms===!0)&&(i.terms={}),i.terms.offset=!0),(i.index||i.terms.index)&&(i.terms=i.terms===!0?{}:i.terms,i.terms.id=!0),i};t.json=function(){var r=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof i=="number"&&this.list[i])return this.list[i].json(e);i=n(i),i.root===!0&&this.list.forEach(function(l){l.terms().forEach(function(c){c.root===null&&c.setRoot(r.world)})});var a=this.list.map(function(l){return l.json(i,r.world)});if((i.terms.offset||i.offset||i.terms.index||i.index)&&qx(this,a,i),i.frequency||i.freq||i.count){var s={};this.list.forEach(function(l){var c=l.text("reduced");s[c]=s[c]||0,s[c]+=1}),this.list.forEach(function(l,c){a[c].count=s[l.text("reduced")]})}if(i.unique){var o={};a=a.filter(function(l){return o[l.reduced]===!0?!1:(o[l.reduced]=!0,!0)})}return a},t.data=t.json}),Qy=Ee(function(u){var t="[0m",e=function(c,d){for(c=c.toString();c.length<d;)c+=" ";return c};function n(){return typeof window!="undefined"&&window.document}var r={green:"#7f9c6c",red:"#914045",blue:"#6699cc",magenta:"#6D5685",cyan:"#2D85A8",yellow:"#e6d7b3",black:"#303b50"},i=function(c){var d=c.world.tags;c.list.forEach(function(p){console.log(`
%c"`+p.text()+'"',"color: #e6d7b3;");var m=p.terms();m.forEach(function(f){var h=Object.keys(f.tags),y=f.text||"-";f.implicit&&(y="["+f.implicit+"]");var b="'"+y+"'";b=e(b,8);var g=h.find(function(N){return d[N]&&d[N].color}),T="steelblue";d[g]&&(T=d[g].color,T=r[T]),console.log("   ".concat(b,"  -  %c").concat(h.join(", ")),"color: ".concat(T||"steelblue",";"))})})},a={green:function(c){return"[32m"+c+t},red:function(c){return"[31m"+c+t},blue:function(c){return"[34m"+c+t},magenta:function(c){return"[35m"+c+t},cyan:function(c){return"[36m"+c+t},yellow:function(c){return"[33m"+c+t},black:function(c){return"[30m"+c+t}},s=function(c,d){return c=c.map(function(p){if(!d.tags.hasOwnProperty(p))return p;var m=d.tags[p].color||"blue";return a[m](p)}),c.join(", ")},o=function(c){return n()?(i(c),c):(console.log(a.blue("=====")),c.list.forEach(function(d){console.log(a.blue("  -----"));var p=d.terms();p.forEach(function(m){var f=Object.keys(m.tags),h=m.text||"-";m.implicit&&(h="["+m.implicit+"]"),h=a.yellow(h);var y="'"+h+"'";y=e(y,18);var b=a.blue("  \uFF5C ")+y+"  - "+s(f,c.world);console.log(b)})}),console.log(""),c)};u.exports=o}),Wx=function(t){var e=t.json({text:!1,terms:!1,reduced:!0}),n={};e.forEach(function(i){n[i.reduced]||(i.count=0,n[i.reduced]=i),n[i.reduced].count+=1});var r=Object.keys(n).map(function(i){return n[i]});return r.sort(function(i,a){return i.count>a.count?-1:i.count<a.count?1:0}),r},Ux=Wx,Gx=function(){return Qy(this),this},Xx=function(t){if(t==="text")return this.text();if(t==="normal")return this.text("normal");if(t==="json")return this.json();if(t==="offset"||t==="offsets")return this.json({offset:!0});if(t==="array")return this.json({terms:!1}).map(function(n){return n.text}).filter(function(n){return n});if(t==="freq"||t==="frequency")return Ux(this);if(t==="terms"){var e=[];return this.json({text:!1,terms:{text:!0}}).forEach(function(n){var r=n.terms.map(function(i){return i.text});r=r.filter(function(i){return i}),e=e.concat(r)}),e}return t==="tags"?this.list.map(function(n){return n.terms().reduce(function(r,i){return r[i.clean||i.implicit]=Object.keys(i.tags),r},{})}):t==="debug"?(Qy(this),this):this.text()},Zx={debug:Gx,out:Xx},Wn={alpha:function(t,e){var n=t.text("clean"),r=e.text("clean");return n<r?-1:n>r?1:0},length:function(t,e){var n=t.text().trim().length,r=e.text().trim().length;return n<r?1:n>r?-1:0},wordCount:function(t,e){var n=t.wordCount(),r=e.wordCount();return n<r?1:n>r?-1:0}},Jx=function(t){var e={},n={case:!0,punctuation:!1,whitespace:!0,unicode:!0};return t.list.forEach(function(r){var i=r.text(n);e[i]=e[i]||0,e[i]+=1}),t.list.sort(function(r,i){var a=e[r.text(n)],s=e[i.text(n)];return a<s?1:a>s?-1:0}),t},Yx=function(t){var e={};return t.json({terms:{offset:!0}}).forEach(function(n){e[n.terms[0].id]=n.terms[0].offset.start}),t.list=t.list.sort(function(n,r){return e[n.start]>e[r.start]?1:e[n.start]<e[r.start]?-1:0}),t};Wn.alphabetical=Wn.alpha;Wn.wordcount=Wn.wordCount;var Qx={index:!0,sequence:!0,seq:!0,sequential:!0,chron:!0,chronological:!0},eV=function(t){return t=t||"alpha",t==="freq"||t==="frequency"||t==="topk"?Jx(this):Qx.hasOwnProperty(t)?Yx(this):(t=Wn[t]||t,typeof t=="function"?(this.list=this.list.sort(t),this):this)},tV=function(){var t=[].concat(this.list);return t=t.reverse(),this.buildFrom(t)},nV=function(){var t=[].concat(this.list),e={};return t=t.filter(function(n){var r=n.text("reduced").trim()||n.text("implicit").trim();return e.hasOwnProperty(r)===!0?!1:(e[r]=!0,!0)}),this.buildFrom(t)},rV={sort:eV,reverse:tV,unique:nV},eb=/[\[\]{}⟨⟩:,،、‒–—―…‹›«»‐\-;\/⁄·*\•^†‡°¡¿※№÷×ºª%‰=‱¶§~|‖¦©℗®℠™¤₳฿]/g,tb=/['‘’“”"′″‴]+/g,iV={whitespace:function(t){var e=t.list.map(function(n){return n.terms()});e.forEach(function(n,r){n.forEach(function(i,a){if(i.hasDash()===!0){i.post=" - ";return}i.pre=i.pre.replace(/\s/g,""),i.post=i.post.replace(/\s/g,""),!(n.length-1===a&&!e[r+1])&&(i.implicit&&Boolean(i.text)===!0||i.hasHyphen()!==!0&&(i.post+=" "))})})},punctuation:function(t){t.forEach(function(e){e.hasHyphen()===!0&&(e.post=" "),e.pre=e.pre.replace(eb,""),e.post=e.post.replace(eb,""),e.post=e.post.replace(/\.\.\./,""),/!/.test(e.post)===!0&&(e.post=e.post.replace(/!/g,""),e.post="!"+e.post),/\?/.test(e.post)===!0&&(e.post=e.post.replace(/[\?!]*/,""),e.post="?"+e.post)})},unicode:function(t){t.forEach(function(e){e.isImplicit()!==!0&&(e.text=Lo(e.text))})},quotations:function(t){t.forEach(function(e){e.post=e.post.replace(tb,""),e.pre=e.pre.replace(tb,"")})},adverbs:function(t){t.match("#Adverb").not("(not|nary|seldom|never|barely|almost|basically|so)").remove()},abbreviations:function(t){t.list.forEach(function(e){var n=e.terms();n.forEach(function(r,i){r.tags.Abbreviation===!0&&n[i+1]&&(r.post=r.post.replace(/^\./,""))})})}},Tn=iV,aV={whitespace:!0,unicode:!0,punctuation:!0,emoji:!0,acronyms:!0,abbreviations:!0,case:!1,contractions:!1,parentheses:!1,quotations:!1,adverbs:!1,possessives:!1,verbs:!1,nouns:!1,honorifics:!1},Uo={light:{},medium:{case:!0,contractions:!0,parentheses:!0,quotations:!0,adverbs:!0}};Uo.heavy=Object.assign({},Uo.medium,{possessives:!0,verbs:!0,nouns:!0,honorifics:!0});var sV=function(t){t=t||{},typeof t=="string"&&(t=Uo[t]||{}),t=Object.assign({},aV,t),this.uncache();var e=this.termList();return t.case&&this.toLowerCase(),t.whitespace&&Tn.whitespace(this),t.unicode&&Tn.unicode(e),t.punctuation&&Tn.punctuation(e),t.emoji&&this.remove("(#Emoji|#Emoticon)"),t.acronyms&&this.acronyms().strip(),t.abbreviations&&Tn.abbreviations(this),(t.contraction||t.contractions)&&this.contractions().expand(),t.parentheses&&this.parentheses().unwrap(),(t.quotations||t.quotes)&&Tn.quotations(e),t.adverbs&&Tn.adverbs(this),(t.possessive||t.possessives)&&this.possessives().strip(),t.verbs&&this.verbs().toInfinitive(),(t.nouns||t.plurals)&&this.nouns().toSingular(),t.honorifics&&this.remove("#Honorific"),this},oV={normalize:sV},lV=Ee(function(u,t){t.splitOn=function(e){if(!e){var n=this.parent();return n.splitOn(this)}var r=xe(e),i=[];return this.list.forEach(function(a){var s=a.match(r);if(s.length===0){i.push(a);return}var o=a;s.forEach(function(l){var c=o.splitOn(l);c.before&&i.push(c.before),c.match&&i.push(c.match),o=c.after}),o&&i.push(o)}),this.buildFrom(i)},t.splitAfter=function(e){if(!e){var n=this.parent();return n.splitAfter(this)}var r=xe(e),i=[];return this.list.forEach(function(a){var s=a.match(r);if(s.length===0){i.push(a);return}var o=a;s.forEach(function(l){var c=o.splitOn(l);c.before&&c.match?(c.before.length+=c.match.length,i.push(c.before)):c.match&&i.push(c.match),o=c.after}),o&&i.push(o)}),this.buildFrom(i)},t.split=t.splitAfter,t.splitBefore=function(e){if(!e){var n=this.parent();return n.splitBefore(this)}var r=xe(e),i=[];return this.list.forEach(function(a){var s=a.match(r);if(s.length===0){i.push(a);return}var o=a;s.forEach(function(l){var c=o.splitOn(l);c.before&&i.push(c.before),c.match&&c.after&&(c.match.length+=c.after.length),o=c.match}),o&&i.push(o)}),this.buildFrom(i)},t.segment=function(e,n){e=e||{},n=n||{text:!0};var r=this,i=Object.keys(e);return i.forEach(function(a){r=r.splitOn(a)}),r.list.forEach(function(a){for(var s=0;s<i.length;s+=1)if(a.has(i[s])){a.segment=e[i[s]];return}}),r.list.map(function(a){var s=a.json(n);return s.segment=a.segment||null,s})}}),Go=function(t,e){var n=t.world;return t.list.forEach(function(r){r.terms().forEach(function(i){return i[e](n)})}),t},uV=function(){return Go(this,"toLowerCase")},cV=function(){return Go(this,"toUpperCase")},dV=function(){return Go(this,"toTitleCase")},pV=function(){return this.list.forEach(function(t){var e=t.terms();e.forEach(function(n,r){r!==0&&n.toTitleCase(),r!==e.length-1&&(n.post="")})}),this},mV={toLowerCase:uV,toUpperCase:cV,toTitleCase:dV,toCamelCase:pV},fV=Ee(function(u,t){t.pre=function(e,n){return e===void 0?this.list[0].terms(0).pre:(this.list.forEach(function(r){var i=r.terms(0);n===!0?i.pre+=e:i.pre=e}),this)},t.post=function(e,n){return e===void 0?this.list.map(function(r){var i=r.terms(),a=i[i.length-1];return a.post}):(this.list.forEach(function(r){var i=r.terms(),a=i[i.length-1];n===!0?a.post+=e:a.post=e}),this)},t.trim=function(){return this.list=this.list.map(function(e){return e.trim()}),this},t.hyphenate=function(){return this.list.forEach(function(e){var n=e.terms();n.forEach(function(r,i){i!==0&&(r.pre=""),n[i+1]&&(r.post="-")})}),this},t.dehyphenate=function(){var e=/(-|–|—)/;return this.list.forEach(function(n){var r=n.terms();r.forEach(function(i){e.test(i.post)&&(i.post=" ")})}),this},t.deHyphenate=t.dehyphenate,t.toQuotations=function(e,n){return e=e||'"',n=n||'"',this.list.forEach(function(r){var i=r.terms();i[0].pre=e+i[0].pre;var a=i[i.length-1];a.post=n+a.post}),this},t.toQuotation=t.toQuotations,t.toParentheses=function(e,n){return e=e||"(",n=n||")",this.list.forEach(function(r){var i=r.terms();i[0].pre=e+i[0].pre;var a=i[i.length-1];a.post=n+a.post}),this}}),hV=function(t){this.uncache();for(var e=this.list[0],n=e.length,r={},i=1;i<this.list.length;i++){var a=this.list[i];r[a.start]=!0;var s=e.lastTerm();t&&(s.post+=t),s.next=a.start,a.terms(0).prev=s.id,e.length+=a.length,e.cache={}}var o=e.length-n;return this.parents().forEach(function(l){l.list.forEach(function(c){for(var d=c.terms(),p=0;p<d.length;p++)if(d[p].id===e.start){c.length+=o;break}c.cache={}}),l.list=l.list.filter(function(c){return r[c.start]!==!0})}),this.buildFrom([e])},yV={join:hV},bV=/[,\)"';:\-–—\.…]/,pt=function(t,e){if(!!t.found){for(var n=t.termList(),r=0;r<n.length-1;r++){var i=n[r];if(bV.test(i.post))return}n.forEach(function(o){o.implicit=o.clean}),n[0].text+=e,n.slice(1).forEach(function(o){o.text=""});for(var a=0;a<n.length-1;a++){var s=n[a];s.post=s.post.replace(/ /,"")}}},gV=function(){var t=this.not("@hasContraction"),e=t.match("(we|they|you) are");return pt(e,"'re"),e=t.match("(he|she|they|it|we|you) will"),pt(e,"'ll"),e=t.match("(he|she|they|it|we) is"),pt(e,"'s"),e=t.match("#Person is"),pt(e,"'s"),e=t.match("#Person would"),pt(e,"'d"),e=t.match("(is|was|had|would|should|could|do|does|have|has|can) not"),pt(e,"n't"),e=t.match("(i|we|they) have"),pt(e,"'ve"),e=t.match("(would|should|could) have"),pt(e,"'ve"),e=t.match("i am"),pt(e,"'m"),e=t.match("going to"),this},vV={contract:gV},CV=Object.assign({},lx,ux,px,gx,wx,Px,Rx,_x,Bx,zx,Kx,Zx,rV,oV,lV,mV,fV,yV,vV),Te={},TV=[["terms","."],["hyphenated","@hasHyphen ."],["adjectives","#Adjective"],["hashTags","#HashTag"],["emails","#Email"],["emoji","#Emoji"],["emoticons","#Emoticon"],["atMentions","#AtMention"],["urls","#Url"],["adverbs","#Adverb"],["pronouns","#Pronoun"],["conjunctions","#Conjunction"],["prepositions","#Preposition"]];TV.forEach(function(u){Te[u[0]]=function(t){var e=this.match(u[1]);return typeof t=="number"&&(e=e.get(t)),e}});Te.emojis=Te.emoji;Te.atmentions=Te.atMentions;Te.words=Te.terms;Te.phoneNumbers=function(u){var t=this.splitAfter("@hasComma");return t=t.match("#PhoneNumber+"),typeof u=="number"&&(t=t.get(u)),t};Te.money=function(u){var t=this.match("#Money #Currency?");return typeof u=="number"&&(t=t.get(u)),t};Te.places=function(u){var t=this.match("(#City && @hasComma) (#Region|#Country)"),e=this.not(t).splitAfter("@hasComma");return e=e.concat(t),e.sort("index"),e=e.match("#Place+"),typeof u=="number"&&(e=e.get(u)),e};Te.organizations=function(u){var t=this.clauses();return t=t.match("#Organization+"),typeof u=="number"&&(t=t.get(u)),t};Te.entities=function(u){var t=this.clauses(),e=t.people();e=e.concat(t.places()),e=e.concat(t.organizations());var n=["someone","man","woman","mother","brother","sister","father"];return e=e.not(n),e.sort("sequence"),typeof u=="number"&&(e=e.get(u)),e};Te.things=Te.entities;Te.topics=Te.entities;var Xo=Te,nb=/^(under|over)-?/,NV=function(t,e,n){var r=n.words,i=t[e].reduced+" "+t[e+1].reduced;return r[i]!==void 0&&r.hasOwnProperty(i)===!0?(t[e].tag(r[i],"lexicon-two",n),t[e+1].tag(r[i],"lexicon-two",n),1):e+2<t.length&&(i+=" "+t[e+2].reduced,r[i]!==void 0&&r.hasOwnProperty(i)===!0)?(t[e].tag(r[i],"lexicon-three",n),t[e+1].tag(r[i],"lexicon-three",n),t[e+2].tag(r[i],"lexicon-three",n),2):e+3<t.length&&(i+=" "+t[e+3].reduced,r[i]!==void 0&&r.hasOwnProperty(i)===!0)?(t[e].tag(r[i],"lexicon-four",n),t[e+1].tag(r[i],"lexicon-four",n),t[e+2].tag(r[i],"lexicon-four",n),t[e+3].tag(r[i],"lexicon-four",n),3):0},xV=function(t,e){for(var n=e.words,r=e.hasCompound,i=0;i<t.length;i+=1){var a=t[i].clean;if(r[a]===!0&&i+1<t.length){var s=NV(t,i,e);if(s>0){i+=s;continue}}if(n[a]!==void 0&&n.hasOwnProperty(a)===!0){t[i].tag(n[a],"lexicon",e);continue}if(a!==t[i].reduced&&n.hasOwnProperty(t[i].reduced)===!0){t[i].tag(n[t[i].reduced],"lexicon",e);continue}if(nb.test(a)===!0){var o=a.replace(nb,"");n.hasOwnProperty(o)===!0&&t[i].tag(n[o],"noprefix-lexicon",e)}}return t},Zo=xV,Jo=/[\'‘’‛‵′`´]$/,VV=/^(m|k|cm|km|m)\/(s|h|hr)$/,wV=function(t,e,n){var r=t[e];if(Jo.test(r.text)&&!Jo.test(r.pre)&&!Jo.test(r.post)&&r.clean.length>2){var i=r.clean[r.clean.length-2];if(i==="s"){r.tag(["Possessive","Noun"],"end-tick",n);return}i==="n"&&r.tag(["Gerund"],"chillin",n)}VV.test(r.text)&&r.tag("Unit","per-sec",n)},DV=wV,Yo=[[/^[\w\.]+@[\w\.]+\.[a-z]{2,3}$/,"Email"],[/^#[a-z0-9_\u00C0-\u00FF]{2,}$/,"HashTag"],[/^@1?[0-9](am|pm)$/i,"Time"],[/^@1?[0-9]:[0-9]{2}(am|pm)?$/i,"Time"],[/^@\w{2,}$/,"AtMention"],[/^(https?:\/\/|www\.)\w+\.[a-z]{2,3}/,"Url"],[/^[\w./]+\.(com|net|gov|org|ly|edu|info|biz|ru|jp|de|in|uk|br)/,"Url"],[/^'[0-9]{2}$/,"Year"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])$/,"Time"],[/^[012]?[0-9](:[0-5][0-9])?(:[0-5][0-9])? ?(am|pm)$/i,"Time"],[/^[012]?[0-9](:[0-5][0-9])(:[0-5][0-9])? ?(am|pm)?$/i,"Time"],[/^[PMCE]ST$/,"Time"],[/^utc ?[+-]?[0-9]+?$/,"Time"],[/^[a-z0-9]*? o\'?clock$/,"Time"],[/^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}/i,"Date"],[/^[0-9]{1,4}-[0-9]{1,2}-[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}\/[0-9]{1,2}\/[0-9]{1,4}$/,"Date"],[/^[0-9]{1,4}-[a-z]{2,9}-[0-9]{1,4}$/i,"Date"],[/^gmt[+-][0-9][0-9]?$/i,"Timezone"],[/^utc[+-][0-9][0-9]?$/i,"Timezone"],[/^ma?c\'.*/,"LastName"],[/^o\'[drlkn].*/,"LastName"],[/^ma?cd[aeiou]/,"LastName"],[/^(lol)+[sz]$/,"Expression"],[/^woo+a*?h?$/,"Expression"],[/^(un|de|re)\\-[a-z\u00C0-\u00FF]{2}/,"Verb"],[/^[0-9]{1,4}\.[0-9]{1,2}\.[0-9]{1,4}$/,"Date"],[/^[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^(\+?[0-9][ -])?[0-9]{3}[ -]?[0-9]{3}-[0-9]{4}$/,"PhoneNumber"],[/^[-+]?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6][-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(k|m|b|bn)?\+?$/,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?[\$\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BD\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]\+?$/,["Money","Value"]],[/^[-+]?[\$£]?[0-9]([0-9,.])+?(usd|eur|jpy|gbp|cad|aud|chf|cny|hkd|nzd|kr|rub)$/i,["Money","Value"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?(st|nd|rd|r?th)$/,["Ordinal","NumericValue"]],[/^\.[0-9]+\+?$/,["Cardinal","NumericValue"]],[/^[-+]?[0-9]+(,[0-9]{3})*(\.[0-9]+)?%\+?$/,["Percent","Cardinal","NumericValue"]],[/^\.[0-9]+%$/,["Percent","Cardinal","NumericValue"]],[/^[0-9]{1,4}\/[0-9]{1,4}(st|nd|rd|th)?s?$/,["Fraction","NumericValue"]],[/^[0-9.]{1,3}[a-z]{0,2}[-–—][0-9]{1,3}[a-z]{0,2}$/,["Value","NumberRange"]],[/^[0-9][0-9]?(:[0-9][0-9])?(am|pm)?[-–—][0-9][0-9]?(:[0-9][0-9])?(am|pm)?$/,["Time","NumberRange"]],[/^[0-9.]+([a-z]{1,4})$/,"Value"]],AV=/^[IVXLCDM]{2,}$/,SV=/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,IV=function(t,e){for(var n=t.text,r=0;r<Yo.length;r+=1)if(Yo[r][0].test(n)===!0){t.tagSafe(Yo[r][1],"prefix #"+r,e);break}t.text.length>=2&&AV.test(n)&&SV.test(n)&&t.tag("RomanNumeral","xvii",e)},PV=IV,ae="Adjective",ti="Infinitive",ni="PresentTense",mt="Singular",Se="PastTense",rb="Adverb",ft="Expression",ib="Actor",ab="Verb",sb="Noun",ri="LastName",ob={a:[[/.[aeiou]na$/,sb],[/.[oau][wvl]ska$/,ri],[/.[^aeiou]ica$/,mt],[/^([hyj]a)+$/,ft]],c:[[/.[^aeiou]ic$/,ae]],d:[[/[aeiou](pp|ll|ss|ff|gg|tt|rr|bb|nn|mm)ed$/,Se],[/.[aeo]{2}[bdgmnprvz]ed$/,Se],[/.[aeiou][sg]hed$/,Se],[/.[aeiou]red$/,Se],[/.[aeiou]r?ried$/,Se],[/.[bcdgtr]led$/,Se],[/.[aoui]f?led$/,Se],[/.[iao]sed$/,Se],[/[aeiou]n?[cs]ed$/,Se],[/[aeiou][rl]?[mnf]ed$/,Se],[/[aeiou][ns]?c?ked$/,Se],[/[aeiou][nl]?ged$/,Se],[/.[tdbwxz]ed$/,Se],[/[^aeiou][aeiou][tvx]ed$/,Se],[/.[cdlmnprstv]ied$/,Se],[/[^aeiou]ard$/,mt],[/[aeiou][^aeiou]id$/,ae],[/.[vrl]id$/,ae]],e:[[/.[lnr]ize$/,ti],[/.[^aeiou]ise$/,ti],[/.[aeiou]te$/,ti],[/.[^aeiou][ai]ble$/,ae],[/.[^aeiou]eable$/,ae],[/.[ts]ive$/,ae]],h:[[/.[^aeiouf]ish$/,ae],[/.v[iy]ch$/,ri],[/^ug?h+$/,ft],[/^uh[ -]?oh$/,ft]],i:[[/.[oau][wvl]ski$/,ri]],k:[[/^(k){2}$/,ft]],l:[[/.[gl]ial$/,ae],[/.[^aeiou]ful$/,ae],[/.[nrtumcd]al$/,ae],[/.[^aeiou][ei]al$/,ae]],m:[[/.[^aeiou]ium$/,mt],[/[^aeiou]ism$/,mt],[/^h*u*m+$/,ft],[/^\d+ ?[ap]m$/,"Date"]],n:[[/.[lsrnpb]ian$/,ae],[/[^aeiou]ician$/,ib],[/[aeiou][ktrp]in$/,"Gerund"]],o:[[/^no+$/,ft],[/^(yo)+$/,ft],[/^woo+[pt]?$/,ft]],r:[[/.[bdfklmst]ler$/,"Noun"],[/[aeiou][pns]er$/,mt],[/[^i]fer$/,ti],[/.[^aeiou][ao]pher$/,ib],[/.[lk]er$/,"Noun"],[/.ier$/,"Comparative"]],t:[[/.[di]est$/,"Superlative"],[/.[icldtgrv]ent$/,ae],[/[aeiou].*ist$/,ae],[/^[a-z]et$/,ab]],s:[[/.[^aeiou]ises$/,ni],[/.[rln]ates$/,ni],[/.[^z]ens$/,ab],[/.[lstrn]us$/,mt],[/.[aeiou]sks$/,ni],[/.[aeiou]kes$/,ni],[/[aeiou][^aeiou]is$/,mt],[/[a-z]\'s$/,sb],[/^yes+$/,ft]],v:[[/.[^aeiou][ai][kln]ov$/,ri]],y:[[/.[cts]hy$/,ae],[/.[st]ty$/,ae],[/.[gk]y$/,ae],[/.[tnl]ary$/,ae],[/.[oe]ry$/,mt],[/[rdntkbhs]ly$/,rb],[/...lly$/,rb],[/[bszmp]{2}y$/,ae],[/.(gg|bb|zz)ly$/,ae],[/.[ai]my$/,ae],[/[ea]{2}zy$/,ae],[/.[^aeiou]ity$/,mt]]},Ve="Adjective",Un="Infinitive",Et="PresentTense",Nn="Singular",Le="PastTense",$t="Adverb",ht="Plural",lb="Actor",ii="Verb",ai="Noun",Ke="LastName",ub="Modal",OV="Place",cb=[null,null,{ea:Nn,ia:ai,ic:Ve,ly:$t,"'n":ii,"'t":ii},{oed:Le,ued:Le,xed:Le," so":$t,"'ll":ub,"'re":"Copula",azy:Ve,eer:ai,end:ii,ped:Le,ffy:Ve,ify:Un,ing:"Gerund",ize:Un,lar:Ve,mum:Ve,nes:Et,nny:Ve,oid:Ve,ous:Ve,que:Ve,rol:Nn,sis:Nn,zes:Et},{amed:Le,aped:Le,ched:Le,lked:Le,nded:Le,cted:Le,dged:Le,akis:Ke,cede:Un,chuk:Ke,czyk:Ke,ects:Et,ends:ii,enko:Ke,ette:Nn,fies:Et,fore:$t,gate:Un,gone:Ve,ices:ht,ints:ht,ines:ht,ions:ht,less:$t,llen:Ve,made:Ve,nsen:Ke,oses:Et,ould:ub,some:Ve,sson:Ke,tage:Un,teen:"Value",tion:Nn,tive:Ve,tors:ai,vice:Nn},{tized:Le,urned:Le,eased:Le,ances:ht,bound:Ve,ettes:ht,fully:$t,ishes:Et,ities:ht,marek:Ke,nssen:Ke,ology:ai,ports:ht,rough:Ve,tches:Et,tieth:"Ordinal",tures:ht,wards:$t,where:$t},{auskas:Ke,keeper:lb,logist:lb,teenth:"Value"},{opoulos:Ke,borough:OV,sdottir:Ke}],LV=function(t,e){var n=t.clean,r=n[n.length-1];if(ob.hasOwnProperty(r)===!0){for(var i=ob[r],a=0;a<i.length;a+=1)if(i[a][0].test(n)===!0){t.tagSafe(i[a][1],"endReg ".concat(r," #").concat(a),e);break}}},RV=function(t,e){var n=t.clean.length,r=7;n<=r&&(r=n-1);for(var i=r;i>1;i-=1){var a=t.clean.substr(n-i,n);if(cb[a.length].hasOwnProperty(a)===!0){var s=cb[a.length][a];t.tagSafe(s,"suffix -"+a,e);break}}},FV=function(t,e){RV(t,e),LV(t,e)},kV=FV,MV={":(":!0,":)":!0,":P":!0,":p":!0,":O":!0,":3":!0,":|":!0,":/":!0,":\\":!0,":$":!0,":*":!0,":@":!0,":-(":!0,":-)":!0,":-P":!0,":-p":!0,":-O":!0,":-3":!0,":-|":!0,":-/":!0,":-\\":!0,":-$":!0,":-*":!0,":-@":!0,":^(":!0,":^)":!0,":^P":!0,":^p":!0,":^O":!0,":^3":!0,":^|":!0,":^/":!0,":^\\":!0,":^$":!0,":^*":!0,":^@":!0,"):":!0,"(:":!0,"$:":!0,"*:":!0,")-:":!0,"(-:":!0,"$-:":!0,"*-:":!0,")^:":!0,"(^:":!0,"$^:":!0,"*^:":!0,"<3":!0,"</3":!0,"<\\3":!0},_V=/^(\u00a9|\u00ae|[\u2319-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/,BV=function(t){return t.charAt(0)===":"?!(t.match(/:.?$/)===null||t.match(" ")||t.length>35):!1},EV=function(t){return t=t.replace(/^[:;]/,":"),MV.hasOwnProperty(t)},$V=function(t,e){var n=t.pre+t.text+t.post;n=n.trim(),n=n.replace(/[.!?,]$/,""),BV(n)===!0&&(t.tag("Emoji","comma-emoji",e),t.text=n,t.pre=t.pre.replace(":",""),t.post=t.post.replace(":","")),t.text.match(_V)&&(t.tag("Emoji","unicode-emoji",e),t.text=n),EV(n)===!0&&(t.tag("Emoticon","emoticon-emoji",e),t.text=n)},zV=$V,Gn={lexicon:Zo,punctuation:DV,regex:PV,suffix:kV,emoji:zV},jV=function(t,e){var n=t.world;Gn.lexicon(e,n);for(var r=0;r<e.length;r+=1){var i=e[r];Gn.punctuation(e,r,n),Gn.regex(i,n),Gn.suffix(i,n),Gn.emoji(i,n)}return t},HV=jV,qV={i:"Verb",first:"Noun",it:"Verb",there:"Verb",not:"Verb",because:"Noun",if:"Noun",but:"Noun",who:"Verb",this:"Noun",his:"Noun",when:"Noun",you:"Verb",very:"Adjective",old:"Noun",never:"Verb",before:"Noun"},KV={there:"Verb",me:"Verb",man:"Adjective",only:"Verb",him:"Verb",were:"Noun",took:"Noun",himself:"Verb",went:"Noun",who:"Noun",jr:"Person"},WV={Adjective:"Noun",Possessive:"Noun",Determiner:"Noun",Adverb:"Verb",Pronoun:"Verb",Value:"Noun",Ordinal:"Noun",Modal:"Verb",Superlative:"Noun",Demonym:"Noun",Honorific:"Person"},UV={Copula:"Noun",PastTense:"Noun",Conjunction:"Noun",Modal:"Noun",Pluperfect:"Noun",PerfectTense:"Verb"},It={beforeThisWord:KV,afterThisWord:qV,beforeThisPos:UV,afterThisPos:WV},GV=Object.keys(It.afterThisPos),XV=Object.keys(It.beforeThisPos),ZV=function(t,e){for(var n=function(s){var o=t[s];if(o.isKnown()===!0)return"continue";var l=t[s-1];if(l){if(It.afterThisWord.hasOwnProperty(l.clean)===!0){var c=It.afterThisWord[l.clean];return o.tag(c,"after-"+l.clean,e),"continue"}var d=GV.find(function(b){return l.tags[b]});if(d!==void 0){var p=It.afterThisPos[d];return o.tag(p,"after-"+d,e),"continue"}}var m=t[s+1];if(m){if(It.beforeThisWord.hasOwnProperty(m.clean)===!0){var f=It.beforeThisWord[m.clean];return o.tag(f,"before-"+m.clean,e),"continue"}var h=XV.find(function(b){return m.tags[b]});if(h!==void 0){var y=It.beforeThisPos[h];return o.tag(y,"before-"+h,e),"continue"}}},r=0;r<t.length;r+=1)var i=n(r)},JV=ZV,YV=/^[A-Z][a-z'\u00C0-\u00FF]/,QV=/[0-9]/,ew=function(t){var e=t.world;t.list.forEach(function(n){for(var r=n.terms(),i=1;i<r.length;i++){var a=r[i];YV.test(a.text)===!0&&QV.test(a.text)===!1&&a.tags.Date===void 0&&a.tag("ProperNoun","titlecase-noun",e)}})},tw=ew,nw=/^(re|un)-?[a-z\u00C0-\u00FF]/,rw=/^(re|un)-?/,iw=function(t,e){var n=e.words;t.forEach(function(r){if(r.isKnown()!==!0&&nw.test(r.clean)===!0){var i=r.clean.replace(rw,"");i&&i.length>3&&n[i]!==void 0&&n.hasOwnProperty(i)===!0&&r.tag(n[i],"stem-"+i,e)}})},aw=iw,sw=[/(^v)ies$/i,/ises$/i,/ives$/i,/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/(buffal|tomat|tornad)oes$/i,/(analy|ba|diagno|parenthe|progno|synop|the)ses$/i,/(vert|ind|cort)ices$/i,/(matr|append)ices$/i,/(x|ch|ss|sh|s|z|o)es$/i,/is$/i,/men$/i,/news$/i,/.tia$/i,/(^f)ves$/i,/(lr)ves$/i,/(^aeiouy|qu)ies$/i,/(m|l)ice$/i,/(cris|ax|test)es$/i,/(alias|status)es$/i,/ics$/i],ow=[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/s[aeiou]+ns$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],db={isSingular:ow,isPlural:sw},lw=["Uncountable","Pronoun","Place","Value","Person","Month","WeekDay","Holiday"],uw=[/ss$/,/sis$/,/[^aeiou][uo]s$/,/'s$/],cw=[/i$/,/ae$/],dw=function(t,e){if(t.tags.Noun&&!t.tags.Acronym){var n=t.clean;if(t.tags.Singular||t.tags.Plural)return;if(n.length<=3){t.tag("Singular","short-singular",e);return}if(lw.find(function(r){return t.tags[r]}))return;if(db.isPlural.find(function(r){return r.test(n)})){t.tag("Plural","plural-rules",e);return}if(db.isSingular.find(function(r){return r.test(n)})){t.tag("Singular","singular-rules",e);return}if(/s$/.test(n)===!0){if(uw.find(function(r){return r.test(n)}))return;t.tag("Plural","plural-fallback",e);return}if(cw.find(function(r){return r.test(n)}))return;t.tag("Singular","singular-fallback",e)}},pw=dw,mw=["academy","administration","agence","agences","agencies","agency","airlines","airways","army","assoc","associates","association","assurance","authority","autorite","aviation","bank","banque","board","boys","brands","brewery","brotherhood","brothers","building society","bureau","cafe","caisse","capital","care","cathedral","center","central bank","centre","chemicals","choir","chronicle","church","circus","clinic","clinique","club","co","coalition","coffee","collective","college","commission","committee","communications","community","company","comprehensive","computers","confederation","conference","conseil","consulting","containers","corporation","corps","corp","council","crew","daily news","data","departement","department","department store","departments","design","development","directorate","division","drilling","education","eglise","electric","electricity","energy","ensemble","enterprise","enterprises","entertainment","estate","etat","evening news","faculty","federation","financial","fm","foundation","fund","gas","gazette","girls","government","group","guild","health authority","herald","holdings","hospital","hotel","hotels","inc","industries","institut","institute","institute of technology","institutes","insurance","international","interstate","investment","investments","investors","journal","laboratory","labs","liberation army","limited","local authority","local health authority","machines","magazine","management","marine","marketing","markets","media","memorial","mercantile exchange","ministere","ministry","military","mobile","motor","motors","musee","museum","news","news service","observatory","office","oil","optical","orchestra","organization","partners","partnership","people's party","petrol","petroleum","pharmacare","pharmaceutical","pharmaceuticals","pizza","plc","police","polytechnic","post","power","press","productions","quartet","radio","regional authority","regional health authority","reserve","resources","restaurant","restaurants","savings","school","securities","service","services","social club","societe","society","sons","standard","state police","state university","stock exchange","subcommittee","syndicat","systems","telecommunications","telegraph","television","times","tribunal","tv","union","university","utilities","workers"],pb=mw.reduce(function(u,t){return u[t]="Noun",u},{}),mb=function(t){return!t.tags.Noun||t.tags.Pronoun||t.tags.Comma||t.tags.Possessive?!1:!!(t.tags.Organization||t.tags.Acronym||t.tags.Place||t.titleCase())},fw=function(t,e){for(var n=0;n<t.length;n+=1){var r=t[n];if(pb[r.clean]!==void 0&&pb.hasOwnProperty(r.clean)===!0){var i=t[n-1];if(i!==void 0&&mb(i)===!0){i.tagSafe("Organization","org-word-1",e),r.tagSafe("Organization","org-word-2",e);continue}var a=t[n+1];if(a!==void 0&&a.clean==="of"&&t[n+2]&&mb(t[n+2])){r.tagSafe("Organization","org-of-word-1",e),a.tagSafe("Organization","org-of-word-2",e),t[n+2].tagSafe("Organization","org-of-word-3",e);continue}}}},hw=fw,yw=/^[A-Z]('s|,)?$/,bw=/([A-Z]\.){2}[A-Z]?/i,gw={I:!0,A:!0},vw=function(t,e){var n=t.reduced;return t.tags.Acronym?!0:e.words[n]||n.length>5?!1:t.isAcronym()},Cw=function(t,e){t.forEach(function(n){n.tags.RomanNumeral!==!0&&(bw.test(n.text)===!0&&n.tag("Acronym","period-acronym",e),n.isUpperCase()&&vw(n,e)?(n.tag("Acronym","acronym-step",e),n.tag("Noun","acronym-infer",e)):!gw.hasOwnProperty(n.text)&&yw.test(n.text)&&(n.tag("Acronym","one-letter-acronym",e),n.tag("Noun","one-letter-infer",e)),n.tags.Organization&&n.text.length<=3&&n.tag("Acronym","acronym-org",e),n.tags.Organization&&n.isUpperCase()&&n.text.length<=6&&n.tag("Acronym","acronym-org-case",e))})},Tw=Cw,xn={neighbours:JV,case:tw,stem:aw,plural:pw,organizations:hw,acronyms:Tw},Nw=function(t,e){var n=t.world;return xn.neighbours(e,n),xn.case(t),xn.stem(e,n),e.forEach(function(r){r.isKnown()===!1&&r.tag("Noun","noun-fallback",t.world)}),xn.organizations(e,n),xn.acronyms(e,n),e.forEach(function(r){xn.plural(r,t.world)}),t},xw=Nw,fb=/n't$/,hb={"won't":["will","not"],wont:["will","not"],"can't":["can","not"],cant:["can","not"],cannot:["can","not"],"shan't":["should","not"],dont:["do","not"],dun:["do","not"]},Vw=function(t,e){var n=e.terms(),r=n.indexOf(t),i=n.slice(0,r),a=i.find(function(s){return s.tags.Noun});return a&&a.tags.Plural?["are","not"]:["is","not"]},ww=function(t,e){if(hb.hasOwnProperty(t.clean)===!0)return hb[t.clean];if(t.clean==="ain't"||t.clean==="aint")return Vw(t,e);if(fb.test(t.clean)===!0){var n=t.clean.replace(fb,"");return[n,"not"]}return null},Dw=ww,Aw=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z]{1,2})$/i,yb={ll:"will",ve:"have",re:"are",m:"am","n't":"not"},Sw=function(t){var e=t.text.match(Aw);return e===null?null:yb.hasOwnProperty(e[2])?[e[1],yb[e[2]]]:null},Iw=Sw,bb={wanna:["want","to"],gonna:["going","to"],im:["i","am"],alot:["a","lot"],ive:["i","have"],imma:["I","will"],"where'd":["where","did"],whered:["where","did"],"when'd":["when","did"],whend:["when","did"],howd:["how","did"],whatd:["what","did"],dunno:["do","not","know"],brb:["be","right","back"],gtg:["got","to","go"],irl:["in","real","life"],tbh:["to","be","honest"],imo:["in","my","opinion"],til:["today","i","learned"],rn:["right","now"],twas:["it","was"],"@":["at"]},Pw=function(t){return bb.hasOwnProperty(t.clean)?bb[t.clean]:null},Ow=Pw,Lw=/([a-z\u00C0-\u00FF]+)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]s$/i,Rw={that:!0,there:!0},Fw={here:!0,there:!0,everywhere:!0},kw=function(t,e){if(t.tags.Possessive)return!0;if(t.tags.Pronoun||t.tags.QuestionWord||Rw.hasOwnProperty(t.reduced))return!1;var n=e.get(t.next);if(!n)return!0;if(n.tags.Verb)return!!(n.tags.Infinitive||n.tags.PresentTense);if(n.tags.Noun)return Fw.hasOwnProperty(n.reduced)!==!0;var r=e.get(n.next);return r&&r.tags.Noun&&!r.tags.Pronoun?!0:(n.tags.Adjective||n.tags.Adverb||n.tags.Verb,!1)},Mw=function(t,e){var n=e.terms(),r=n.indexOf(t),i=n.slice(r+1,r+3);return i.find(function(a){return a.tags.PastTense})},_w=function(t,e,n){var r=t.text.match(Lw);if(r!==null){if(kw(t,e.pool)===!0)return t.tag("#Possessive","isPossessive",n),null;if(r!==null)return Mw(t,e)?[r[1],"has"]:[r[1],"is"]}return null},Bw=_w,Ew=/[a-z\u00C0-\u00FF]'d$/,$w={how:!0,what:!0},zw=function(t,e){if(Ew.test(t.clean)){for(var n=t.clean.replace(/'d$/,""),r=e.terms(),i=r.indexOf(t),a=r.slice(i+1,i+4),s=0;s<a.length;s++){var o=a[s];if(o.tags.Verb)return o.tags.PastTense?[n,"had"]:$w[n]===!0?[n,"did"]:[n,"would"]}return[n,"would"]}return null},jw=zw,Hw=/^([0-9.]{1,3}[a-z]{0,2})[-–—]([0-9]{1,3}[a-z]{0,2})$/i,qw=/^([0-9][0-9]?(:[0-9][0-9])?(am|pm)?)[-–—]([0-9][0-9]?(:[0-9][0-9])?(am|pm)?)$/i,Kw=function(t){if(t.tags.PhoneNumber===!0)return null;var e=t.text.match(Hw);return e!==null?[e[1],"to",e[2]]:(e=t.text.match(qw),e!==null?[e[1],"to",e[4]]:null)},Ww=Kw,Uw=/^(l|c|d|j|m|n|qu|s|t)[\u0027\u0060\u00B4\u2018\u2019\u201A\u201B\u2032\u2035\u2039\u203A]([a-z\u00C0-\u00FF]+)$/i,gb={l:"le",c:"ce",d:"de",j:"je",m:"me",n:"ne",qu:"que",s:"se",t:"tu"},Gw=function(t){var e=t.text.match(Uw);if(e===null||gb.hasOwnProperty(e[1])===!1)return null;var n=[gb[e[1]],e[2]];return n[0]&&n[1]?n:null},Xw=Gw,Zw=/^[0-9]+$/,Jw=/^[0-9]+(st|nd|rd|th)$/,Yw=/^[0-9:]+(am|pm)?$/,Qw=function(t,e){var n=dt(t.join(" "),e.world,e.pool())[0],r=n.terms();Zo(r,e.world);var i=r[0];return Jw.test(i.text)?(r[0].tag("Ordinal","ord-range",e.world),r[2].tag("Ordinal","ord-range",e.world)):Zw.test(i.text)?(r[0].tag("Cardinal","num-range",e.world),r[2].tag("Cardinal","num-range",e.world)):Yw.test(i.text)&&(r[0].tag("Time","time-range",e.world),r[1].tag("Date","time-range",e.world),r[2].tag("Time","time-range",e.world)),r.forEach(function(a){a.implicit=a.text,a.text="",a.clean="",a.pre="",a.post="",Object.keys(a.tags).length===0&&(a.tags.Noun=!0)}),n},eD=function(t){var e=t.world;return t.list.forEach(function(n){for(var r=n.terms(),i=0;i<r.length;i+=1){var a=r[i],s=Dw(a,n);if(s=s||Iw(a),s=s||Ow(a),s=s||Bw(a,n,e),s=s||jw(a,n),s=s||Ww(a),s=s||Xw(a),s!==null){var o=Qw(s,t);n.has("#NumberRange")===!0&&t.buildFrom([o]).tag("NumberRange");var l=o.terms(0);l.text=a.text;var c=n.buildFrom(a.id,1,t.pool());c.replace(o,t,!0)}}}),t},tD=eD,nD=function(t,e){var n=t._cache.words[e]||[];return n=n.map(function(r){return t.list[r]}),t.buildFrom(n)},Vn=function(t,e){var n=t._cache.tags[e]||[];return n=n.map(function(r){return t.list[r]}),t.buildFrom(n)},rD=function(t){var e=Vn(t,"Infinitive");return e.found&&(e=e.ifNo("@hasQuestionMark"),e=e.ifNo("(i|we|they)"),e.match("[#Infinitive] (#Determiner|#Possessive) #Noun",0).tag("Imperative","shut-the"),e.match("^[#Infinitive] #Adverb?$",0).tag("Imperative","go-fast"),e.match("[(do && #Infinitive)] not? #Verb",0).tag("Imperative","do-not"),e.match("[#Infinitive] (it|some)",0).tag("Imperative","do-it")),e=nD(t,"like"),e.match("#Adverb like").notIf("(really|generally|typically|usually|sometimes|often|just) [like]").tag("Adverb","adverb-like"),e=Vn(t,"Adjective"),e.match("#Determiner #Adjective$").notIf("(#Comparative|#Superlative)").terms(1).tag("Noun","the-adj-1"),e=Vn(t,"FirstName"),e.match("#FirstName (#Noun|@titleCase)").ifNo("^#Possessive").ifNo("(#Pronoun|#Plural)").ifNo("@hasComma .").lastTerm().tag("#LastName","firstname-noun"),e=Vn(t,"Value"),e=e.match("#Value #PresentTense").ifNo("#Copula"),e.found&&(e.has("(one|1)")===!0?e.terms(1).tag("Singular","one-presentTense"):e.terms(1).tag("Plural","value-presentTense")),t.match("^(well|so|okay)").tag("Expression","well-"),t.match("#Value [of a second]",0).unTag("Value","of-a-second"),t.match("#Value [seconds]",0).unTag("Value","30-seconds").tag(["Unit","Plural"]),e=Vn(t,"Gerund"),e.match("(be|been) (#Adverb|not)+? #Gerund").not("#Verb$").tag("Auxiliary","be-walking"),t.match("(try|use|attempt|build|make) #Verb").ifNo("(@hasComma|#Negative|#PhrasalVerb|#Copula|will|be)").lastTerm().tag("#Noun","do-verb"),e=Vn(t,"Possessive"),e=e.match("#Possessive [#Infinitive]",0),e.lookBehind("(let|made|make|force|ask)").found||e.tag("Noun","her-match"),t},iD=rD,aD=function(t){for(var e={},n=0;n<t.length;n++)e[t[n]]=!0;return Object.keys(e)},Qo=aD,sD=[{match:"too much",tag:"Adverb Adjective",reason:"bit-4"},{match:"u r",tag:"Pronoun Copula",reason:"u r"},{match:"#Copula (pretty|dead|full|well|sure) (#Adjective|#Noun)",tag:"#Copula #Adverb #Adjective",reason:"sometimes-adverb"},{match:"(#Pronoun|#Person) (had|#Adverb)? [better] #PresentTense",group:0,tag:"Modal",reason:"i-better"},{match:"[#Gerund] #Adverb? not? #Copula",group:0,tag:"Activity",reason:"gerund-copula"},{match:"[#Gerund] #Modal",group:0,tag:"Activity",reason:"gerund-modal"},{match:"holy (shit|fuck|hell)",tag:"Expression",reason:"swears-expression"},{match:"#Noun #Actor",tag:"Actor",reason:"thing-doer"},{match:"#Conjunction [u]",group:0,tag:"Pronoun",reason:"u-pronoun-2"},{match:"[u] #Verb",group:0,tag:"Pronoun",reason:"u-pronoun-1"},{match:"#Noun [(who|whom)]",group:0,tag:"Determiner",reason:"captain-who"},{match:"a bit much",tag:"Determiner Adverb Adjective",reason:"bit-3"},{match:"#Verb #Adverb? #Noun [(that|which)]",group:0,tag:"Preposition",reason:"that-prep"},{match:"@hasComma [which] (#Pronoun|#Verb)",group:0,tag:"Preposition",reason:"which-copula"},{match:"#Copula just [like]",group:0,tag:"Preposition",reason:"like-preposition"},{match:"#Noun [like] #Noun",group:0,tag:"Preposition",reason:"noun-like"},{match:"[had] #Noun+ #PastTense",group:0,tag:"Condition",reason:"had-he"},{match:"[were] #Noun+ to #Infinitive",group:0,tag:"Condition",reason:"were-he"},{match:"^how",tag:"QuestionWord",reason:"how-question"},{match:"[how] (#Determiner|#Copula|#Modal|#PastTense)",group:0,tag:"QuestionWord",reason:"how-is"},{match:"^which",tag:"QuestionWord",reason:"which-question"},{match:"[so] #Noun",group:0,tag:"Conjunction",reason:"so-conj"},{match:"[(who|what|where|why|how|when)] #Noun #Copula #Adverb? (#Verb|#Adjective)",group:0,tag:"Conjunction",reason:"how-he-is-x"}],oD=sD,zt={adverbAdjective:["dark","bright","flat","light","soft","pale","dead","dim","faux","little","wee","sheer","most","near","good","extra","all"],personDate:["april","june","may","jan","august","eve"],personMonth:["january","april","may","june","jan","sep"],personAdjective:["misty","rusty","dusty","rich","randy","young"],personVerb:["pat","wade","ollie","will","rob","buck","bob","mark","jack"],personPlace:["darwin","hamilton","paris","alexandria","houston","kobe","santiago","salvador","sydney","victoria"],personNoun:["art","baker","berg","bill","brown","charity","chin","christian","cliff","daisy","dawn","dick","dolly","faith","franco","gene","green","hall","hill","holly","hope","jean","jewel","joy","kelvin","king","kitty","lane","lily","melody","mercedes","miles","olive","penny","ray","reed","robin","rod","rose","sky","summer","trinity","van","viola","violet","wang","white"]},it="(".concat(zt.personDate.join("|"),")"),lD=[{match:"#Holiday (day|eve)",tag:"Holiday",reason:"holiday-day"},{match:"[sun] the #Ordinal",tag:"WeekDay",reason:"sun-the-5th"},{match:"[sun] #Date",group:0,tag:"WeekDay",reason:"sun-feb"},{match:"#Date (on|this|next|last|during)? [sun]",group:0,tag:"WeekDay",reason:"1pm-sun"},{match:"(in|by|before|during|on|until|after|of|within|all) [sat]",group:0,tag:"WeekDay",reason:"sat"},{match:"(in|by|before|during|on|until|after|of|within|all) [wed]",group:0,tag:"WeekDay",reason:"wed"},{match:"(in|by|before|during|on|until|after|of|within|all) [march]",group:0,tag:"Month",reason:"march"},{match:"[sat] #Date",group:0,tag:"WeekDay",reason:"sat-feb"},{match:"#Preposition [(march|may)]",group:0,tag:"Month",reason:"in-month"},{match:"this [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"next [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"last [(march|may)]",group:0,tag:"Month",reason:"this-month"},{match:"[(march|may)] the? #Value",group:0,tag:"Month",reason:"march-5th"},{match:"#Value of? [(march|may)]",group:0,tag:"Month",reason:"5th-of-march"},{match:"[(march|may)] .? #Date",group:0,tag:"Month",reason:"march-and-feb"},{match:"#Date .? [(march|may)]",group:0,tag:"Month",reason:"feb-and-march"},{match:"#Adverb [(march|may)]",group:0,tag:"Verb",reason:"quickly-march"},{match:"[(march|may)] #Adverb",group:0,tag:"Verb",reason:"march-quickly"},{match:"#Value of #Month",tag:"Date",reason:"value-of-month"},{match:"#Cardinal #Month",tag:"Date",reason:"cardinal-month"},{match:"#Month #Value to #Value",tag:"Date",reason:"value-to-value"},{match:"#Month the #Value",tag:"Date",reason:"month-the-value"},{match:"(#WeekDay|#Month) #Value",tag:"Date",reason:"date-value"},{match:"#Value (#WeekDay|#Month)",tag:"Date",reason:"value-date"},{match:"(#TextValue && #Date) #TextValue",tag:"Date",reason:"textvalue-date"},{match:"in [".concat(it,"]"),group:0,tag:"Date",reason:"in-june"},{match:"during [".concat(it,"]"),group:0,tag:"Date",reason:"in-june"},{match:"on [".concat(it,"]"),group:0,tag:"Date",reason:"in-june"},{match:"by [".concat(it,"]"),group:0,tag:"Date",reason:"by-june"},{match:"after [".concat(it,"]"),group:0,tag:"Date",reason:"after-june"},{match:"#Date [".concat(it,"]"),group:0,tag:"Date",reason:"in-june"},{match:"".concat(it," #Value"),tag:"Date",reason:"june-5th"},{match:"".concat(it," #Date"),tag:"Date",reason:"june-5th"},{match:"".concat(it," #ProperNoun"),tag:"Person",reason:"june-smith",safe:!0},{match:"".concat(it," #Acronym? (#ProperNoun && !#Month)"),tag:"Person",reason:"june-smith-jr"},{match:"#Cardinal [second]",tag:"Unit",reason:"one-second"},{match:"#Month #NumberRange",tag:"Date",reason:"aug 20-21"},{match:"(#Place|#Demonmym|#Time) (standard|daylight|central|mountain)? time",tag:"Timezone",reason:"std-time"},{match:"(eastern|mountain|pacific|central|atlantic) (standard|daylight|summer)? time",tag:"Timezone",reason:"eastern-time"},{match:"#Time [(eastern|mountain|pacific|central|est|pst|gmt)]",group:0,tag:"Timezone",reason:"5pm-central"},{match:"(central|western|eastern) european time",tag:"Timezone",reason:"cet"}],uD=lD,el="(".concat(zt.personAdjective.join("|"),")"),cD=[{match:"[all] #Determiner? #Noun",group:0,tag:"Adjective",reason:"all-noun"},{match:"#Adverb [".concat(el,"]"),group:0,tag:"Adjective",reason:"really-rich"},{match:"".concat(el," #Person"),tag:"Person",reason:"randy-smith"},{match:"".concat(el," #Acronym? #ProperNoun"),tag:"Person",reason:"rusty-smith"},{match:"#Copula [(just|alone)]$",group:0,tag:"Adjective",reason:"not-adverb"},{match:"#Singular is #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"is-filled"},{match:"[#PastTense] #Singular is",group:0,tag:"Adjective",reason:"smoked-poutine"},{match:"[#PastTense] #Plural are",group:0,tag:"Adjective",reason:"baked-onions"},{match:"well [#PastTense]",group:0,tag:"Adjective",reason:"well-made"},{match:"#Copula [fucked up?]",tag:"Adjective",reason:"swears-adjective"},{match:"#Singular (seems|appears) #Adverb? [#PastTense$]",group:0,tag:"Adjective",reason:"seems-filled"},{match:"(a|an) [#Gerund]",group:0,tag:"Adjective",reason:"a|an"},{match:"as [#Gerund] as",group:0,tag:"Adjective",reason:"as-gerund-as"},{match:"more [#Gerund] than",group:0,tag:"Adjective",reason:"more-gerund-than"},{match:"(so|very|extremely) [#Gerund]",group:0,tag:"Adjective",reason:"so-gerund"},{match:"(it|he|she|everything|something) #Adverb? was #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"it-was-gerund"},{match:"(found|found) it #Adverb? [#Gerund]",group:0,tag:"Adjective",reason:"found-it-gerund"},{match:"a (little|bit|wee) bit? [#Gerund]",group:0,tag:"Adjective",reason:"a-bit-gerund"},{match:"#Copula #Adjective? [(out|in|through)]$",group:0,tag:"Adjective",reason:"still-out"},{match:"^[#Adjective] (the|your) #Noun",group:0,tag:"Infinitive",reason:"shut-the"}],dD=cD,pD=[{match:"there (are|were) #Adjective? [#PresentTense]",group:0,tag:"Plural",reason:"there-are"},{match:"#Determiner [sun]",group:0,tag:"Singular",reason:"the-sun"},{match:"#Verb (a|an) [#Value]",group:0,tag:"Singular",reason:"did-a-value"},{match:"the [(can|will|may)]",group:0,tag:"Singular",reason:"the can"},{match:"#FirstName #Acronym? (#Possessive && #LastName)",tag:"Possessive",reason:"name-poss"},{match:"#Organization+ #Possessive",tag:"Possessive",reason:"org-possessive"},{match:"#Place+ #Possessive",tag:"Possessive",reason:"place-possessive"},{match:"(#Verb && !#Modal) (all|every|each|most|some|no) [#PresentTense]",group:0,tag:"Noun",reason:"all-presentTense"},{match:"#Determiner [#Adjective] #Copula",group:0,tag:"Noun",reason:"the-adj-is"},{match:"#Adjective [#Adjective] #Copula",group:0,tag:"Noun",reason:"adj-adj-is"},{match:"(had|have|#PastTense) #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adj-presentTense"},{match:"^#Adjective [#PresentTense]",group:0,tag:"Noun",reason:"start adj-presentTense"},{match:"#Value #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"one-big-reason"},{match:"#PastTense #Adjective+ [#PresentTense]",group:0,tag:"Noun",reason:"won-wide-support"},{match:"(many|few|several|couple) [#PresentTense]",group:0,tag:"Noun",reason:"many-poses"},{match:"#Adverb #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"very-big-dream"},{match:"#Adjective [#Infinitive] #Noun",group:0,tag:"Noun",reason:"good-wait-staff"},{match:"#Adjective #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"adorable-little-store"},{match:"#Preposition #Adjective [#PresentTense]",group:0,tag:"Noun",reason:"of-basic-training"},{match:"#Adjective [#Gerund]",group:0,tag:"Noun",reason:"early-warning"},{match:"#Gerund #Adverb? #Comparative [#PresentTense]",group:0,tag:"Noun",reason:"higher-costs"},{match:"#Infinitive (this|that|the) [#Infinitive]",group:0,tag:"Noun",reason:"do-this-dance"},{match:"(his|her|its) [#Adjective]",group:0,tag:"Noun",reason:"his-fine"},{match:"some [#Verb] #Plural",group:0,tag:"Noun",reason:"determiner6"},{match:"more #Noun",tag:"Noun",reason:"more-noun"},{match:"(#Noun && @hasComma) #Noun (and|or) [#PresentTense]",group:0,tag:"Noun",reason:"noun-list"},{match:"(right|rights) of .",tag:"Noun",reason:"right-of"},{match:"a [bit]",group:0,tag:"Noun",reason:"bit-2"},{match:"#Possessive #Ordinal [#PastTense]",group:0,tag:"Noun",reason:"first-thought"},{match:"#Gerund #Determiner [#Infinitive]",group:0,tag:"Noun",reason:"running-a-show"},{match:"#Determiner #Adverb [#Infinitive]",group:0,tag:"Noun",reason:"the-reason"},{match:"(the|this|those|these) #Adjective [#Verb]",group:0,tag:"Noun",reason:"the-adj-verb"},{match:"(the|this|those|these) #Adverb #Adjective [#Verb]",group:0,tag:"Noun",reason:"determiner4"},{match:"#Determiner [#Adjective] (#Copula|#PastTense|#Auxiliary)",group:0,tag:"Noun",reason:"the-adj-2"},{match:"(the|this|a|an) [#Infinitive] #Adverb? #Verb",group:0,tag:"Noun",reason:"determiner5"},{match:"#Determiner [#Infinitive] #Noun",group:0,tag:"Noun",reason:"determiner7"},{match:"#Determiner #Adjective #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"a-nice-inf"},{match:"the [#Verb] #Preposition .",group:0,tag:"Noun",reason:"determiner1"},{match:"#Determiner [#Verb] of",group:0,tag:"Noun",reason:"the-verb-of"},{match:"#Adjective #Noun+ [#Infinitive] #Copula",group:0,tag:"Noun",reason:"career-move"},{match:"#Determiner #Noun of [#Verb]",group:0,tag:"Noun",reason:"noun-of-noun"},{match:"#Determiner [(western|eastern|northern|southern|central)] #Noun",group:0,tag:"Noun",reason:"western-line"},{match:"#Possessive [#Gerund]",group:0,tag:"Noun",reason:"her-polling"},{match:"(his|her|its) [#PresentTense]",group:0,tag:"Noun",reason:"its-polling"},{match:"(#Determiner|#Value) [(linear|binary|mobile|lexical|technical|computer|scientific|formal)] #Noun",group:0,tag:"Noun",reason:"technical-noun"},{match:"(the|those|these|a|an) [#Participle] #Noun",group:0,tag:"Adjective",reason:"blown-motor"},{match:"(the|those|these|a|an) #Adjective? [#Infinitive]",group:0,tag:"Noun",reason:"det-inf"},{match:"(the|those|these|a|an) #Adjective? [#PresentTense]",group:0,tag:"Noun",reason:"det-pres"},{match:"(the|those|these|a|an) #Adjective? [#PastTense]",group:0,tag:"Noun",reason:"det-past"},{match:"(this|that) [#Gerund]",group:0,tag:"Noun",reason:"this-gerund"},{match:"at some [#Infinitive]",group:0,tag:"Noun",reason:"at-some-inf"},{match:"(#Noun && @hasHyphen) #Verb",tag:"Noun",reason:"hyphen-verb"},{match:"is no [#Verb]",group:0,tag:"Noun",reason:"is-no-verb"},{match:"[#Verb] than",group:0,tag:"Noun",reason:"correction"},{match:"(go|goes|went) to [#Infinitive]",group:0,tag:"Noun",reason:"goes-to-verb"},{match:"(a|an) #Noun [#Infinitive] (#Preposition|#Noun)",group:0,tag:"Noun",reason:"a-noun-inf"},{match:"(a|an) #Noun [#Infinitive]$",group:0,tag:"Noun",reason:"a-noun-inf2"},{match:"do [so]",group:0,tag:"Noun",reason:"so-noun"},{match:"#Copula [#Infinitive] #Noun",group:0,tag:"Noun",reason:"is-pres-noun"},{match:"#Determiner #Adverb? [close]",group:0,tag:"Adjective",reason:"a-close"},{match:"#Determiner [(shit|damn|hell)]",group:0,tag:"Noun",reason:"swears-noun"},{match:"(the|these) [#Singular] (were|are)",group:0,tag:"Plural",reason:"singular-were"},{match:"#Gerund #Adjective? for [#Infinitive]",group:0,tag:"Noun",reason:"running-for"},{match:"#Gerund #Adjective to [#Infinitive]",group:0,tag:"Noun",reason:"running-to"},{match:"(many|any|some|several) [#PresentTense] for",group:0,tag:"Noun",reason:"any-verbs-for"},{match:"(have|had) [#Adjective] #Preposition .",group:0,tag:"Noun",reason:"have-fun"},{match:"co #Noun",tag:"Actor",reason:"co-noun"}],mD="(".concat(zt.adverbAdjective.join("|"),")"),fD=[{match:"[still] #Adjective",group:0,tag:"Adverb",reason:"still-advb"},{match:"[still] #Verb",group:0,tag:"Adverb",reason:"still-verb"},{match:"[so] #Adjective",group:0,tag:"Adverb",reason:"so-adv"},{match:"[way] #Comparative",group:0,tag:"Adverb",reason:"way-adj"},{match:"[way] #Adverb #Adjective",group:0,tag:"Adverb",reason:"way-too-adj"},{match:"[all] #Verb",group:0,tag:"Adverb",reason:"all-verb"},{match:"(#Verb && !#Modal) [like]",group:0,tag:"Adverb",reason:"verb-like"},{match:"(barely|hardly) even",tag:"Adverb",reason:"barely-even"},{match:"[even] #Verb",group:0,tag:"Adverb",reason:"even-walk"},{match:"even left",tag:"#Adverb #Verb",reason:"even-left"},{match:"(#PresentTense && !#Copula) [(hard|quick|long|bright|slow|fast|backwards|forwards)]",group:0,tag:"Adverb",reason:"lazy-ly"},{match:"[much] #Adjective",group:0,tag:"Adverb",reason:"bit-1"},{match:"#Copula [#Adverb]$",group:0,tag:"Adjective",reason:"is-well"},{match:"a [(little|bit|wee) bit?] #Adjective",group:0,tag:"Adverb",reason:"a-bit-cold"},{match:"[".concat(mD,"] #Adjective"),group:0,tag:"Adverb",reason:"dark-green"},{match:"#Adverb [#Adverb]$",group:0,tag:"Adjective",reason:"kinda-sparkly"},{match:"#Adverb [#Adverb] (and|or|then)",group:0,tag:"Adjective",reason:"kinda-sparkly-and"}],hD=[{match:"1 #Value #PhoneNumber",tag:"PhoneNumber",reason:"1-800-Value"},{match:"#NumericValue #PhoneNumber",tag:"PhoneNumber",reason:"(800) PhoneNumber"},{match:"#Demonym #Currency",tag:"Currency",reason:"demonym-currency"},{match:"[second] #Noun",group:0,tag:"Ordinal",reason:"second-noun"},{match:"#Value+ [#Currency]",group:0,tag:"Unit",reason:"5-yan"},{match:"#Value [(foot|feet)]",group:0,tag:"Unit",reason:"foot-unit"},{match:"(minus|negative) #Value",tag:"Value",reason:"minus-value"},{match:"#Value [#Abbreviation]",group:0,tag:"Unit",reason:"value-abbr"},{match:"#Value [k]",group:0,tag:"Unit",reason:"value-k"},{match:"#Unit an hour",tag:"Unit",reason:"unit-an-hour"},{match:"#Value (point|decimal) #Value",tag:"Value",reason:"value-point-value"},{match:"(#Value|a) [(buck|bucks|grand)]",group:0,tag:"Currency",reason:"value-bucks"},{match:"#Determiner [(half|quarter)] #Ordinal",group:0,tag:"Value",reason:"half-ordinal"},{match:"a #Value",tag:"Value",reason:"a-value"},{match:"[#Value+] #Currency",group:0,tag:"Money",reason:"15 usd"},{match:"(hundred|thousand|million|billion|trillion|quadrillion)+ and #Value",tag:"Value",reason:"magnitude-and-value"},{match:"!once [(a|an)] (#Duration|hundred|thousand|million|billion|trillion)",group:0,tag:"Value",reason:"a-is-one"}],si="(".concat(zt.personVerb.join("|"),")"),yD=[{match:"[#Adjective] #Possessive #Noun",group:0,tag:"Verb",reason:"gerund-his-noun"},{match:"[#Adjective] (us|you)",group:0,tag:"Gerund",reason:"loving-you"},{match:"(slowly|quickly) [#Adjective]",group:0,tag:"Gerund",reason:"slowly-adj"},{match:"(#Modal|i|they|we|do) not? [like]",group:0,tag:"PresentTense",reason:"modal-like"},{match:"do (simply|just|really|not)+ [(#Adjective|like)]",group:0,tag:"Verb",reason:"do-simply-like"},{match:"does (#Adverb|not)? [#Adjective]",group:0,tag:"PresentTense",reason:"does-mean"},{match:"i (#Adverb|do)? not? [mean]",group:0,tag:"PresentTense",reason:"i-mean"},{match:"#Noun #Adverb? [left]",group:0,tag:"PastTense",reason:"left-verb"},{match:"(this|that) [#Plural]",group:0,tag:"PresentTense",reason:"this-verbs"},{match:"[#Copula (#Adverb|not)+?] (#Gerund|#PastTense)",group:0,tag:"Auxiliary",reason:"copula-walking"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[#Adverb+? (#Modal|did)+ (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"modal-verb"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"[(has|had) (#Adverb|not)+?] #PastTense",group:0,tag:"Auxiliary",reason:"had-walked"},{match:"[(do|does|will|have|had)] (not|#Adverb)? #Verb",group:0,tag:"Auxiliary",reason:"have-had"},{match:"[about to] #Adverb? #Verb",group:0,tag:["Auxiliary","Verb"],reason:"about-to"},{match:"#Modal (#Adverb|not)+? be (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"would-be"},{match:"(were|was) being [#PresentTense]",group:0,tag:"PastTense",reason:"was-being"},{match:"[#Modal (#Adverb|not)+? have (#Adverb|not)+? had (#Adverb|not)+?] #Verb",group:0,tag:"Auxiliary",reason:"would-have"},{match:"(#Modal|had|has) (#Adverb|not)+? been (#Adverb|not)+? #Verb",group:0,tag:"Auxiliary",reason:"had-been"},{match:"[(be|being|been)] #Participle",group:0,tag:"Auxiliary",reason:"being-foo"},{match:"(#Verb && @hasHyphen) up",tag:"PhrasalVerb",reason:"foo-up"},{match:"(#Verb && @hasHyphen) off",tag:"PhrasalVerb",reason:"foo-off"},{match:"(#Verb && @hasHyphen) over",tag:"PhrasalVerb",reason:"foo-over"},{match:"(#Verb && @hasHyphen) out",tag:"PhrasalVerb",reason:"foo-out"},{match:"#PhrasalVerb [#PhrasalVerb]",group:0,tag:"Particle",reason:"phrasal-particle"},{match:"#Verb (him|her|it|us|himself|herself|itself|everything|something) [(up|down)]",group:0,tag:"Adverb",reason:"phrasal-pronoun-advb"},{match:"[will #Adverb? not? #Adverb? be] #Gerund",group:0,tag:"Copula",reason:"will-be-copula"},{match:"will #Adverb? not? #Adverb? [be] #Adjective",group:0,tag:"Copula",reason:"be-copula"},{match:"[march] (up|down|back|to|toward)",group:0,tag:"Infinitive",reason:"march-to"},{match:"#Modal [march]",group:0,tag:"Infinitive",reason:"must-march"},{match:"(let|make|made) (him|her|it|#Person|#Place|#Organization)+ [#Singular] (a|an|the|it)",group:0,tag:"Infinitive",reason:"let-him-glue"},{match:"will [#Adjective]",group:0,tag:"Verb",reason:"will-adj"},{match:"#Pronoun [#Adjective] #Determiner #Adjective? #Noun",group:0,tag:"Verb",reason:"he-adj-the"},{match:"#Copula [#Adjective to] #Verb",group:0,tag:"Verb",reason:"adj-to"},{match:"[open] #Determiner",group:0,tag:"Infinitive",reason:"open-the"},{match:"[#PresentTense] (are|were|was) #Adjective",group:0,tag:"Plural",reason:"compromises-are-possible"},{match:"#Modal [".concat(si,"]"),group:0,tag:"Verb",reason:"would-mark"},{match:"#Adverb [".concat(si,"]"),group:0,tag:"Verb",reason:"really-mark"},{match:"(to|#Modal) [mark]",group:0,tag:"PresentTense",reason:"to-mark"},{match:"".concat(si," #Person"),tag:"Person",reason:"rob-smith"},{match:"".concat(si," #Acronym #ProperNoun"),tag:"Person",reason:"rob-a-smith"},{match:"[shit] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear1-verb"},{match:"[damn] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear2-verb"},{match:"[fuck] (#Determiner|#Possessive|them)",group:0,tag:"Verb",reason:"swear3-verb"}],bD=yD,gD=[{match:"(west|north|south|east|western|northern|southern|eastern)+ #Place",tag:"Region",reason:"west-norfolk"},{match:"#City [(al|ak|az|ar|ca|ct|dc|fl|ga|id|il|nv|nh|nj|ny|oh|pa|sc|tn|tx|ut|vt|pr)]",group:0,tag:"Region",reason:"us-state"},{match:"portland [or]",group:0,tag:"Region",reason:"portland-or"},{match:"#ProperNoun+ (district|region|province|county|prefecture|municipality|territory|burough|reservation)",tag:"Region",reason:"foo-district"},{match:"(district|region|province|municipality|territory|burough|state) of #ProperNoun",tag:"Region",reason:"district-of-Foo"},{match:"in [#ProperNoun] #Place",group:0,tag:"Place",reason:"propernoun-place"},{match:"#Value #Noun (st|street|rd|road|crescent|cr|way|tr|terrace|avenue|ave)",tag:"Address",reason:"address-st"}],vD=gD,CD=[{match:"#Noun (&|n) #Noun",tag:"Organization",reason:"Noun-&-Noun"},{match:"#Organization of the? #ProperNoun",tag:"Organization",reason:"org-of-place",safe:!0},{match:"#Organization #Country",tag:"Organization",reason:"org-country"},{match:"#ProperNoun #Organization",tag:"Organization",reason:"titlecase-org"},{match:"#ProperNoun (ltd|co|inc|dept|assn|bros)",tag:"Organization",reason:"org-abbrv"},{match:"the [#Acronym]",group:0,tag:"Organization",reason:"the-acronym",safe:!0},{match:"(world|global|international|national|#Demonym) #Organization",tag:"Organization",reason:"global-org"},{match:"#Noun+ (public|private) school",tag:"School",reason:"noun-public-school"}],vb="(".concat(zt.personNoun.join("|"),")"),Ie="(".concat(zt.personMonth.join("|"),")"),TD="(".concat(zt.personPlace.join("|"),")"),ND=[{match:"[(1st|2nd|first|second)] #Honorific",group:0,tag:"Honorific",reason:"ordinal-honorific"},{match:"[(private|general|major|corporal|lord|lady|secretary|premier)] #Honorific? #Person",group:0,tag:"Honorific",reason:"ambg-honorifics"},{match:"#Copula [(#Noun|#PresentTense)] #LastName",group:0,tag:"FirstName",reason:"copula-noun-lastname"},{match:"(lady|queen|sister) #ProperNoun",tag:"FemaleName",reason:"lady-titlecase",safe:!0},{match:"(king|pope|father) #ProperNoun",tag:"MaleName",reason:"pope-titlecase",safe:!0},{match:"[(will|may|april|june|said|rob|wade|ray|rusty|drew|miles|jack|chuck|randy|jan|pat|cliff|bill)] #LastName",group:0,tag:"FirstName",reason:"maybe-lastname"},{match:"#FirstName [#Determiner #Noun] #LastName",group:0,tag:"NickName",reason:"first-noun-last"},{match:"#Possessive [#FirstName]",group:0,tag:"Person",reason:"possessive-name"},{match:"#ProperNoun (b|c|d|e|f|g|h|j|k|l|m|n|o|p|q|r|s|t|u|v|w|x|y|z) #ProperNoun",tag:"Person",reason:"titlecase-acronym-titlecase",safe:!0},{match:"#Acronym #LastName",tag:"Person",reason:"acronym-latname",safe:!0},{match:"#Person (jr|sr|md)",tag:"Person",reason:"person-honorific"},{match:"#Person #Person the? #RomanNumeral",tag:"Person",reason:"roman-numeral"},{match:"#FirstName [/^[^aiurck]$/]",group:0,tag:["Acronym","Person"],reason:"john-e"},{match:"#Honorific #Person",tag:"Person",reason:"honorific-person"},{match:"#Honorific #Acronym",tag:"Person",reason:"Honorific-TitleCase"},{match:"#Noun van der? #Noun",tag:"Person",reason:"van der noun",safe:!0},{match:"(king|queen|prince|saint|lady) of #Noun",tag:"Person",reason:"king-of-noun",safe:!0},{match:"(prince|lady) #Place",tag:"Person",reason:"lady-place"},{match:"(king|queen|prince|saint) #ProperNoun",tag:"Person",reason:"saint-foo"},{match:"[#ProperNoun] #Person",group:0,tag:"Person",reason:"proper-person",safe:!0},{match:"al (#Person|#ProperNoun)",tag:"Person",reason:"al-borlen",safe:!0},{match:"#FirstName de #Noun",tag:"Person",reason:"bill-de-noun"},{match:"#FirstName (bin|al) #Noun",tag:"Person",reason:"bill-al-noun"},{match:"#FirstName #Acronym #ProperNoun",tag:"Person",reason:"bill-acronym-title"},{match:"#FirstName #FirstName #ProperNoun",tag:"Person",reason:"bill-firstname-title"},{match:"#Honorific #FirstName? #ProperNoun",tag:"Person",reason:"dr-john-Title"},{match:"#FirstName the #Adjective",tag:"Person",reason:"name-the-great"},{match:"#FirstName (green|white|brown|hall|young|king|hill|cook|gray|price)",tag:"Person",reason:"bill-green"},{match:"".concat(vb," #Person"),tag:"Person",reason:"ray-smith",safe:!0},{match:"".concat(vb," #Acronym? #ProperNoun"),tag:"Person",reason:"ray-a-smith",safe:!0},{match:"#Infinitive #Determiner? #Adjective? #Noun? (to|for) [".concat(Ie,"]"),group:0,tag:"Person",reason:"ambig-person"},{match:"#Infinitive [".concat(Ie,"]"),group:0,tag:"Person",reason:"infinitive-person"},{match:"[".concat(Ie,"] #Modal"),group:0,tag:"Person",reason:"ambig-modal"},{match:"[may] be",group:0,tag:"Verb",reason:"may-be"},{match:"#Modal [".concat(Ie,"]"),group:0,tag:"Person",reason:"modal-ambig"},{match:"#Copula [".concat(Ie,"]"),group:0,tag:"Person",reason:"is-may"},{match:"[".concat(Ie,"] #Copula"),group:0,tag:"Person",reason:"may-is"},{match:"that [".concat(Ie,"]"),group:0,tag:"Person",reason:"that-month"},{match:"with [".concat(Ie,"]"),group:0,tag:"Person",reason:"with-month"},{match:"for [".concat(Ie,"]"),group:0,tag:"Person",reason:"for-month"},{match:"this [".concat(Ie,"]"),group:0,tag:"Month",reason:"this-may"},{match:"next [".concat(Ie,"]"),group:0,tag:"Month",reason:"next-may"},{match:"last [".concat(Ie,"]"),group:0,tag:"Month",reason:"last-may"},{match:"#Date [".concat(Ie,"]"),group:0,tag:"Month",reason:"date-may"},{match:"[".concat(Ie,"] the? #Value"),group:0,tag:"Month",reason:"may-5th"},{match:"#Value of [".concat(Ie,"]"),group:0,tag:"Month",reason:"5th-of-may"},{match:"#ProperNoun (van|al|bin) #ProperNoun",tag:"Person",reason:"title-van-title",safe:!0},{match:"#ProperNoun (de|du) la? #ProperNoun",tag:"Person",reason:"title-de-title",safe:!0},{match:"#Singular #Acronym #LastName",tag:"#Person",reason:"title-acro-noun",safe:!0},{match:"#FirstName (#Noun && #ProperNoun) #ProperNoun?",tag:"Person",reason:"firstname-titlecase"},{match:"#FirstName #Acronym #Noun",tag:"Person",reason:"n-acro-noun",safe:!0},{match:"#FirstName [(de|di|du|van|von) #Person]",group:0,tag:"LastName",reason:"de-firstname"},{match:"[".concat(TD,"] (#ProperNoun && !#Place)"),group:0,tag:"FirstName",reason:"place-firstname"}],xD=ND,oe=[];oe=oe.concat(oD);oe=oe.concat(uD);oe=oe.concat(dD);oe=oe.concat(pD);oe=oe.concat(fD);oe=oe.concat(hD);oe=oe.concat(bD);oe=oe.concat(vD);oe=oe.concat(CD);oe=oe.concat(xD);var VD=function(t){var e=[],n=[];return t.forEach(function(r){r.optional===!0||r.negative===!0||(r.tag!==void 0&&e.push(r.tag),r.word!==void 0&&n.push(r.word))}),{tags:Qo(e),words:Qo(n)}},wD=function(t){var e=[],n=t.reg.filter(function(i){return i.fastOr!==void 0});if(n.length===1){var r=t.reg.findIndex(function(i){return i.fastOr!==void 0});Object.keys(t.reg[r].fastOr).forEach(function(i){var a=Object.assign({},t);a.reg=a.reg.slice(0),a.reg[r]=Object.assign({},a.reg[r]),a.reg[r].word=i,delete a.reg[r].operator,delete a.reg[r].fastOr,e.push(a)})}return e},Xn=[];oe.forEach(function(u){u.reg=xe(u.match);var t=wD(u);t.length>0?Xn=Xn.concat(t):Xn.push(u)});Xn.forEach(function(u){return u.required=VD(u.reg),u});var DD=Xn,AD=function(t){if(t.length===0)return[];var e={};t.forEach(function(r){r=Qo(r);for(var i=0;i<r.length;i++)e[r[i]]=e[r[i]]||0,e[r[i]]+=1});var n=Object.keys(e);return n=n.filter(function(r){return e[r]===t.length}),n=n.map(function(r){return Number(r)}),n},SD=function(t){DD.forEach(function(e){var n=[];e.required.words.forEach(function(o){n.push(t._cache.words[o]||[])}),e.required.tags.forEach(function(o){n.push(t._cache.tags[o]||[])});var r=AD(n);if(r.length!==0){var i=r.map(function(o){return t.list[o]}),a=t.buildFrom(i),s=a.match(e.reg,e.group);s.found&&(e.safe===!0?s.tagSafe(e.tag,e.reason):s.tag(e.tag,e.reason))}})},ID=SD,PD=function(t){return ID(t),iD(t),t},OD=PD,LD=function(t){var e=t.termList();return t=HV(t,e),t=xw(t,e),t=tD(t),t.cache(),t=OD(t),t.uncache(),t.world.taggers.forEach(function(n){n(t)}),t},RD=LD,FD=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return qe(i,[{key:"stripPeriods",value:function(){return this.termList().forEach(function(s){s.tags.Abbreviation===!0&&s.next&&(s.post=s.post.replace(/^\./,""));var o=s.text.replace(/\./,"");s.set(o)}),this}},{key:"addPeriods",value:function(){return this.termList().forEach(function(s){s.post=s.post.replace(/^\./,""),s.post="."+s.post}),this}}]),i}(t);return e.prototype.unwrap=e.prototype.stripPeriods,t.prototype.abbreviations=function(n){var r=this.match("#Abbreviation");return typeof n=="number"&&(r=r.get(n)),new e(r.list,this,this.world)},t},kD=FD,MD=/\./,_D=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return qe(i,[{key:"stripPeriods",value:function(){return this.termList().forEach(function(s){var o=s.text.replace(/\./g,"");s.set(o)}),this}},{key:"addPeriods",value:function(){return this.termList().forEach(function(s){var o=s.text.replace(/\./g,"");o=o.split("").join("."),MD.test(s.post)===!1&&(o+="."),s.set(o)}),this}}]),i}(t);return e.prototype.unwrap=e.prototype.stripPeriods,e.prototype.strip=e.prototype.stripPeriods,t.prototype.acronyms=function(n){var r=this.match("#Acronym");return typeof n=="number"&&(r=r.get(n)),new e(r.list,this,this.world)},t},BD=_D,ED=function(t){return t.prototype.clauses=function(e){var n=this.if("@hasComma").notIf("@hasComma @hasComma").notIf("@hasComma . .? (and|or) .").notIf("(#City && @hasComma) #Country").notIf("(#WeekDay && @hasComma) #Date").notIf("(#Date && @hasComma) #Year").notIf("@hasComma (too|also)$").match("@hasComma"),r=this.splitAfter(n),i=r.quotations();r=r.splitOn(i);var a=r.parentheses();r=r.splitOn(a);var s=r.if("#Copula #Adjective #Conjunction (#Pronoun|#Determiner) #Verb").match("#Conjunction");r=r.splitBefore(s);var o=r.if("if .{2,9} then .").match("then");r=r.splitBefore(o),r=r.splitBefore("as well as ."),r=r.splitBefore("such as ."),r=r.splitBefore("in addition to ."),r=r.splitAfter("@hasSemicolon"),r=r.splitAfter("@hasDash");var l=r.filter(function(d){return d.wordCount()>5&&d.match("#Verb+").length>=2});if(l.found){var c=l.splitAfter("#Noun .* #Verb .* #Noun+");r=r.splitOn(c.eq(0))}return typeof e=="number"&&(r=r.get(e)),new t(r.list,this,this.world)},t},$D=ED,zD=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(a,s,o){var l;return Ae(this,i),l=r.call(this,a,s,o),l.contracted=null,l}return qe(i,[{key:"expand",value:function(){return this.list.forEach(function(s){var o=s.terms(),l=o[0].isTitleCase();o.forEach(function(c,d){c.set(c.implicit||c.text),c.implicit=void 0,d<o.length-1&&c.post===""&&(c.post+=" ")}),l&&o[0].toTitleCase()}),this}}]),i}(t);return t.prototype.contractions=function(n){var r=this.match("@hasContraction+");return typeof n=="number"&&(r=r.get(n)),new e(r.list,this,this.world)},t.prototype.expanded=t.prototype.isExpanded,t.prototype.contracted=t.prototype.isContracted,t},jD=zD,HD=function(t){var e=function(i){var a=i.splitAfter("@hasComma").splitOn("(and|or) not?").not("(and|or) not?"),s=i.match("[.] (and|or)",0);return{things:a,conjunction:i.match("(and|or) not?"),beforeLast:s,hasOxford:s.has("@hasComma")}},n=function(r){tt(a,r);var i=nt(a);function a(){return Ae(this,a),i.apply(this,arguments)}return qe(a,[{key:"conjunctions",value:function(){return this.match("(and|or)")}},{key:"parts",value:function(){return this.splitAfter("@hasComma").splitOn("(and|or) not?")}},{key:"items",value:function(){return e(this).things}},{key:"add",value:function(o){return this.forEach(function(l){var c=e(l).beforeLast;c.append(o),c.termList(0).addPunctuation(",")}),this}},{key:"remove",value:function(o){return this.items().if(o).remove()}},{key:"hasOxfordComma",value:function(){return this.filter(function(o){return e(o).hasOxford})}},{key:"addOxfordComma",value:function(){var o=this.items(),l=o.eq(o.length-2);return l.found&&l.has("@hasComma")===!1&&l.post(", "),this}},{key:"removeOxfordComma",value:function(){var o=this.items(),l=o.eq(o.length-2);return l.found&&l.has("@hasComma")===!0&&l.post(" "),this}}]),a}(t);return n.prototype.things=n.prototype.items,t.prototype.lists=function(r){var i=this.if("@hasComma+ .? (and|or) not? ."),a=i.match("(#Noun|#Adjective|#Determiner|#Article)+ #Conjunction not? (#Article|#Determiner)? #Adjective? #Noun+").if("#Noun"),s=i.match("(#Adjective|#Adverb)+ #Conjunction not? #Adverb? #Adjective+"),o=i.match("(#Verb|#Adverb)+ #Conjunction not? #Adverb? #Verb+"),l=a.concat(s);return l=l.concat(o),l=l.if("@hasComma"),typeof r=="number"&&(l=i.get(r)),new n(l.list,this,this.world)},t},qD=HD,KD="(#Pronoun|#Place|#Value|#Person|#Uncountable|#Month|#WeekDay|#Holiday|#Possessive)",WD=function(t){return t.has("#Plural")===!0?!0:t.has(KD)!==!0},tl=WD,Cb={hour:"an",heir:"an",heirloom:"an",honest:"an",honour:"an",honor:"an",uber:"an"},UD={a:!0,e:!0,f:!0,h:!0,i:!0,l:!0,m:!0,n:!0,o:!0,r:!0,s:!0,x:!0},Tb=[/^onc?e/i,/^u[bcfhjkqrstn][aeiou]/i,/^eul/i],GD=function(t){if(t.has("#Person")||t.has("#Place"))return"";if(t.has("#Plural"))return"the";var e=t.text("normal").trim();if(Cb.hasOwnProperty(e))return Cb[e];var n=e.substr(0,1);if(t.has("^@isAcronym")&&UD.hasOwnProperty(n))return"an";for(var r=0;r<Tb.length;r++)if(Tb[r].test(e))return"a";return/^[aeiou]/i.test(e)?"an":"a"},Nb=GD,XD=[/(antenn|formul|nebul|vertebr|vit)ae$/i,/(octop|vir|radi|nucle|fung|cact|stimul)i$/i,/men$/i,/.tia$/i,/(m|l)ice$/i],ZD=[/(ax|test)is$/i,/(octop|vir|radi|nucle|fung|cact|stimul)us$/i,/(octop|vir)i$/i,/(rl)f$/i,/(alias|status)$/i,/(bu)s$/i,/(al|ad|at|er|et|ed|ad)o$/i,/(ti)um$/i,/(ti)a$/i,/sis$/i,/(?:(^f)fe|(lr)f)$/i,/hive$/i,/(^aeiouy|qu)y$/i,/(x|ch|ss|sh|z)$/i,/(matr|vert|ind|cort)(ix|ex)$/i,/(m|l)ouse$/i,/(m|l)ice$/i,/(antenn|formul|nebul|vertebr|vit)a$/i,/.sis$/i,/^(?!talis|.*hu)(.*)man$/i],xb={isSingular:ZD,isPlural:XD},JD=/s$/,YD=function(t){return xb.isSingular.find(function(e){return e.test(t)})?!1:JD.test(t)===!0||xb.isPlural.find(function(e){return e.test(t)})?!0:null},Vb=YD,wb={he:"his",she:"hers",they:"theirs",we:"ours",i:"mine",you:"yours",her:"hers",their:"theirs",our:"ours",my:"mine",your:"yours"},QD=function(t){var e=t.text("text").trim();if(wb.hasOwnProperty(e)){t.replaceWith(wb[e],!0),t.tag("Possessive","toPossessive");return}if(/s$/.test(e)){e+="'",t.replaceWith(e,!0),t.tag("Possessive","toPossessive");return}e+="'s",t.replaceWith(e,!0),t.tag("Possessive","toPossessive")},e1=QD,t1=function(t){var e={main:t};if(t.has("#Noun (of|by|for) .")){var n=t.splitAfter("[#Noun+]",0);e.main=n.eq(0),e.post=n.eq(1)}return e},Db=t1,n1={json:function(t){var e=null;typeof t=="number"&&(e=t,t=null),t=t||{text:!0,normal:!0,trim:!0,terms:!0};var n=[];return this.forEach(function(r){var i=r.json(t)[0];i.article=Nb(r),n.push(i)}),e!==null?n[e]:n},adjectives:function(){var t=this.lookAhead("^(that|who|which)? (was|is|will)? be? #Adverb? #Adjective+");return t=t.concat(this.lookBehind("#Adjective+ #Adverb?$")),t=t.match("#Adjective"),t.sort("index")},isPlural:function(){return this.if("#Plural")},hasPlural:function(){return this.filter(function(t){return tl(t)})},toPlural:function(t){var e=this,n=this.world.transforms.toPlural;return this.forEach(function(r){if(!(r.has("#Plural")||tl(r)===!1)){var i=Db(r).main,a=i.text("reduced");if(!(!i.has("#Singular")&&Vb(a)===!0)&&(a=n(a,e.world),i.replace(a).tag("#Plural"),t)){var s=i.lookBefore("(an|a) #Adjective?$").not("#Adjective");s.found===!0&&s.remove()}}}),this},toSingular:function(t){var e=this,n=this.world.transforms.toSingular;return this.forEach(function(r){if(!(r.has("^#Singular+$")||tl(r)===!1)){var i=Db(r).main,a=i.text("reduced");if(!(!i.has("#Plural")&&Vb(a)!==!0)&&(a=n(a,e.world),i.replace(a).tag("#Singular"),t)){var s=r,o=r.lookBefore("#Adjective");o.found&&(s=o);var l=Nb(s);s.insertBefore(l)}}}),this},toPossessive:function(){return this.forEach(function(t){e1(t)}),this}},r1=n1,i1=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return i}(t);return Object.assign(e.prototype,r1),t.prototype.nouns=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.match("(#City && @hasComma) (#Region|#Country)"),a=this.not(i).splitAfter("@hasComma");a=a.concat(i);var s=a.quotations();return s.found&&(a=a.splitOn(s.eq(0))),a=a.match("#Noun+ (of|by)? the? #Noun+?"),r.keep_anaphora!==!0&&(a=a.not("#Pronoun"),a=a.not("(there|these)"),a=a.not("(#Month|#WeekDay)"),a=a.not("(my|our|your|their|her|his)")),a=a.not("(of|for|by|the)$"),typeof n=="number"&&(a=a.get(n)),new e(a.list,this,this.world)},t},a1=i1,Ab=/\(/,Sb=/\)/,s1=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return qe(i,[{key:"unwrap",value:function(){return this.list.forEach(function(s){var o=s.terms(0);o.pre=o.pre.replace(Ab,"");var l=s.lastTerm();l.post=l.post.replace(Sb,"")}),this}}]),i}(t);return t.prototype.parentheses=function(n){var r=[];return this.list.forEach(function(i){for(var a=i.terms(),s=0;s<a.length;s+=1){var o=a[s];if(Ab.test(o.pre)){for(var l=s;l<a.length;l+=1)if(Sb.test(a[l].post)){var c=l-s+1;r.push(i.buildFrom(o.id,c)),s=l;break}}}}),typeof n=="number"?(r[n]?r=[r[n]]:r=[],new e(r,this,this.world)):new e(r,this,this.world)},t},o1=s1,l1=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(a,s,o){var l;return Ae(this,i),l=r.call(this,a,s,o),l.contracted=null,l}return qe(i,[{key:"strip",value:function(){return this.list.forEach(function(s){var o=s.terms();o.forEach(function(l){var c=l.text.replace(/'s$/,"");l.set(c||l.text)})}),this}}]),i}(t);return t.prototype.possessives=function(n){var r=this.match("#Noun+? #Possessive");return typeof n=="number"&&(r=r.get(n)),new e(r.list,this,this.world)},t},u1=l1,Ib={'"':'"',"\uFF02":"\uFF02","'":"'","\u201C":"\u201D","\u2018":"\u2019","\u201F":"\u201D","\u201B":"\u2019","\u201E":"\u201D","\u2E42":"\u201D","\u201A":"\u2019","\xAB":"\xBB","\u2039":"\u203A","\u2035":"\u2032","\u2036":"\u2033","\u2037":"\u2034","\u301D":"\u301E","`":"\xB4","\u301F":"\u301E"},Pb=RegExp("("+Object.keys(Ib).join("|")+")"),c1=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return qe(i,[{key:"unwrap",value:function(){return this}}]),i}(t);return t.prototype.quotations=function(n){var r=[];return this.list.forEach(function(i){for(var a=i.terms(),s=0;s<a.length;s+=1){var o=a[s];if(Pb.test(o.pre)){for(var l=(o.pre.match(Pb)||[])[0],c=Ib[l],d=s;d<a.length;d+=1)if(a[d].post.indexOf(c)!==-1){var p=d-s+1;r.push(i.buildFrom(o.id,p)),s=d;break}}}}),typeof n=="number"?(r[n]?r=[r[n]]:r=[],new e(r,this,this.world)):new e(r,this,this.world)},t.prototype.quotes=t.prototype.quotations,t},d1=c1,p1=function(t,e){var n=t.verb,r=n.text("reduced");if(n.has("#Infinitive"))return r;var i=null;return n.has("#PastTense")?i="PastTense":n.has("#Gerund")?i="Gerund":n.has("#PresentTense")?i="PresentTense":n.has("#Participle")?i="Participle":n.has("#Actor")&&(i="Actor"),e.transforms.toInfinitive(r,e,i)},Zn=p1,m1=function(t){var e=t.lookBehind("#Noun+").last();return e},f1=function(t){var e=t.verb;if(e.has("(are|were|does)")||t.auxiliary.has("(are|were|does)"))return!0;if(e.has("(is|am|do|was)")||t.auxiliary.has("(is|am|do|was)"))return!1;var n=m1(e);return n.has("(we|they|you)")||n.has("#Plural")?!0:n.has("#Singular")?!1:null},Jn=f1,h1=function(t,e){var n=t.verb;if(!t.negative.found){if(t.auxiliary.found){t.auxiliary.eq(0).append("not"),t.auxiliary.has("#Modal have not")&&t.auxiliary.replace("have not","not have");return}if(n.has("(#Copula|will|has|had|do)")){n.append("not");return}if(n.has("#PastTense")){var r=Zn(t,e);n.replaceWith(r,!0),n.prepend("did not");return}if(n.has("#PresentTense")){var i=Zn(t,e);n.replaceWith(i,!0),Jn(t)?n.prepend("do not"):n.prepend("does not");return}if(n.has("#Gerund")){var a=Zn(t,e);n.replaceWith(a,!0),n.prepend("not");return}if(Jn(t)){n.prepend("does not");return}n.prepend("do not")}},y1=h1,b1=function(t){var e=t.lookBehind(),n=e.nouns(null,{keep_anaphora:!0}).last();return n.found||(n=e.match("(that|this|each)").last(),n=n.tag("#Noun").nouns()),n},Ob=b1,g1=function(t){var e={adverb:t.match("#Adverb+"),negative:t.match("#Negative"),auxiliary:t.match("#Auxiliary+").not("(#Negative|#Adverb)"),particle:t.match("#Particle"),verb:t.match("#Verb+").not("(#Adverb|#Negative|#Auxiliary|#Particle)"),original:t,subject:Ob(t)};if(!e.verb.found)return Object.keys(e).forEach(function(r){e[r]=e[r].not(".")}),e.verb=t,e;if(e.adverb&&e.adverb.found){var n=e.adverb.text("reduced")+"$";t.has(n)&&(e.adverbAfter=!0)}return e},$e=g1,v1=function(t){var e=!1,n=Jn(t),r=t.negative.found;t.verb.lookBehind("(i|we) (#Adverb|#Verb)?$").found&&(e=!0);var i={PastTense:"was",PresentTense:"is",FutureTense:"will be",Infinitive:"is",Gerund:"being",Actor:"",PerfectTense:"been",Pluperfect:"been"};return e===!0&&(i.PresentTense="am",i.Infinitive="am"),n&&(i.PastTense="were",i.PresentTense="are",i.Infinitive="are"),r&&(i.PastTense+=" not",i.PresentTense+=" not",i.FutureTense="will not be",i.Infinitive+=" not",i.PerfectTense="not "+i.PerfectTense,i.Pluperfect="not "+i.Pluperfect,i.Gerund="not "+i.Gerund),i},C1=v1,T1=function(t){var e=t.verb.text(),n={PastTense:e+" have",PresentTense:e,FutureTense:e,Infinitive:e};return n},N1=T1,x1=function(t,e){var n=t.verb;if(n.has("#Copula")||n.out("normal")==="be"&&t.auxiliary.has("will"))return C1(t);if(t.auxiliary.has("are")&&n.has("#Gerund")){var r=t.original.clone(),i=r.clone().replace("are","were"),a=r.clone().replace("are","will be"),s=Zn(t,e),o={PastTense:i.text(),PresentTense:r.text(),FutureTense:a.text(),Infinitive:s};return o}if(n.has("#Modal"))return N1(t);var l=t.verb.termList(0).hasHyphen(),c=Zn(t,e);if(!c)return{};var d=e.transforms.conjugate(c,e);if(d.Infinitive=c,t.particle.found){var p=t.particle.text(),m=l===!0?"-":" ";Object.keys(d).forEach(function(h){return d[h]+=m+p})}var f=t.negative.found;return f&&(d.PastTense="did not "+d.Infinitive,d.PresentTense="does not "+d.Infinitive,d.Gerund="not "+d.Gerund),d.FutureTense||(f?d.FutureTense="will not "+d.Infinitive:d.FutureTense="will "+d.Infinitive),f&&(d.Infinitive="not "+d.Infinitive),d},Pt=x1,V1=function(t){return!!(t.auxiliary.has("(could|should|would|may|can|must)")||t.auxiliary.has("am .+? being")||t.auxiliary.has("had .+? been"))},w1=function(t,e){if(!(t.auxiliary.has("(have|had)")&&t.verb.has("#Participle"))){var n=Pt(t,e),r=n.Participle||n.PastTense;r&&t.verb.replaceWith(r,!1),t.auxiliary.has("am .+? being")&&(t.auxiliary.remove("am"),t.auxiliary.replace("being","have been")),t.auxiliary.has("have")||t.auxiliary.append("have"),t.verb.tag("Participle","toParticiple"),t.auxiliary.replace("can","could"),t.auxiliary.replace("be have","have been"),t.auxiliary.replace("not have","have not"),t.auxiliary.tag("Auxiliary")}},Lb={useParticiple:V1,toParticiple:w1},Rb=Lb.toParticiple,Fb=Lb.useParticiple,nl=function(t){return t.auxiliary.remove("(will|are|am|being)"),t.auxiliary.remove("(did|does)"),t.auxiliary.remove("(had|has|have)"),t.particle.remove(),t.negative.remove(),t},D1={json:function(t){var e=this,n=null;typeof t=="number"&&(n=t,t=null),t=t||{text:!0,normal:!0,trim:!0,terms:!0};var r=[];return this.forEach(function(i){var a=i.json(t)[0],s=$e(i);a.parts={},Object.keys(s).forEach(function(o){s[o]&&s[o].isA==="Doc"?a.parts[o]=s[o].text("normal"):a.parts[o]=s[o]}),a.isNegative=i.has("#Negative"),a.conjugations=Pt(s,e.world),r.push(a)}),n!==null?r[n]:r},adverbs:function(){var t=[];this.forEach(function(n){var r=$e(n).adverb;r.found&&(t=t.concat(r.list))});var e=this.lookBehind("#Adverb+$");return e.found&&(t=e.list.concat(t)),e=this.lookAhead("^#Adverb+"),e.found&&(t=t.concat(e.list)),this.buildFrom(t)},isPlural:function(){var t=this,e=[];return this.forEach(function(n){var r=$e(n);Jn(r,t.world)===!0&&e.push(n.list[0])}),this.buildFrom(e)},isSingular:function(){var t=this,e=[];return this.forEach(function(n){var r=$e(n);Jn(r,t.world)===!1&&e.push(n.list[0])}),this.buildFrom(e)},conjugate:function(){var t=this,e=[];return this.forEach(function(n){var r=$e(n),i=Pt(r,t.world);e.push(i)}),e},toPastTense:function(){var t=this;return this.forEach(function(e){var n=$e(e);if(Fb(n)){Rb(n,t.world);return}if(!e.has("#Imperative")&&!(e.has("be")&&e.lookBehind("to$").found)){if(n.verb.has("#Gerund")&&n.auxiliary.has("(is|will|was)")){e.replace("is","was");return}var r=Pt(n,t.world).PastTense;r&&(n=nl(n),n.verb.replaceWith(r,!1))}}),this},toPresentTense:function(){var t=this;return this.forEach(function(e){var n=$e(e),r=Pt(n,t.world),i=r.PresentTense;if(e.lookBehind("(i|we) (#Adverb|#Verb)?$").found&&(i=r.Infinitive),i){if(n.auxiliary.has("(have|had) been")){n.auxiliary.replace("(have|had) been","am being"),r.Particle&&(i=r.Particle||r.PastTense);return}n.verb.replaceWith(i,!1),n.verb.tag("PresentTense"),n=nl(n),n.auxiliary.remove("#Modal")}}),this},toFutureTense:function(){var t=this;return this.forEach(function(e){var n=$e(e);if(!Fb(n)){var r=Pt(n,t.world).FutureTense;r&&(n=nl(n),n.auxiliary.remove("#Modal"),n.verb.replaceWith(r,!1),n.verb.tag("FutureTense"))}}),this},toInfinitive:function(){var t=this;return this.forEach(function(e){var n=$e(e),r=Pt(n,t.world).Infinitive;r&&(e.replaceWith(r,!1),e.tag("Infinitive"))}),this},toGerund:function(){var t=this;return this.forEach(function(e){var n=$e(e),r=Pt(n,t.world).Gerund;r&&(e.replaceWith(r,!1),e.tag("Gerund"))}),this},toParticiple:function(){var t=this;return this.forEach(function(e){var n=$e(e),r=!n.auxiliary.found;Rb(n,t.world),r&&(n.verb.prepend(n.auxiliary.text()),n.auxiliary.remove())}),this},isNegative:function(){return this.if("#Negative")},isPositive:function(){return this.ifNo("#Negative")},isImperative:function(){return this.if("#Imperative")},toNegative:function(){var t=this;return this.list.forEach(function(e){var n=t.buildFrom([e]),r=$e(n);y1(r,n.world)}),this},toPositive:function(){var t=this.match("do not #Verb");return t.found&&t.remove("do not"),this.remove("#Negative")},subject:function(){var t=[];return this.forEach(function(e){var n=Ob(e);n.list[0]&&t.push(n.list[0])}),this.buildFrom(t)}},A1=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return i}(t);return Object.assign(e.prototype,D1),e.prototype.negate=e.prototype.toNegative,t.prototype.verbs=function(n){var r=this.match("(#Adverb|#Auxiliary|#Verb|#Negative|#Particle)+");r=r.not("^#Adverb+"),r=r.not("#Adverb+$");var i=r.match("(#Adverb && @hasComma) #Adverb"),a=r.not(i).splitAfter("@hasComma"),s=a.match("#PastTense #Gerund");s.has("(been|am|#Auxiliary) #Gerund")||(a=a.splitBefore(s.match("#Gerund"))),a=a.concat(i),a.sort("index"),a=a.if("#Verb"),a.has("(is|was)$")&&(a=a.splitBefore("(is|was)$")),a.has("#PresentTense #Adverb #PresentTense")&&(a=a.splitBefore("#Adverb #PresentTense")),typeof n=="number"&&(a=a.get(n));var o=new e(a.list,this,this.world);return o},t},S1=A1,I1=function(t){var e=function(n){tt(i,n);var r=nt(i);function i(){return Ae(this,i),r.apply(this,arguments)}return i}(t);return t.prototype.people=function(n){var r=this.splitAfter("@hasComma");return r=r.match("#Person+"),typeof n=="number"&&(r=r.get(n)),new e(r.list,this,this.world)},t},P1=I1,O1=[kD,BD,$D,jD,qD,a1,o1,u1,d1,S1,P1],L1=function(t){return Object.keys(Xo).forEach(function(e){return t.prototype[e]=Xo[e]}),O1.forEach(function(e){return e(t)}),t},R1=L1,kb={misc:CV,selections:Xo},yt=function(){function u(t,e,n){var r=this;Ae(this,u),this.list=t,Object.defineProperty(this,"from",{enumerable:!1,value:e,writable:!0}),n===void 0&&e!==void 0&&(n=e.world),Object.defineProperty(this,"world",{enumerable:!1,value:n,writable:!0}),Object.defineProperty(this,"_cache",{enumerable:!1,writable:!0,value:{}}),Object.defineProperty(this,"found",{get:function(){return r.list.length>0}}),Object.defineProperty(this,"length",{get:function(){return r.list.length}}),Object.defineProperty(this,"isA",{get:function(){return"Doc"}})}return qe(u,[{key:"tagger",value:function(){return RD(this)}},{key:"pool",value:function(){return this.list.length>0?this.list[0].pool:this.all().list[0].pool}}]),u}();yt.prototype.buildFrom=function(u){u=u.map(function(e){return e.clone(!0)});var t=new yt(u,this,this.world);return t};yt.prototype.fromText=function(u){var t=dt(u,this.world,this.pool());return this.buildFrom(t)};Object.assign(yt.prototype,kb.misc);Object.assign(yt.prototype,kb.selections);R1(yt);var Mb={untag:"unTag",and:"match",notIf:"ifNo",only:"if",onlyIf:"if"};Object.keys(Mb).forEach(function(u){return yt.prototype[u]=yt.prototype[Mb[u]]});var oi=yt,F1=function(t){var e=t.termList();return Zo(e,t.world),t.world.taggers.forEach(function(n){n(t)}),t},k1=F1;function _b(u){var t=u,e=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;i&&t.addWords(i);var a=dt(r,t),s=new oi(a,null,t);return s.tagger(),s};return e.tokenize=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1?arguments[1]:void 0,i=t;r&&(i=i.clone(),i.words={},i.addWords(r));var a=dt(n,i),s=new oi(a,null,i);return(r||s.world.taggers.length>0)&&k1(s),s},e.extend=function(n){return n(oi,t,this,Mo,Fo,Bo),this},e.fromJSON=function(n){var r=ZN(n,t);return new oi(r,null,t)},e.clone=function(){return _b(t.clone())},e.verbose=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return t.verbose(n),this},e.world=function(){return t},e.parseMatch=function(n,r){return xe(n,r)},e.version=JN,e.import=e.load,e.plugin=e.extend,e}var M1=_b(new ox),li=M1;function ui(u,t){if(!(u instanceof t))throw new TypeError("Cannot call a class as a function")}function ci(u,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");u.prototype=Object.create(t&&t.prototype,{constructor:{value:u,writable:!0,configurable:!0}}),t&&rl(u,t)}function di(u){return di=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},di(u)}function rl(u,t){return rl=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},rl(u,t)}function _1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(u){return!1}}function B1(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function E1(u,t){return t&&(typeof t=="object"||typeof t=="function")?t:B1(u)}function pi(u){var t=_1();return function(){var n=di(u),r;if(t){var i=di(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return E1(this,r)}}var $1=function(t,e){var n=t.match("#Value+? #Money+ #Currency+ (and #Money+ #Currency+)+?");return t.match("#Money").forEach(function(r){r.lookAfter("#Currency").found||(n=n.concat(r))}),typeof e=="number"&&(n=n.get(e)),n},z1=$1,j1="one|two|three|four|five|six|seven|eight|nine",Ot="twenty|thirty|forty|fifty|sixty|seventy|eighty|ninety|fourty",H1="eleven|twelve|thirteen|fourteen|fifteen|sixteen|seventeen|eighteen|nineteen",q1=function(t,e){var n=t.match("#Value+");if(n.has("#NumericValue #NumericValue")&&(n.has("#Value @hasComma #Value")?n.splitAfter("@hasComma"):n.has("#NumericValue #Fraction")?n.splitAfter("#NumericValue #Fraction"):n=n.splitAfter("#NumericValue")),n.has("#Value #Value #Value")&&!n.has("#Multiple")&&n.has("("+Ot+") #Cardinal #Cardinal")&&(n=n.splitAfter("("+Ot+") #Cardinal")),n.has("#Value #Value")){n.has("#NumericValue #NumericValue")&&(n=n.splitOn("#Year")),n.has("("+Ot+") ("+H1+")")&&(n=n.splitAfter("("+Ot+")"));var r=n.match("#Cardinal #Cardinal");if(r.found&&!n.has("(point|decimal|#Fraction)")&&!r.has("#Cardinal (#Multiple|point|decimal)")){var i=n.has("(".concat(j1,") (").concat(Ot,")")),a=r.has("("+Ot+") #Cardinal"),s=r.has("#Multiple #Value");!i&&!a&&!s&&r.terms().forEach(function(o){n=n.splitOn(o)})}n.match("#Ordinal #Ordinal").match("#TextValue").found&&!n.has("#Multiple")&&(n.has("("+Ot+") #Ordinal")||(n=n.splitAfter("#Ordinal"))),n.has("#Ordinal #Cardinal")&&(n=n.splitBefore("#Cardinal+")),n.has("#TextValue #NumericValue")&&!n.has("("+Ot+"|#Multiple)")&&(n=n.splitBefore("#NumericValue+"))}return n.has("#NumberRange")&&(n=n.splitAfter("#NumberRange")),typeof e=="number"&&(n=n.get(e)),n},K1=q1,W1=function(t,e){var n=t.match("#Fraction+");return n=n.filter(function(r){return!r.lookBehind("#Value and$").found}),typeof e=="number"&&(n=n.eq(e)),n},U1=W1,G1=function(t,e){var n=t.match("#Percent+");return n=n.concat(t.match("[#Cardinal] percent",0)),typeof e=="number"&&(n=n.eq(e)),n},X1=G1,Z1=function(t){for(var e=[{reg:/^(minus|negative)[\s\-]/i,mult:-1},{reg:/^(a\s)?half[\s\-](of\s)?/i,mult:.5}],n=0;n<e.length;n++)if(e[n].reg.test(t)===!0)return{amount:e[n].mult,str:t.replace(e[n].reg,"")};return{amount:1,str:t}},J1=Z1,ue={ones:{zeroth:0,first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9},teens:{tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19},tens:{twentieth:20,thirtieth:30,fortieth:40,fourtieth:40,fiftieth:50,sixtieth:60,seventieth:70,eightieth:80,ninetieth:90,twenty:20,thirty:30,forty:40,fourty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},multiples:{hundredth:100,thousandth:1e3,millionth:1e6,billionth:1e9,trillionth:1e12,quadrillionth:1e15,quintillionth:1e18,sextillionth:1e21,septillionth:1e24,hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,grand:1e3}},Y1=function(t,e){if(ue.ones.hasOwnProperty(t)){if(e.ones||e.teens)return!1}else if(ue.teens.hasOwnProperty(t)){if(e.ones||e.teens||e.tens)return!1}else if(ue.tens.hasOwnProperty(t)&&(e.ones||e.teens||e.tens))return!1;return!0},Q1=Y1,eA=function(t){for(var e="0.",n=0;n<t.length;n++){var r=t[n];if(ue.ones.hasOwnProperty(r)===!0)e+=ue.ones[r];else if(ue.teens.hasOwnProperty(r)===!0)e+=ue.teens[r];else if(ue.tens.hasOwnProperty(r)===!0)e+=ue.tens[r];else if(/^[0-9]$/.test(r)===!0)e+=r;else return 0}return parseFloat(e)},tA=eA,nA=function(t){return t=t.replace(/1st$/,"1"),t=t.replace(/2nd$/,"2"),t=t.replace(/3rd$/,"3"),t=t.replace(/([4567890])r?th$/,"$1"),t=t.replace(/^[$€¥£¢]/,""),t=t.replace(/[%$€¥£¢]$/,""),t=t.replace(/,/g,""),t=t.replace(/([0-9])([a-z\u00C0-\u00FF]{1,2})$/,"$1"),t},rA=nA,iA=/^([0-9,\. ]+)\/([0-9,\. ]+)$/,Bb={"a few":3,"a couple":2,"a dozen":12,"two dozen":24,zero:0},mi=function(t){return Object.keys(t).reduce(function(e,n){return e+=t[n],e},0)},aA=function(t){if(Bb.hasOwnProperty(t)===!0)return Bb[t];if(t==="a"||t==="an")return 1;var e=J1(t);t=e.str;for(var n=null,r={},i=0,a=!1,s=t.split(/[ -]/),o=0;o<s.length;o++){var l=s[o];if(l=rA(l),!(!l||l==="and")){if(l==="-"||l==="negative"){a=!0;continue}if(l.charAt(0)==="-"&&(a=!0,l=l.substr(1)),l==="point")return i+=mi(r),i+=tA(s.slice(o+1,s.length)),i*=e.amount,i;var c=l.match(iA);if(c){var d=parseFloat(c[1].replace(/[, ]/g,"")),p=parseFloat(c[2].replace(/[, ]/g,""));p&&(i+=d/p||0);continue}if(ue.tens.hasOwnProperty(l)&&r.ones&&Object.keys(r).length===1&&(i=r.ones*100,r={}),Q1(l,r)===!1)return null;if(/^[0-9\.]+$/.test(l))r.ones=parseFloat(l);else if(ue.ones.hasOwnProperty(l)===!0)r.ones=ue.ones[l];else if(ue.teens.hasOwnProperty(l)===!0)r.teens=ue.teens[l];else if(ue.tens.hasOwnProperty(l)===!0)r.tens=ue.tens[l];else if(ue.multiples.hasOwnProperty(l)===!0){var m=ue.multiples[l];if(m===n)return null;if(m===100&&s[o+1]!==void 0){var f=s[o+1];ue.multiples[f]&&(m*=ue.multiples[f],o+=1)}n===null||m<n?(i+=(mi(r)||1)*m,n=m,r={}):(i+=mi(r),n=m,i=(i||1)*m,r={})}}}return i+=mi(r),i*=e.amount,i*=a?-1:1,i===0&&Object.keys(r).length===0?null:i},fi=aA,Eb=/s$/,Yn=function(t){var e=t.text("reduced");return fi(e)},hi={half:2,halve:2,quarter:4},sA=function(t){var e=t.text("reduced"),n=e.match(/^([-+]?[0-9]+)\/([-+]?[0-9]+)(st|nd|rd|th)?s?$/);return n&&n[1]&&n[0]?{numerator:Number(n[1]),denominator:Number(n[2])}:null},oA=function(t){var e=t.match("[<num>#Value+] out of every? [<den>#Value+]");if(e.found!==!0)return null;var n=e.groups(),r=n.num,i=n.den;return r=Yn(r),i=Yn(i),typeof r=="number"&&typeof i=="number"?{numerator:r,denominator:i}:null},lA=function(t){var e=t.match("[<num>(#Cardinal|a)+] [<dem>#Fraction+]");if(e.found!==!0)return null;var n=e.groups(),r=n.num,i=n.dem;r.has("a")?r=1:r=Yn(r);var a=i.text("reduced");return Eb.test(a)&&(a=a.replace(Eb,""),i.replaceWith(a)),hi.hasOwnProperty(a)?i=hi[a]:i=Yn(i),typeof r=="number"&&typeof i=="number"?{numerator:r,denominator:i}:null},uA=function(t){var e=t.match("^#Ordinal$");if(e.found!==!0)return null;if(t.lookAhead("^of .")){var n=Yn(e);return{numerator:1,denominator:n}}return null},cA=function(t){var e=t.text("reduced");return hi.hasOwnProperty(e)?{numerator:1,denominator:hi[e]}:null},dA=function(t){var e=Math.round(t*1e3)/1e3;return e===0&&t!==0?t:e},pA=function(t){t=t.clone();var e=cA(t)||sA(t)||oA(t)||lA(t)||uA(t)||null;return e!==null&&e.numerator&&e.denominator&&(e.decimal=e.numerator/e.denominator,e.decimal=dA(e.decimal)),e},jt=pA,mA=function(t,e,n){t=t.replace(/,/g,"");var r=t.split(/^([^0-9]*)([0-9.,]*)([^0-9]*)$/);if(r&&r[2]&&e.terms().length<2){var i=parseFloat(r[2]||t);typeof i!="number"&&(i=null);var a=r[3]||"";return(a==="st"||a==="nd"||a==="rd"||a==="th")&&(a=""),(a==="m"||a==="M")&&(i*=1e6,a=""),(a==="k"||a==="k")&&(i*=1e3,a=""),i=n?1/i:i,{prefix:r[1]||"",num:i,suffix:a}}return null},fA=function(t){var e=t.text("reduced"),n=/[0-9],[0-9]/.test(t.text("text")),r=mA(e,t);if(r!==null)return r.hasComma=n,r;var i=t.match("#Fraction #Fraction+$");i=i.found===!1?t.match("^#Fraction$"):i;var a=null;i.found&&(a=jt(i),t=t.not(i),t=t.not("and$"),e=t.text("reduced"));var s=0;return e&&(s=fi(e)||0),a&&a.decimal&&(s+=a.decimal),{hasComma:n,prefix:"",num:s,suffix:""}},Ne=fA,hA=function(t,e,n){if(t!==!1){var r=e.lookAhead("^(#Unit|#Noun)");r.has("(#Address|#Money|#Percent)")||e.has("#Ordinal")||(n.num===1?r.nouns().toSingular():r.has("#Singular")&&r.nouns().toPlural())}},il=hA,yA=function(t){if(t<1e6)return String(t);var e;return typeof t=="number"?e=t.toFixed(0):e=t,e.indexOf("e+")===-1?e:e.replace(".","").split("e+").reduce(function(n,r){return n+Array(r-n.length+2).join(0)})},yi=yA,bi=[["ninety",90],["eighty",80],["seventy",70],["sixty",60],["fifty",50],["forty",40],["thirty",30],["twenty",20]],$b=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],bA=[[1e24,"septillion"],[1e20,"hundred sextillion"],[1e21,"sextillion"],[1e20,"hundred quintillion"],[1e18,"quintillion"],[1e17,"hundred quadrillion"],[1e15,"quadrillion"],[1e14,"hundred trillion"],[1e12,"trillion"],[1e11,"hundred billion"],[1e9,"billion"],[1e8,"hundred million"],[1e6,"million"],[1e5,"hundred thousand"],[1e3,"thousand"],[100,"hundred"],[1,"one"]],gA=function(t){var e=t,n=[];return bA.forEach(function(r){if(t>=r[0]){var i=Math.floor(e/r[0]);e-=i*r[0],i&&n.push({unit:r[1],count:i})}}),n},vA=function(t){var e=[];if(t>100)return e;for(var n=0;n<bi.length;n++)t>=bi[n][1]&&(t-=bi[n][1],e.push(bi[n][0]));return $b[t]&&e.push($b[t]),e},CA=function(t){var e=["zero","one","two","three","four","five","six","seven","eight","nine"],n=[],r=yi(t),i=r.match(/\.([0-9]+)/);if(!i||!i[0])return n;n.push("point");for(var a=i[0].split(""),s=0;s<a.length;s++)n.push(e[a[s]]);return n},TA=function(t){if(t===0||t==="0")return"zero";t>1e21&&(t=yi(t));var e=[];t<0&&(e.push("minus"),t=Math.abs(t));for(var n=gA(t),r=0;r<n.length;r++){var i=n[r].unit;i==="one"&&(i="",e.length>1&&e.push("and")),e=e.concat(vA(n[r].count)),e.push(i)}return e=e.concat(CA(t)),e=e.filter(function(a){return a}),e.length===0&&(e[0]=""),e.join(" ")},Qn=TA,NA=function(t){if(!t&&t!==0)return null;var e=t%100;if(e>10&&e<20)return String(t)+"th";var n={0:"th",1:"st",2:"nd",3:"rd"},r=yi(t),i=r.slice(r.length-1,r.length);return n[i]?r+=n[i]:r+="th",r},xA=NA,zb={one:"first",two:"second",three:"third",five:"fifth",eight:"eighth",nine:"ninth",twelve:"twelfth",twenty:"twentieth",thirty:"thirtieth",forty:"fortieth",fourty:"fourtieth",fifty:"fiftieth",sixty:"sixtieth",seventy:"seventieth",eighty:"eightieth",ninety:"ninetieth"},VA=function(t){var e=Qn(t).split(" "),n=e[e.length-1];return zb.hasOwnProperty(n)?e[e.length-1]=zb[n]:e[e.length-1]=n.replace(/y$/,"i")+"th",e.join(" ")},jb=VA,wA={"\xA2":"cents",$:"dollars","\xA3":"pounds","\xA5":"yen","\u20AC":"euros","\u20A1":"col\xF3n","\u0E3F":"baht","\u20AD":"kip","\u20A9":"won","\u20B9":"rupees","\u20BD":"ruble","\u20BA":"liras"},DA={"%":"percent",s:"seconds",cm:"centimetres",km:"kilometres"},Hb={prefixes:wA,suffixes:DA},qb=Hb.prefixes,Kb=Hb.suffixes,AA={usd:!0,eur:!0,jpy:!0,gbp:!0,cad:!0,aud:!0,chf:!0,cny:!0,hkd:!0,nzd:!0,kr:!0,rub:!0},Wb=function(t){return qb.hasOwnProperty(t.prefix)&&(t.suffix+=qb[t.prefix],t.prefix=""),Kb.hasOwnProperty(t.suffix)&&(t.suffix=Kb[t.suffix]),AA.hasOwnProperty(t.suffix)&&(t.suffix=t.suffix.toUpperCase()),t.suffix&&(t.suffix=" "+t.suffix),t},SA=function(t,e,n){var r=String(t.num);return e?(t=Wb(t),n?(r=jb(r),"".concat(t.prefix||"").concat(r).concat(t.suffix||"")):(r=Qn(r),"".concat(t.prefix||"").concat(r).concat(t.suffix||""))):n?(r=xA(r),t=Wb(t),"".concat(t.prefix||"").concat(r).concat(t.suffix||"")):(t.hasComma===!0&&(r=t.num.toLocaleString()),r=yi(r),"".concat(t.prefix||"").concat(r).concat(t.suffix||""))},ze=SA,We={json:function(t){var e=null;typeof t=="number"&&(e=t,t=null),t=t||{text:!0,normal:!0,trim:!0,terms:!0};var n=[];return this.forEach(function(r){var i=r.json(t)[0],a=Ne(r);i.prefix=a.prefix,i.number=a.num,i.suffix=a.suffix,i.cardinal=ze(a,!1,!1),i.ordinal=ze(a,!1,!0),i.textCardinal=ze(a,!0,!1),i.textOrdinal=ze(a,!0,!0),n.push(i)}),e!==null?n[e]:n},units:function(){var t=this.lookAhead("(#Unit|#Noun)+");return t=t.splitAfter("@hasComma").first(),t=t.not("#Pronoun"),t.first()},isOrdinal:function(){return this.if("#Ordinal")},isCardinal:function(){return this.if("#Cardinal")},toNumber:function(){return this.forEach(function(t){var e=Ne(t);if(e.num!==null){var n=ze(e,!1,t.has("#Ordinal"));t.replaceWith(n,!0),t.tag("NumericValue")}}),this},toLocaleString:function(){return this.forEach(function(t){var e=Ne(t);if(e.num!==null){e.num=e.num.toLocaleString();var n=ze(e,!1,t.has("#Ordinal"));t.replaceWith(n,!0)}}),this},toText:function(){return this.forEach(function(t){var e=Ne(t);if(e.num!==null){var n=ze(e,!0,t.has("#Ordinal"));t.replaceWith(n,!0),t.tag("TextValue")}}),this},toCardinal:function(t){var e=this.if("#Ordinal");return e.forEach(function(n){var r=Ne(n);if(r.num!==null){var i=ze(r,n.has("#TextValue"),!1);if(n.has("#NumberRange")){var a=n.termList()[0];a.text&&a.post===""&&(a.post=" ")}n.replaceWith(i,!0),n.tag("Cardinal"),il(t,n,r)}}),this},toOrdinal:function(){var t=this,e=this.if("#Cardinal");return e.forEach(function(n){var r=Ne(n);if(r.num!==null){var i=ze(r,n.has("#TextValue"),!0);if(n.has("#NumberRange")){var a=n.termList()[0];a.text&&a.post===""&&(a.post=" ")}n.replaceWith(i,!0),n.tag("Ordinal");var s=t.lookAhead("^#Plural");s.found&&s.nouns().toSingular()}}),this},isEqual:function(t){return this.filter(function(e){var n=Ne(e).num;return n===t})},greaterThan:function(t){return this.filter(function(e){var n=Ne(e).num;return n>t})},lessThan:function(t){return this.filter(function(e){var n=Ne(e).num;return n<t})},between:function(t,e){return this.filter(function(n){var r=Ne(n).num;return r>t&&r<e})},set:function(t,e){return t===void 0?this:(typeof t=="string"&&(t=fi(t)),this.forEach(function(n){var r=Ne(n);if(r.num=t,r.num!==null){var i=ze(r,n.has("#TextValue"),n.has("#Ordinal"));n=n.not("#Currency"),n.replaceWith(i,!0),il(e,n,r)}}),this)},add:function(t,e){return t?(typeof t=="string"&&(t=fi(t)),this.forEach(function(n){var r=Ne(n);if(r.num!==null){r.num+=t;var i=ze(r,n.has("#TextValue"),n.has("#Ordinal"));n=n.not("#Currency"),n.replaceWith(i,!0),il(e,n,r)}}),this):this},subtract:function(t,e){return this.add(t*-1,e)},increment:function(t){return this.add(1,t),this},decrement:function(t){return this.add(-1,t),this},romanNumerals:function(t){var e=this.match("#RomanNumeral").numbers();return typeof t=="number"&&(e=e.get(t)),e},normalize:function(){var t={"%":!0};return this.forEach(function(e){var n=Ne(e);if(n.num!==null&&n.suffix&&t[n.suffix]!==!0){var r=n.prefix||"";e=e.replaceWith(r+n.num+" "+n.suffix);return}}),this},get:function(t){var e=[];return this.forEach(function(n){e.push(Ne(n).num)}),t!==void 0?e[t]||null:e||null}};We.toNice=We.toLocaleString;We.isBetween=We.between;We.minus=We.subtract;We.plus=We.add;We.equals=We.isEqual;var IA=We,al=function(t){var e=Ne(t).num;return typeof e=="number"?e/100:null},PA={get:function(t){var e=[];return this.forEach(function(n){var r=al(n);r!==null&&e.push(r)}),t!==void 0?e[t]||null:e||null},json:function(t){var e=null;typeof t=="number"&&(e=t,t=null),t=t||{text:!0,normal:!0,trim:!0,terms:!0};var n=[];return this.forEach(function(r){var i=r.json(t)[0],a=al(r);if(i.number=a,a!==null){var s=a*100;i.textNumber="".concat(s," percent"),i.cardinal="".concat(s,"%")}n.push(i)}),e!==null?n[e]||{}:n},toFraction:function(){var t=this;return this.forEach(function(e){var n=al(e);if(n!==null){n*=100,n=Math.round(n*100)/100;var r="".concat(n,"/100");t.replace(e,r)}}),this}},er=[{dem:"american",name:"dollar",iso:"usd",sub:"cent",sym:["$","US$","U$"]},{name:"euro",iso:"eur",sub:"cent",sym:["\u20AC"]},{dem:"british",name:"pound",iso:"gbp",sub:"penny",alias:{sterling:!0},sym:["\xA3"]},{name:"renminbi",iso:"cny",plural:"yu\xE1n",alias:{yuan:!0},sym:["\u5143"]},{dem:"japanese",name:"yen",iso:"jpy",sub:"sen",sym:["\xA5","\u5186","\u5713"]},{dem:"swedish",name:"krona",iso:"sek",sub:"\xF6re",alias:{ore:!0,kronor:!0},sym:["kr"]},{dem:"estonian",name:"kroon",iso:"eek",sub:"sent",sym:["kr"]},{dem:"norwegian",name:"krone",iso:"nok",sub:"\xF8re",sym:["kr"]},{dem:"icelandic",name:"kr\xF3na",iso:"isk",sym:["kr"]},{dem:"danish",name:"krone",iso:"dkk",sub:"\xF8re",sym:["kr."]},{dem:"zambian",name:"kwacha",iso:"zmw",sub:"ngwee",sym:["K"]},{dem:"malawian",name:"kwacha",iso:"mwk",sub:"tambala",sym:["K"]},{dem:"greek",name:"drachma",iso:"grd",sub:"lept\u03BFn",sym:["\u0394\u03C1\u03C7.","\u0394\u03C1.","\u20AF"]},{dem:"eastern caribbean",name:"dollar",iso:"xcd",sub:"cent",sym:["$"]},{dem:"finnish",name:"markka",iso:"fim",sub:"penni",sym:["mk"]},{dem:"polish",name:"z\u0142oty",iso:"pln",sub:"grosz",sym:["z\u0142"]},{dem:"slovenian",name:"tolar",iso:"sit",sub:"stotin",sym:[]},{dem:"australian",name:"dollar",iso:"aud",sub:"cent",sym:["$","A$","AU$"]},{dem:"deutsche",name:"mark",iso:"dem",sub:"pfennig",sym:["DM"]},{dem:"thai",name:"baht",iso:"thb",sub:"satang",sym:["\u0E3F"]},{dem:"canadian",name:"dollar",iso:"cad",sub:"cent",sym:["$","Can$","C$","CA$","CAD"]},{dem:"mexican",name:"peso",iso:"mxn",sub:"centavo",sym:["$","Mex$"]},{dem:"spanish",name:"peseta",iso:"esp",sub:"c\xE9ntimo",sym:["Pta"]},{dem:"new zealand",name:"dollar",iso:"nzd",sub:"cent",sym:["$","NZ$"]},{dem:"chilean",name:"peso",iso:"clp",sub:"centavo",sym:["Cifr\xE3o","$"]},{dem:"nigerian",name:"naira",iso:"ngn",sub:"kobo",sym:["\u20A6"]},{dem:"austrian",name:"schilling",iso:"ats",sub:"groschen",sym:["S","\xF6S"]},{dem:"guatemalan",name:"quetzal",iso:"gtq",sub:"centavo",sym:["Q"]},{dem:"philippine",name:"peso",iso:"php",sub:"sentimo",sym:["\u20B1"]},{dem:"hungarian",name:"forint",iso:"huf",sym:["Ft"]},{dem:"russian",name:"ruble",iso:"rub",sub:"kopeyka",sym:["\u20BD","\u0440\u0443\u0431","\u0440."]},{dem:"kuwaiti",name:"dinar",iso:"kwd",sub:"fils",sym:["\u062F.\u0643","KD"]},{dem:"israeli",name:"new shekel",iso:"ils",sub:"agora",sym:["\u20AA"]},{dem:"latvian",name:"lats",iso:"lvl",sub:"sant\u012Bms",sym:["Ls"]},{dem:"kazakhstani",name:"tenge",iso:"kzt",sub:"t\u0131yn",sym:["\u20B8"]},{dem:"iraqi",name:"dinar",iso:"iqd",sub:"fils",sym:["\u062F.\u0639"]},{dem:"bahamian",name:"dollar",iso:"bsd",sub:"cent",sym:["$","B$"]},{dem:"seychellois",name:"rupee",iso:"scr",sub:"cent",sym:["SCR","SR"]},{dem:"albanian",name:"lek",iso:"all",sub:"qindark\xEB",sym:["L"]},{dem:"bulgarian",name:"lev",iso:"bgn",sub:"stotinka",sym:["\u043B\u0432."]},{dem:"irish",name:"pound",iso:"iep",sym:["\xA3","IR\xA3"]},{name:"cfp franc",iso:"xpf",sym:["f"]},{dem:"south african",name:"rand",iso:"zar",sub:"cent",sym:["R"]},{dem:"south korean",name:"won",iso:"krw",sub:"jeon",plural:"won",sym:["\u20A9"]},{dem:"north korean",name:"won",iso:"kpw",sub:"chon",plural:"won",sym:["\u20A9"]},{dem:"portuguese",name:"escudo",iso:"pte",sub:"centavo",sym:[]},{dem:"ghanaian",name:"cedi",iso:"ghs",sub:"pesewa",sym:["GH\u20B5"]},{dem:"hong kong",name:"dollar",iso:"hkd",sub:"\u6BEB",sym:["$"]},{dem:"new taiwan",name:"dollar",iso:"twd",sub:"dime",sym:["NT$"]},{dem:"east german",name:"mark",iso:"ddm",sub:"pfennig",sym:["M"]},{dem:"namibian",name:"dollar",iso:"nad",sub:"cent",sym:["$"]},{dem:"malaysian",name:"ringgit",iso:"myr",sub:"sen",sym:["RM"]},{dem:"swiss",name:"franc",iso:"chf",sym:["Rp."]},{dem:"panamanian",name:"balboa",iso:"pab",sub:"cent\xE9simo",sym:["B/."]},{dem:"indonesian",name:"rupiah",iso:"idr",sub:"sen",sym:["Rp"]},{dem:"brunei",name:"dollar",iso:"bnd",sub:"sen",sym:["$","B$"]},{dem:"venezuelan",name:"bol\xEDvar",iso:"vef",sub:"c\xE9ntimo",sym:["Bs.F","Bs."]},{dem:"macedonian",name:"denar",iso:"mkd",sub:"deni",sym:["den"]},{dem:"mauritanian",name:"ouguiya",iso:"mru",sub:"khoums",sym:["UM"]},{dem:"argentine",name:"peso",iso:"ars",sub:"centavo",sym:["$"]},{dem:"libyan",name:"dinar",iso:"lyd",sub:"dirham",sym:["LD","\u0644.\u062F"]},{dem:"jordanian",name:"dinar",iso:"jod",sub:"dirham",sym:["\u062F.\u0623"]},{dem:"french",name:"franc",iso:"frf",sub:"centime",sym:["F","Fr","FF","\u20A3"]},{dem:"syrian",name:"pound",iso:"syp",sub:"piastre",sym:["LS","\xA3S"]},{dem:"belize",name:"dollar",iso:"bzd",sub:"cent",sym:["$"]},{dem:"saudi",name:"riyal",iso:"sar",sub:"halalah",sym:["SAR","\u0631.\u0633"," \uFDFC"]},{dem:"surinamese",name:"dollar",iso:"srd",sub:"cent",sym:["$"]},{dem:"singapore",name:"dollar",iso:"sgd",sub:"cent",sym:["S$","$"]},{dem:"nepalese",name:"rupee",iso:"npr",sub:"paisa",sym:["\u0930\u0941 \u20A8","Re"]},{dem:"nicaraguan",name:"c\xF3rdoba",iso:"nio",sub:"centavo",sym:["C$"]},{dem:"bangladeshi",name:"taka",iso:"bdt",sub:"poysha",sym:["\u09F3"]},{dem:"indian",name:"rupee",iso:"inr",sub:"paisa",sym:["\u20B9"]},{dem:"maldivian",name:"rufiyaa",iso:"mvr",sub:"laari",sym:["Rf","MRf","MVR",".\u0783 "]},{dem:"sri lankan",name:"rupee",iso:"lkr",sub:"cents",sym:["Rs","\u0DBB\u0DD4","\u0BB0\u0BC2"]},{dem:"bhutanese",name:"ngultrum",iso:"btn",sub:"chhertum",sym:["Nu."]},{dem:"turkish",name:"lira",iso:"try",sub:"kuru\u015F",sym:["YTL"]},{dem:"serbian",name:"dinar",iso:"rsd",sub:"para",sym:["din","\u0434\u0438\u043D"]},{dem:"bosnia and herzegovina",name:"convertible mark",iso:"bam",sub:"fening",sym:["KM"]},{dem:"botswana",name:"pula",iso:"bwp",sub:"thebe",sym:["p"]},{dem:"swazi",name:"lilangeni",iso:"szl",sub:"cent",sym:["L","E"]},{dem:"lithuanian",name:"litas",iso:"ltl",sub:"centas",sym:["Lt","ct"]},{dem:"mauritian",name:"rupee",iso:"mur",sub:"cent",sym:["\u20A8"]},{dem:"pakistani",name:"rupee",iso:"pkr",sub:"paisa",sym:["\u20A8"]},{dem:"maltese",name:"lira",iso:"mtl",sub:"cent",sym:["\u20A4","Lm"]},{dem:"cypriot",name:"pound",iso:"cyp",sub:"cent",sym:["\xA3"]},{dem:"moldovan",name:"leu",iso:"mdl",sym:["l"]},{dem:"croatian",name:"kuna",iso:"hrk",sub:"lipa",sym:["kn"]},{dem:"afghan",name:"afghani",iso:"afn",sub:"pul",sym:["\u060B","Af","Afs"]},{dem:"ecuadorian",name:"sucre",iso:"ecs",sub:"centavo",sym:["S/."]},{dem:"sierra leonean",name:"leone",iso:"sll",sub:"cent",sym:["Le"]}],Lt={},Ub={};er.forEach(function(u){u.sym.forEach(function(t){Lt[t]=Lt[t]||u.iso}),Lt[u.iso]=Lt[u.iso]||u.iso,u.sub&&(Ub[u.sub]=!0)});var Gb="(".concat(Object.keys(Ub).join("|"),")"),OA=function(t){var e=t.match("#Currency+");e.nouns().toSingular();var n=e.text("reduced");return er.find(function(r){return n==="".concat(r.dem," ").concat(r.name)||n===r.iso||n===r.sub||n===r.name||r.alias&&r.alias[n]===!0?r:!1})},LA=function(t){return t.suffix&&Lt.hasOwnProperty(t.suffix)?er.find(function(e){return e.iso===Lt[t.suffix]}):t.prefix&&Lt.hasOwnProperty(t.prefix)?er.find(function(e){return e.iso===Lt[t.prefix]}):null},RA=function(t){var e=0,n=t.match("and #Money+ ".concat(Gb));if(n.found){t=t.not(n);var r=Ne(n.match("#Value+"));r&&r.num&&(e=r.num/100)}var i=Ne(t),a=i.num||0;a+=e;var s=LA(i)||OA(t)||{},o="";return s&&s.sym&&(o=s.sym[0],a&&t.has("".concat(Gb))&&(a=a/100)),{num:a,iso:s.iso,demonym:s.dem,currency:s.name,plural:s.plural,symbol:o}},sl=RA,Xb=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return t.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},FA={get:function(t){var e=[];return this.forEach(function(n){e.push(sl(n))}),t!==void 0?e[t]||null:e||null},currency:function(t){var e=[];return this.forEach(function(n){var r=sl(n);r&&e.push(r)}),typeof t=="number"?e[t]||null:e||null},json:function(t){var e=null;typeof t=="number"&&(e=t,t=null),t=t||{text:!0,normal:!0,trim:!0,terms:!0};var n=[];return this.forEach(function(r){var i=r.json(t)[0],a=sl(r);if(i.number=a.num,a.iso&&(i.iso=a.iso.toUpperCase(),i.symbol=a.symbol,i.currency=Xb(a.demonym)+" "+Xb(a.currency)),i.textFmt=ze(a,!0,!1),a.currency){var s=a.currency;a.num!==1&&(s=a.plural||s+"s"),i.textFmt+=" "+s}n.push(i)}),e!==null?n[e]||{}:n}},kA=FA,MA=function(t){if(!t.numerator||!t.denominator)return"";var e=Qn(t.numerator),n=jb(t.denominator);return t.denominator===2&&(n="half"),e&&n?(t.numerator!==1&&(n+="s"),"".concat(e," ").concat(n)):""},_A=function(t){if(!t.numerator||!t.denominator)return"";var e=Qn(t.numerator),n=Qn(t.denominator);return"".concat(e," out of ").concat(n)},BA=function(t){return t.decimal},tr={toText:MA,textCardinal:_A,toDecimal:BA},ol={get:function(t){var e=[];return this.forEach(function(n){e.push(jt(n))}),t!==void 0?e[t]||null:e||null},toDecimal:function(){return this.forEach(function(t){var e=jt(t);if(e){var n=tr.toDecimal(e);t.replaceWith(String(n),!0),t.tag("NumericValue"),t.unTag("Fraction")}}),this},json:function(t){var e=null;typeof t=="number"&&(e=t,t=null),t=t||{text:!0,normal:!0,trim:!0,terms:!0};var n=[];return this.forEach(function(r){var i=r.json(t)[0],a=jt(r)||{},s=tr.toDecimal(a);i.numerator=a.numerator,i.denominator=a.denominator,i.number=s,i.textOrdinal=tr.toText(a),i.textCardinal=tr.textCardinal(a),n.push(i)}),e!==null?n[e]||{}:n},normalize:function(){var t=this;return this.forEach(function(e){var n=jt(e);if(n&&typeof n.numerator=="number"&&typeof n.denominator=="number"){var r="".concat(n.numerator,"/").concat(n.denominator);t.replace(e,r)}}),this},toText:function(t){var e=[];return this.forEach(function(n){var r=jt(n)||{},i=tr.toText(r);n.replaceWith(i,!0),n.tag("Fraction")}),t!==void 0?e[t]:e},toPercentage:function(){var t=this;return this.forEach(function(e){var n=jt(e);if(n.decimal||n.decimal===0){var r=n.decimal*100;r=Math.round(r*100)/100,t.replace(e,"".concat(r,"%"))}}),this}};ol.toNumber=ol.toDecimal;var EA=ol,$A="(hundred|thousand|million|billion|trillion|quadrillion|quintillion|sextillion|septillion)",Zb="fraction-tagger",zA=function(t){return t.match($A).tag("#Multiple",Zb),t.match("[(half|quarter)] of? (a|an)",0).tag("Fraction","millionth"),t.match("#Adverb [half]",0).tag("Fraction","nearly-half"),t.match("[half] the",0).tag("Fraction","half-the"),t.match("#Value (halves|halfs|quarters)").tag("Fraction","two-halves"),t.match("a #Ordinal").tag("Fraction","a-quarter"),t.match("(#Fraction && /s$/)").lookBefore("#Cardinal+$").tag("Fraction"),t.match("[#Cardinal+ #Ordinal] of .",0).tag("Fraction","ordinal-of"),t.match("[(#NumericValue && #Ordinal)] of .",0).tag("Fraction","num-ordinal-of"),t.match("(a|one) #Cardinal?+ #Ordinal").tag("Fraction","a-ordinal"),t.match("#Cardinal+ out? of every? #Cardinal").tag("Fraction",Zb),t},jA=zA,HA=function(t){var e="money-tagger";t.match("#Money and #Money #Currency?").tag("Money","money-and-money"),t.match("#Money").not("#TextValue").match("/\\.[0-9]{3}$/").unTag("#Money","three-decimal money"),t.ifNo("#Value").match("#Currency #Verb").unTag("Currency","no-currency"),t.match("#Value #Currency [and] #Value (cents|ore|centavos|sens)",0).tag("Money",e);var n=t.match("[<num>#Value] [<currency>(mark|rand|won|rub|ore)]");return n.group("num").tag("Money",e),n.group("currency").tag("Currency",e),t},qA=HA,Jb="number-tag",KA=function(t){t=qA(t),t.match("the [/[0-9]+s$/]").tag("#Plural",Jb),t.match("half a? #Value").tag("Value","half-a-value"),t.match("#Value [and a (half|quarter)]",0).tag(["TextValue","#Fraction"],"value-and-a-half"),t=jA(t),t.match("#Cardinal and #Fraction #Fraction").tag("Value",Jb)},WA=KA,UA={Fraction:{isA:["Value"]},Multiple:{isA:"Value"}},Yb={mark:!0,sucre:!0,leone:!0,afghani:!0,rand:!0,try:!0,mop:!0,won:!0,all:!0,rub:!0,eek:!0,sit:!0,bam:!0,npr:!0,leu:!0},Ht={kronor:"Currency"};er.forEach(function(u){u.iso&&!Yb[u.iso]&&(Ht[u.iso]=["Acronym","Currency"]);var t=u.name;if(t&&!Yb[t]&&(Ht[t]="Currency",Ht[t+"s"]="Currency"),u.dem){var e=u.dem;Ht["".concat(e," ").concat(t)]="Currency",Ht["".concat(e," ").concat(t,"s")]="Currency"}u.sub&&(Ht[u.sub]="Currency")});var GA=Ht,XA=function(t,e){e.addWords(GA),e.addTags(UA),e.postProcess(WA);var n=function(o){ci(c,o);var l=pi(c);function c(){return ui(this,c),l.apply(this,arguments)}return c}(t);Object.assign(n.prototype,IA);var r=function(o){ci(c,o);var l=pi(c);function c(){return ui(this,c),l.apply(this,arguments)}return c}(n);Object.assign(r.prototype,kA);var i=function(o){ci(c,o);var l=pi(c);function c(){return ui(this,c),l.apply(this,arguments)}return c}(n);Object.assign(i.prototype,EA);var a=function(o){ci(c,o);var l=pi(c);function c(){return ui(this,c),l.apply(this,arguments)}return c}(n);Object.assign(a.prototype,PA);var s={numbers:function(l){var c=K1(this,l);return new n(c.list,this,this.world)},percentages:function(l){var c=X1(this,l);return new a(c.list,this,this.world)},fractions:function(l){var c=U1(this,l);return new i(c.list,this,this.world)},money:function(l){var c=z1(this,l);return new r(c.list,this,this.world)}};return s.values=s.numbers,s.percents=s.percentages,Object.assign(t.prototype,s),t},ZA=XA,Qb=ZA;li.extend(Qb);var ll=class extends z{static componentType="pluralize";static rendererType="text";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.pluralForm={default:null},e.basedOnNumber={default:null},e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return st({stateVariableDefinitions:t,oldName:"value",newName:"valuePrePluralize"}),t.value={public:!0,componentType:"text",forRenderer:!0,returnDependencies:()=>({valuePrePluralize:{dependencyType:"stateVariable",variableName:"valuePrePluralize"},pluralForm:{dependencyType:"stateVariable",variableName:"pluralForm"},basedOnNumber:{dependencyType:"stateVariable",variableName:"basedOnNumber"}}),definition:function({dependencyValues:e}){let n=li(e.valuePrePluralize),r=n.values().toNumber().all().terms().json();if(r.length===0)return{newValues:{value:e.valuePrePluralize}};let i;if(e.basedOnNumber!==null&&(i=eg(e.basedOnNumber)),r.length===1)return i===void 0&&(i=!0),i?e.pluralForm!==null?{newValues:{value:e.pluralForm}}:{newValues:{value:n.nouns().toPlural().all().out("text")}}:{newValues:{value:e.valuePrePluralize}};if(i===void 0){let s=[],o=[],l=n.nouns().json();for(let[p,m]of r.entries()){let f=l[s.length];m.terms[0].tags.includes("Value")&&o.push(p),f!==void 0&&f.text===m.text&&s.push(p)}i=[];let c=n.values().numbers().json(),d=-1;for(let p of s){for(;Number(o[d+1])<Number(p);)d++;c[d]&&eg(Number(c[d].normal))?i.push(!0):i.push(!1)}}if(i===!1)return{newValues:{value:e.valuePrePluralize}};let a=li(e.valuePrePluralize);if(e.pluralForm!==null)for(let[s,o]of n.nouns().data().entries())(i===!0||i[s]===!0)&&a.replace(o.text,e.pluralForm);else{let s=n.nouns().json().length;for(let o=0;o<s;o++)(i===!0||i[o]===!0)&&a.nouns(o).toPlural().all()}return{newValues:{value:a.out("text")}}}},t}},tg=ll;function eg(u){return u!==1}var ul=class extends Q{static componentType="feedback";static primaryStateVariableForDefinition="feedbackText";static createPropertiesObject(){let t=super.createPropertiesObject();return delete t.hide,t}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atMostOneCondition",componentType:"condition",comparison:"atMost",number:1,allowSpillover:!1}),r=e.newLeaf({name:"atLeastZeroAnything",componentType:"_base",comparison:"atLeast",number:0});return e.newOperator({name:"ifAndRest",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.hide={forRenderer:!0,returnDependencies:()=>({conditionChild:{dependencyType:"child",childLogicName:"atMostOneCondition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n;return e.conditionChild.length===0?n=!1:n=!e.conditionChild[0].stateValues.value,{newValues:{hide:n}}}},t.feedbackText={forRenderer:!0,defaultValue:null,returnDependencies:()=>({}),definition:()=>({useEssentialOrDefaultValue:{feedbackText:{variablesToCheck:["feedbackText"]}}})},t.childrenToRender={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"atLeastZeroAnything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.children.map(n=>n.componentName)}}}},t}},ng=ul;var cl=class extends Q{static componentType="container";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"anything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}initializeRenderer(){this.renderer===void 0&&(this.renderer=new this.availableRenderers.container({key:this.componentName}))}},rg=cl;var dl=class extends R{static componentType="collaborategroups";static stateVariableForPropertyValue="collaborateGroups";static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastZeroPoints",componentType:"point",comparison:"atLeast",number:0}),r=ur(a=>({componentType:"point",children:[{componentType:"coords",children:a}]})),i=e.newLeaf({name:"exactlyOneString",componentType:"string",number:1,isSugar:!0,logicToWaitOnSugar:["atLeastZeroPoints"],replacementFunction:r});return e.newOperator({name:"pointsXorSugar",operator:"xor",propositions:[i,n],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.collaborateGroups={returnDependencies:()=>({pointChildren:{dependencyType:"child",childLogicName:"atLeastZeroPoints",variableNames:["xs","coords","nDimensions"]}}),definition:function({dependencyValues:e}){let n={};for(let i of e.pointChildren)if(i.stateValues.nDimensions!==2)console.warn(`invalid collaborate group: ${i.stateValues.coords.toString()}`);else{let a=i.stateValues.xs[0].evaluate_to_constant(),s=i.stateValues.xs[1].evaluate_to_constant();Number.isInteger(a)&&a>0&&Number.isInteger(s)&&s>0?(n[a]===void 0&&(n[a]=[]),n[a].push(s)):console.warn(`invalid collaborate group: ${i.stateValues.coords.toString()}`)}return{newValues:{collaborateGroups:{groups:n,matchGroup:function({groupNumber:i,numberOfGroups:a}={}){if(a>1){let s=n[a];return s===void 0?!1:s.includes(i)}else return!0}}}}}},t}},ig=dl;var pl=class extends R{static componentType="collaborateGroupSetup";static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOnePossibleNumberOfGroups",componentType:"possibleNumberOfGroups",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.possibleNumberOfGroups={returnDependencies:()=>({pngChild:{dependencyType:"child",childLogicName:"atMostOnePossibleNumberOfGroups",variableNames:["numbers"]}}),definition:function({dependencyValues:e}){return e.pngChild.length===0?{newValues:{possibleNumberOfGroups:[1]}}:{newValues:{possibleNumberOfGroups:e.pngChild[0].stateValues.numbers}}}},t}},ag=pl;var ml=class extends Q{static componentType="div";static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.width={default:300},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenToRender={returnDependencies:()=>({activeChildren:{dependencyType:"child",childLogicName:"anything"}}),definition:function({dependencyValues:e}){return{newValues:{childrenToRender:e.activeChildren.map(n=>n.componentName)}}}},t}initializeRenderer(){this.renderer===void 0?this.renderer=new this.availableRenderers.div({key:this.componentName,width:this.stateValues.width}):this.updateRenderer()}updateRenderer(){this.renderer.updateDiv({width:this.stateValues.width})}},sg=ml;var fl=class extends Q{static componentType="considerAsResponses";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.childrenWithNValues={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:["nValues"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({newValues:{childrenWithNValues:e.children}})},t.childrenAsResponses={returnDependencies:()=>({children:{dependencyType:"child",childLogicName:"anything",variableNames:["value","values","componentType"],variablesOptional:!0}}),definition:({dependencyValues:e})=>({newValues:{childrenAsResponses:e.children}})},t}},og=fl;var hl=class extends G{static componentType="selectByIndex";static assignNamesToReplacements=!0;static useChildrenForReference=!1;static get stateVariablesShadowedForReference(){return["selectedIndices"]}static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.selectIndices={default:[]},e}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atLeastOneOption",componentType:"option",comparison:"atLeast",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nOptions={additionalStateVariablesDefined:["optionChildren"],returnDependencies:()=>({optionChildren:{dependencyType:"child",childLogicName:"atLeastOneOption"}}),definition({dependencyValues:e}){return{newValues:{optionChildren:e.optionChildren,nOptions:e.optionChildren.length}}}},t.selectedIndices={returnDependencies:()=>({nOptions:{dependencyType:"stateVariable",variableName:"nOptions"},selectIndices:{dependencyType:"stateVariable",variableName:"selectIndices"}}),definition:function({dependencyValues:e}){return e.nOptions===0?{newValues:{selectedIndices:[]}}:{newValues:{selectedIndices:e.selectIndices.filter(i=>Number.isInteger(i)&&i>=1&&i<=e.nOptions).map(i=>i-1)}}}},t.readyToExpand={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition(){return{newValues:{readyToExpand:!0}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){let i=this.getReplacements(t,e,r);return t.stateValues.needsReplacementsUpdatedWhenStale,n.previousSelectedIndices=[...t.stateValues.selectedIndices],{replacements:i}}static getReplacements(t,e,n){let r=[];for(let a of t.stateValues.selectedIndices){let s=t.stateValues.optionChildren[a].componentName,o=Z(e[s].state.serializedChildren.value),l={componentType:"option",state:{rendered:!0},doenetAttributes:Object.assign({},e[s].doenetAttributes),children:o,originalName:s};t.stateValues.hide&&(l.state||(l.state={}),l.state.hide=!0),r.push(l)}return U({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:n}).serializedComponents}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:i}){if(t.stateValues.needsReplacementsUpdatedWhenStale,r.previousSelectedIndices.length===t.stateValues.selectedIndices.length&&t.stateValues.selectedIndices.every((l,c)=>l===r.previousSelectedIndices[c]))return[];let a=[],s=this.getReplacements(t,n,i),o={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:s,replacementsToWithhold:0};return a.push(o),r.previousSelectedIndices=[...t.stateValues.selectedIndices],a}},lg=hl;var yl=class extends R{static componentType="case";static rendererType=void 0;static createPropertiesObject(t){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"exactlyOneCondition",componentType:"condition",number:1}),r=e.newLeaf({name:"exactlyOneResult",componentType:"result",number:1});return e.newOperator({name:"conditionAndResult",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.serializedChildren={additionalStateVariablesDefined:["resultChild"],returnDependencies:()=>({resultChild:{dependencyType:"child",childLogicName:"exactlyOneResult",variableNames:["serializedChildren"],doNotProxy:!0}}),definition:function({dependencyValues:e}){let n,r;return e.resultChild.length===0?(n=null,r=null):(n=e.resultChild[0].stateValues.serializedChildren,r=Object.assign({},e.resultChild[0]),delete r.stateValues),{newValues:{serializedChildren:n,resultChild:r}}}},t.conditionSatisfied={public:!0,componentType:"boolean",returnDependencies:()=>({conditionChild:{dependencyType:"child",childLogicName:"exactlyOneCondition",variableNames:["value"]}}),definition:function({dependencyValues:e}){let n;return e.conditionChild.length===0?n=!1:n=e.conditionChild[0].stateValues.value,{newValues:{conditionSatisfied:n}}}},t}},ug=yl;var bl=class extends G{static componentType="selectByCondition";static assignNamesToReplacements=!0;static createPropertiesObject(t){let e=super.createPropertiesObject(t);return e.maximumNumberToSelect={default:null},e}static returnChildLogic(t){let e=super.returnChildLogic(t),n=e.newLeaf({name:"atLeastOneCase",componentType:"case",comparison:"atLeast",number:1}),r=e.newLeaf({name:"atMostOneElse",componentType:"else",comparison:"atMost",number:1});return e.newOperator({name:"casesAndElse",operator:"and",propositions:[n,r],setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.nCases={additionalStateVariablesDefined:["caseChildren"],returnDependencies:()=>({caseChildren:{dependencyType:"child",childLogicName:"atLeastOneCase"}}),definition({dependencyValues:e}){return{newValues:{caseChildren:e.caseChildren,nCases:e.caseChildren.length}}}},t.elseChild={returnDependencies:()=>({elseChild:{dependencyType:"child",childLogicName:"atMostOneElse"}}),definition({dependencyValues:e}){let n=null;return e.elseChild.length===1&&(n=e.elseChild[0]),{newValues:{elseChild:n}}}},t.selectedIndices={returnDependencies:()=>({caseChildren:{dependencyType:"child",childLogicName:"atLeastOneCase",variableNames:["conditionSatisfied"]},elseChild:{dependencyType:"stateVariable",variableName:"elseChild"},maximumNumberToSelect:{dependencyType:"stateVariable",variableName:"maximumNumberToSelect"}}),definition({dependencyValues:e}){let n=[];for(let[r,i]of e.caseChildren.entries())i.stateValues.conditionSatisfied&&n.push(r);if(n.length===0&&e.elseChild&&n.push(e.caseChildren.length),e.maximumNumberToSelect!==null&&n.length>e.maximumNumberToSelect){let r=Math.max(0,Math.floor(e.maximumNumberToSelect));n=n.slice(0,r)}return{newValues:{selectedIndices:n}}}},t.readyToExpand={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),definition(){return{newValues:{readyToExpand:!0}}}},t.needsReplacementsUpdatedWhenStale={returnDependencies:()=>({selectedIndices:{dependencyType:"stateVariable",variableName:"selectedIndices"}}),markStale:()=>({updateReplacements:!0}),definition:()=>({newValues:{needsReplacementsUpdatedWhenStale:!0}})},t}static createSerializedReplacements({component:t,components:e,workspace:n,componentInfoObjects:r}){let i=this.getReplacements(t,e,r);return t.stateValues.needsReplacementsUpdatedWhenStale,n.previousSelectedIndices=[...t.stateValues.selectedIndices],{replacements:i}}static getReplacements(t,e,n){let r=[];for(let a of t.stateValues.selectedIndices){let s,o={};a<t.stateValues.nCases?(s=t.stateValues.caseChildren[a].componentName,o.componentType="result",o.componentName=e[s].stateValues.resultChild.componentName):(s=o.componentName=t.stateValues.elseChild.componentName,o.componentType="else");let l=Z(e[s].state.serializedChildren.value),c={componentType:o.componentType,state:{rendered:!0},doenetAttributes:Object.assign({},e[o.componentName].doenetAttributes),children:l,originalName:o.componentName};t.stateValues.hide&&(c.state||(c.state={}),c.state.hide=!0),r.push(c)}return U({assignNames:t.doenetAttributes.assignNames,serializedComponents:r,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:n}).serializedComponents}static calculateReplacementChanges({component:t,componentChanges:e,components:n,workspace:r,componentInfoObjects:i}){if(t.stateValues.needsReplacementsUpdatedWhenStale,r.previousSelectedIndices.length===t.stateValues.selectedIndices.length&&r.previousSelectedIndices.every((l,c)=>l===t.stateValues.selectedIndices[c]))return[];let a=[],s=this.getReplacements(t,n,i),o={changeType:"add",changeTopLevelReplacements:!0,firstReplacementInd:0,numberReplacementsToReplace:t.replacements.length,serializedReplacements:s,replacementsToWithhold:0};return a.push(o),r.previousSelectedIndices=[...t.stateValues.selectedIndices],console.log(`replacementChanges for if ${t.componentName}`),console.log(a),a}},cg=bl;var gl=class extends G{static componentType="empty";static assignNamesToReplacements=!0;static createPropertiesObject(){return{}}static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"anything",componentType:"_base",comparison:"atLeast",number:0,setAsBase:!0}),e}static createSerializedReplacements({component:t,componentInfoObjects:e}){let n=t.doenetAttributes.assignNames;return n===void 0?{replacements:[]}:{replacements:U({assignNames:n,serializedComponents:[],parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:e}).serializedComponents}}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.readyToExpand={returnDependencies:()=>({}),definition:()=>({newValues:{readyToExpand:!0}})},t}},dg=gl;var vl=class extends R{static componentType="bindValueTo";static rendererType=void 0;static returnChildLogic(t){let e=super.returnChildLogic(t);return e.newLeaf({name:"atMostOneChild",componentType:"_base",comparison:"atMost",number:1,setAsBase:!0}),e}static returnStateVariableDefinitions(){let t=super.returnStateVariableDefinitions();return t.value={returnDependencies:()=>({child:{dependencyType:"child",childLogicName:"atMostOneChild",variableNames:["value"],variablesOptional:!0,requireChildLogicInitiallySatisfied:!0}}),definition:function({dependencyValues:e}){if(e.child.length===1){let n=e.child[0];if(n.stateValues.value!==void 0)return{newValues:{value:n.stateValues.value}}}return{newValues:{value:null}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){let r=!1;return n.child.length===1&&n.child[0].stateValues.value!==void 0&&(r=!0),r?{success:!0,instructions:[{setDependency:"child",desiredValue:e.value,childIndex:0,variableIndex:0}]}:{success:!1}}},t.valueForDisplay={returnDependencies:()=>({child:{dependencyType:"child",childLogicName:"atMostOneChild",variableNames:["valueForDisplay"],variablesOptional:!0,requireChildLogicInitiallySatisfied:!0}}),definition:function({dependencyValues:e}){if(e.child.length===1){let n=e.child[0];if(n.stateValues.valueForDisplay!==void 0)return{newValues:{valueForDisplay:n.stateValues.valueForDisplay}}}return{newValues:{valueForDisplay:null}}}},t.text={returnDependencies:()=>({child:{dependencyType:"child",childLogicName:"atMostOneChild",variableNames:["text"],variablesOptional:!0,requireChildLogicInitiallySatisfied:!0}}),definition:function({dependencyValues:e}){if(e.child.length===1){let n=e.child[0];if(typeof n.stateValues.text=="string")return{newValues:{text:n.stateValues.text}}}return{newValues:{text:""}}},inverseDefinition:function({desiredStateVariableValues:e,dependencyValues:n}){let r=!1;return n.child.length===1&&typeof n.child[0].stateValues.text=="string"&&(r=!0),r?{success:!0,instructions:[{setDependency:"child",desiredValue:e.text,childIndex:0,variableIndex:0}]}:{success:!1}}},t}},pg=vl;var gi=[...Object.values(la),...Object.values(ua),...Object.values(ca),...Object.values(fa),...Object.values(ya),...Object.values(va),...Object.values(xa),...Object.values(Va),...Object.values(wa),...Object.values(Aa),...Object.values(Sa),...Object.values(La),...Object.values(Fa),...Object.values($a),...Object.values(za),...Object.values(ja),...Object.values(qa),ff,hf,z,yf,Yt,bf,gf,k,vf,H,Ze,Qt,Cf,Tf,Nf,xf,Nt,Vf,wf,Df,un,dn,Sf,If,Of,Lf,mn,Rf,Ff,fr,kf,Mf,_f,Bf,zl,Ef,$f,zf,jf,Hf,$,ye,qf,Kf,Pn,xr,vr,Mt,fn,Zf,hh,yh,bh,gh,vh,Ar,Jf,uh,Uf,Gf,Yf,Qf,eh,th,nh,rh,ih,ah,sh,oh,lh,ch,dh,ph,mh,Ch,Cr,Nh,At,wh,Dh,Sh,Jh,bn,Qh,ey,ty,ny,ry,iy,ay,sy,oy,ly,uy,tg,ng,rg,ig,ag,sg,og,lg,ug,cg,dg,pg],JA=[...gi,...Object.values(Mi),R,B,Q,le,ge,et,G,El,Xt,pr,mr,rn,kn,He,Je,sn,In,_e,An,Jt,ot,On];function mg(){let u={};for(let t of gi){let e=t.componentType;if(e===void 0)throw Error("Cannot create component as componentType is undefined for class "+t);if(e=e.toLowerCase(),e in u)throw Error("component type "+e+" defined in two classes");if(!/[a-z]/.test(e.substring(0,1)))throw Error("Invalid component type "+e+". Component types must begin with a letter.");u[e]=t}return u}function fg(){let u={};for(let t of JA){let e=t.componentType;if(e===void 0)throw Error("Cannot create component as componentType is undefined for class "+t);if(e=e.toLowerCase(),e in u)throw Error("component type "+e+" defined in two classes");u[e]=t}return u}function hg(){let u={};for(let t of gi)if(t.createsVariants){let e=t.componentType;if(e===void 0)throw Error("Cannot create component as componentType is undefined for class "+t);if(e=e.toLowerCase(),e in u)throw Error("component type "+e+" defined in two classes");u[e]=t}return u}function yg(){let u={};for(let t of gi)if(t.createsVariants||t.setUpVariantIfVariantControlChild||t.alwaysSetUpVariant){let e=t.componentType;if(e===void 0)throw Error("Cannot create component as componentType is undefined for class "+t);if(e=e.toLowerCase(),e in u)throw Error("component type "+e+" defined in two classes");u[e]=t}return u}var Cl=class{constructor(t){this.stack=[{}],t!==void 0&&Object.assign(this.parameters,t)}get parameters(){return this.stack[this.stack.length-1]}push(t,e=!0){let n={};e?(Object.assign(n,this.parameters),t!==void 0&&Object.assign(n,t)):n=t,this.stack.push(n)}pop(){let t=this.stack.pop();return this.stack.length===0&&(this.stack=[{}]),t}},bg=Cl;var Tl=class{constructor({maxIterationsRoot:t=80,maxIterationsMinimize:e=500,eps:n=1e-6}={}){this.maxIterationsRoot=t,this.maxIterationsMinimize=e,this.eps=n}fzero(t,e,n){var r,i,a,s,o,l,c,d,p,m,f,h,y,b,g,T,N,v,C,x,V=this.eps,w=this.maxIterationsRoot,D=0,I=0;if(Array.isArray(e)){if(e.length<2)throw new Error("fzero: length of array x0 has to be at least two.");r=e[0],s=t.call(n,r),I+=1,i=e[1],o=t.call(n,i),I+=1}else{for(r=e,s=t.call(n,r),I+=1,r===0?c=1:c=r,d=[.9*c,1.1*c,c-1,c+1,.5*c,1.5*c,-c,2*c,-10*c,10*c],m=d.length,p=0;p<m&&(i=d[p],o=t.call(n,i),I+=1,!(s*o<=0));p++);i<r&&(f=r,r=i,i=f,h=s,s=o,o=h)}if(s*o>0)return Array.isArray(e)?this.fminbr(t,[r,i],n).x:this.Newton(t,r,n);for(a=r,l=s;D<w;){if(y=i-r,Math.abs(l)<Math.abs(o)&&(r=i,i=a,a=r,s=o,o=l,l=s),N=2*V*Math.abs(i)+V*.5,x=(a-i)*.5,Math.abs(x)<=N&&Math.abs(o)<=V)return i;Math.abs(y)>=N&&Math.abs(s)>Math.abs(o)&&(g=a-i,r===a?(b=o/s,v=g*b,C=1-b):(C=s/l,b=o/l,T=o/s,v=T*(g*C*(C-b)-(i-r)*(b-1)),C=(C-1)*(b-1)*(T-1)),v>0?C=-C:v=-v,v<.75*g*C-Math.abs(N*C)*.5&&v<Math.abs(y*C*.5)&&(x=v/C)),Math.abs(x)<N&&(x>0?x=N:x=-N),r=i,s=o,i+=x,o=t.call(n,i),I+=1,(o>0&&l>0||o<0&&l<0)&&(a=r,l=s),D++}return i}fminbr(t,e,n){var r,i,a,s,o,l,c,d,p,m,f,h,y,b,g,T,N=(3-Math.sqrt(5))*.5,v=this.eps,C=this.eps,x=this.maxIterationsMinimize,V=0,w=0;if(!Array.isArray(e)||e.length<2)throw new Error("Numerics.fminbr: length of array x0 has to be at least two.");if(r=e[0],i=e[1],s=r+N*(i-r),c=t.call(n,s),Number.isNaN(c))return{success:!1};for(w+=1,a=s,o=s,l=c,d=c;V<x;){if(p=i-r,m=(r+i)*.5,f=C*Math.abs(a)+v/3,Math.abs(a-m)+p*.5<=2*f)return{success:!0,x:a,fx:l,tol:f};if(h=N*(a<m?i-a:r-a),Math.abs(a-o)>=f&&(g=(a-o)*(l-c),b=(a-s)*(l-d),y=(a-s)*b-(a-o)*g,b=2*(b-g),b>0?y=-y:b=-b,Math.abs(y)<Math.abs(h*b)&&y>b*(r-a+2*f)&&y<b*(i-a-2*f)&&(h=y/b)),Math.abs(h)<f&&(h>0?h=f:h=-f),g=a+h,T=t.call(n,g),Number.isNaN(T))return{success:!1};w+=1,T<=l?(g<a?i=a:r=a,s=o,o=a,a=g,c=d,d=l,l=T):(g<a?r=g:i=g,T<=d||o===a?(s=o,o=g,c=d,d=T):(T<=c||s===a||s===o)&&(s=g,c=T)),V+=1}return{success:!1,x:a,fx:l}}Newton(t,e,n){var r,i=0,a=this.eps,s=t.apply(n,[e]),o=1;for(Array.isArray(e)&&(e=e[0]);i<50&&Math.abs(s)>a;)r=this.D(t,n)(e),o+=2,Math.abs(r)>a?e-=s/r:e+=Math.random()*.2-1,s=t.apply(n,[e]),o+=1,i+=1;return e}D(t,e){return e!=null?function(n){var r=1e-5,i=r*2;return(t(n+r)-t(n-r))/i}:function(n){var r=1e-5,i=r*2;return(t.apply(e,[n+r])-t.apply(e,[n-r]))/i}}},gg=Tl;var Dl=Kt(Cg());import YA from"../_snowpack/pkg/math-expressions.js";function Nl({ancestor:u,descendantClasses:t,recurseToMatchedChildren:e=!0,useReplacementsForComposites:n=!1,compositeClass:r,includeNonActiveChildren:i=!1,includePropertyChildren:a=!1,skipOverAdapters:s=!1,ignoreReplacementsOfMatchedComposites:o=!1,definingChildrenFirst:l=!1,namesToIgnore:c=[],init:d=!0}){let p=[];if(n&&u instanceof r)d&&p.push(...xl({composite:u,compositeClass:r,includeComposites:i}));else{if(i&&l)for(let h of u.definingChildren)(a||!h.doenetAttributes.isPropertyChild)&&p.push(h);if(u.activeChildren)for(let h of u.activeChildren)(a||!h.doenetAttributes.isPropertyChild)&&(p.map(y=>y.componentName).includes(h.componentName)||p.push(h));if(i){if(!l)for(let h of u.definingChildren)(a||!h.doenetAttributes.isPropertyChild)&&(p.map(y=>y.componentName).includes(h.componentName)||p.push(h));if(u.allChildren)for(let h in u.allChildren){let y=u.allChildren[h];if(y.definingChildrenIndex===void 0&&y.activeChildrenIndex===void 0){let b=y.component;(a||!b.doenetAttributes.isPropertyChild)&&p.push(b)}}}}if(o)for(let h of p)t.some(b=>h instanceof b)&&h instanceof r&&(c=[...c,...xl({composite:h,compositeClass:r,includeComposites:!0}).map(b=>b.componentName)]);if(s){for(let[h,y]of p.entries())if(y.adaptedFrom&&!c.includes(y.componentName)){c=[...c,y.componentName];let b=p.map(g=>g.componentName).indexOf(y.adaptedFrom.componentName);b===-1?p.splice(h,1,y.adaptedFrom):l&&u.definingChildren.map(g=>g.componentName).includes(y.adaptedFrom.componentName)||(p.splice(h,1,y.adaptedFrom),p.splice(b,1,y))}}c.length>0&&(p=p.filter(h=>!c.includes(h.componentName)));let m=[],f=[];for(let h of p){let y=t.some(b=>h instanceof b);if(y&&m.push({componentName:h.componentName,componentType:h.componentType}),!y||e){let b=Nl({ancestor:h,descendantClasses:t,recurseToMatchedChildren:e,useReplacementsForComposites:n,compositeClass:r,includeNonActiveChildren:i,includePropertyChildren:a,skipOverAdapters:s,ignoreReplacementsOfMatchedComposites:o,definingChildrenFirst:l,init:!1});m.push(...b)}}return o&&(m=m.filter(h=>!f.includes(h))),m}function xl({composite:u,compositeClass:t,includeComposites:e=!1}){let n=[];if(u.replacements){let r;if(u.replacementsToWithhold){let i=u.replacements.length-u.replacementsToWithhold;r=u.replacements.slice(0,i)}else r=u.replacements;for(let i of r)i instanceof t?(e&&n.push(i),n.push(...xl({composite:i,compositeClass:t,includeComposites:e}))):n.push(i)}return n}function gt(u,t){if(u.ancestors===void 0||u.ancestors.length===0)return[];let e=[u.ancestors[0].componentName],n=t[u.ancestors[0].componentName];if(n&&e.push(...gt(n,t)),u.replacementOf){e.push(u.replacementOf.componentName);let r=gt(u.replacementOf,t);for(let i of r)e.includes(i)||e.push(i)}return e}var pe=[],Vl=class{constructor({_components:t,componentInfoObjects:e,core:n}){this.setUpStateVariableDependenciesSub=this.setUpStateVariableDependenciesSub.bind(this),this.upstreamDependencies={},this.downstreamDependencies={},this.switchDependencies={},this.circularCheckPassed={},this.dependencyTypes={},pe.forEach(r=>this.dependencyTypes[r.dependencyType]=r),this.core=n,this._components=t,this.componentInfoObjects=e,this.updateTriggers={descendantDependenciesByAncestor:{},ancestorDependenciesByPotentialAncestor:{},replacementDependenciesByComposite:{},childDependenciesByParent:{},parentDependenciesByParent:{},dependenciesMissingComponentBySpecifiedName:{}}}setUpComponentDependencies({component:t,updatesNeeded:e,compositesBeingExpanded:n}){this.downstreamDependencies[t.componentName]&&this.deleteAllDownstreamDependencies({component:t,updatesNeeded:e}),this.downstreamDependencies[t.componentName]={},this.upstreamDependencies[t.componentName]||(this.upstreamDependencies[t.componentName]={});let r=[],i=[];for(let a in t.state)t.state[a].isArrayEntry||t.state[a].isAlias||i.includes(a)||(r.push(a),t.state[a].additionalStateVariablesDefined&&i.push(...t.state[a].additionalStateVariablesDefined));for(let a of r){let s=[a];t.state[a].additionalStateVariablesDefined&&s.push(...t.state[a].additionalStateVariablesDefined),this.setUpStateVariableDependencies({component:t,stateVariable:a,allStateVariablesAffected:s,updatesNeeded:e,compositesBeingExpanded:n})}}setUpStateVariableDependencies({component:t,stateVariable:e,allStateVariablesAffected:n,updatesNeeded:r,compositesBeingExpanded:i}){let a=t.state[e],s;if(a.stateVariablesDeterminingDependencies||a.determineIfShadowData){let o=this.createDetermineDependenciesStateVariable({stateVariable:e,component:t,allStateVariablesAffected:n,updatesNeeded:r,compositesBeingExpanded:i});s={[o]:{dependencyType:"stateVariable",componentName:t.componentName,variableName:o,__isDetermineDependencyStateVariable:!0}}}else s=a.returnDependencies({componentInfoObjects:this.componentInfoObjects,sharedParameters:t.sharedParameters});this.setUpStateVariableDependenciesSub({dependencies:s,component:t,stateVariable:e,allStateVariablesAffected:n,updatesNeeded:r,compositesBeingExpanded:i})}deleteAllDownstreamDependencies({component:t,stateVariables:e="__all__",updatesNeeded:n}){let r=t.componentName,i;e==="__all__"?i=Object.keys(this.downstreamDependencies[r]):i=e;for(let a of i){let s=this.downstreamDependencies[r][a];for(let o in s)s[o].delete(n);delete this.downstreamDependencies[r][a]}Object.keys(this.downstreamDependencies[r]).length===0&&!this.components[r]&&delete this.downstreamDependencies[r]}deleteAllUpstreamDependencies({component:t,stateVariables:e="__all__",completelyDelete:n=!1,updatesNeeded:r}){let i=t.componentName,a;e==="__all__"?a=Object.keys(this.upstreamDependencies[i]):a=e;for(let s of a){if(this.upstreamDependencies[i][s])for(let o of[...this.upstreamDependencies[i][s]])n?o.delete(r):o.removeDownstreamComponent({indexToRemove:o.downstreamComponentNames.indexOf(i),updatesNeeded:r});delete this.upstreamDependencies[i][s]}Object.keys(this.upstreamDependencies[i]).length===0&&!this._components[i]&&delete this.upstreamDependencies[i]}setUpStateVariableDependenciesSub({dependencies:t,component:e,stateVariable:n,allStateVariablesAffected:r,updatesNeeded:i,compositesBeingExpanded:a}){for(let s in t){let o=t[s];if(!(o.dependencyType in this.dependencyTypes))throw Error(`Unrecognized dependency type ${o.dependencyType} for ${s} of ${n} of ${e.componentName}`);new this.dependencyTypes[o.dependencyType]({component:e,stateVariable:n,allStateVariablesAffected:r,dependencyName:s,dependencyDefinition:o,dependencyHandler:this,updatesNeeded:i,compositesBeingExpanded:a}).checkForCircular()}}createDetermineDependenciesStateVariable({stateVariable:t,component:e,allStateVariablesAffected:n,updatesNeeded:r,compositesBeingExpanded:i}){let a=e.state[t].stateVariablesDeterminingDependencies;a||(a=[]);let s=e.state[t].determineIfShadowData,o=[];if(s){for(let f of n)o.push({component:s.targetComponent,stateVariable:f});s.arraySizeStateVariableToResolve&&o.push({component:e,stateVariable:s.arraySizeStateVariableToResolve})}let l=`__determine_dependencies_${t}`,c=this;for(let f of n)e.state[f].determineDependenciesStateVariable=l;let d=[...n],p=this.core;e.state[l]={actionOnResolved:!0,willNeverBeEssential:!0,dependenciesForStateVariables:n,returnDependencies:function(){let f={};for(let h of a)f[h]={dependencyType:"stateVariable",componentName:e.componentName,variableName:h};for(let h of o)f["_"+h.component.componentName+"_"+h.stateVariable]={dependencyType:"stateVariable",componentName:h.component.componentName,variableName:h.stateVariable};return f},resolvedAction({dependencyValues:f,updatesNeeded:h}){let y=e.state[l];c.deleteAllUpstreamDependencies({component:e,stateVariables:[l],completelyDelete:!0,updatesNeeded:h});let b=y.dependenciesForStateVariables[0],g=e.state[b];if(s){let N=[];d=[];for(let v of n){let C=s.targetComponent.state[v];C.value,C.essential||C.alwaysShadow||C.isShadow||C.isArray&&C.getAllArrayKeys(C.arraySize).length>0&&C.getAllArrayKeys(C.arraySize).some(x=>C.essentialByArrayKey[x])?N.push(v):d.push(v)}N.length>0&&p.modifyStateDefsToBeShadows({stateVariablesToShadow:N,stateVariableDefinitions:e.state,foundReadyToExpand:s.foundReadyToExpand,targetComponent:s.targetComponent})}let T;return g.isArray&&!g.entireArrayAtOnce?T=g.returnDependencies({stateValues:f,componentInfoObjects:p.componentInfoObjects,sharedParameters:e.sharedParameters,arraySize:g.arraySize}):g.isArrayEntry&&!g.entireArrayAtOnce?T=g.returnDependencies({stateValues:f,componentInfoObjects:p.componentInfoObjects,sharedParameters:e.sharedParameters,arraySize:g.arraySize,arrayKeys:g.arrayKeys}):T=g.returnDependencies({stateValues:f,componentInfoObjects:p.componentInfoObjects,sharedParameters:e.sharedParameters}),c.setUpStateVariableDependenciesSub({dependencies:T,component:e,stateVariable:b,allStateVariablesAffected:y.dependenciesForStateVariables,updatesNeeded:h,compositesBeingExpanded:i}),{}},markStale:function(){return d.length>0&&a.length>0?{updateDependencies:e.state[l].dependenciesForStateVariables}:{}},definition(){return{newValues:{[l]:!0}}}},this.core.initializeStateVariable({component:e,stateVariable:l});let m=e.state[l].returnDependencies();return this.setUpStateVariableDependenciesSub({dependencies:m,component:e,stateVariable:l,allStateVariablesAffected:[l],updatesNeeded:r,compositesBeingExpanded:i}),l}updateChildAndDescendantDependencies(t,e,n){if(!t.childLogicSatisfied)return;let r=t.componentName;if(this.upstreamDependencies[r].__activeChildren&&(this.markUpstreamDependentsStale({component:t,varName:"__activeChildren",updatesNeeded:e}),this.recordActualChangeInUpstreamDependencies({component:t,varName:"__activeChildren",updatesNeeded:e})),r in this.downstreamDependencies&&this.updateChildDependencies(t,e,n),t.ancestors){this.updateParentDependencies(t,e,n),this.updateAncestorDependencies(t,e,n),e.parentsToUpdateDescendants.add(t.componentName);for(let i of gt(t,this.components))e.parentsToUpdateDescendants.add(i)}}updateChildDependencies(t,e,n){if(this.updateTriggers.childDependenciesByParent[t.componentName])for(let r of this.updateTriggers.childDependenciesByParent[t.componentName])r.recalculateDownstreamComponents(e,n)}updateDescendantDependencies(t,e,n){if(this.updateTriggers.descendantDependenciesByAncestor[t.componentName])for(let r of this.updateTriggers.descendantDependenciesByAncestor[t.componentName])r.recalculateDownstreamComponents(e,n)}updateParentDependencies(t,e,n){if(this.updateTriggers.parentDependenciesByParent[t.componentName])for(let r of this.updateTriggers.parentDependenciesByParent[t.componentName])r.recalculateDownstreamComponents(e,n)}updateAncestorDependencies(t,e,n){if(this.updateTriggers.ancestorDependenciesByPotentialAncestor[t.componentName])for(let r of this.updateTriggers.ancestorDependenciesByPotentialAncestor[t.componentName])r.recalculateDownstreamComponents(e,n)}updateReplacementDependencies(t,e,n){if(this.updateTriggers.replacementDependenciesByComposite[t.componentName])for(let r of this.updateTriggers.replacementDependenciesByComposite[t.componentName])r.recalculateDownstreamComponents(e,n)}checkForCircularDependency({componentName:t,varName:e,previouslyVisited:n=[]}){let r=t+":"+e;if(n.includes(r)){console.log("found circular",r,n);let i=/^(.*):/,a=n.map(l=>l.match(i)[1]),s=a.filter(l=>l.slice(0,2)!=="__").reduce((l,c)=>l.includes(c)?l:[...l,c],[]);s.length===0&&(s=[a[0]]);let o;throw s.length===1?o=s[0]:s.length===2?o=s.join(" and "):(s[s.length-2]=s.slice(s.length-2).join(", and "),s.pop(),o=s.join(", ")),Error(`Circular dependency involving ${o}`)}else n=[...n,r];if(!this.circularCheckPassed[r]&&(this.circularCheckPassed[r]=!0,t in this.downstreamDependencies)){let i=this.downstreamDependencies[t][e];for(let a in i){let s=i[a],o=s.downstreamComponentNames;if(!o)continue;let l=s.mappedDownstreamVariableNamesByComponent;if(!!l)for(let[c,d]of o.entries()){let p=l[c];for(let m of p)this.checkForCircularDependency({componentName:d,varName:m,previouslyVisited:n})}}}}resetCircularCheckPassed(t,e){let n=t+":"+e;if(this.circularCheckPassed[n]){delete this.circularCheckPassed[n];let r=this.upstreamDependencies[t][e];if(r)for(let i of r)for(let a of i.upstreamVariableNames)a!=="__childLogic"&&a!=="__identity"&&this.resetCircularCheckPassed(i.upstreamComponentName,a)}}updateDependencies(t,e,n){if(t.parentsToUpdateDescendants.size>0){for(let i of t.parentsToUpdateDescendants)this._components[i]&&this.updateDescendantDependencies(this._components[i],t,e);t.parentsToUpdateDescendants=new Set}let r=[];if(t.componentsToUpdateDependencies.length>0){console.log("updating dependencies"),console.log(t.componentsToUpdateDependencies);let i=[],a=[],s=[];for(let l of t.componentsToUpdateDependencies){let c=this._components[l.componentName];if(!c)continue;let d=[],p=[];for(let m of l.stateVariables)if(!p.includes(m)){d.push(m),c.state[m].additionalStateVariablesDefined&&p.push(...c.state[m].additionalStateVariablesDefined);let f=c.state[m].determineDependenciesStateVariable;i.push(c.state[f])}for(let m of d){let f=[m];c.state[m].additionalStateVariablesDefined&&f.push(...c.state[m].additionalStateVariablesDefined);let h=c.state[m],y;try{y=this.getStateVariableDependencyValues({component:c,stateVariable:h.determineDependenciesStateVariable})}catch(N){console.log(`Couldn't update dependencies of ${h.determineDependenciesStateVariable} of ${c.componentName}`),a.push({componentName:c.componentName,stateVariables:[m]});continue}if(Object.keys(y.changes).length===0&&h._previousValue!==void 0)continue;let b={stateValues:y.dependencyValues,componentInfoObjects:this.componentInfoObjects,sharedParameters:c.sharedParameters},g=h.returnDependencies(b),T=this.replaceDependenciesIfChanged({component:c,stateVariable:m,newDependencies:g,allStateVariablesAffected:f,updatesNeeded:t,compositesBeingExpanded:e});s.push(...T.newlyCreatedDependencies),(T.changedDependency||b.changedDependency)&&r.push({componentName:c.componentName,stateVariable:m,allStateVariablesAffected:f})}}for(let l of s)l.checkForCircular();console.log("dependencyChanges"),console.log(r),t.componentsToUpdateDependencies=a;let o=Object.keys(t.unresolvedDependencies).length>0;for(let l of r){let c=this._components[l.componentName];for(let p of l.allStateVariablesAffected)c.state[p].isResolved=!1;let d=this.core.resolveStateVariables({component:c,stateVariables:l.allStateVariablesAffected,updatesNeeded:t,compositesBeingExpanded:e});this.core.addUnresolvedDependencies({varsUnresolved:d.varsUnresolved,component:c,updatesNeeded:t});for(let p of l.allStateVariablesAffected)c.state[p].isResolved||(o=!0,this.resetUpstreamDependentsUnresolved({component:c,varName:p,updatesNeeded:t}))}o&&this.core.resolveAllDependencies(t,e);for(let l of i)l.value;for(let l of r){for(let c of l.allStateVariablesAffected)this.checkForCircularDependency({componentName:l.componentName,varName:c}),this._components[l.componentName].state[c].forceRecalculation=!0;this.core.markStateVariableAndUpstreamDependentsStale({component:this._components[l.componentName],varName:l.stateVariable,updatesNeeded:t}),this.recordActualChangeInUpstreamDependencies({component:this._components[l.componentName],varName:l.stateVariable})}}for(Object.keys(t.unresolvedDependencies).length>0&&this.core.resolveAllDependencies(t,e);t.compositesToUpdateReplacements.length>0;)this.core.replacementChangesFromCompositesToUpdate({updatesNeeded:t,compositesBeingExpanded:e}),Object.keys(t.unresolvedDependencies).length>0&&this.core.resolveAllDependencies(t,e);if(t.componentsToUpdateDependencies.length>0&&r.length>0||t.parentsToUpdateDescendants.size>0){let i=t.componentsToUpdateDependencies.length+t.parentsToUpdateDescendants.size;(!n||i<n)&&(console.log("since found more components to update dependencies, will try to recurse"),console.log(t.componentsToUpdateDependencies),console.log(t.parentsToUpdateDescendants),this.updateDependencies(t,e,i))}}replaceDependenciesIfChanged({component:t,stateVariable:e,newDependencies:n,allStateVariablesAffected:r,updatesNeeded:i,compositesBeingExpanded:a}){let s=this.downstreamDependencies[t.componentName][e],o=!1,l=[];for(let c in s)c in n||(o=!0,s[c].delete(i));for(let c in n)if(c in s){let d=n[c],p=s[c];if(!Wt(d,p.definition)){o=!0,s[c].delete(i);let m=n[c],f=new this.dependencyTypes[m.dependencyType]({component:t,stateVariable:e,allStateVariablesAffected:r,dependencyName:c,dependencyDefinition:m,dependencyHandler:this,updatesNeeded:i,compositesBeingExpanded:a});l.push(f)}}else{o=!0;let d=n[c],p=new this.dependencyTypes[d.dependencyType]({component:t,stateVariable:e,allStateVariablesAffected:r,dependencyName:c,dependencyDefinition:d,dependencyHandler:this,updatesNeeded:i,compositesBeingExpanded:a});l.push(p)}return{changedDependency:o,newlyCreatedDependencies:l}}checkForDependenciesOnNewComponent({componentName:t,updatesNeeded:e,compositesBeingExpanded:n}){let r=[];if(this.updateTriggers.dependenciesMissingComponentBySpecifiedName[t]){for(let i of this.updateTriggers.dependenciesMissingComponentBySpecifiedName[t]){let a=this._components[i.upstreamComponentName];if(!a)continue;let s=!0;for(let o of i.upstreamVariableNames)if(!(o in a.state)){s=!1;break}if(!!s){i.recalculateDownstreamComponents(e,n);for(let o of i.upstreamVariableNames)r.push({componentName:i.upstreamComponentName,varName:o})}}delete this.updateTriggers.dependenciesMissingComponentBySpecifiedName[t]}return r}getStateVariableDependencyValues({component:t,stateVariable:e}){let n={},r={},i={},a=this.downstreamDependencies[t.componentName][e];for(let s in a){let{value:o,changes:l,usedDefault:c}=a[s].getValue();n[s]=o,Object.keys(l).length>0&&(r[s]=l),c&&(i[s]=!0)}return{dependencyValues:n,changes:r,usedDefault:i}}recordActualChangeInUpstreamDependencies({component:t,varName:e,changes:n}){let r=t.componentName,i=this.upstreamDependencies[r][e];if(i){for(let a of i)if(a.valuesChanged){let s=a.downstreamComponentNames.indexOf(r),o=a.valuesChanged[s][e];if(!o&&t.stateVarAliases)for(let l in t.stateVarAliases)t.stateVarAliases[l]===e&&l in upValuesChangedSub&&(o=upValuesChangedSub[l]);if(!o){if(!t.state[e].isArrayEntry)throw Error(`Something is wrong, as a variable ${e} of ${t.componentName} actually changed, but wasn't marked with a potential change`);o=upValuesChangedSub[e]={changed:{}}}t.state[e]&&t.state[e].isArray?(o.changed===void 0?o.changed={arrayKeysChanged:{}}:o.changed===!0&&(o.changed={allArrayKeysChanged:!0,arraySizeChanged:!0,arrayKeysChanged:{}}),n&&(n.allArrayKeysChanged&&(o.changed.allArrayKeysChanged=!0),n.arraySizeChanged&&(o.changed.arraySizeChanged=!0),Object.assign(o.changed.arrayKeysChanged,n.arrayKeysChanged))):o.changed=!0}}}get components(){return new Proxy(this._components,K)}set components(t){return null}},Pe=class{constructor({component:t,stateVariable:e,allStateVariablesAffected:n,dependencyName:r,dependencyDefinition:i,dependencyHandler:a,updatesNeeded:s,compositesBeingExpanded:o}){this.dependencyName=r,this.dependencyHandler=a,this.upstreamComponentName=t.componentName,this.upstreamVariableNames=n,this.definition=Object.assign({},i),this.representativeStateVariable=e,i.doNotProxy&&(this.doNotProxy=!0),i.variablesOptional&&(this.variablesOptional=!0),i.requireChildLogicInitiallySatisfied&&(this.requireChildLogicInitiallySatisfied=!0),i.__isDetermineDependencyStateVariable&&(this.__isDetermineDependencyStateVariable=!0),i.publicStateVariablesOnly&&(this.publicStateVariablesOnly=!0),i.caseInsensitiveVariableMatch&&(this.caseInsensitiveVariableMatch=!0),i.useMappedVariableNames&&(this.useMappedVariableNames=!0),Number.isInteger(i.propIndex)&&(this.propIndex=i.propIndex),this.returnSingleVariableValue=!1,this.returnSingleComponent=!1,this.originalDownstreamVariableNames=[],this.setUpParameters();let l=this.determineDownstreamComponents();this.initialize({downstreamComponentNames:l.downstreamComponentNames,downstreamComponentTypes:l.downstreamComponentTypes,updatesNeeded:s,compositesBeingExpanded:o})}static dependencyType="_base";downstreamVariableNameIfNoVariables="__identity";static get rendererType(){return this.componentType}get dependencyType(){return this.constructor.dependencyType}setUpParameters(){}determineDownstreamComponents(){return{downstreamComponentNames:[],downstreamComponentTypes:[]}}initialize({downstreamComponentNames:t,downstreamComponentTypes:e,updatesNeeded:n,compositesBeingExpanded:r}){this.componentIdentitiesChanged=!0;let i=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];i||(i=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName]={});for(let a of this.upstreamVariableNames)i[a]||(i[a]={}),i[a][this.dependencyName]=this;this.originalDownstreamVariableNames.length===0?(delete this.mappedDownstreamVariableNamesByComponent,delete this.upValuesChanged):(this.mappedDownstreamVariableNamesByComponent=[],this.valuesChanged=[]),this.downstreamComponentNames=[],this.downstreamComponentTypes=[];for(let[a,s]of t.entries())this.addDownstreamComponent({downstreamComponentName:s,downstreamComponentType:e[a],index:a,updatesNeeded:n,compositesBeingExpanded:r})}addDownstreamComponent({downstreamComponentName:t,downstreamComponentType:e,index:n,updatesNeeded:r,compositesBeingExpanded:i}){this.componentIdentitiesChanged=!0,this.downstreamComponentNames.splice(n,0,t),this.downstreamComponentTypes.splice(n,0,e);let a=this.dependencyHandler._components[t],s=this.originalDownstreamVariableNames;this.caseInsensitiveVariableMatch&&(s=this.dependencyHandler.core.findCaseInsensitiveMatches({stateVariables:s,componentClass:a.constructor})),this.publicStateVariablesOnly&&(s=this.dependencyHandler.core.matchPublicStateVariables({stateVariables:s,componentClass:a.constructor}));let o=this.dependencyHandler.core.substituteAliases({stateVariables:s,componentClass:a.constructor});this.constructor.convertToArraySize&&(o=o.map(function(d){let p=a.state[d];if(p)return p.arraySizeStateVariable?p.arraySizeStateVariable:`__${d}_is_not_an_array`;let m=Object.keys(a.arrayEntryPrefixes).sort((f,h)=>h.length-f.length);for(let f of m)if(d.substring(0,f.length)===f){let h=a.arrayEntryPrefixes[f];return a.state[h].arraySizeStateVariable}return`__${d}_is_not_an_array`})),this.propIndex!==void 0&&console.warn("Need to implement propIndex!");let l=o;if(this.originalDownstreamVariableNames.length>0){this.mappedDownstreamVariableNamesByComponent.splice(n,0,o);let d={};for(let p of o)d[p]={changed:!0};this.valuesChanged.splice(n,0,d),this.variablesOptional&&(l=l.filter(p=>p in a.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:p,component:a})));for(let p of l){if(!a.state[p]){let m=this.dependencyHandler.core.createFromArrayEntry({component:a,stateVariable:p,updatesNeeded:r,compositesBeingExpanded:i});Object.keys(m.varsUnresolved).length>0&&this.dependencyHandler.core.addUnresolvedDependencies({varsUnresolved:m.varsUnresolved,component:a,updatesNeeded:r})}if(!a.state[p].isResolved){let m=this.dependencyHandler._components[this.upstreamComponentName],f={};for(let h of this.upstreamVariableNames)f[h]=[{componentName:t,stateVariable:p}];this.dependencyHandler.core.addUnresolvedDependencies({varsUnresolved:f,component:m,updatesNeeded:r});for(let h of this.upstreamVariableNames)m.state[h].isResolved&&(this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:h,updatesNeeded:r}),m.state[h].isResolved=!1,this.dependencyHandler.core.resetUpstreamDependentsUnresolved({component:m,varName:h,updatesNeeded:r}))}}}l.length===0&&(l=[this.downstreamVariableNameIfNoVariables]);let c=this.dependencyHandler.upstreamDependencies[t];c||(c=this.dependencyHandler.upstreamDependencies[t]={});for(let d of l)if(c[d]===void 0&&(c[d]=[]),c[d].push(this),d!==this.downstreamVariableNameIfNoVariables)for(let p of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,p);for(let d of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[d].isResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:d,updatesNeeded:r})}removeDownstreamComponent({indexToRemove:t,updatesNeeded:e,recordChange:n=!0}){n&&(this.componentIdentitiesChanged=!0);let r=this.downstreamComponentNames[t];this.downstreamComponentNames.splice(t,1),this.downstreamComponentTypes.splice(t,1);let i;this.mappedDownstreamVariableNamesByComponent?(i=this.mappedDownstreamVariableNamesByComponent[t],this.mappedDownstreamVariableNamesByComponent.splice(t,1),this.valuesChanged.splice(t,1),this.variablesOptional&&i.push(this.downstreamVariableNameIfNoVariables)):i=[this.downstreamVariableNameIfNoVariables];for(let a of i){let s=this.dependencyHandler.upstreamDependencies[r][a];if(s){let o=s.indexOf(this);o!==-1&&(s.length===1?delete this.dependencyHandler.upstreamDependencies[r][a]:s.splice(o,1))}if(a!==this.downstreamVariableNameIfNoVariables)for(let o of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,o)}if(n)for(let a of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[a].isResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:a,updatesNeeded:e})}swapDownstreamComponents(t,e,n){this.componentIdentitiesChanged=!0,[this.downstreamComponentNames[t],this.downstreamComponentNames[e]]=[this.downstreamComponentNames[e],this.downstreamComponentNames[t]],[this.downstreamComponentTypes[t],this.downstreamComponentTypes[e]]=[this.downstreamComponentTypes[e],this.downstreamComponentTypes[t]],this.originalDownstreamVariableNames&&([this.mappedDownstreamVariableNamesByComponent[t],this.mappedDownstreamVariableNamesByComponent[e]]=[this.mappedDownstreamVariableNamesByComponent[e],this.mappedDownstreamVariableNamesByComponent[t]]);for(let r of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[r].isResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:r,updatesNeeded:n})}delete(t){let e=[];if(!this.mappedDownstreamVariableNamesByComponent)e=Array(this.downstreamComponentNames.length).fill([this.downstreamVariableNameIfNoVariables]);else if(e=this.mappedDownstreamVariableNamesByComponent,this.variablesOptional){let r=[];for(let[i,a]of this.downstreamComponentNames.entries()){let s=[];for(let o of e[i])this.dependencyHandler.components[a].state[o]&&s.push(o);s.length>0?r.push(s):r.push([this.downstreamVariableNameIfNoVariables])}e=r}for(let[r,i]of this.downstreamComponentNames.entries())for(let a of e[r]){let s=this.dependencyHandler.upstreamDependencies[i][a];if(s){let o=s.indexOf(this);o!==-1&&(s.length===1?delete this.dependencyHandler.upstreamDependencies[i][a]:s.splice(o,1))}if(a!==this.downstreamVariableNameIfNoVariables)for(let o of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,o)}for(let r of this.upstreamVariableNames)this.dependencyHandler._components[this.upstreamComponentName].state[r].isResolved&&this.dependencyHandler.core.recordActualChangeInStateVariable({componentName:this.upstreamComponentName,varName:r,updatesNeeded:t});this.deleteFromUpdateTriggers();let n=this.dependencyHandler.downstreamDependencies[this.upstreamComponentName];for(let r of this.upstreamVariableNames)delete n[r][this.dependencyName]}deleteFromUpdateTriggers(){}getValue({verbose:t=!1,skipProxy:e=!1}={}){let n=[],r={},i=!1;this.componentIdentitiesChanged&&(r.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1);for(let[a,s]of this.downstreamComponentNames.entries()){let o=this.dependencyHandler.components[s],l={componentName:o.componentName,componentType:o.componentType};if(this.originalDownstreamVariableNames.length>0){l.stateValues={};for(let[c,d]of this.originalDownstreamVariableNames.entries()){let p=this.mappedDownstreamVariableNamesByComponent[a][c],m=this.useMappedVariableNames?p:d;(!this.variablesOptional||p in o.state)&&(o.state[p].deferred||(l.stateValues[m]=o.stateValues[p],this.valuesChanged[a][p].changed&&(r.valuesChanged||(r.valuesChanged={}),r.valuesChanged[a]||(r.valuesChanged[a]={}),r.valuesChanged[a][m]=this.valuesChanged[a][p]),this.valuesChanged[a][p]={}))}}n.push(l)}if(!t)if(this.returnSingleVariableValue)if(n.length===1){n=n[0];let a=Object.keys(n.stateValues);r.valuesChanged&&r.valuesChanged[0]&&r.valuesChanged[0][0]&&(r.valuesChanged=r.valuesChanged[0][0]),a.length===1?(n=n.stateValues[a[0]],i=this.dependencyHandler.components[this.downstreamComponentNames[0]].state[this.mappedDownstreamVariableNamesByComponent[0][0]].usedDefault):n=null}else n=null;else this.returnSingleComponent&&(n.length===1?(n=n[0],r.valuesChanged&&r.valuesChanged[0]&&(r.valuesChanged=r.valuesChanged[0])):n=null);return!this.doNotProxy&&!e&&n!==null&&typeof n=="object"&&(n=new Proxy(n,K)),{value:n,changes:r,usedDefault:i}}checkForCircular(){for(let t of this.upstreamVariableNames)this.dependencyHandler.resetCircularCheckPassed(this.upstreamComponentName,t);for(let t of this.upstreamVariableNames)this.dependencyHandler.checkForCircularDependency({componentName:this.upstreamComponentName,varName:t})}recalculateDownstreamComponents(t,e){let n=this.determineDownstreamComponents(),r=n.downstreamComponentNames;if(r.length!==this.downstreamComponentNames.length||this.downstreamComponentNames.some((a,s)=>a!=r[s])){this.componentIdentitiesChanged=!0;let a=0;for(let[s,o]of[...this.downstreamComponentNames].entries())r.includes(o)||(this.removeDownstreamComponent({indexToRemove:s-a,updatesNeeded:t}),a++);for(let[s,o]of r.entries()){let l=this.downstreamComponentNames.indexOf(o);l!==-1?l!==s&&this.swapDownstreamComponents(l,s,t):this.addDownstreamComponent({downstreamComponentName:o,downstreamComponentType:n.downstreamComponentTypes[s],index:s,createVariables:!0,updatesNeeded:t,compositesBeingExpanded:e})}}}},nr=class extends Pe{static dependencyType="stateVariable";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableName is not defined`);this.originalDownstreamVariableNames=[this.definition.variableName],this.definition.returnAsComponentObject?this.returnSingleComponent=!0:this.returnSingleVariableValue=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),e.includes(this)||e.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}return delete this.unresolvedSpecifiedComponent,{downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(nr);var Tg=class extends nr{static dependencyType="stateVariableComponentType";getValue({verbose:t=!1}={}){let e=[],n={};if(this.staticValue)e=[this.staticValue];else if(this.componentIdentitiesChanged&&(n.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1){let r=this.downstreamComponentNames[0],i=this.dependencyHandler.components[r],a={componentName:i.componentName,componentType:i.componentType};a.stateValues={};let s=this.originalDownstreamVariableNames[0],o=this.mappedDownstreamVariableNamesByComponent[0][0],l=this.useMappedVariableNames?o:s;if((!this.variablesOptional||o in i.state)&&!i.state[o].deferred){let c=i.state[o];if(c.value,a.stateValues[l]=c.componentType,c.isArray&&c.wrappingComponents&&c.wrappingComponents.length>0){let p=c.wrappingComponents[c.wrappingComponents.length-1][0];typeof p=="object"&&(p=p.componentType),a.stateValues[l]=p}this.valuesChanged[0][o].changed&&(n.valuesChanged||(n.valuesChanged={}),n.valuesChanged[0]||(n.valuesChanged[0]={}),n.valuesChanged[0][l]=this.valuesChanged[0][o]),this.valuesChanged[0][o]={};let d=c.hasVariableComponentType;!d&&c.isArrayEntry&&(d=i.state[c.arrayStateVariable].hasVariableComponentType),d||(this.staticValue=a,this.removeDownstreamComponent({indexToRemove:0,recordChange:!1}))}e=[a]}if(!t)if(this.returnSingleVariableValue)if(e.length===1){e=e[0];let r=Object.keys(e.stateValues);n.valuesChanged&&n.valuesChanged[0]&&n.valuesChanged[0][0]&&(n.valuesChanged=n.valuesChanged[0][0]),r.length===1?e=e.stateValues[r[0]]:e=null}else e=null;else this.returnSingleComponent&&(e.length===1?(e=e[0],n.valuesChanged&&n.valuesChanged[0]&&(n.valuesChanged=n.valuesChanged[0])):e=null);return!this.doNotProxy&&e!==null&&typeof e=="object"&&(e=new Proxy(e,K)),{value:e,changes:n,usedDefault:!1}}};pe.push(Tg);var Ng=class extends nr{static dependencyType="stateVariableArraySize";static convertToArraySize=!0};pe.push(Ng);var xg=class extends Pe{static dependencyType="recursiveDependencyValues";setUpParameters(){if(this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.definition.variableName===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableName is not defined`);this.originalDownstreamVariableNames=[this.definition.variableName],this.changedValuesOnly=this.definition.changedValuesOnly,this.returnSingleVariableValue=!1}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),e.includes(this)||e.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}return delete this.unresolvedSpecifiedComponent,{downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}getValue(){let t=this.mappedDownstreamVariableNamesByComponent[0][0];this.dependencyHandler._components[this.componentName].stateValues[t];let e=this.getStateVariableRecursiveDependencyValues({componentName:this.componentName,stateVariable:t,changedValuesOnly:this.changedValuesOnly}),n={};return this.valuesChanged[0][t]&&(n={valuesChanged:this.valuesChanged[0][t]}),this.valuesChanged[0][t]={},{value:e,changes:n}}getStateVariableRecursiveDependencyValues({componentName:t,stateVariable:e,changedValuesOnly:n}){let r=this.dependencyHandler._components[t],i=this.dependencyHandler.downstreamDependencies[r.componentName][e],a=r.state[e].recursiveDependencyValues={};for(let s in i){let o=i[s],l=o.getValue({verbose:!0}).value;for(let[c,d]of o.downstreamComponentNames.entries()){let p=a[d];p===void 0&&(p=a[d]={});let m=this.dependencyHandler.core.changedStateVariables[d],f=[];if(o.originalDownstreamVariableNames.length>0&&(f=o.mappedDownstreamVariableNamesByComponent[c],o.variablesOptional)){let h=f;f=[];for(let y of h)(y in this.dependencyHandler._components[d].state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:y,component:this.dependencyHandler._components[d]}))&&f.push(y)}for(let h of f)if(!(h in p)){if(!n||m){let b=l[c].stateValues[h];if(!n)p[h]=b;else{let g=this.dependencyHandler._components[d].state[h];if(g)if(g.isArray||g.isArrayEntry){let T,N;g.isArray?(N=h,T=g.getAllArrayKeys(g.arraySize)):(N=g.arrayStateVariable,T=g.arrayKeys),m[N]&&T.some(v=>m[N].has(v))&&(p[h]=b)}else m[h]&&(p[h]=b)}}let y=this.getStateVariableRecursiveDependencyValues({componentName:d,stateVariable:h,changedValuesOnly:n});for(let b in y){let g=a[b];g===void 0&&(g=a[b]={}),Object.assign(g,y[b])}}Object.keys(p).length===0&&delete a[d]}}return a}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(xg);var Vg=class extends Pe{static dependencyType="componentIdentity";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName,this.returnSingleComponent=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),e.includes(this)||e.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}return delete this.unresolvedSpecifiedComponent,{downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(Vg);var wg=class extends Pe{static dependencyType="child";setUpParameters(){if(this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.childLogicName=this.definition.childLogicName,this.definition.childIndices!==void 0&&(this.childIndices=this.definition.childIndices.map(t=>Number(t)))}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.parentName];if(!t){if(this.specifiedComponentName){let a=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];a||(a=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),a.includes(this)||a.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}delete this.unresolvedSpecifiedComponent;let e=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];e||(e=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),e.includes(this)||e.push(this);let n=t.childLogic.returnMatches(this.definition.childLogicName);if(n===void 0)throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: childLogicName ${this.definition.childLogicName} does not exist.`);this.childIndices&&(n=n.filter((a,s)=>this.childIndices.includes(s)));let r=n.map(a=>t.activeChildren[a]),i=r.map(a=>a.componentName);this.compositeIndices=[];for(let[a,s]of t.definingChildren.entries())if(this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:s.componentType,baseComponentType:"_composite"})&&s.isExpanded){let o=s.stateValues.fullRecursiveReplacements.map(l=>this.dependencyHandler.components[l.componentName]).map(l=>l.adapterUsed?l.adapterUsed:l).map(l=>l.componentName);for(let[l,c]of i.entries())o.includes(c)&&(this.compositeIndices[l]=a)}return{downstreamComponentNames:i,downstreamComponentTypes:r.map(a=>a.componentType)}}getValue({verbose:t}={}){let e=super.getValue({verbose:t,skipProxy:!0});for(let[n,r]of this.compositeIndices.entries())r!==void 0&&(e.value[n].compositeInd=r);return this.doNotProxy||(e.value=new Proxy(e.value,K)),e}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}}};pe.push(wg);var Dg=class extends Pe{static dependencyType="descendant";setUpParameters(){if(this.definition.ancestorName?(this.ancestorName=this.definition.ancestorName,this.specifiedComponentName=this.ancestorName):this.ancestorName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.componentTypes=this.definition.componentTypes.map(t=>t.toLowerCase()),this.recurseToMatchedChildren=this.definition.recurseToMatchedChildren,this.useReplacementsForComposites=this.definition.useReplacementsForComposites,this.includeNonActiveChildren=this.definition.includeNonActiveChildren,this.includePropertyChildren=this.definition.includePropertyChildren,this.skipOverAdapters=this.definition.skipOverAdapters,this.ignoreReplacementsOfMatchedComposites=this.definition.ignoreReplacementsOfMatchedComposites,this.definingChildrenFirst=this.definition.definingChildrenFirst}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.ancestorName];if(!t){if(this.specifiedComponentName){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),r.includes(this)||r.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}delete this.unresolvedSpecifiedComponent;let e=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];e||(e=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName]=[]),e.includes(this)||e.push(this);let n=Nl({ancestor:t,descendantClasses:this.componentTypes.map(r=>this.dependencyHandler.componentInfoObjects.allComponentClasses[r]),recurseToMatchedChildren:this.recurseToMatchedChildren,useReplacementsForComposites:this.useReplacementsForComposites,includeNonActiveChildren:this.includeNonActiveChildren,includePropertyChildren:this.includePropertyChildren,skipOverAdapters:this.skipOverAdapters,ignoreReplacementsOfMatchedComposites:this.ignoreReplacementsOfMatchedComposites,definingChildrenFirst:this.definingChildrenFirst,compositeClass:this.dependencyHandler.componentInfoObjects.allComponentClasses._composite});return{downstreamComponentNames:n.map(r=>r.componentName),downstreamComponentTypes:n.map(r=>r.componentType)}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.descendantDependenciesByAncestor[this.ancestorName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}}};pe.push(Dg);var Ag=class extends Pe{static dependencyType="parentStateVariable";setUpParameters(){if(this.definition.childName?(this.childName=this.definition.childName,this.specifiedComponentName=this.childName):this.childName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.returnSingleVariableValue=!0,this.variablesOptional=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.childName];if(!t){if(this.specifiedComponentName){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),r.includes(this)||r.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}if(delete this.unresolvedSpecifiedComponent,!t.parentName)return{downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=t.parentName;let e=this.dependencyHandler._components[this.parentName];if(!e){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];return r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),r.includes(this)||r.push(this),this.unresolvedSpecifiedComponent=this.parentName,{downstreamComponentNames:[],downstreamComponentTypes:[]}}let n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];return n||(n=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),{downstreamComponentNames:[this.parentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.parentDependenciesByParent[this.parentName];if(t){let n=t.indexOf(this);n!==-1&&t.splice(n,1)}if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(n){let r=n.indexOf(this);r!==-1&&n.splice(r,1)}}let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}};pe.push(Ag);var Sg=class extends Pe{static dependencyType="ancestor";setUpParameters(){if(this.definition.descendantName?(this.descendantName=this.definition.descendantName,this.specifiedComponentName=this.descendantName):this.descendantName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.returnSingleComponent=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.descendantName];if(!t){if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),n.includes(this)||n.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}delete this.unresolvedSpecifiedComponent,this.definition.componentType&&(this.componentType=this.definition.componentType.toLowerCase());let e=this.findMatchingAncestor(t);if(e.missingComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e.missingComponentName];return n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[e.missingComponentName]=[]),n.includes(this)||n.push(this),this.unresolvedSpecifiedComponent=e.missingComponentName,{downstreamComponentNames:[],downstreamComponentTypes:[]}}for(let n of e.ancestorsExamined){let r=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[n];r||(r=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[n]=[]),r.includes(this)||r.push(this)}return this.ancestorResults=e,e.ancestorFound?{downstreamComponentNames:[e.ancestorFound.componentName],downstreamComponentTypes:[e.ancestorFound.componentType]}:{downstreamComponentNames:[],downstreamComponentTypes:[]}}findMatchingAncestor(t){let e=[];if(this.componentType){for(let r of t.ancestors){let i=this.dependencyHandler._components[r.componentName];if(!i)return{missingComponentName:r.componentName};if(e.push(r.componentName),this.dependencyHandler.componentInfoObjects.isInheritedComponentType({inheritedComponentType:i.componentType,baseComponentType:this.componentType}))return{ancestorsExamined:e,ancestorFound:r}}return{ancestorsExamined:e}}if(this.originalDownstreamVariableNames.length===0)return console.warn(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must specify componentType or variableNames to find ancestor`),{ancestorsExamined:e};let n=this.originalDownstreamVariableNames;for(let r of t.ancestors){let i=this.dependencyHandler._components[r.componentName];if(!i)return{missingComponentName:r.componentName};e.push(r.componentName);let a=!0;for(let s of n)if(!(s in i.state||this.dependencyHandler.core.checkIfArrayEntry({stateVariable:s,component:i}))){a=!1;break}if(a)return{ancestorsExamined:e,ancestorFound:r}}return{ancestorsExamined:e}}deleteFromUpdateTriggers(){for(let t of this.ancestorResults.ancestorsExamined){let e=this.dependencyHandler.updateTriggers.ancestorDependenciesByPotentialAncestor[t];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}if(this.ancestorResults&&this.ancestorResults.missingComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.ancestorResults.missingComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(Sg);var Ig=class extends Pe{static dependencyType="replacement";setUpParameters(){if(this.definition.compositeName?(this.compositeName=this.definition.compositeName,this.specifiedComponentName=this.compositeName):this.compositeName=this.upstreamComponentName,this.definition.variableNames){if(!Array.isArray(this.definition.variableNames))throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: variableNames must be an array`);this.originalDownstreamVariableNames=this.definition.variableNames}else this.originalDownstreamVariableNames=[];this.recursive=this.definition.recursive,this.recurseNonStandardComposites=this.definition.recurseNonStandardComposites,Number.isInteger(this.definition.componentIndex)&&(this.componentIndex=this.definition.componentIndex),this.expandReplacements=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.compositeName];if(!t){if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),n.includes(this)||n.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}delete this.unresolvedSpecifiedComponent,this.compositesFound=[this.compositeName];let e=t.replacements;if(!e)e=[];else if(this.recursive){let n=this.dependencyHandler.core.recursivelyReplaceCompositesWithReplacements({replacements:e,recurseNonStandardComposites:this.recurseNonStandardComposites});e=n.newReplacements,this.compositesFound.push(...n.compositesFound)}for(let n of this.compositesFound){let r=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[n];r||(r=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[n]=[]),r.includes(this)||r.push(this)}if(this.componentIndex!==void 0){let n=e[this.componentIndex-1];n?e=[n]:e=[]}return{downstreamComponentNames:e.map(n=>n.componentName),downstreamComponentTypes:e.map(n=>n.componentType)}}deleteFromUpdateTriggers(){for(let t of this.compositesFound){let e=this.dependencyHandler.updateTriggers.replacementDependenciesByComposite[t];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(Ig);var Pg=class extends Pe{static dependencyType="sourceCompositeStateVariable";setUpParameters(){if(this.definition.replacementName?(this.replacementName=this.definition.replacementName,this.specifiedComponentName=this.replacementName):this.replacementName=this.upstreamComponentName,this.definition.variableName)this.originalDownstreamVariableNames=[this.definition.variableName];else throw Error(`Invalid state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}: must have a variableName`);this.returnSingleVariableValue=!0,this.variablesOptional=!0}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.replacementName];if(!t){if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];n||(n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),n.includes(this)||n.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}if(delete this.unresolvedSpecifiedComponent,!t.replacementOf)return{downstreamComponentNames:[],downstreamComponentTypes:[]};let e=t.replacementOf;return{downstreamComponentNames:[e.componentName],downstreamComponentTypes:[e.componentType]}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(Pg);var Og=class extends Pe{static dependencyType="countAmongSiblingsOfSameType";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){if(this.specifiedComponentName){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),r.includes(this)||r.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}if(delete this.unresolvedSpecifiedComponent,!t.parentName)return console.warn(`component ${this.componentName} does not have a parent for state variable ${this.representativeStateVariable} of ${this.upstreamComponentName}, dependency ${this.dependencyName}.`),{downstreamComponentNames:[],downstreamComponentTypes:[]};this.parentName=t.parentName;let e=this.dependencyHandler._components[this.parentName];if(!e){let r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];return r||(r=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName]=[]),r.includes(this)||r.push(this),this.unresolvedSpecifiedComponent=this.parentNam,{downstreamComponentNames:[],downstreamComponentTypes:[]}}let n=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];return n||(n=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName]=[]),n.includes(this)||n.push(this),{downstreamComponentNames:e.activeChildren.map(r=>r.componentName),downstreamComponentTypes:e.activeChildren.map(r=>r.componentType)}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.childDependenciesByParent[this.parentName];if(t){let n=t.indexOf(this);n!==-1&&t.splice(n,1)}if(this.specifiedComponentName){let n=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(n){let r=n.indexOf(this);r!==-1&&n.splice(r,1)}}let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.parentName];if(e){let n=e.indexOf(this);n!==-1&&e.splice(n,1)}}getValue(){let t=this.dependencyHandler.components[this.upstreamComponentName].componentType;return{value:this.dependencyHandler.components[this.parentName].activeChildren.filter(r=>r.componentType===t).map(r=>r.componentName).indexOf(this.upstreamComponentName)+1,changes:{}}}};pe.push(Og);var Lg=class extends Pe{static dependencyType="targetComponent";setUpParameters(){let t=this.dependencyHandler._components[this.upstreamComponentName];this.tName=t.doenetAttributes.tName,this.tName&&(this.targetComponentName=this.specifiedComponentName=t.doenetAttributes.fullTName),this.returnSingleComponent=!0}determineDownstreamComponents(){if(!this.tName)return{downstreamComponentNames:[],downstreamComponentTypes:[]};let t=this.dependencyHandler._components[this.targetComponentName];if(!t){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];return e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),e.includes(this)||e.push(this),this.unresolvedSpecifiedComponent=this.targetComponentName,{downstreamComponentNames:[],downstreamComponentTypes:[]}}return delete this.unresolvedSpecifiedComponent,{downstreamComponentNames:[this.targetComponentName],downstreamComponentTypes:[t.componentType]}}deleteFromUpdateTriggers(){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}};pe.push(Lg);var wl=class extends Pe{static dependencyType="value";setUpParameters(){this.value=this.definition.value}getValue(){return{value:this.value,changes:{}}}};pe.push(wl);var Rg=class extends wl{static dependencyType="flag";setUpParameters(){this.flagName=this.definition.flagName,this.value=this.dependencyHandler.core.flags[this.flagName]}};pe.push(Rg);var Fg=class extends nr{static dependencyType="doenetAttribute";setUpParameters(){this.attributeName=this.definition.attributeName,this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}getValue(){let t=null,e={};return this.componentIdentitiesChanged&&(e.componentIdentitiesChanged=!0,this.componentIdentitiesChanged=!1),this.downstreamComponentNames.length===1&&(t=this.dependencyHandler.components[this.downstreamComponentNames[0]].doenetAttributes[this.attributeName]),!this.doNotProxy&&t!==null&&typeof t=="object"&&(t=new Proxy(t,K)),{value:t,changes:e}}};pe.push(Fg);var kg=class extends Pe{static dependencyType="serializedChildren";setUpParameters(){this.definition.parentName?(this.parentName=this.definition.parentName,this.specifiedComponentName=this.parentName):this.parentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.parentName];if(!t){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),e.includes(this)||e.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}return delete this.unresolvedSpecifiedComponent,{downstreamComponentNames:[this.parentName],downstreamComponentTypes:[t.componentType]}}getValue(){return{value:this.dependencyHandler._components[this.parentName].serializedChildren,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(kg);var Mg=class extends Pe{static dependencyType="variants";setUpParameters(){this.definition.componentName?(this.componentName=this.definition.componentName,this.specifiedComponentName=this.componentName):this.componentName=this.upstreamComponentName}determineDownstreamComponents(){let t=this.dependencyHandler._components[this.componentName];if(!t){if(this.specifiedComponentName){let e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];e||(e=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName]=[]),e.includes(this)||e.push(this),this.unresolvedSpecifiedComponent=this.specifiedComponentName}return{downstreamComponentNames:[],downstreamComponentTypes:[]}}return delete this.unresolvedSpecifiedComponent,{downstreamComponentNames:[this.componentName],downstreamComponentTypes:[t.componentType]}}getValue(){return{value:this.dependencyHandler._components[this.componentName].variants,changes:{}}}deleteFromUpdateTriggers(){if(this.specifiedComponentName){let t=this.dependencyHandler.updateTriggers.dependenciesMissingComponentBySpecifiedName[this.specifiedComponentName];if(t){let e=t.indexOf(this);e!==-1&&t.splice(e,1)}}}};pe.push(Mg);var zg=Kt(Bg()),jg=Kt($g());var Al=class{constructor({doenetML:t,doenetState:e,parameters:n,requestedVariant:r,externalFunctions:i,flags:a={},coreReadyCallback:s,coreUpdatedCallback:o}){this.numerics=new gg,this.flags=new Proxy(a,K),this.switches={ignoreRequireChildLogicInitiallySatisfied:!1,ignoreUnresolvedSpecifiedComponents:!1},this.externalFunctions=i,i===void 0&&(this.externalFunctions={}),this.requestUpdate=this.requestUpdate.bind(this),this.requestAction=this.requestAction.bind(this),this.requestRecordEvent=this.requestRecordEvent.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this._requestAnimationFrame=this._requestAnimationFrame.bind(this),this.cancelAnimationFrame=this.cancelAnimationFrame.bind(this),this.calculateScoredItemNumberOfContainer=this.calculateScoredItemNumberOfContainer.bind(this),this.expandDoenetMLsToFullSerializedState=this.expandDoenetMLsToFullSerializedState.bind(this),this.finishCoreConstruction=this.finishCoreConstruction.bind(this),this.getStateVariableValue=this.getStateVariableValue.bind(this),this.submitResponseCallBack=this.submitResponseCallBack.bind(this),this.coreUpdatedCallback=o,this.coreReadyCallback=function(){s(),this.requestRecordEvent({verb:"experienced",object:{componentName:this.document.componentName,componentType:"document"}})}.bind(this),this._standardComponentClasses=mg(),this._allComponentClasses=fg(),this._componentTypesCreatingVariants=hg(),this._componentTypeWithPotentialVariants=yg(),this._allPossibleProperties=this.createAllPossibleProperties(),this.stateVariableInfo={};for(let c in this.allComponentClasses)Object.defineProperty(this.stateVariableInfo,c,{get:function(){let d=this.allComponentClasses[c].returnStateVariableInfo({standardComponentClasses:this.standardComponentClasses,allComponentClasses:this.allComponentClasses});return delete this.stateVariableInfo[c],this.stateVariableInfo[c]=d}.bind(this),configurable:!0});this.publicStateVariableInfo={};for(let c in this.allComponentClasses)Object.defineProperty(this.publicStateVariableInfo,c,{get:function(){let d=this.allComponentClasses[c].returnStateVariableInfo({onlyPublic:!0,standardComponentClasses:this.standardComponentClasses,allComponentClasses:this.allComponentClasses});return delete this.publicStateVariableInfo[c],this.publicStateVariableInfo[c]=d}.bind(this),configurable:!0});this.componentInfoObjects={standardComponentClasses:this.standardComponentClasses,allComponentClasses:this.allComponentClasses,componentTypesCreatingVariants:this.componentTypesCreatingVariants,componentTypeWithPotentialVariants:this.componentTypeWithPotentialVariants,allPossibleProperties:this.allPossibleProperties,isInheritedComponentType:this.isInheritedComponentType,isCompositeComponent:this.isCompositeComponent,stateVariableInfo:this.stateVariableInfo,publicStateVariableInfo:this.publicStateVariableInfo},this.coreFunctions={requestUpdate:this.requestUpdate,requestAction:this.requestAction,requestRecordEvent:this.requestRecordEvent,requestAnimationFrame:this.requestAnimationFrame,cancelAnimationFrame:this.cancelAnimationFrame,calculateScoredItemNumberOfContainer:this.calculateScoredItemNumberOfContainer,recordSolutionView:this.externalFunctions.recordSolutionView},this.animationIDs={},this.lastAnimationID=0,this.requestedVariant=r,this.parameterStack=new bg(n),this.setUpRng();let l;if(e){l=e;let c;l[0].doenetAttributes&&(c=l[0].doenetAttributes.contentId),c===void 0&&(c=""),console.log(`contentId from doenetState: ${c}`),this.finishCoreConstruction({contentIds:[c],fullSerializedStates:[l],finishSerializedStateProcessing:!1})}else{let c=jg.default.stringify((0,zg.default)(JSON.stringify(t)));this.expandDoenetMLsToFullSerializedState({contentIds:[c],doenetMLs:[t],callBack:this.finishCoreConstruction})}}finishCoreConstruction({contentIds:t,fullSerializedStates:e,finishSerializedStateProcessing:n=!0,calledAsynchronously:r=!1}){this.contentId=t[0];let i=e[0];Yl(i),n?xt({serializedComponents:i,componentInfoObjects:this.componentInfoObjects}):i[0].doenetAttributes===void 0&&(i[0].doenetAttributes={}),console.log("serialized components at the beginning"),console.log(Z(i)),this.documentName=i[0].componentName,i[0].doenetAttributes.contentId=this.contentId,this._components={},this.renderedComponentInstructions={},this.componentsWithChangedChildrenToRender=new Set([]),this._renderComponents=[],this._renderComponentsByName={},this._graphRenderComponents=[],this.dependencies=new Vl({_components:this._components,componentInfoObjects:this.componentInfoObjects,core:this}),this.unsatisfiedChildLogic={},this.setUpVariants(i),window.state={components:this._components,renderedComponentInstructions:this.renderedComponentInstructions,renderedComponentTypes:this.renderedComponentTypes,dependencies:this.dependencies,core:this,componentInfoObjects:this.componentInfoObjects},this.changedStateVariables={},this.addComponents({serializedComponents:i,initialAdd:!0}),this.rendererTypesInDocument=this.document.allPotentialRendererTypes,this.document.stateValues.itemCreditAchieved,console.log("** components at the end of the core constructor **"),console.log(this._components),r?this.coreReadyCallback():setTimeout(()=>this.coreReadyCallback(),0)}setUpVariants(t){let e=Fn({serializedComponents:t,componentTypesCreatingVariants:this.componentTypesCreatingVariants,allComponentClasses:this.allComponentClasses});this.requestedVariant!==void 0&&(this.parameterStack.parameters.variant=this.requestedVariant),e[0].variants.desiredVariant=this.parameterStack.parameters.variant}setUpRng(){this.parameterStack.parameters.hashStringToInteger=function(t){var e=0,n,r;if(t.length===0)return e;for(n=0;n<t.length;n++)r=t.charCodeAt(n),e=(e<<5)-e+r,e|=0;return e},this.parameterStack.parameters.seed===void 0&&(this.parameterStack.parameters.seed=this.parameterStack.parameters.hashStringToInteger(Date.now().toString())),this.parameterStack.parameters.selectRng=new Dl.default(this.parameterStack.parameters.seed),this.parameterStack.parameters.rngClass=Dl.default}expandDoenetMLsToFullSerializedState({contentIds:t,doenetMLs:e,callBack:n}){let r=[],i={};for(let s of e){let o=gr({doenetML:s,standardComponentClasses:this.standardComponentClasses,allComponentClasses:this.allComponentClasses});tn(o,this.standardComponentClasses),o=Rn(o,this.componentInfoObjects),ta(o),na({serializedComponents:o,componentInfoObjects:this.componentInfoObjects}),r.push(o);let l=ea({serializedComponents:o});for(let c in l)i[c]===void 0&&(i[c]=[]),i[c].push(...l[c])}let a=Object.keys(i);if(a.length>0){let s=function({fullSerializedStates:l}){for(let[c,d]of a.entries()){let p=l[c];for(let m of i[d])m.state===void 0&&(m.state={}),m.state.serializedStateForContentId=p}n({contentIds:t,fullSerializedStates:r,calledAsynchronously:!0})}.bind(this),o=function({newDoenetMLs:l,newContentIds:c,success:d,message:p}){d||console.warn(p),this.expandDoenetMLsToFullSerializedState({doenetMLs:l,contentIds:c,callBack:s})}.bind(this);this.externalFunctions.contentIdsToDoenetMLs({contentIds:a,callBack:o})}else n({contentIds:t,fullSerializedStates:r,calledAsynchronously:!1})}addComponents({serializedComponents:t,parent:e,indexOfDefiningChildren:n,initialAdd:r=!1}){Array.isArray(t)||(t=[t]);let i,a=[];e&&(i=e.componentName,a=[{componentName:i,componentClass:e.constructor},...e.ancestors]);let s=this.createIsolatedComponents({serializedComponents:t,ancestors:a});if(s.success!==!0)throw Error(s.message);let o=s.components,l={},c={};if(o.forEach(d=>c[d.componentName]=d),r===!0){if(o.length!==1)throw Error("Initial components need to be an array of just one component.");this.document=o[0],this.initializeRenderedComponentInstruction(this.document)}else{if(e===void 0)throw Error("Must specify parent when adding components.");if(n===void 0&&(n=e.definingChildren.length),e.isShadow===!0)throw Error("Cannot add components to a shadow component "+e.componentName);let d=this.addChildren({parent:e,indexOfDefiningChildren:n,newChildren:o});if(!d.success)throw Error("Couldn't satisfy child logic result.  Need informative error message");Object.assign(c,d.addedComponents),Object.assign(l,d.deletedComponents),this.updateRendererInstructions({componentNames:this.componentAndRenderedDescendants(e)})}return this.finishUpdate({addedComponents:c,deletedComponents:l,init:r}),o}updateRendererInstructions({componentNames:t,sourceOfUpdate:e,recreatedComponents:n={}}){let r=[],i=[],a=[];for(let s of t){let o=this._components[s];o&&(o.stateValues.childrenToRender,s in this.renderedComponentInstructions&&r.push(s))}for(let s of this.componentsWithChangedChildrenToRender)if(s in this.renderedComponentInstructions){let o=[],l=this._components[s];l&&(o=l.stateValues.childrenToRender);let c=this.renderedComponentInstructions[s].children,d=c.map(h=>h.componentName),p=[],m=[];for(let[h,y]of d.entries())o.includes(y)&&!n[y]?p.push(y):m.push({childName:y,ind:h});for(let{childName:h,ind:y}of m.reverse()){let b=this.deleteFromRenderedComponentInstructions({componentName:h,recurseToChildren:!0});c.splice(y,1),a.push({instructionType:"deleteRenderers",parentName:s,firstIndexInParent:y,numberChildrenDeleted:1,deletedComponentNames:b}),i.push(...b)}let f=o.filter(h=>p.includes(h));for(let h=0;h<f.length;h++)if(p[h]!==f[h]){let y=p.indexOf(f[h]);[c[h],c[y]]=[c[y],c[h]],[p[h],p[y]]=[p[y],p[h]],a.push({instructionType:"swapChildRenderers",parentName:s,index1:h,index2:y})}for(let[h,y]of o.entries())if(!d.includes(y)||n[y]){let b=this._components[y];if(b&&b.rendererType){let g=this.initializeRenderedComponentInstruction(b);c.splice(h,0,g),a.push({instructionType:"addRenderer",componentName:b.componentName,parentName:s,indexForParent:h})}}}if(this.componentsWithChangedChildrenToRender=new Set([]),r=r.filter(s=>!i.includes(s)),r.length>0){let s={instructionType:"updateStateVariable",renderersToUpdate:r,sourceOfUpdate:e};a.push(s)}this.coreUpdatedCallback(a)}initializeRenderedComponentInstruction(t){if(t.rendererType===void 0)return;let e=t.componentName,n=[];if(t.stateValues.childrenToRender)for(let i of t.stateValues.childrenToRender){let a=this._components[i];!a||!a.rendererType||n.push(this.initializeRenderedComponentInstruction(a))}this.componentsWithChangedChildrenToRender.delete(e);let r={};for(let i in t.state)t.state[i].forRenderer&&(r[i]=t.state[i]);return this.renderedComponentInstructions[e]={componentName:e,componentType:t.componentType,rendererType:t.rendererType,stateValues:new Proxy(r,wn()),children:n,actions:t.actions},this.renderedComponentInstructions[e]}deleteFromRenderedComponentInstructions({componentName:t,recurseToChildren:e=!0}){let n=[t];if(e){let r=this.renderedComponentInstructions[t];if(r)for(let i of r.children){let a=this.deleteFromRenderedComponentInstructions({componentName:i.componentName,recurseToChildren:e});n.push(...a)}}return delete this.renderedComponentInstructions[t],n}componentAndRenderedDescendants(t){if(t===void 0)return[];let e=[t.componentName];if(t.state.childrenToRender.isResolved&&t.stateValues.childrenToRender)for(let n of t.stateValues.childrenToRender)e.push(...this.componentAndRenderedDescendants(this._components[n]));return e}createIsolatedComponents({serializedComponents:t,ancestors:e,applyAdapters:n=!0,shadow:r=!1,compositesBeingExpanded:i=[]}){let a={componentsTouched:[],compositesToExpand:new Set([]),compositesToUpdateReplacements:[],componentsToUpdateDependencies:[],unresolvedDependencies:{},unresolvedByDependent:{},deletedStateVariables:{},deletedComponents:{},recreatedComponents:{},itemScoreChanges:new Set,parentsToUpdateDescendants:new Set},s=Object.assign({},this.unsatisfiedChildLogic),o="/";if(e.length>0){let d=e[0].componentName,p=this.components[d];p.doenetAttributes.newNamespace?o=p.componentName+"/":o=en(p.componentName)}let c=this.createIsolatedComponentsSub({serializedComponents:t,ancestors:e,applyAdapters:n,shadow:r,updatesNeeded:a,compositesBeingExpanded:i,namespaceForUnamed:o}).components;if(Object.keys(a.unresolvedDependencies).length>0&&(a.unresolvedMessage="",this.resolveAllDependencies(a,i)),this.dependencies.updateDependencies(a,i),Object.keys(a.unresolvedDependencies).length>0)return console.log("have some unresolved"),console.log(a.unresolvedDependencies),console.log(a.unresolvedByDependent),{success:!1,message:a.unresolvedMessage,updatesNeeded:a};if(Object.keys(this.unsatisfiedChildLogic).length>0){let d="",p=!1;for(let m in this.unsatisfiedChildLogic)d+=`Invalid children for ${m}: ${this.unsatisfiedChildLogic[m].message} `,m in s||(p=!0);if(p)return{success:!1,message:d,updatesNeeded:a}}return{success:!0,components:c,componentsTouched:[...new Set(a.componentsTouched)]}}createIsolatedComponentsSub({serializedComponents:t,ancestors:e,applyAdapters:n=!0,shadow:r=!1,updatesNeeded:i,compositesBeingExpanded:a,createNameContext:s="",namespaceForUnamed:o="/",componentsReplacementOf:l}){let c=[],d="";for(let[m,f]of t.entries()){if(f.createdComponent===!0){let T=this._components[f.componentName];c.push(T),this.setAncestors(T,e);continue}let h;try{h=this.standardComponentClasses[f.componentType]}catch(T){throw this.standardComponentClasses[f.componentType]===void 0?Error("Cannot create component of type "+f.componentType):T}if(h===void 0)throw Error("Cannot create component of type "+f.componentType);f.doenetAttributes||(f.doenetAttributes={});let y=f.componentName;if(y===void 0){let N=e[0].componentName+"|"+s+"|";f.uniqueIdentifier?N+=f.uniqueIdentifier:N+=m,y=kt(f.componentType,N),y=o+y}let g=this.createChildrenThenComponent({serializedComponent:f,componentName:y,ancestors:e,componentClass:h,applyAdapters:n,shadow:r,updatesNeeded:i,compositesBeingExpanded:a,namespaceForUnamed:o,componentsReplacementOf:l}).newComponent;c.push(g)}return{components:c}}createChildrenThenComponent({serializedComponent:t,componentName:e,ancestors:n,componentClass:r,applyAdapters:i=!0,shadow:a=!1,updatesNeeded:s,compositesBeingExpanded:o,namespaceForUnamed:l="/",componentsReplacementOf:c}){let d=t.children,p=[],m=[],f=[{componentName:e,componentClass:r},...n],h=this.parameterStack.parameters;this.parameterStack.push();let y=this.parameterStack.parameters,b=this.propagateAncestorProps({componentClass:r,componentName:e,sharedParameters:y});if(r.modifySharedParameters&&r.modifySharedParameters({sharedParameters:y,serializedComponent:t}),t.doenetAttributes.pushSharedParameters)for(let w of t.doenetAttributes.pushSharedParameters){let D=w.parameterName;D in y?y[D]=[...y[D]]:y[D]=[],y[D].push(w.value)}if(t.doenetAttributes.addToSharedParameters)for(let w of t.doenetAttributes.addToSharedParameters){let D=w.parameterName;D in y?y[D]=Object.assign({},y[D]):y[D]={},y[D][w.key]=w.value}if(d!==void 0){let w=!1,D,I;if(r.alwaysSetUpVariant||r.setUpVariantIfVariantControlChild){for(let[A,S]of d.entries())if(S.componentType==="variantcontrol"||S.createdComponent&&components[S.componentName].componentType==="variantcontrol"){D=A,I=S;break}(D!==void 0||r.alwaysSetUpVariant)&&(w=!0)}if(w){if(D!==void 0){let P=t.variants.desiredVariant;P!==void 0&&(P.index!==void 0?I.variants.desiredVariantNumber=P.index:P.value!==void 0&&(I.variants.desiredVariant=P.value)),t.variants.uniquevariants&&(y.numberOfVariants=t.variants.numberOfVariants);let L=this.createIsolatedComponentsSub({serializedComponents:[I],ancestors:f,applyAdapters:i,shadow:a,updatesNeeded:s,compositesBeingExpanded:o,createNameContext:"variantControl",namespaceForUnamed:l});p[D]=L.components[0]}r.setUpVariant({serializedComponent:t,sharedParameters:y,definingChildrenSoFar:p,allComponentClasses:this.allComponentClasses});let A=[...d.keys()].filter(P=>P!==D),S=d.filter((P,L)=>L!==D),O=this.createIsolatedComponentsSub({serializedComponents:S,ancestors:f,applyAdapters:i,shadow:a,updatesNeeded:s,compositesBeingExpanded:o,namespaceForUnamed:l});for(let[P,L]of A.entries())p[L]=O.components[P]}else if(r.keepChildrenSerialized){let A=new Set([]),S=r.keepChildrenSerialized({serializedComponent:t,componentInfoObjects:this.componentInfoObjects});for(let L of S){if(A.has(Number(L)))throw Error("Invalid instructions to keep children serialized from "+r.componentType+": child repeated");A.add(Number(L)),m.push(d[L])}let O=[],P=[];for(let[L,F]of d.entries())A.has(L)||(O.push(F),P.push(L));if(O.length>0){let L=this.createIsolatedComponentsSub({serializedComponents:O,ancestors:f,applyAdapters:i,shadow:a,updatesNeeded:s,compositesBeingExpanded:o,namespaceForUnamed:l});for(let[F,M]of P.entries())p[M]=L.components[F]}}else p=this.createIsolatedComponentsSub({serializedComponents:d,ancestors:f,applyAdapters:i,shadow:a,updatesNeeded:s,compositesBeingExpanded:o,namespaceForUnamed:l}).components}let g=r.returnChildLogic({standardComponentClasses:this.standardComponentClasses,allComponentClasses:this.allComponentClasses,components:this.components,allPossibleProperties:this.allPossibleProperties,sharedParameters:y,flags:this.flags});if(g===void 0||typeof g.applyLogic!="function")throw Error("Invalid component class "+r.componentType+": returnChildLogic must return a childLogic object");let T={};t.downstreamDependencies&&Object.assign(T,t.downstreamDependencies);for(let w in b){let D=b[w],I=D.componentName;T[I]===void 0&&(T[I]=[]),T[I].push({dependencyType:"ancestorProp",property:w,ancestorIdentity:D})}let N=this.createStateVariableDefinitions({childLogic:g,componentClass:r,prescribedDependencies:T,componentName:e});s.deletedComponents[e]&&(s.recreatedComponents[e]=!0),delete s.deletedComponents[e],delete s.deletedStateVariables[e];let v=new r({componentName:e,ancestors:n,definingChildren:p,childLogic:g,stateVariableDefinitions:N,serializedChildren:m,serializedComponent:t,componentInfoObjects:this.componentInfoObjects,coreFunctions:this.coreFunctions,flags:this.flags,shadow:a,numerics:this.numerics,sharedParameters:y,parentSharedParameters:h});this.registerComponent(v),c&&(v.replacementOf=c);for(let w in T){let D=T[w];for(let I of D)if(I.dependencyType==="referenceShadow"){let A={componentName:w};Object.assign(A,I),delete A.dependencyType,v.shadows=new Proxy(A,K);let S=this._components[w];S.shadowedBy||(S.shadowedBy=[]),S.shadowedBy.push(v);break}}this.deriveChildResultsFromDefiningChildren(v,s,o),this.initializeComponentStateVariables(v),this.dependencies.setUpComponentDependencies({component:v,core:this,updatesNeeded:s,compositesBeingExpanded:o});let{varsUnresolved:C}=this.resolveStateVariables({component:v,updatesNeeded:s,compositesBeingExpanded:o});this.addUnresolvedDependencies({varsUnresolved:C,component:v,updatesNeeded:s});let x=this.dependencies.checkForDependenciesOnNewComponent({componentName:e,updatesNeeded:s,compositesBeingExpanded:o});for(let w of x)this.recordActualChangeInStateVariable({componentName:w.componentName,varName:w.varName,updatesNeeded:s});return this.parameterStack.pop(),{newComponent:v}}addUnresolvedDependencies({varsUnresolved:t,component:e,updatesNeeded:n}){if(Object.keys(t).length>0){n.unresolvedDependencies[e.componentName]||(n.unresolvedDependencies[e.componentName]={}),Object.assign(n.unresolvedDependencies[e.componentName],t);for(let r in t)for(let i of t[r]){n.unresolvedByDependent[i.componentName]||(n.unresolvedByDependent[i.componentName]={}),n.unresolvedByDependent[i.componentName][i.stateVariable]||(n.unresolvedByDependent[i.componentName][i.stateVariable]=[]);let a=!1;for(let s of n.unresolvedByDependent[i.componentName][i.stateVariable])if(s.componentName===e.componentName&&s.stateVariable===r){a=!0;break}a||n.unresolvedByDependent[i.componentName][i.stateVariable].push({componentName:e.componentName,stateVariable:r})}}}propagateAncestorProps({componentClass:t,componentName:e,sharedParameters:n}){let r=t.createPropertiesObject({standardComponentClasses:this.standardComponentClasses,allPossibleProperties:this.allPossibleProperties}),i={};for(let o in r)r[o].propagateToDescendants&&(i[o]={componentName:e,componentType:t.componentType});let a={},s={};for(let o in n.propertiesToPropagate)o in r&&(s[o]=!0,r[o].ignorePropagationFromAncestors||(a[o]=n.propertiesToPropagate[o]));if(Object.keys(i).length>0||Object.keys(s).length>0){if(n.propertiesToPropagate){n.propertiesToPropagate=Object.assign({},n.propertiesToPropagate);for(let o in s)delete n.propertiesToPropagate[o]}else n.propertiesToPropagate={};Object.assign(n.propertiesToPropagate,i)}return a}deriveChildResultsFromDefiningChildren(t,e,n){t.activeChildren&&this.evaluatedDeferredChildStateVariables(t),t.activeChildren=t.definingChildren.slice(),t.allChildren={};for(let a=0;a<t.activeChildren.length;a++){let s=t.activeChildren[a];t.allChildren[s.componentName]={activeChildrenIndex:a,definingChildrenIndex:a,component:s}}let r=this.replaceCompositeChildren(t,e,n);t.constructor.includeBlankStringChildren||(t.activeChildren=t.activeChildren.filter(a=>a.componentType!=="string"||/\S/.test(a.stateValues.value)));let i=this.matchChildrenToChildLogic({component:t,applyAdapters:!0,updatesNeeded:e});return i.success?delete this.unsatisfiedChildLogic[t.componentName]:this.unsatisfiedChildLogic[t.componentName]={message:t.childLogic.logicResult.message},i}matchChildrenToChildLogic({component:t,applyAdapters:e=!0,updatesNeeded:n}){let r=0;if(e===!0)for(let s of t.activeChildren){let o=s.nAdapters;o>r&&(r=o)}let i=0,a=!1;for(;i<=r;i++)if(t.childLogic.applyLogic({activeChildren:t.activeChildren,maxAdapterNumber:i}).success){a=!0,this.substituteAdapters(t,n);break}return{success:a}}expandCompositeComponent({component:t,updatesNeeded:e,compositesBeingExpanded:n}){if(!("readyToExpand"in t.state))throw Error(`Could not evaluate state variable readyToExpand of composite ${t.componentName}`);if(!t.state.readyToExpand.isResolved||!t.state.readyToExpand.value)return e.compositesToExpand.add(t.componentName),{success:!1};if(e.compositesToExpand.delete(t.componentName),n.push(t.componentName),t.shadows){if(n.includes(t.shadows.componentName)){let d=this._components[t.shadows.componentName];for(;d.shadows;)d=this._components[d.shadows.componentName];throw Error(`Circular reference involving ${d.componentName}`)}let a=this._components[t.shadows.componentName];if(!a.isExpanded&&!this.expandCompositeComponent({component:a,updatesNeeded:e,compositesBeingExpanded:n}).success){let p=n.indexOf(t.componentName);if(p===-1)throw Error(`Something is wrong as we lost track that we were expanding ${t.componentName}`);return n.splice(p,1),{sucess:!1,readyToExpand:!0}}let s=a.replacements.map(d=>d.serialize({forCopy:!0})),o=t.replacementsWorkspace.uniqueIdentifiersUsed=[],l=t.shadows.compositeName;if(s=ke({serializedComponents:s,componentName:l,uniqueIdentifiersUsed:o}),t.constructor.assignNamesToReplacements){let d=t.constructor.originalNamesAreConsistent&&t.doenetAttributes.newNamespace;s=U({assignNames:t.doenetAttributes.assignNames,serializedComponents:s,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:d}).serializedComponents}else{let d=t.doenetAttributes.newNamespace;s=U({serializedComponents:s,parentName:t.componentName,parentCreatesNewNamespace:t.doenetAttributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:d}).serializedComponents}this.createAndSetReplacements({component:t,serializedReplacements:s,updatesNeeded:e,compositesBeingExpanded:n}),e.parentsToUpdateDescendants.add(t.componentName);for(let d of gt(t,this.components))e.parentsToUpdateDescendants.add(d);let c=n.indexOf(t.componentName);if(c===-1)throw Error(`Something is wrong as we lost track that we were expanding ${t.componentName}`);return n.splice(c,1),{success:!0}}let r=t.constructor.createSerializedReplacements({component:this.components[t.componentName],components:this.components,workspace:t.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects});if(r.replacements){let a=r.replacements;this.createAndSetReplacements({component:t,serializedReplacements:a,updatesNeeded:e,compositesBeingExpanded:n})}else throw Error(`Invalid createSerializedReplacements of ${t.componentName}`);e.parentsToUpdateDescendants.add(t.componentName);for(let a of gt(t,this.components))e.parentsToUpdateDescendants.add(a);let i=n.indexOf(t.componentName);if(i===-1)throw Error(`Something is wrong as we lost track that we were expanding ${t.componentName}`);return n.splice(i,1),{success:!0}}createAndSetReplacements({component:t,serializedReplacements:e,updatesNeeded:n,compositesBeingExpanded:r}){this.parameterStack.push(t.sharedParameters,!1);let i;t.doenetAttributes.newNamespace?i=t.componentName+"/":i=en(t.componentName);let a=this.createIsolatedComponentsSub({serializedComponents:e,ancestors:t.ancestors,shadow:!0,updatesNeeded:n,compositesBeingExpanded:r,createNameContext:t.componentName+"|replacements",namespaceForUnamed:i,componentsReplacementOf:t});this.parameterStack.pop(),t.replacements=a.components,this.dependencies.updateReplacementDependencies(t,n,r),t.isExpanded=!0;let s=[];for(let l of["replacements","recursiveReplacements","fullRecursiveReplacements"])s.push(l),t.state["__determine_dependencies_"+l]&&s.push("__determine_dependencies_"+l);let o=this.resolveStateVariables({component:t,stateVariables:s,updatesNeeded:n,compositesBeingExpanded:r});if(Object.keys(o.varsUnresolved).length>0)throw console.log(o),Error("Couldn't resolve replacement variables after expanding!")}replaceCompositeChildren(t,e,n){let r=!1;for(let i=0;i<t.activeChildren.length;i++){let a=t.activeChildren[i];if(a instanceof this._allComponentClasses._composite){if(t.childLogic.checkIfChildInLogic(a))continue;if(!a.isExpanded){let l=this.expandCompositeComponent({component:a,updatesNeeded:e,compositesBeingExpanded:n});if(!l.success){if(l.readyToExpand)throw Error(`expand result of ${a.componentName} was not a success even though ready to expand.`);r=!0;continue}}this.markWithheldReplacementInactive(a,e);let s=a.replacements;a.replacementsToWithhold>0&&(s=s.slice(0,-a.replacementsToWithhold)),t.activeChildren.splice(i,1,...s);let o=t.allChildren[a.componentName];delete o.activeChildrenIndex;for(let l=0;l<s.length;l++){let c=s[l];t.allChildren[c.componentName]={activeChildrenIndex:i+l,component:c}}if(s.length!==1){let l=s.length-1;for(let c=i+s.length;c<t.activeChildren.length;c++){let d=t.activeChildren[c];t.allChildren[d.componentName].activeChildrenIndex+=l}}i--}}return{compositeChildNotReadyToExpand:r}}markWithheldReplacementInactive(t,e){let n=t.replacements.length;t.stateValues.isInactiveCompositeReplacement?n=0:t.replacementsToWithhold>0&&(n-=t.replacementsToWithhold);for(let r of t.replacements.slice(0,n))this.changeInactiveComponentAndDescendants(r,!1,e);for(let r of t.replacements.slice(n))this.changeInactiveComponentAndDescendants(r,!0,e)}changeInactiveComponentAndDescendants(t,e,n){if(t.stateValues.isInactiveCompositeReplacement!==e){t.state.isInactiveCompositeReplacement.value=e,this.markUpstreamDependentsStale({component:t,varName:"isInactiveCompositeReplacement",updatesNeeded:n}),this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:"isInactiveCompositeReplacement"});for(let r in t.allChildren)this.changeInactiveComponentAndDescendants(this._components[r],e,n);t.replacements&&this.markWithheldReplacementInactive(t,n)}}substituteAdapters(t,e){if(t.childLogicSatisfied){let n=t.childLogic.logicResult.adapterResults;for(let r in n){let i=t.activeChildren[r],a=n[r],s=i.adapterUsed;if(s===void 0||s.componentType!==a.componentType){let o;t.doenetAttributes.newNamespace?o=t.componentName+"/":o=en(t.componentName),s=this.createIsolatedComponentsSub({serializedComponents:[a],shadow:!0,ancestors:i.ancestors,updatesNeeded:e,createNameContext:i.componentName+"|adapter",namespaceForUnamed:o}).components[0],i.adapterUsed=s,s.adaptedFrom=i}t.activeChildren.splice(r,1,s),delete t.allChildren[i.componentName].activeChildrenIndex,t.allChildren[s.componentName]={activeChildrenIndex:Number(r),component:s}}}}findShadowedChildInSerializedComponents({serializedComponents:t,shadowedComponentName:e}){for(let n of t){if(n.originalName===e)return n;if(n.children){let r=this.findShadowedChildInSerializedComponents({serializedComponents:n.children,shadowedComponentName:e});if(r)return r}}}createStateVariableDefinitions({childLogic:t,componentClass:e,prescribedDependencies:n,componentName:r}){let i,a={};if(n)for(let c in n){let d=n[c];for(let p of d)p.dependencyType==="referenceShadow"?i={linkSource:"referenceShadow",targetName:c,compositeName:p.compositeName,propVariable:p.propVariable,arrayStateVariable:p.arrayStateVariable,arrayKey:p.arrayKey,ignorePrimaryStateVariable:p.ignorePrimaryStateVariable}:p.dependencyType==="adapter"?i={linkSource:"adapter",adapterTargetIdentity:p.adapterTargetIdentity,adapterVariable:p.adapterVariable}:p.dependencyType==="ancestorProp"?a[p.property]=p.ancestorIdentity:p.dependencyType==="nonShadowingReplacement"&&(i={linkSource:"nonShadowingReplacement",compositeName:c})}let s={};i||this.createPropertyStateVariableDefinitions({childLogic:t,ancestorProps:a,stateVariableDefinitions:s});let o=e.returnNormalizedStateVariableDefinitions({propertyNames:Object.keys(s),numerics:this.numerics});Object.assign(s,o),i&&(i.linkSource==="adapter"?this.createAdapterStateVariableDefinitions({redefineDependencies:i,childLogic:t,stateVariableDefinitions:s,componentClass:e}):this.createReferenceShadowStateVariableDefinitions({redefineDependencies:i,childLogic:t,stateVariableDefinitions:s,componentClass:e,ancestorProps:a}));let l=s.childrenToRender;if(l){let c=l.definition,d=this;l.definition=function(p){return d.componentsWithChangedChildrenToRender.add(r),c(p)}}return s}createPropertyStateVariableDefinitions({childLogic:t,ancestorProps:e,stateVariableDefinitions:n}){for(let r in t.properties){let i=t.properties[r],a="_property_"+r,s=i.componentType?i.componentType:r,o=i.default;o===void 0&&(o=null);let l=this.allComponentClasses[r.toLowerCase()];if(!l)throw Error(`Component type ${r} does not exist so cannot create property.`);let c=l.stateVariableForPropertyValue;c===void 0&&(c="value");let d=[];i.dependentStateVariables&&d.push(...i.dependentStateVariables);let p=!1;l.attributesForPropertyValue&&(p=l.attributesForPropertyValue.isArray);let m,f,h;if(r in e){m={[a]:{dependencyType:"child",childLogicName:a,variableNames:[c]},ancestorProp:{dependencyType:"stateVariable",componentName:e[r].componentName,variableName:r}};for(let b of d)m[b.dependencyName]={dependencyType:"stateVariable",variableName:b.variableName};f=function({dependencyValues:b,usedDefault:g,arrayKeys:T,freshnessInfo:N}){let v=b[a];if(v.length===0)return g.ancestorProp?p?{useEssentialOrDefaultValue:{[r]:{__entire_array:{variablesToCheck:r,defaultValue:b.ancestorProp}}}}:{useEssentialOrDefaultValue:{[r]:{variablesToCheck:r,defaultValue:b.ancestorProp}}}:{newValues:{[r]:b.ancestorProp}};if(i.definitionForPropertyValue)return i.definitionForPropertyValue({dependencyValues:b,propertyChild:v,propertySpecification:new Proxy(i,K),arrayKeys:T,freshnessInfo:N});if(l.definitionForPropertyValue)return l.definitionForPropertyValue({dependencyValues:b,propertyChild:v,propertySpecification:new Proxy(i,K),arrayKeys:T,freshnessInfo:N});let C=Ti({value:v[0].stateValues[c],propertySpecification:i,property:r});if(i.mergeArrays&&Array.isArray(b.ancestorProp)&&Array.isArray(C)){let x=[...C,...b.ancestorProp];return{newValues:{[r]:x}}}else return{newValues:{[r]:C}}},h=function({desiredStateVariableValues:b,dependencyValues:g,usedDefault:T}){return g[a].length===0?T.ancestorProp?{success:!0,instructions:[{setStateVariable:r,value:b[r]}]}:{success:!0,instructions:[{setDependency:"ancestorProp",desiredValue:b[r]}]}:i.definitionForPropertyValue?i.inverseDefinitionForPropertyValue?i.inverseDefinitionForPropertyValue({desiredStateVariableValues:b,dependencyValues:g,propertySpecification:new Proxy(i,K)}):{success:!1}:l.definitionForPropertyValue?l.inverseDefinitionForPropertyValue?l.inverseDefinitionForPropertyValue({desiredStateVariableValues:b,dependencyValues:g,propertySpecification:new Proxy(i,K)}):{success:!1}:i.mergeArrays?{success:!1}:{success:!0,instructions:[{setDependency:a,desiredValue:b[r],childIndex:0,variableIndex:0}]}}}else{m={[a]:{dependencyType:"child",childLogicName:a,variableNames:[c]}};for(let g of d)m[g.dependencyName]={dependencyType:"stateVariable",variableName:g.variableName};let b=!((l.definitionForPropertyValue||i.definitionForPropertyValue)&&!("default"in i));f=function({dependencyValues:g,arrayKeys:T,freshnessInfo:N}){let v=g[a];if(v.length===0&&b)return p?{useEssentialOrDefaultValue:{[r]:{__entire_array:{variablesToCheck:r}}}}:{useEssentialOrDefaultValue:{[r]:{variablesToCheck:r}}};if(i.definitionForPropertyValue)return i.definitionForPropertyValue({dependencyValues:g,propertyChild:v,propertySpecification:new Proxy(i,K),arrayKeys:T,freshnessInfo:N});if(l.definitionForPropertyValue)return l.definitionForPropertyValue({dependencyValues:g,propertyChild:v,propertySpecification:new Proxy(i,K),arrayKeys:T,freshnessInfo:N});let C=Ti({value:v[0].stateValues[c],propertySpecification:i,property:r});if(i.mergeArrayWithDefault&&Array.isArray(C)){let x=i.default;if(Array.isArray(x)){let V=[...C,...x];return{newValues:{[r]:V}}}}return{newValues:{[r]:C}}},h=function({desiredStateVariableValues:g,dependencyValues:T}){return T[a].length===0?{success:!0,instructions:[{setStateVariable:r,value:g[r]}]}:i.definitionForPropertyValue?i.inverseDefinitionForPropertyValue?i.inverseDefinitionForPropertyValue({desiredStateVariableValues:g,dependencyValues:T,propertySpecification:new Proxy(i,K)}):{success:!1}:l.definitionForPropertyValue?l.inverseDefinitionForPropertyValue?l.inverseDefinitionForPropertyValue({desiredStateVariableValues:g,dependencyValues:T,propertySpecification:new Proxy(i,K)}):{success:!1}:i.mergeArrays?{success:!1}:{success:!0,instructions:[{setDependency:a,desiredValue:g[r],childIndex:0,variableIndex:0}]}}}n[r]={public:!0,componentType:s,isProperty:!0,defaultValue:o,returnDependencies:()=>m,definition:f,inverseDefinition:h},l.markStaleForPropertyValue&&(n[r].markStale=l.markStaleForPropertyValue);for(let b in l.attributesForPropertyValue)n[r][b]=l.attributesForPropertyValue[b];let y=["forRenderer","entryPrefixes","requireChildLogicInitiallySatisfied","useDefaultForShadows","propagateToProps"];for(let b of y)b in i&&(n[r][b]=i[b])}}createAdapterStateVariableDefinitions({redefineDependencies:t,childLogic:e,stateVariableDefinitions:n,componentClass:r}){let i=this._components[t.adapterTargetIdentity.componentName];for(let o in e.properties){let l=e.properties[o],c=l.componentType?l.componentType:o,d=l.default,p={};o in i.state&&(p.adapterTargetVariable={dependencyType:"stateVariable",componentName:t.adapterTargetIdentity.componentName,variableName:o}),n[o]={public:!0,componentType:c,isProperty:!0,defaultValue:d,returnDependencies:()=>p,definition:function({dependencyValues:m}){return m.adapterTargetVariable===void 0?{useEssentialOrDefaultValue:{[o]:{variablesToCheck:o}}}:{newValues:{[o]:m.adapterTargetVariable}}},inverseDefinition:function({desiredStateVariableValues:m,dependencyValues:f}){return f.adapterTargetVariable===void 0?{success:!0,instructions:[{setStateVariable:o,value:m[o]}]}:{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:m[o]}]}}};for(let m of["forRenderer","entryPrefixes"])m in l&&(n[o][m]=l[m])}let a="value";r.primaryStateVariableForDefinition&&(a=r.primaryStateVariableForDefinition);let s=n[a];s.returnDependencies=()=>({adapterTargetVariable:{dependencyType:"stateVariable",componentName:t.adapterTargetIdentity.componentName,variableName:t.adapterVariable}}),s.set?s.definition=function({dependencyValues:o}){return{newValues:{[a]:s.set(o.adapterTargetVariable)}}}:s.definition=function({dependencyValues:o}){return{newValues:{[a]:o.adapterTargetVariable}}},s.inverseDefinition=function({desiredStateVariableValues:o}){return{success:!0,instructions:[{setDependency:"adapterTargetVariable",desiredValue:o[a]}]}}}createReferenceShadowStateVariableDefinitions({redefineDependencies:t,childLogic:e,stateVariableDefinitions:n,componentClass:r,ancestorProps:i}){let a=this._components[t.compositeName],s=this._components[t.targetName],o=t.linkSource==="nonShadowingReplacement",l={};if(t.propVariable){let m=s.state[t.propVariable];m&&m.stateVariablesPrescribingAdditionalProperties&&(l=m.stateVariablesPrescribingAdditionalProperties)}for(let m in e.properties){let f=e.properties[m],h=f.componentType?f.componentType:m,y=f.default,b={};m in a.state&&(b.compositeComponentVariable={dependencyType:"stateVariable",componentName:a.componentName,variableName:m}),!o&&(!t.propVariable||f.propagateToProps)&&m in s.state&&(b.targetVariable={dependencyType:"stateVariable",componentName:s.componentName,variableName:m},"targetPropertiesToIgnore"in a.state&&(b.targetPropertiesToIgnore={dependencyType:"stateVariable",componentName:a.componentName,variableName:"targetPropertiesToIgnore"})),l[m]&&(b.targetVariable={dependencyType:"stateVariable",componentName:s.componentName,variableName:l[m]}),m in i&&(b.ancestorProp={dependencyType:"stateVariable",componentName:i[m].componentName,variableName:m}),n[m]={public:!0,componentType:h,isProperty:!0,defaultValue:y,returnDependencies:()=>b,definition:function({dependencyValues:g,usedDefault:T}){if(g.compositeComponentVariable!==void 0&&(!T.compositeComponentVariable||a.state[m].useDefaultForShadows)){let N=Ti({value:g.compositeComponentVariable,propertySpecification:f,property:m});return{newValues:{[m]:N}}}else{if(g.targetVariable!==void 0&&!(g.targetPropertiesToIgnore&&g.targetPropertiesToIgnore.map(N=>N.toLowerCase()).includes(m.toLowerCase()))&&(!T.targetVariable||s.state[m].useDefaultForShadows))return{newValues:{[m]:g.targetVariable}};if(g.ancestorProp!==void 0){let N=Ti({value:g.ancestorProp,propertySpecification:f,property:m});return T.ancestorProp?{useEssentialOrDefaultValue:{[m]:{variablesToCheck:m,defaultValue:N}}}:{newValues:{[m]:N}}}else return{useEssentialOrDefaultValue:{[m]:{variablesToCheck:m}}}}},inverseDefinition:function({desiredStateVariableValues:g,dependencyValues:T,usedDefault:N}){if(T.compositeComponentVariable!==void 0&&!N.compositeComponentVariable)return{success:!0,instructions:[{setDependency:"compositeComponentVariable",desiredValue:g[m]}]};if(T.targetVariable!==void 0&&!(T.targetPropertiesToIgnore&&T.targetPropertiesToIgnore.map(v=>v.toLowerCase()).includes(m.toLowerCase()))&&!N.targetVariable)return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:g[m]}]};if(T.ancestorProp!==void 0)if("ancestorProp"in N){let v=[{setStateVariable:m,value:g[m]}];return T.targetVariable!==void 0&&!(T.targetPropertiesToIgnore&&T.targetPropertiesToIgnore.map(C=>C.toLowerCase()).includes(m.toLowerCase()))&&v.push({setDependency:"targetVariable",desiredValue:g[m]}),{success:!0,instructions:v}}else return{success:!0,instructions:[{setDependency:"ancestorProp",desiredValue:g[m]}]};else{let v=[{setStateVariable:m,value:g[m]}];return T.targetVariable!==void 0&&!(T.targetPropertiesToIgnore&&T.targetPropertiesToIgnore.map(C=>C.toLowerCase()).includes(m.toLowerCase()))&&v.push({setDependency:"targetVariable",desiredValue:g[m]}),{success:!0,instructions:v}}}};for(let g of["forRenderer","entryPrefixes"])g in f&&(n[m][g]=f[g])}if(o)return;if(t.propVariable){if(!t.ignorePrimaryStateVariable){let m="value";r.primaryStateVariableForDefinition&&(m=r.primaryStateVariableForDefinition);let f=n[m];if(!f)throw Error(`Cannot have a public state variable with componentType ${r.componentType} as the class doesn't have a primary state variable for definition`);f.returnDependencies=()=>({targetVariable:{dependencyType:"stateVariable",componentName:s.componentName,variableName:t.propVariable}}),f.set?f.definition=function({dependencyValues:h}){return{newValues:{[m]:f.set(h.targetVariable)},alwaysShadow:[m]}}:f.definition=function({dependencyValues:h}){return{newValues:{[m]:h.targetVariable},alwaysShadow:[m]}},f.inverseDefinition=function({desiredStateVariableValues:h}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:h[m]}]}}}return}let c=!1;if("readyToExpand"in n){c=!0;let m=n.readyToExpand,f=m.returnDependencies.bind(m),h=m.definition;m.returnDependencies=function(y){let b=f(y);return b.targetReadyToExpand={dependencyType:"stateVariable",componentName:s.componentName,variableName:"readyToExpand"},b},m.definition=function(y){let b=h(y);return b.newValues&&b.newValues.readyToExpand&&(y.dependencyValues.targetReadyToExpand||(b.newValues.readyToExpand=!1)),b}}let d=[...s.constructor.stateVariablesShadowedForReference];d||(d=[]);let p=[];for(let m in s.state){let f=s.state[m];if(!(f.isProperty||m in d)&&(f.isResolved&&!f.willNeverBeEssential&&f.value,!f.neverShadow)){if(f.essential||f.alwaysShadow||f.isShadow||f.isArray&&f.isResolved&&s.state[f.arraySizeStateVariable].isResolved&&f.getAllArrayKeys(f.arraySize).length>0&&f.getAllArrayKeys(f.arraySize).some(h=>f.essentialByArrayKey[h]))d.includes(m)||d.push(m);else if((!f.isResolved||f.isArray&&!s.state[f.arraySizeStateVariable].isResolved)&&!p.includes(m)){let h=n[m];if(!h)continue;let y=[m];h.additionalStateVariablesDefined&&y.push(...h.additionalStateVariablesDefined);let b={targetComponent:s,foundReadyToExpand:c};f.isArray&&!f.entireArrayAtOnce&&!s.state[f.arraySizeStateVariable].isResolved&&(b.arraySizeStateVariableToResolve=f.arraySizeStateVariable);for(let g of y)n[g].determineIfShadowData=b;p.push(...y)}}}this.modifyStateDefsToBeShadows({stateVariablesToShadow:d,stateVariableDefinitions:n,foundReadyToExpand:c,targetComponent:s})}modifyStateDefsToBeShadows({stateVariablesToShadow:t,stateVariableDefinitions:e,foundReadyToExpand:n,targetComponent:r}){let i={};for(let a of t){let s=e[a];if(s===void 0)if(a.slice(0,8)==="__array_")s=e[a]={};else continue;if(s.isShadow=!0,s.additionalStateVariablesDefined)for(let l of s.additionalStateVariablesDefined)t.includes(l)||(i[l]||(i[l]=[]),i[l].push(a));delete s.additionalStateVariablesDefined,n||delete s.stateVariablesDeterminingDependencies;let o=s.public&&s.componentType===void 0;if(s.isArray)s.returnArrayDependenciesByKey=function({arrayKeys:l}){let c={};for(let p of l)c[p]={targetVariable:{dependencyType:"stateVariable",componentName:r.componentName,variableName:this.arrayVarNameFromArrayKey(p)}};let d={};return o&&(d.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:r.componentName,variableName:a}),{globalDependencies:d,dependenciesByKey:c}},s.arrayDefinitionByKey=function({globalDependencyValues:l,dependencyValuesByKey:c,arrayKeys:d}){let p={};for(let f of d)"targetVariable"in c[f]?p[f]=c[f].targetVariable:p[f]=s.defaultEntryValue;let m={newValues:{[a]:p},alwaysShadow:[a]};return"targetVariableComponentType"in l&&(m.setComponentType={[a]:l.targetVariableComponentType}),m},s.inverseArrayDefinitionByKey=function({desiredStateVariableValues:l,dependencyValuesByKey:c,dependencyNamesByKey:d,arraySize:p}){let m=[];for(let f in l[a])!c[f]||m.push({setDependency:d[f].targetVariable,desiredValue:l[a][f],shadowedVariable:!0});return{success:!0,instructions:m}};else{let l={};n&&(l=s.returnDependencies.bind(s)),s.returnDependencies=function(c){let d=Object.assign({},l);return d.targetVariable={dependencyType:"stateVariable",componentName:r.componentName,variableName:a},o&&(d.targetVariableComponentType={dependencyType:"stateVariableComponentType",componentName:r.componentName,variableName:a}),d},s.definition=function({dependencyValues:c}){let d={alwaysShadow:[a]};return"targetVariableComponentType"in c&&(d.setComponentType={[a]:c.targetVariableComponentType}),d.newValues={[a]:c.targetVariable},d},s.inverseDefinition=function({desiredStateVariableValues:c,dependencyValues:d}){return{success:!0,instructions:[{setDependency:"targetVariable",desiredValue:c[a],shadowedVariable:!0}]}}}}for(let a in i)this.modifyStateDefToDeleteVariableReferences({varNamesToDelete:i[a],stateDef:e[a]})}modifyStateDefToDeleteVariableReferences({varNamesToDelete:t,stateDef:e}){for(let r of t){let i=e.additionalStateVariablesDefined.indexOf(r);e.additionalStateVariablesDefined.splice(i,1)}let n=e.definition;e.definition=function(r){let i=n(r);for(let a in i)if(Array.isArray(i[a]))for(let s of t){let o=i[a].indexOf(s);o!==-1&&i[a].splice(o,1)}else for(let s of t)delete i[a][s];return i}}initializeComponentStateVariables(t){for(let e in t.state)t.state[e].isAlias?(t.stateVarAliases||(t.stateVarAliases={}),t.stateVarAliases[e]=t.state[e].targetVariableName,delete t.state[e]):this.initializeStateVariable({component:t,stateVariable:e})}initializeStateVariable({component:t,stateVariable:e,arrayStateVariable:n,arrayEntryPrefix:r,updatesNeeded:i}){let a=this.getStateVariableValue;t.state[e]||(t.state[e]={});let s=t.state[e];s.isResolved=!1,Object.defineProperty(s,"value",{get:()=>a({component:t,stateVariable:e}),configurable:!0}),r!==void 0?this.initializeArrayEntryStateVariable({stateVarObj:s,arrayStateVariable:n,arrayEntryPrefix:r,component:t,stateVariable:e,updatesNeeded:i}):s.isArray&&this.initializeArrayStateVariable({stateVarObj:s,component:t,stateVariable:e})}initializeArrayEntryStateVariable({stateVarObj:t,arrayStateVariable:e,arrayEntryPrefix:n,component:r,stateVariable:i,updatesNeeded:a}){t.isArrayEntry=!0,t.neverShadow=!0,t.arrayStateVariable=e;let s=r.state[e];if(t.definition=s.definition,t.inverseDefinition=s.inverseDefinition,t.markStale=s.markStale,t.freshnessInfo=s.freshnessInfo,t.getPreviousDependencyValuesForMarkStale=s.getPreviousDependencyValuesForMarkStale,t.nDimensions=s.returnEntryDimensions(n),t.wrappingComponents=s.returnWrappingComponents(n),t.entryPrefix=n,t.varEnding=i.slice(n.length),s.additionalStateVariablesDefined){t.additionalStateVariablesDefined=[];let o=s.entryPrefixes.indexOf(n);for(let l of s.additionalStateVariablesDefined){let c=r.state[l];if(c.isArray){let p=c.entryPrefixes[o]+t.varEnding;t.additionalStateVariablesDefined.push(p)}else t.additionalStateVariablesDefined.push(l)}}if(s.getEntryValues?t.getValueFromArrayValues=function(){return s.getEntryValues({varName:i})}:t.getValueFromArrayValues=function(){if(t.arrayKeys.length===0)return;let o=[];for(let l of t.arrayKeys)o.push(s.getArrayValue({arrayKey:l}));return o.length===1?o[0]:o},t.arraySizeStateVariable=s.arraySizeStateVariable,t._arrayKeys=[],t._unflattenedArrayKeys=[],Object.defineProperty(t,"arrayKeys",{get:function(){return s.arraySize,t._arrayKeys}}),Object.defineProperty(t,"unflattenedArrayKeys",{get:function(){return s.arraySize,t._unflattenedArrayKeys}}),r.state[t.arraySizeStateVariable].isResolved){let o=r.stateValues[t.arraySizeStateVariable],l=s.getArrayKeysFromVarName({arrayEntryPrefix:t.entryPrefix,varEnding:t.varEnding,arraySize:o,nDimensions:s.nDimensions});t._unflattenedArrayKeys=l,t._arrayKeys=ne(l);let c=s.varNamesIncludingArrayKeys;for(let d of t._arrayKeys)c[d]||(c[d]=[]),c[d].push(i)}if(s.arrayEntryNames.push(i),Object.defineProperty(t,"arraySize",{get:()=>s.arraySize}),Object.defineProperty(t,"arrayEntrySize",{get:function(){let o=t.unflattenedArrayKeys,l=[],c=[o];for(let d=0;d<t.nDimensions;d++)c=c[0],l.push(c.length);return l.reverse(),l}}),s.stateVariablesDeterminingDependencies){t.stateVariablesDeterminingDependencies||(t.stateVariablesDeterminingDependencies=[]);for(let o of s.stateVariablesDeterminingDependencies)t.stateVariablesDeterminingDependencies.includes(o)||t.stateVariablesDeterminingDependencies.push(o)}if(s.entireArrayAtOnce)t.entireArrayAtOnce=!0,t.returnDependencies=s.returnDependencies.bind(s);else{let o=s.returnDependencies.bind(s);t.returnDependencies=function(l){l.arraySize=t.arraySize,l.arrayKeys=t.arrayKeys;let c=o(l),d=Object.keys(s.dependencyNames.namesByKey).length;return t.numberNamesInPreviousReturnDep!==d&&(l.changedDependency=!0),t.numberNamesInPreviousReturnDep=d,c}}}initializeArrayStateVariable({stateVarObj:t,component:e,stateVariable:n}){t.arrayValues=[],t.nDimensions===void 0&&(t.nDimensions=1),t.nDimensions>1?(t.keyToIndex=i=>i.split(",").map(a=>Number(a)),t.setArrayValue=function({value:i,arrayKey:a,arraySize:s}){let o=t.keyToIndex(a),l=o.length;if(!l>t.nDimensions)return console.warn("Cannot set array value.  Number of dimensions is too large."),{nFailures:1};let c=t.arrayValues,d=s;for(let m of o.slice(0,o.length-1))if(m>=0&&m<d[0])c[m]||(c[m]=[]),c=c[m],d=d.slice(1);else return console.warn("ignore setting array value out of bounds"),{nFailures:1};let p=0;if(l<t.nDimensions){let m=function(h,y,b){if(!Array.isArray(h))return console.warn("ignoring array values with insufficient dimensions"),{nFailures:1};let g=0,T=b[0];if(h.length>T&&(console.warn("ignoring array values of out bounds"),g+=h.length-T,h=h.slice(0,T)),b.length===1)for(let[N,v]of h.entries())y[N]=v;else for(let[N,v]of h.entries())y[N]||(y=[]),g+=m(v,y[N],b[N]).nFailures;return{nFailures:g}};p+=m(i,c,d).nFailures}else c[o[o.length-1]]=i;return{nFailures:p}},t.getArrayValue=function({arrayKey:i,arrayValues:a=t.arrayValues}){let s=t.keyToIndex(i),o=a;for(let l of s.slice(0,s.length-1))if(o=o[l],!o)return;return o[s[s.length-1]]},t.getArrayKeysFromVarName||(t.getArrayKeysFromVarName=function({arrayEntryPrefix:i,varEnding:a,arraySize:s,nDimensions:o}){let l=a.split("_").map(c=>Number(c)-1);return l.length===o&&l.every((c,d)=>Number.isInteger(c)&&c>=0)?s?l.every((c,d)=>c<s[d])?[String(l)]:[]:[String(l)]:[]}),t.getAllArrayKeys=function(i,a=!0){function s(o){if(o.length===1)return Array.from(Array(o[0]),(l,c)=>String(c));{let l=o[0],c=s(o.slice(1)),d=[];for(let p=0;p<l;p++)a?d.push(...c.map(m=>p+","+m)):d.push(c.map(m=>p+","+m));return d}}return!i||i.length===0?[]:s(i)},t.arrayVarNameFromArrayKey||(t.arrayVarNameFromArrayKey=function(i){return r[0]+i.split(",").map(a=>Number(a)+1).join("_")}),t.adjustArrayToNewArraySize=function(){function i(a,s){if(a.length=s[0],s.length>1){let o=s.slice(1);for(let[l,c]of a.entries())c||(c=a[l]=[]),i(c,o)}}i(t.arrayValues,t.arraySize);for(let a of Object.keys(t.essentialByArrayKey))t.keyToIndex(a).some((o,l)=>o>=t.arraySize[l])&&delete t.essentialByArrayKey[a]}):(t.keyToIndex=i=>Number(i),t.setArrayValue=function({value:i,arrayKey:a,arraySize:s}){let o=t.keyToIndex(a);return o>=0&&o<s[0]?(t.arrayValues[o]=i,{nFailures:0}):(console.warn(`Ignoring setting array values out of bounds: ${a} of ${n}`),{nFailures:1})},t.getArrayValue=function({arrayKey:i,arrayValues:a=t.arrayValues}){return a[i]},t.getArrayKeysFromVarName||(t.getArrayKeysFromVarName=function({arrayEntryPrefix:i,varEnding:a,arraySize:s}){let o=Number(a)-1;return Number.isInteger(o)&&o>=0?s?o<s[0]?[String(o)]:[]:[String(o)]:[]}),t.getAllArrayKeys=function(i){return!i||i.length===0?[]:Array.from(Array(i[0]),(a,s)=>String(s))},t.arrayVarNameFromArrayKey||(t.arrayVarNameFromArrayKey=function(i){return r[0]+String(Number(i)+1)}),t.adjustArrayToNewArraySize=function(){t.arrayValues.length=t.arraySize[0];for(let i of Object.keys(t.essentialByArrayKey))t.keyToIndex(i)>=t.arraySize[0]&&delete t.essentialByArrayKey[i]}),t.indexToKey=i=>String(i);let r=t.entryPrefixes;r||(r=[n]),e.arrayEntryPrefixes||(e.arrayEntryPrefixes={});for(let i of r)e.arrayEntryPrefixes[i]=n;if(t.returnEntryDimensions||(t.returnEntryDimensions=()=>1),t.returnWrappingComponents||(t.returnWrappingComponents=i=>[]),t.wrappingComponents=t.returnWrappingComponents(),t.essentialByArrayKey={},t.arrayEntryNames=[],t.varNamesIncludingArrayKeys={},t.entireArrayAtOnce){let i=function(a,s){if(a===void 0)return Array(s).fill(0);let o=[a.length];return s>1&&o.push(...i(a[0],s-1)),o};t.getCurrentFreshness=function({freshnessInfo:a}){return{fresh:{[n]:a.arrayFresh}}},t.markStale=function({freshnessInfo:a}){return a.arrayFresh=!1,t.arraySizeStale=!0,{fresh:{[n]:!1}}},t.freshenOnNoChanges=function({freshnessInfo:a}){a.arrayFresh=!0},t.definition=function(a){if(a.freshnessInfo.arrayFresh)return{noChanges:[t.arraySizeStateVariable]};a.freshnessInfo.arrayFresh=!0;let s=t.entireArrayDefinition(a);if(s.newValues){let o=s.newValues[n],l=i(o,t.nDimensions);s.newValues[t.arraySizeStateVariable]=l}else if(s.useEssentialOrDefaultValue&&!t._previousValue){let o=s.defaultValue;o===void 0&&(o=t.defaultValue);let l=i(o,t.nDimensions);s.newValues={[t.arraySizeStateVariable]:l}}if(s.checkForActualChange||(s.checkForActualChange={}),s.checkForActualChange[t.arraySizeStateVariable]=!0,s.arraySizeChanged=[n],t.additionalStateVariablesDefined)for(let o of t.additionalStateVariablesDefined)e.state[o].isArray&&s.arraySizeChanged.push(o);return s}}else{let i=function(a,s){let o={};for(let d of t.dependencyNames.global)o[d]=a[d];let l={},c={};for(let d of s)if(l[d]={},d in t.dependencyNames.namesByKey){c[d]=!0;for(let p in t.dependencyNames.namesByKey[d]){let m=t.dependencyNames.namesByKey[d][p];m in a?l[d][p]=a[m]:c[d]=!1}}return{globalDependencyValues:o,dependencyValuesByKey:l,foundAllDependencyValuesForKey:c}};t.returnDependencies=function(a){a.arraySize=t.arraySize;for(let o in a.stateValues)o.slice(0,8)==="__array_"&&delete a.stateValues[o];a.arrayKeys===void 0&&(a.arrayKeys=t.getAllArrayKeys(a.arraySize));let s={};if(t.basedOnArrayKeyStateVariables&&a.arrayKeys.length>1)for(let o of a.arrayKeys)s[o]={dependencyType:"stateVariable",variableName:t.arrayVarNameFromArrayKey(o)};else{let o=t.returnArrayDependenciesByKey(a);if(!t.dependencyNames&&(t.dependencyNames={namesByKey:{},keysByName:{},global:[]},t.additionalStateVariablesDefined))for(let l of t.additionalStateVariablesDefined)e.state[l].dependencyNames=t.dependencyNames;o.globalDependencies&&(t.dependencyNames.global=Object.keys(o.globalDependencies),Object.assign(s,o.globalDependencies)),o.dependenciesByKey||(o.dependenciesByKey={});for(let l of a.arrayKeys){l in t.dependencyNames.namesByKey||(a.changedDependency=!0),t.dependencyNames.namesByKey[l]={};for(let c in o.dependenciesByKey[l]){let d="__"+l+"_"+c;s[d]=o.dependenciesByKey[l][c],t.dependencyNames.namesByKey[l][c]=d,t.dependencyNames.keysByName[d]||(t.dependencyNames.keysByName[d]=[]),t.dependencyNames.keysByName[d].push(l)}}t.dependencyNames.global.push("__array_size")}return s.__array_size={dependencyType:"stateVariable",variableName:t.arraySizeStateVariable},s},t.getCurrentFreshness=function({freshnessInfo:a,arrayKeys:s,arraySize:o}){s===void 0&&(s=t.getAllArrayKeys(o));let l=a.freshByKey,c=a.freshArraySize?1:0;for(let d of s)l[d]&&(c+=1);return c>0?c===s.length+1?{fresh:{[n]:!0}}:{partiallyFresh:{[n]:c}}:{fresh:{[n]:!1}}},t.markStale=function({freshnessInfo:a,changes:s,arrayKeys:o,arraySize:l}){let c={};o===void 0&&(o=t.getAllArrayKeys(l)),t.markStaleByKey&&(c=t.markStaleByKey({arrayKeys:o,changes:s}));let d=a.freshByKey;if(s.__array_size)return a.freshArraySize=!1,a.freshByKey={},c.fresh={[n]:!1},c;if(Object.keys(d).length===0)return a.freshByKey={},a.freshArraySize?(c.partiallyFresh={[n]:1},c):(c.fresh={[n]:!1},c);for(let m in s){if(t.dependencyNames.global.includes(m))return a.freshByKey={},a.freshArraySize?(c.partiallyFresh={[n]:1},c):(c.fresh={[n]:!1},c);if(t.basedOnArrayKeyStateVariables&&o.length>1)delete d[m];else for(let f of t.dependencyNames.keysByName[m])delete d[f]}let p=a.freshArraySize?1:0;for(let m of o)d[m]&&(p+=1);return p>0?p===o.length+1?(c.fresh={[n]:!0},c):(c.partiallyFresh={[n]:p},c):(c.fresh={[n]:!1},c)},t.freshenOnNoChanges=function({arrayKeys:a,freshnessInfo:s,arraySize:o}){let l=s.freshByKey;a===void 0&&(a=t.getAllArrayKeys(o));for(let c of a)l[c]=!0},t.definition=function(a){if(a.arrayKeys===void 0&&(a.arrayKeys=t.getAllArrayKeys(a.arraySize)),t.basedOnArrayKeyStateVariables&&a.arrayKeys.length>1)return{};{let s=i(a.dependencyValues,a.arrayKeys),o=s.globalDependencyValues,l=s.dependencyValuesByKey,c=s.foundAllDependencyValuesForKey;delete a.dependencyValues,a.globalDependencyValues=o,a.dependencyValuesByKey=l;let d=[],p=a.freshnessInfo.freshByKey;for(let f of a.arrayKeys)!p[f]&&c[f]&&(p[f]=!0,d.push(f));let m;if(d.length===0)m={};else{if(a.arrayKeys=d,!t.arrayDefinitionByKey)throw Error(`For ${n} of ${e.componentType}, arrayDefinitionByKey must be a function`);if(m=t.arrayDefinitionByKey(a),m.newValues&&m.newValues[n])for(let f in m.newValues[n])p[f]=!0;if(m.useEssentialOrDefaultValue&&m.useEssentialOrDefaultValue[n])for(let f in m.useEssentialOrDefaultValue[n])p[f]=!0}if(!a.freshnessInfo.freshArraySize){if(a.changes.__array_size&&(m.arraySizeChanged=[n],t.additionalStateVariablesDefined))for(let f of t.additionalStateVariablesDefined)e.state[f].isArray&&m.arraySizeChanged.push(f);a.freshnessInfo.freshArraySize=!0}return m}},t.inverseDefinition=function(a){if(!t.inverseArrayDefinitionByKey)return{success:!1};if(a.arrayKeys===void 0&&(a.arrayKeys=t.getAllArrayKeys(a.arraySize)),t.basedOnArrayKeyStateVariables&&a.arrayKeys.length>1){let s=[];for(let o in a.desiredStateVariableValues[n])o in a.dependencyValues&&s.push({setDependency:o,desiredValue:a.desiredStateVariableValues[n][o],treatAsInitialChange:a.initialChange});return{success:!0,instructions:s}}else{let s=i(a.dependencyValues,a.arrayKeys),o=s.globalDependencyValues,l=s.dependencyValuesByKey;return delete a.dependencyValues,a.globalDependencyValues=o,a.dependencyValuesByKey=l,a.dependencyNamesByKey=t.dependencyNames.namesByKey,t.inverseArrayDefinitionByKey(a)}}}if(this.createArraySizeStateVariable({stateVarObj:t,component:e,stateVariable:n}),t.arraySizeStale=!0,t.previousArraySize=[],Object.defineProperty(t,"arraySize",{get:function(){return e.state[t.arraySizeStateVariable].isResolved?(t.arraySizeStale&&t.recalculateArraySizeDependentQuantities(),e.stateValues[t.arraySizeStateVariable]):[]}}),t.recalculateArraySizeDependentQuantities=function(){let i=e.stateValues[t.arraySizeStateVariable];if(t.previousArraySize.length!==i.length||t.previousArraySize.some((a,s)=>a!=i[s])){t.previousArraySize=[...i];let a=t.varNamesIncludingArrayKeys={};for(let s of t.arrayEntryNames){let o=e.state[s],l=t.getArrayKeysFromVarName({arrayEntryPrefix:o.entryPrefix,varEnding:o.varEnding,arraySize:i,nDimensions:t.nDimensions});o._unflattenedArrayKeys=l,o._arrayKeys=ne(l);for(let c of o._arrayKeys)a[c]||(a[c]=[]),a[c].push(s)}}t.arraySizeStale=!1},!t.freshnessInfo&&(t.entireArrayAtOnce?t.freshnessInfo={arrayFresh:!1}:t.freshnessInfo={freshByKey:{}},t.additionalStateVariablesDefined))for(let i of t.additionalStateVariablesDefined)e.state[i]||(e.state[i]={}),e.state[i].freshnessInfo=t.freshnessInfo}createArraySizeStateVariable({stateVarObj:t,component:e,stateVariable:n}){let r=`__array_size_${n}`;t.arraySizeStateVariable=r;let i,a;if(t.entireArrayAtOnce?t.additionalStateVariablesDefined?(a=[...t.additionalStateVariablesDefined],t.additionalStateVariablesDefined.push(r)):t.additionalStateVariablesDefined=[r]:t.stateVariablesDeterminingDependencies?(i=[...t.stateVariablesDeterminingDependencies],t.stateVariablesDeterminingDependencies.push(r)):t.stateVariablesDeterminingDependencies=[r],t.entireArrayAtOnce)e.state[r]={returnDependencies:t.returnDependencies.bind(t),getCurrentFreshness:t.getCurrentFreshness.bind(t),markStale:t.markStale.bind(t),freshenOnNoChanges:t.freshenOnNoChanges.bind(t),definition:t.definition.bind(t)},t.inverseDefinition&&(e.state[r].inverseDefinition=t.inverseDefinition.bind(t)),t.stateVariablesDeterminingDependencies&&(e.state[r].stateVariablesDeterminingDependencies=t.stateVariablesDeterminingDependencies),a?e.state[r].additionalStateVariablesDefined=a:e.state[r].additionalStateVariablesDefined=[],e.state[r].additionalStateVariablesDefined.push(n);else{if(t.isShadow){let s=e.state[r];s.markStale=function(){return t.arraySizeStale=!0,{}};return}e.state[r]={alwaysShadow:!0,returnDependencies:t.returnArraySizeDependencies,definition({dependencyValues:s}){let o=t.returnArraySize({dependencyValues:s});for(let[l,c]of o.entries())Number.isInteger(c)&&c>=0||(o[l]=0);return{newValues:{[r]:o}}},markStale(){return t.arraySizeStale=!0,{}}},i&&(e.state[r].stateVariablesDeterminingDependencies=i)}this.initializeStateVariable({component:e,stateVariable:r})}recursivelyReplaceCompositesWithReplacements({replacements:t,recurseNonStandardComposites:e=!1}){let n=[],r=[];for(let i of t)if(this.isCompositeComponent({componentType:i.componentType,includeNonStandard:e})){if(n.push(i.componentName),i.replacements){let a=this.recursivelyReplaceCompositesWithReplacements({replacements:i.replacements,recurseNonStandardComposites:e});n.push(...a.compositesFound),r.push(...a.newReplacements)}}else r.push(i);return{compositesFound:n,newReplacements:r}}getStateVariableValue({component:t,stateVariable:e}){let n=t.state[e];if(!(n&&n.isResolved))throw Error(`Can't get value of ${e} of ${t.componentName} as it doesn't exist or is not resolved.`);let r=this.getStateVariableDefinitionArguments({component:t,stateVariable:e});r.componentInfoObjects=this.componentInfoObjects,r.freshnessInfo=n.freshnessInfo;let i=n.additionalStateVariablesDefined;t instanceof this.allComponentClasses._composite&&(r.replacementsWorkspace=new Proxy(t.replacementsWorkspace,K));let a;if(Object.keys(r.changes).length===0&&n._previousValue!==void 0&&!n.forceRecalculation){let l=[e];i&&l.push(...i),a={noChanges:l},n.freshenOnNoChanges&&n.freshenOnNoChanges(r)}else delete n.forceRecalculation,a=n.definition(r);let s={[e]:!1},o={};if(i)for(let l of i)s[l]=!1;for(let l in a.newValues){if(!(l in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} returned value of ${l}, which isn't a state variable.`);let c;if(l in s)s[l]=!0,o[l]=!0;else{if(t.state[l].isArray&&t.state[l].arrayEntryNames){for(let d of t.state[l].arrayEntryNames)if(d in s){c=d,s[d]=!0,o[d]=!0;break}}if(!c)throw Error(`Attempting to set value of stateVariable ${l} in definition of ${e} of ${t.componentName}, but it's not listed as an additional state variable defined.`)}if(!t.state[l].isResolved&&(!c||!t.state[c].isResolved))throw Error(`Attempting to set value of stateVariable ${l} of ${t.componentName} while it is still unresolved!`);if(t.state[l].isArray)if(t.state[l].entireArrayAtOnce)t.state[l].arrayValues=a.newValues[l],o[l]={arrayKeysChanged:{},allArrayKeysChanged:!0};else{o[l]={arrayKeysChanged:{}};let d={};a.checkForActualChange&&a.checkForActualChange[l]&&(d=a.checkForActualChange[l]);let p=t.state[l].arraySize;for(let m in a.newValues[l])if(d[m]){let f=t.state[l].getArrayValue({arrayKey:m}),h=a.newValues[l][m];f!==h&&(t.state[l].setArrayValue({value:a.newValues[l][m],arrayKey:m,arraySize:p}),o[l].arrayKeysChanged[m]=!0)}else t.state[l].setArrayValue({value:a.newValues[l][m],arrayKey:m,arraySize:p}),o[l].arrayKeysChanged[m]=!0}else if(delete t.state[l].value,t.state[l].value=a.newValues[l],delete t.state[l].usedDefault,a.checkForActualChange&&a.checkForActualChange[l]){let d=t.state[l].value,p=t.state[l]._previousValue;(d===p||Array.isArray(d)&&Array.isArray(p)&&d.length===p.length&&d.every((m,f)=>m===p[f]))&&delete o[l]}}for(let l in a.useEssentialOrDefaultValue){if(!(l in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} requested essential or default value of ${l}, which isn't a state variable.`);let c;if(l in s)s[l]=!0;else{if(t.state[l].isArray&&t.state[l].arrayEntryNames){for(let f of t.state[l].arrayEntryNames)if(f in s){c=f,s[f]=!0;break}}if(!c)throw Error(`Attempting to set value of stateVariable ${l} in definition of ${e} of ${t.componentName}, but it's not listed as an additional state variable defined.`)}if(!t.state[l].isResolved&&(!c||!t.state[c].isResolved))throw Error(`Attempting to set value of stateVariable ${l} of ${t.componentName} while it is still unresolved!`);let{haveEssentialValue:d,valueUnchanged:p,byArrayEntries:m}=this.setValueToEssential({component:t,varName:l,useEssentialInfo:a.useEssentialOrDefaultValue[l]});if(m){let f=t.state[l].arraySize;for(let h in a.useEssentialOrDefaultValue[l])d[h]||("defaultValue"in a.useEssentialOrDefaultValue[l][h]?(t.state[l].setArrayValue({value:a.useEssentialOrDefaultValue[l][h].defaultValue,arrayKey:h,arraySize:f}),t.state[l].essentialByArrayKey[h]=!0):"defaultEntryValue"in t.state[l]&&(t.state[l].setArrayValue({value:t.state[l].defaultEntryValue,arrayKey:h,arraySize:f}),t.state[l].essentialByArrayKey[h]=!0)),p[h]||(o[l]===void 0&&(o[l]={arrayKeysChanged:{}}),o[l].arrayKeysChanged[h]=!0)}else if(p||(o[l]=!0),!d)if("defaultValue"in a.useEssentialOrDefaultValue[l])delete t.state[l].value,t.state[l].value=a.useEssentialOrDefaultValue[l].defaultValue,t.state[l].usedDefault=!0,t.state[l].essential=!0;else if("defaultValue"in t.state[l])delete t.state[l].value,t.state[l].value=t.state[l].defaultValue,t.state[l].usedDefault=!0,t.state[l].essential=!0;else throw Error(`Neither value nor default value specified; state variable: ${l}, component: ${t.componentName}.`)}if(a.noChanges)for(let l of a.noChanges){if(!t.state[l].isResolved)throw Error(`Claiming state variable is unchanged when it isn't yet resolved: ${l} of ${t.componentName}`);if(!(l in s)){let c;if(t.state[l].isArray&&t.state[l].arrayEntryNames){for(let d of t.state[l].arrayEntryNames)if(d in s){c=d;break}}if(!c)throw Error(`Claiming stateVariable ${l} is unchanged in definition of ${e} of ${t.componentName}, but it's not listed as an additional state variable defined.`)}s[l]=!0,(Object.getOwnPropertyDescriptor(t.state[l],"value").get||t.state[l].immutable)&&(delete t.state[l].value,t.state[l].value=t.state[l]._previousValue)}if(a.makeEssential)for(let l of a.makeEssential){if(!(l in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} tried to make ${l} essential, which isn't a state variable.`);if(!t.state[l].isResolved)throw Error(`Attempting to make stateVariable ${l} of ${t.componentName} essential while it is still unresolved!`);if(!(l in s)){let c;if(t.state[l].isArray&&t.state[l].arrayEntryNames){for(let d of t.state[l].arrayEntryNames)if(d in s){c=d;break}}if(!c)throw Error(`Attempting to make stateVariable ${l} in definition of ${e} of ${t.componentName} essential, but it's not listed as an additional state variable defined.`)}t.state[l].essential=!0}if(a.makeImmutable)for(let l of a.makeImmutable){if(!(l in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} tried to make ${l} immutable, which isn't a state variable.`);if(!t.state[l].isResolved)throw Error(`Attempting to make stateVariable ${l} of ${t.componentName} immutable while it is still unresolved!`);if(!(l in s)){let c;if(t.state[l].isArray&&t.state[l].arrayEntryNames){for(let d of t.state[l].arrayEntryNames)if(d in s){c=d;break}}if(!c)throw Error(`Attempting to make stateVariable ${l} in definition of ${e} of ${t.componentName} immutable, but it's not listed as an additional state variable defined.`)}t.state[l].immutable=!0}if(a.alwaysShadow)for(let l of a.alwaysShadow){if(!(l in t.state))throw Error(`Definition of state variable ${e} of ${t.componentName} set alwaysShadow for ${l}, which isn't a state variable.`);if(!(l in s)){let c=!1;if(t.state[l].isArray&&t.state[l].arrayEntryNames){for(let d of t.state[l].arrayEntryNames)if(d in s){c=!0;break}}if(!c)throw Error(`Definition of state variable ${e} of ${t.componentName} set alwaysShadow for ${l}, but didn't set its value.`)}t.state[l].alwaysShadow=!0}if(a.setComponentType)for(let l in a.setComponentType){let c=!1,d=t.state[l].componentType,p=a.setComponentType[l];if(Array.isArray(d)?Array.isArray(p)?(d.length!==p.length||d.some((m,f)=>m!=p[f]))&&(c=!0):c=!0:Array.isArray(p)?c=!0:c=d!==p,c&&(o[l]=!0),t.state[l].componentType=a.setComponentType[l],t.state[l].isArray&&t.state[l].arrayEntryNames){let m=a.setComponentType[l],f=Array.isArray(m);for(let h of t.state[l].arrayEntryNames)if(f){let y=t.state[h].arrayKeys,b=[];for(let g of y){let T=t.state[l].keyToIndex(g);b.push(m[T])}t.state[h].componentType=b}else t.state[h].componentType=m}}if(a.arraySizeChanged)for(let l of a.arraySizeChanged)t.state[l].entireArrayAtOnce?o[t.state[l].arraySizeStateVariable]&&(o[l]===void 0?o[l]={arrayKeysChanged:{}}:o[l]===!0&&(o[l]={allArrayKeysChanged:!0,arrayKeysChanged:{}}),o[l].arraySizeChanged=!0):(t.state[l].adjustArrayToNewArraySize(),o[l]===void 0?o[l]={arrayKeysChanged:{}}:o[l]===!0&&(o[l]={allArrayKeysChanged:!0,arrayKeysChanged:{}}),o[l].arraySizeChanged=!0);for(let l in s){if(!(s[l]||t.state[l].isArrayEntry||t.state[l].isArray))throw Error(`definition of ${e} of ${t.componentName} didn't return value of ${l}`);if(t.state[l].isArray)delete t.state[l].value,t.state[l].value=t.state[l].arrayValues;else if(t.state[l].isArrayEntry){if(delete t.state[l].value,t.state[l].entireArrayAtOnce){let c=t.state[l].arraySizeStateVariable;o[c]&&(this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:c,changes:o[c]}),delete o[c])}t.state[l].value=t.state[l].getValueFromArrayValues()}}for(let l in o)if(this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:l,changes:o[l]}),t.state[l].isArray){let c=[];if(o[l]===!0||o[l].allArrayKeysChanged||o.arraySizeChanged)t.state[l].arrayEntryNames&&(c=t.state[l].arrayEntryNames);else{let d=t.state[l].varNamesIncludingArrayKeys;for(let p in o[l].arrayKeysChanged){let m=d[p];m&&c.push(...m)}}for(let d of c)this.dependencies.recordActualChangeInUpstreamDependencies({component:t,varName:d})}return n.value}setValueToEssential({component:t,varName:e,useEssentialInfo:n}){let r=!1,i=!1,a=!1;if(t.state[e].isArray)if("__entire_array"in n)n=n.__entire_array;else{a=!0,i={},r={};for(let s in n)r[s]=!1}if(t.state[e].essential&&!a)return t.state[e].isArray||(delete t.state[e].value,t.state[e].value=t.state[e]._previousValue),{haveEssentialValue:!0,valueUnchanged:!0,byArrayEntries:a};if(t.potentialEssentialState)if(a){let s=t.state[e].arraySize;for(let o in n)if(t.state[e].essentialByArrayKey[o]||t.state[e].essential)r[o]=!0,i[o]=!0;else{let l=n[o].variablesToCheck;Array.isArray(l)||(l=[l]);let{foundEssential:c,value:d}=this.findPotentialEssentialValue({variablesToCheck:l,potentialEssentialState:t.potentialEssentialState});c&&(t.state[e].setArrayValue({value:d,arrayKey:o,arraySize:s}),t.state[e].essentialByArrayKey[o]=!0,r[o]=!0)}}else{let s=n.variablesToCheck;Array.isArray(s)||(s=[s]);let{foundEssential:o,value:l}=this.findPotentialEssentialValue({variablesToCheck:s,potentialEssentialState:t.potentialEssentialState});o&&(t.state[e].isArray?t.state[e].arrayValues=l:(delete t.state[e].value,t.state[e].value=l),t.state[e].essential=!0,r=!0)}else if(a)for(let s in n)(t.state[e].essentialByArrayKey[s]||t.state[e].essential)&&(r[s]=!0,i[s]=!0);return{haveEssentialValue:r,valueUnchanged:i,byArrayEntries:a}}findPotentialEssentialValue({variablesToCheck:t,potentialEssentialState:e}){for(let n of t){let r,i,a;if(typeof n=="string"?r=n:(r=n.variableName,i=n.mathComponentIndex,a=n.arrayIndex),e[r]!==void 0){let s=e[r];if(a!==void 0)if(Array.isArray(a))for(let o of a)s=s[o];else s=s[a];else i!==void 0&&s instanceof YA.class&&(s=s.get_component(i));return{foundEssential:!0,value:s}}}return{foundEssential:!1}}getStateVariableDefinitionArguments({component:t,stateVariable:e}){let n=this.dependencies.getStateVariableDependencyValues({component:t,stateVariable:e});n.componentName=t.componentName;let r=t.state[e];if(r.isArrayEntry&&!r.entireArrayAtOnce?(n.arrayKeys=r.arrayKeys,n.arraySize=r.arraySize):r.isArray&&!r.entireArrayAtOnce&&(n.arraySize=r.arraySize),r.providePreviousValuesInDefinition){let i=[e];r.additionalStateVariablesDefined&&i.push(...r.additionalStateVariablesDefined);let a={};for(let s of i)a[s]=t.state[s]._previousValue;n.previousValues=a}return n}recordActualChangeInStateVariable({componentName:t,varName:e,includeAdditionalStateVariables:n=!0,updatesNeeded:r}){let i=this._components[t];this.markStateVariableAndUpstreamDependentsStale({component:i,varName:e,updatesNeeded:r});let a=[e];n&&i.state[e].additionalStateVariablesDefined&&a.push(...i.state[e].additionalStateVariablesDefined);for(let s of a)i.state[s].forceRecalculation=!0,this.dependencies.recordActualChangeInUpstreamDependencies({component:i,varName:s})}resolveStateVariables({component:t,stateVariables:e,updatesNeeded:n,compositesBeingExpanded:r}){let i=t.componentName,a={},s=Infinity,o=[];e||(e=Object.keys(t.state));for(let l of e)t.state[l].isResolved||o.push(l);for(;o.length>0&&o.length<s;){let l=[];for(let c of o){if(n.deletedStateVariables[i]&&n.deletedStateVariables[i].includes(c))continue;let d=this.dependencies.downstreamDependencies[i][c],p=!0,m=[],f=!0;for(let h in d){let y=d[h];if(y.unresolvedSpecifiedComponent&&!this.switches.ignoreUnresolvedSpecifiedComponents&&(p=!1,y.unresolvedSpecifiedComponent!==i&&(f=!1),m.push({componentName:y.unresolvedSpecifiedComponent,stateVariable:"__specified_component_identity"})),y.requireChildLogicInitiallySatisfied&&!t.childLogicSatisfied&&!this.switches.ignoreRequireChildLogicInitiallySatisfied&&(p=!1,m.push({componentName:i,stateVariable:"__childLogic"})),y.expandReplacements){let T=this._components[y.compositeName];T.isExpanded||this.expandCompositeComponent({component:T,updatesNeeded:n,compositesBeingExpanded:r}).success||(p=!1,m.push({componentName:y.compositeName,stateVariable:"__replacements"}))}let b=y.downstreamComponentNames;b||(y.downstreamComponentName?b=[y.downstreamComponentName]:b=[]);let g=y.mappedDownstreamVariableNamesByComponent;g||y.mappedDownstreamVariableName&&(g=[[y.mappedDownstreamVariableName]]);for(let[T,N]of b.entries()){let v=this._components[N];if(!v)p=!1,N!==i&&(f=!1),m.push({componentName:N,stateVariable:"__identity"});else if(g){let C=g[T];for(let x of C){let V=!1;if(!v.state[x]){if((y.variablesOptional||y.variableOptional)&&!this.checkIfArrayEntry({stateVariable:x,component:v}))continue;let w=this.createFromArrayEntry({stateVariable:x,component:v,updatesNeeded:n,compositesBeingExpanded:r});Object.keys(w.varsUnresolved).length>0&&(this.addUnresolvedDependencies({varsUnresolved:w.varsUnresolved,component:v,updatesNeeded:n}),v.componentName===i&&Object.assign(a,w.varsUnresolved))}v.state[x]&&v.state[x].isResolved&&(V=!0),V||(p=!1,N!==i&&(f=!1),m.push({componentName:N,stateVariable:x}))}}else if(y.downstreamAttribute)throw Error(`Unrecognized downstream attribute ${y.downstreamAttribute} for state variable ${c} of ${i}`)}}if(t.state[c].isResolved=p,p){if(delete a[c],t.state[c].actionOnResolved){let h=this.getStateVariableDefinitionArguments({component:t,stateVariable:c});h.updatesNeeded=n;let y=t.state[c].resolvedAction(h);y&&y.varsUnresolved&&Object.assign(a,y.varsUnresolved),c in t.state&&t.stateValues[c]}}else{let h=[...new Set(m.map(y=>y.componentName+"|"+y.stateVariable))];a[c]=h.map(function(y){let b=y.split("|");return{componentName:b[0],stateVariable:b[1]}}),f&&l.push(c)}}s=o.length,o=l}return{varsUnresolved:a}}findCaseInsensitiveMatches({stateVariables:t,componentClass:e}){let n=this.componentInfoObjects.stateVariableInfo[e.componentType.toLowerCase()],r=[];for(let i of t){let a=!1,s=i.toLowerCase();for(let d in n.stateVariableDescriptions)if(s===d.toLowerCase()){a=!0,r.push(d);break}if(a)continue;let o=!1,l=s;s.substring(0,13)==="__array_size_"&&(o=!0,l=s.substring(13));for(let d in n.aliases)if(l===d.toLowerCase()){o&&(d="__array_size_"+d),r.push(d),a=!0;break}if(a)continue;let c=Object.keys(n.arrayEntryPrefixes).sort((d,p)=>p.length-d.length);for(let d of c)if(s.substring(0,d.length)===d.toLowerCase()){let p=d+s.substring(d.length);a=!0,r.push(p);break}a||r.push(i)}return r}matchPublicStateVariables({stateVariables:t,componentClass:e}){let n=this.componentInfoObjects.publicStateVariableInfo[e.componentType.toLowerCase()],r=[];for(let i of t){if(i in n.stateVariableDescriptions){r.push(i);continue}let a=i;if(a in n.aliases&&(a=n.aliases[a],a in n.stateVariableDescriptions)){r.push(a);continue}let s=!1,o=Object.keys(n.arrayEntryPrefixes).sort((l,c)=>c.length-l.length);for(let l of o)if(a.substring(0,l.length)===l){s=!0;break}s?r.push(i):r.push("__not_public_"+i)}return r}substituteAliases({stateVariables:t,componentClass:e}){let n=[],r=this.componentInfoObjects.stateVariableInfo[e.componentType.toLowerCase()];for(let i of t){let a=!1;i.substring(0,13)==="__array_size_"&&(a=!0,i=i.substring(13)),i=i in r.aliases?r.aliases[i]:i,a&&(i="__array_size_"+i),n.push(i)}return n}checkIfArrayEntry({stateVariable:t,component:e}){for(let n in e.arrayEntryPrefixes)if(t.substring(0,n.length)===n)return!0;return!1}createFromArrayEntry({stateVariable:t,component:e,updatesNeeded:n,compositesBeingExpanded:r,initializeOnly:i=!1}){let a={},s=!1;if(!e.arrayEntryPrefixes)throw Error(`Unknown state variable ${t} of ${e.componentName}`);let o=Object.keys(e.arrayEntryPrefixes).sort((l,c)=>c.length-l.length);for(let l of o)if(t.substring(0,l.length)===l){let c=e.arrayEntryPrefixes[l];if(this.initializeStateVariable({component:e,stateVariable:t,arrayStateVariable:c,arrayEntryPrefix:l,updatesNeeded:n}),i)return{varsUnresolved:a};let d=[t];if(e.state[t].additionalStateVariablesDefined){d.push(...e.state[t].additionalStateVariablesDefined);for(let f of e.state[t].additionalStateVariablesDefined)e.state[f]||this.createFromArrayEntry({stateVariable:f,component:e,updatesNeeded:n,compositesBeingExpanded:r,initializeOnly:!0})}this.dependencies.setUpStateVariableDependencies({component:e,stateVariable:t,allStateVariablesAffected:d,core:this,updatesNeeded:n,compositesBeingExpanded:r});let p=[];for(let f of d)this.dependencies.checkForCircularDependency({componentName:e.componentName,varName:f}),p.push(f),e.state[f].determineDependenciesStateVariable&&p.push(e.state[f].determineDependenciesStateVariable);let m=this.resolveStateVariables({component:e,stateVariables:p,updatesNeeded:n,compositesBeingExpanded:r});Object.assign(a,m.varsUnresolved),s=!0;break}if(!s)throw Error(`Unknown state variable ${t} of ${e.componentName}`);return{varsUnresolved:a}}resolveAllDependencies(t,e){console.log("resolving all dependencies");let n=[],r=!0,i=!1;for(;r&&Object.keys(t.unresolvedDependencies).length>0||i;){r=!1,i=!1;for(let a in t.unresolvedByDependent){let s=t.deletedComponents[a],o=!1;if(!(a in this.components)&&!s){if(this.switches.ignoreUnresolvedSpecifiedComponents){let l=Object.keys(t.unresolvedByDependent[a]);l.length===1&&l[0]==="__specified_component_identity"&&(o=!0)}if(!o){n.push(a);continue}}for(let l in t.unresolvedByDependent[a]){if(s=t.deletedComponents[a],l==="__replacements"&&!s&&!this.components[a].isExpanded||l==="__childLogic"&&!s&&!this.components[a].childLogicSatisfied&&!this.switches.ignoreRequireChildLogicInitiallySatisfied)continue;let c=t.deletedStateVariables[a]&&t.deletedStateVariables[a].includes(l);if(l!=="__identity"&&l!=="__specified_component_identity"&&l!=="__replacements"&&l!=="__childLogic"&&!s&&!(l in this.components[a].state)&&!c){if(t.recreatedComponents[a])continue;throw Error(`Reference to invalid state variable ${l} of ${a}`)}if(!(a in t.unresolvedDependencies)||s||c||o||!(l in t.unresolvedDependencies[a])){for(let d of t.unresolvedByDependent[a][l]){let p=this._components[d.componentName];if(t.unresolvedDependencies[d.componentName]===void 0||t.unresolvedDependencies[d.componentName][d.stateVariable]===void 0)continue;if(t.deletedStateVariables[d.componentName]&&t.deletedStateVariables[d.componentName].includes(d.stateVariable)){delete t.unresolvedDependencies[d.componentName][d.stateVariable],Object.keys(t.unresolvedDependencies[d.componentName]).length===0&&delete t.unresolvedDependencies[d.componentName];continue}let m=this.resolveStateVariables({component:p,stateVariables:[d.stateVariable],updatesNeeded:t,compositesBeingExpanded:e});if(t.compositesToUpdateReplacements.length>0&&this.replacementChangesFromCompositesToUpdate({updatesNeeded:t,compositesBeingExpanded:e}),Object.keys(m.varsUnresolved).length>0){let f=Object.assign({},m.varsUnresolved);if(delete f[d.stateVariable],Object.keys(f).length>0){this.addUnresolvedDependencies({varsUnresolved:f,component:p,updatesNeeded:t});for(let h in f)delete m.varsUnresolved[h]}}Object.keys(m.varsUnresolved).length===0?(r=!0,delete t.unresolvedDependencies[d.componentName][d.stateVariable],Object.keys(t.unresolvedDependencies[d.componentName]).length===0&&delete t.unresolvedDependencies[d.componentName],d.stateVariable==="readyToExpand"&&p instanceof this._allComponentClasses._composite&&(this.processNewDefiningChildren({parent:this._components[p.parentName],updatesNeeded:t,compositesBeingExpanded:e}),t.compositesToUpdateReplacements.length>0&&this.replacementChangesFromCompositesToUpdate({updatesNeeded:t,compositesBeingExpanded:e}))):this.recalculateUnresolvedForDep({dep:d,componentName:a,varName:l,updatesNeeded:t,varsUnresolved:m.varsUnresolved}),delete m.varsUnresolved[d.stateVariable]}(!(a in t.unresolvedDependencies)||s||c||o||!(l in t.unresolvedDependencies[a]))&&(delete t.unresolvedByDependent[a][l],Object.keys(t.unresolvedByDependent[a]).length===0&&delete t.unresolvedByDependent[a])}}}for(let a of t.compositesToExpand){let s=this._components[a];if(!s)continue;let o=t.compositesToExpand.size;this.processNewDefiningChildren({parent:this._components[s.parentName],updatesNeeded:t,compositesBeingExpanded:e}),t.compositesToExpand.size<o&&(r=!0,t.compositesToUpdateReplacements.length>0&&this.replacementChangesFromCompositesToUpdate({updatesNeeded:t,compositesBeingExpanded:e}))}r&&Object.keys(t.unresolvedDependencies).length>0||(this.switches.ignoreUnresolvedSpecifiedComponents||(this.switches.ignoreUnresolvedSpecifiedComponents=!0,i=!0),this.switches.ignoreRequireChildLogicInitiallySatisfied||(this.switches.ignoreRequireChildLogicInitiallySatisfied=!0,i=!0))}for(let a in this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName)for(let s of this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[a])s.dependencyType==="targetComponent"?console.error(`Reference to invalid target name ${s.tName} by component ${s.upstreamComponentName}`):console.error(`Dependency ${s.dependencyName} of state variable ${s.representativeStateVariable} of component ${s.upstreamComponentName} references unknown component ${a}`);Object.keys(t.unresolvedDependencies).length>0&&this.createUnresolvedMessage(n,t),this.switches.ignoreUnresolvedSpecifiedComponents=!1,this.switches.ignoreRequireChildLogicInitiallySatisfied=!1}createUnresolvedMessage(t,e){let n="",r="",i="";if(t.length>0){t=new Set(t);for(let a of t)a in this.components||(i+=`Reference to invalid component name ${a}. `)}if(i)e.unresolvedMessage=i;else{for(let a in e.unresolvedDependencies){let s=this.components[a];if(!s.childLogicSatisfied)n+=`Invalid children for ${a}: ${s.childLogic.logicResult.message} `;else for(let o in e.unresolvedDependencies[a])r+=`Could not resolve state variable ${o} of ${a}. `}n?e.unresolvedMessage=n:e.unresolvedMessage=r}}recalculateUnresolvedForDep({dep:t,componentName:e,varName:n,varsUnresolved:r,updatesNeeded:i}){for(let a of i.unresolvedDependencies[t.componentName][t.stateVariable]){let s=a.componentName,o=a.stateVariable;if(s!==e||o!==n){let l;for(let[c,d]of i.unresolvedByDependent[s][o].entries())if(d.componentName===t.componentName&&d.stateVariable===t.stateVariable){l=c;break}if(l===void 0)throw Error("Something went wrong with unresolved dependencies....");i.unresolvedByDependent[s][o].splice(l,1)}}i.unresolvedDependencies[t.componentName][t.stateVariable]=r[t.stateVariable];for(let a of r[t.stateVariable]){let s=a.componentName,o=a.stateVariable;if(s===e&&o===n)throw Error(`State variable ${o} of ${s} reported as unresolved after already being resolved.`);i.unresolvedByDependent[s]===void 0&&(i.unresolvedByDependent[s]={}),i.unresolvedByDependent[s][o]===void 0&&(i.unresolvedByDependent[s][o]=[]),i.unresolvedByDependent[s][o].push({componentName:t.componentName,stateVariable:t.stateVariable})}}resetUpstreamDependentsUnresolved({component:t,varName:e,updatesNeeded:n}){let r=this.dependencies.upstreamDependencies[t.componentName][e];if(r)for(let i of r){n.componentsTouched.push(i.upstreamComponentName);let a=this._components[i.upstreamComponentName],s={};for(let o of i.upstreamVariableNames)s[o]=[{componentName:t.componentName,stateVariable:e}];this.addUnresolvedDependencies({varsUnresolved:s,component:a,updatesNeeded:n});for(let o of i.upstreamVariableNames){let l=a.state[o];l.isResolved&&(l.isResolved=!1,this.resetUpstreamDependentsUnresolved({component:a,varName:o,updatesNeeded:n}))}}}markStateVariableAndUpstreamDependentsStale({component:t,varName:e,updatesNeeded:n}){n.componentsTouched.push(t.componentName);let r={[e]:t.state[e]};t.state[e].additionalStateVariablesDefined&&t.state[e].additionalStateVariablesDefined.forEach(p=>r[p]=t.state[p]);let i=this.lookUpCurrentFreshness({component:t,varName:e,allStateVariablesAffectedObj:r}),a=[],s=[],o=0;for(let p in r){let m=r[p];Object.getOwnPropertyDescriptor(m,"value").get||m.immutable?i&&(i.fresh&&i.fresh[p]?s.push(p):i.partiallyFresh&&i.partiallyFresh[p]&&(o+=i.partiallyFresh[p])):a.push(p)}s.push(...a);let l=s.length>0||o>0,c={};for(let p in r)c[p]=!0;let d=!1;if(l){let p=this.processMarkStale({component:t,varName:e,allStateVariablesAffectedObj:r});if(p.fresh)for(let f in p.fresh)p.fresh[f]&&delete c[f];let m=0;for(let f in r){if(s.includes(f)&&!(p.fresh&&p.fresh[f])){d=!0;break}p.partiallyFresh&&p.partiallyFresh[f]&&(m+=p.partiallyFresh[f])}if(m<o&&(d=!0),p.updateReplacements&&n.compositesToUpdateReplacements.push(t.componentName),p.updateDependencies&&n.componentsToUpdateDependencies.push({componentName:t.componentName,stateVariables:p.updateDependencies}),p.itemScoreChanged)for(let f of p.itemScoreChanged.itemNumbers)n.itemScoreChanges.add(f)}for(let p in c){let m=r[p];if(delete m.recursiveDependencyValues,a.includes(p)){m._previousValue=m.value,delete m.value;let f=this.getStateVariableValue;Object.defineProperty(m,"value",{get:()=>f({component:t,stateVariable:p}),configurable:!0})}}if(d)for(let p in c)this.markUpstreamDependentsStale({component:t,varName:p,updatesNeeded:n})}lookUpCurrentFreshness({component:t,varName:e,allStateVariablesAffectedObj:n}){let r=t.state[e];if(!r.getCurrentFreshness)return;let i=r.freshnessInfo,a,s;if(r.isArrayEntry&&(a=new Proxy(r._arrayKeys,K)),r.isArrayEntry||r.isArray){let l=t.state[r.arraySizeStateVariable];s=l._previousValue,!(Object.getOwnPropertyDescriptor(l,"value").get||l.immutable)&&(s=l.value),Array.isArray(s)?s=new Proxy(s,K):s=[]}let o=r.getCurrentFreshness({freshnessInfo:i,arrayKeys:a,arraySize:s});if(o.partiallyFresh){for(let l in n)if(n[l].isArrayEntry){let c=n[l].arrayStateVariable;o.partiallyFresh[l]=o.partiallyFresh[c],delete o.partiallyFresh[c]}}if(o.fresh){for(let l in n)if(n[l].isArrayEntry){let c=n[l].arrayStateVariable;c in o.fresh&&(o.fresh[l]=o.fresh[c],delete o.fresh[c])}}return o}processMarkStale({component:t,varName:e,allStateVariablesAffectedObj:n}){let r=t.state[e];if(!r.markStale){let d={};return Object.keys(n).forEach(p=>d[p]=!1),{fresh:d}}let i={},a=this.dependencies.downstreamDependencies[t.componentName][e];for(let d in a){let p=a[d],m={},f=!1;p.componentIdentityChanged&&(m.componentIdentityChanged=!0,f=!0),p.componentIdentitiesChanged&&(m.componentIdentitiesChanged=!0,f=!0),p.valuesChanged&&(m.valuesChanged=p.valuesChanged,f=!0),f&&(i[d]=m)}let s=r.freshnessInfo,o,l;if(r.isArrayEntry&&!r.entireArrayAtOnce&&(o=new Proxy(r._arrayKeys,K)),(r.isArrayEntry||r.isArray)&&!r.entireArrayAtOnce){let d=t.state[r.arraySizeStateVariable];l=d._previousValue,!(Object.getOwnPropertyDescriptor(d,"value").get||d.immutable)&&(l=d.value),Array.isArray(l)?l=new Proxy(l,K):l=[]}let c=r.markStale({freshnessInfo:s,changes:i,arrayKeys:o,arraySize:l});if(c.partiallyFresh){for(let d in n)if(n[d].isArrayEntry){let p=n[d].arrayStateVariable;c.partiallyFresh[d]=c.partiallyFresh[p],delete c.partiallyFresh[p]}}if(c.fresh){for(let d in n)if(n[d].isArrayEntry){let p=n[d].arrayStateVariable;p in c.fresh&&(c.fresh[d]=c.fresh[p],delete c.fresh[p])}}return c}markUpstreamDependentsStale({component:t,varName:e,updatesNeeded:n}){let r=t.componentName,i=this.getStateVariableValue,a=this.dependencies.upstreamDependencies[r][e],s;if(t.state[e]&&(s=t.state[e].freshnessInfo),a)for(let o of a){let l=!1;if(o.downstreamComponentNames){let c=o.downstreamComponentNames.indexOf(r);if(c===-1)continue;if(o.originalDownstreamVariableNames.length>0){let d=o.mappedDownstreamVariableNamesByComponent[c].indexOf(e);if(d===-1)throw Error(`something went wrong as ${e} not a downstreamVariable of ${o.dependencyName}`);let p=o.originalDownstreamVariableNames[d];o.valuesChanged||(o.valuesChanged=[]),o.valuesChanged[c]||(o.valuesChanged[c]={}),o.valuesChanged[c][e]||(o.valuesChanged[c][e]={}),o.valuesChanged[c][e].potentialChange=!0,s&&(o.valuesChanged[c][e].freshnessInfo=new Proxy(s,K)),l=!0}else e===o.downstreamVariableNameIfNoVariables&&(o.valuesChanged||(o.valuesChanged={[o.downstreamVariableNameIfNoVariables]:{}}),o.componentIdentityChanged=!0,o.valuesChanged[o.downstreamVariableNameIfNoVariables].potentialChange=!0,l=!0)}if(l){n.componentsTouched.push(o.upstreamComponentName);let c=o.upstreamVariableNames[0],d=this._components[o.upstreamComponentName],p={};o.upstreamVariableNames.forEach(N=>p[N]=d.state[N]);let m=this.lookUpCurrentFreshness({component:d,varName:c,allStateVariablesAffectedObj:p}),f=[],h=[],y=0;for(let N in p){let v=p[N];Object.getOwnPropertyDescriptor(v,"value").get||v.immutable?m&&(m.fresh&&m.fresh[N]?h.push(N):m.partiallyFresh&&m.partiallyFresh[N]&&(y+=m.partiallyFresh[N])):f.push(N)}h.push(...f);let b=h.length>0||y>0,g={};for(let N in p)g[N]=!0;let T=!1;if(b){let N=this.processMarkStale({component:d,varName:c,allStateVariablesAffectedObj:p});if(N.fresh)for(let C in N.fresh)N.fresh[C]&&delete g[C];let v=0;for(let C in p){if(h.includes(C)&&!(N.fresh&&N.fresh[C])){T=!0;break}N.partiallyFresh&&N.partiallyFresh[C]&&(v+=N.partiallyFresh[C])}if(v<y&&(T=!0),N.updateReplacements&&n.compositesToUpdateReplacements.push(o.upstreamComponentName),N.updateDependencies&&n.componentsToUpdateDependencies.push({componentName:o.upstreamComponentName,stateVariables:N.updateDependencies}),N.itemScoreChanged)for(let C of N.itemScoreChanged.itemNumbers)n.itemScoreChanges.add(C)}for(let N in g){let v=p[N];delete v.recursiveDependencyValues,f.includes(N)&&(v._previousValue=v.value,delete v.value,Object.defineProperty(v,"value",{get:()=>i({component:d,stateVariable:N}),configurable:!0}))}if(T)for(let N in g)this.markUpstreamDependentsStale({component:d,varName:N,updatesNeeded:n})}}}evaluatedDeferredChildStateVariables(t){for(let e of t.activeChildren)if(e.componentType==="string"){for(let n in e.state)if(e.state[n].deferred){let r=e.state[n].value}}}registerComponent(t){if(t.componentName in this._components)throw Error(`Duplicate componentName: ${t.componentName}`);this._components[t.componentName]=t}deregisterComponent(t,e=!0){if(e===!0)for(let n in t.allChildren)this.deregisterComponent(t.allChildren[n].component);delete this._components[t.componentName]}setAncestors(t,e=[]){t.ancestors=e;let n=[{componentName:t.componentName,componentClass:t.constructor},...t.ancestors];for(let r in t.allChildren){let i=this._components[r];this.setAncestors(i,n)}}addChildren({parent:t,indexOfDefiningChildren:e,newChildren:n,updatesNeeded:r,compositesBeingExpanded:i}){this.spliceChildren(t,e,n);let a=this.processNewDefiningChildren({parent:t,updatesNeeded:r,compositesBeingExpanded:i}),s={},o={};return n.forEach(l=>s[l.componentName]=l),a.success?{success:!0,deletedComponents:o,addedComponents:s}:a}processNewDefiningChildren({parent:t,updatesNeeded:e,compositesBeingExpanded:n}){this.parameterStack.push(t.sharedParameters,!1);let r=this.deriveChildResultsFromDefiningChildren(t,e,n);this.parameterStack.pop();let i=[{componentName:t.componentName,componentClass:t.constructor},...t.ancestors];for(let a in t.allChildren){let s=this._components[a];this.setAncestors(s,i)}return this.dependencies.updateChildAndDescendantDependencies(t,e,n),r}spliceChildren(t,e,n){let r=t.definingChildren.length;if(!Number.isInteger(e)||e>r||e<0)throw Error("Can't add children at index "+e+". Invalid index.");t.definingChildren.splice(e,0,...n)}finishUpdate({deletedComponents:t,addedComponents:e,init:n=!1}={}){}deleteComponents({components:t,deleteUpstreamDependencies:e=!0,cancelIfUpstreamDeleteFailure:n=!0,updatesNeeded:r,compositesBeingExpanded:i}){Array.isArray(t)||(t=[t]);let a={};this.determineComponentsToDelete({components:t,deleteUpstreamDependencies:e,componentsToDelete:a});let s={};for(let p in a){let m=a[p],f=this.components[m.parentName];if(f===void 0||f.componentName in a)continue;let h=s[m.parentName];h===void 0&&(h={parent:this._components[m.parentName],definingChildrenNames:new Set},s[m.parentName]=h),h.definingChildrenNames.add(p)}let o=!0,l={},c={};for(let p in a){let m=this._components[p];if(m.replacementOf){let f=m.replacementOf;for(let[h,y]of f.replacements.entries())if(y.componentName===p){let b=c[f.componentName];b===void 0&&(b=c[f.componentName]=[]),b.push({ind:h,replacement:f.replacements[h]}),f.replacements.splice(h,1),this.dependencies.updateReplacementDependencies(f,r,i);break}}}for(let p in s){let m=s[p],f=m.parent;l[p]=f.definingChildren,f.definingChildren=f.definingChildren.slice();let h=!1;for(let y=f.definingChildren.length-1;y>=0;y--){let b=f.definingChildren[y];m.definingChildrenNames.has(b.componentName)&&(f.definingChildren.splice(y,1),h=!0)}h&&(this.processNewDefiningChildren({parent:f,updatesNeeded:r,compositesBeingExpanded:i}).success||(console.log("***** can't delete because couldn't derive child results"),o=!1))}if(o===!1&&e===!0&&n!==!0&&console.log("**** Need to determine whether or not can delete components and leave upstream in place"),o===!1){console.log("Failed to delete components");for(let p in c){let m=c[p],f=this._components[p];for(;m.length>0;){let h=m.pop();f.replacements.splice(h.ind,0,h.replacement),this.dependencies.updateReplacementDependencies(f,r,i)}}for(let p in s){let f=s[p].parent;f.definingChildren=l[p],this.processNewDefiningChildren({parent:f,updatesNeeded:r,compositesBeingExpanded:i})}return{success:!1}}let d=[];for(let p in s){let f=s[p].parent;d.push(f),this.processNewDefiningChildren({parent:f,updatesNeeded:r,compositesBeingExpanded:i})}for(let p in c)if(!(p in a)){r.parentsToUpdateDescendants.add(p);for(let m of gt(this._components[p],this.components))r.parentsToUpdateDescendants.add(m)}for(let p in a){let m=this._components[p];if(m.shadows){let f=this._components[m.shadows.componentName];f.shadowedBy.length===1?delete f.shadowedBy:f.shadowedBy.splice(f.shadowedBy.indexOf(m),1)}this.dependencies.deleteAllDownstreamDependencies({component:m,updatesNeeded:r});for(let f in this.dependencies.upstreamDependencies[m.componentName]){let h=this.dependencies.upstreamDependencies[m.componentName][f];for(let y of h)if(y.specifiedComponentName&&y.specifiedComponentName in a){let b=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[y.specifiedComponentName];b||(b=this.dependencies.updateTriggers.dependenciesMissingComponentBySpecifiedName[y.specifiedComponentName]=[]),b.includes(y)||b.push(y)}}this.dependencies.deleteAllUpstreamDependencies({component:m,updatesNeeded:r}),r.deletedStateVariables[m.componentName]||(r.deletedStateVariables[m.componentName]=[]),r.deletedStateVariables[m.componentName].push(...Object.keys(m.state)),r.deletedComponents[m.componentName]=!0,delete this.unsatisfiedChildLogic[m.componentName]}for(let p in a){let m=this._components[p];this.deregisterComponent(m,!1)}return r.componentsTouched=[...new Set(r.componentsTouched)].filter(p=>!(p in a)),r.compositesToUpdateReplacements=[...new Set(r.compositesToUpdateReplacements)].filter(p=>!(p in a)),r.componentsToUpdateDependencies=r.componentsToUpdateDependencies.filter(p=>!(p.componentName in a)),{success:!0,deletedComponents:a,parentsOfDeleted:d}}determineComponentsToDelete({components:t,deleteUpstreamDependencies:e,componentsToDelete:n}){for(let r of t){if(r.componentName in n)continue;n[r.componentName]=this._components[r.componentName];let i=Object.values(r.allChildren).map(a=>a.component);r.adaptedFrom!==void 0&&i.push(r.adaptedFrom),e===!0&&(r.shadowedBy&&i.push(...r.shadowedBy),r.adapterUsed&&i.push(r.adapterUsed),r.replacements&&i.push(...r.replacements)),this.determineComponentsToDelete({components:i,deleteUpstreamDependencies:e,componentsToDelete:n})}}updateCompositeReplacements({component:t,componentChanges:e,sourceOfUpdate:n,updatesNeeded:r,compositesBeingExpanded:i}){let a={},s={},o=new Set;if(t.shadows)return{success:!0,deletedComponents:a,addedComponents:s,parentsOfDeleted:o};let l=this.components[t.componentName];t.replacements||(t.replacements=[]);let c=t.constructor.calculateReplacementChanges({component:l,componentChanges:e,components:this.components,workspace:t.replacementsWorkspace,componentInfoObjects:this.componentInfoObjects}),d=[];for(let m of c)if(m.changeType==="add"){m.replacementsToWithhold!==void 0&&this.adjustReplacementsToWithhold({component:t,change:m,componentChanges:e,updatesNeeded:r,compositesBeingExpanded:i});let f=this._components[t.componentName];this.parameterStack.push(f.sharedParameters,!1);let h,y={[t.componentName]:rr(t)},b=m.numberReplacementsToReplace,g=m.firstReplacementInd;if(b>0&&m.changeTopLevelReplacements&&this.deleteReplacementsFromShadowsThenComposite({change:m,composite:t,componentChanges:e,sourceOfUpdate:n,parentsOfDeleted:o,deletedComponents:a,addedComponents:s,updatesNeeded:r,compositesBeingExpanded:i}),m.serializedReplacements){let N=m.serializedReplacements,v;t.doenetAttributes.newNamespace?v=t.componentName+"/":v=en(t.componentName),h=this.createIsolatedComponentsSub({serializedComponents:N,ancestors:t.ancestors,updatesNeeded:r,compositesBeingExpanded:i,createNameContext:t.componentName+"|replacements",namespaceForUnamed:v,componentsReplacementOf:t}).components}else throw Error("Invalid replacement change.");this.parameterStack.pop();let T={[t.componentName]:{newComponents:h,parent:m.parent}};if(f.shadowedBy){let N=this.createShadowedReplacements({replacementsToShadow:h,componentToShadow:f,parentToShadow:m.parent,updatesNeeded:r,compositesBeingExpanded:i,currentShadowedBy:y,assignNamesOffset:m.assignNamesOffset,componentChanges:e,sourceOfUpdate:n,parentsOfDeleted:o,deletedComponents:a,addedComponents:s});Object.assign(T,N)}for(let N in T){d.push(N);let v=this._components[N];if(!v)continue;let C=T[N].newComponents;if(!v.isExpanded){this.expandCompositeComponent({component:v,updatesNeeded:r,compositesBeingExpanded:i});let x={changeType:"addedReplacements",composite:v,newReplacements:v.replacements,topLevel:!0,firstIndex:0,numberDeleted:0};e.push(x);continue}for(let x of C)s[x.componentName]=x;if(m.changeTopLevelReplacements===!0){let x=this._components[v.parentName];v.replacements.splice(g,0,...C),this.dependencies.updateReplacementDependencies(v,r,i);let V={changeType:"addedReplacements",composite:v,newReplacements:C,topLevel:!0,firstIndex:g,numberDeleted:b};e.push(V),this.processNewDefiningChildren({parent:x,updatesNeeded:r,compositesBeingExpanded:i}),r.componentsTouched.push(...this.componentAndRenderedDescendants(x))}else{let x=this._components[T[N].parent.componentName];this.spliceChildren(x,m.indexOfDefiningChildren,C),this.processNewDefiningChildren({parent:x,updatesNeeded:r,compositesBeingExpanded:i}),C.forEach(w=>s[w.componentName]=w),r.componentsTouched.push(...this.componentAndRenderedDescendants(x));let V={changeType:"addedReplacements",composite:v,newReplacements:C};e.push(V)}}}else if(m.changeType==="delete"){m.replacementsToWithhold!==void 0&&this.adjustReplacementsToWithhold({component:t,change:m,componentChanges:e,updatesNeeded:r,compositesBeingExpanded:i});let f=this.deleteReplacementsFromShadowsThenComposite({change:m,composite:t,componentsToDelete:m.components,componentChanges:e,sourceOfUpdate:n,parentsOfDeleted:o,deletedComponents:a,addedComponents:s,updatesNeeded:r,compositesBeingExpanded:i});d.push(...f)}else{if(m.changeType==="moveDependency")throw Error("moveDependency not implemented");if(m.changeType==="addDependency")throw Error("addDependency not implemented");if(m.changeType==="updateStateVariables"){r.componentsTouched.push(m.component.componentName);let f={},h={};for(let y in m.stateChanges){let b={componentName:m.component.componentName,stateVariable:y,value:m.stateChanges[y],overrideFixed:!0};this.requestComponentChanges({instruction:b,initialChange:!1,workspace:f,updatesNeeded:r,newStateVariableValues:h})}this.processNewStateVariableValues(h,r)}else if(m.changeType==="changeReplacementsToWithhold"){if(m.replacementsToWithhold!==void 0){let f=this.adjustReplacementsToWithhold({component:t,change:m,componentChanges:e,updatesNeeded:r,compositesBeingExpanded:i});d.push(...f)}this.processChildChangesAndRecurseToShadows({component:t,updatesNeeded:r,compositesBeingExpanded:i})}}for(let m of d){let f=this._components[m];r.parentsToUpdateDescendants.add(f.componentName);for(let h of gt(f,this.components))r.parentsToUpdateDescendants.add(h)}return{success:!0,deletedComponents:a,addedComponents:s,parentsOfDeleted:o}}deleteReplacementsFromShadowsThenComposite({change:t,composite:e,componentsToDelete:n,componentChanges:r,sourceOfUpdate:i,parentsOfDeleted:a,deletedComponents:s,addedComponents:o,updatesNeeded:l,compositesBeingExpanded:c}){let d=[];if(!e.isExpanded)return d;if(e.shadowedBy)for(let p of e.shadowedBy){let m;if(n){m=[];for(let h of n){let y;if(h.shadowedBy){for(let b of h.shadowedBy)if(b.shadows.compositeName===p.shadows.compositeName){y=b;break}}y?m.push(y):console.error(`could not find shadowing component of ${h.componentName}`)}}let f=this.deleteReplacementsFromShadowsThenComposite({change:t,composite:p,componentsToDelete:m,componentChanges:r,sourceOfUpdate:i,parentsOfDeleted:a,deletedComponents:s,addedComponents:o,updatesNeeded:l,compositesBeingExpanded:c});d.push(...f)}if(t.changeTopLevelReplacements){let p=t.firstReplacementInd,m=t.numberReplacementsToDelete;t.changeType==="add"&&(m=t.numberReplacementsToReplace);let f=e.replacements.splice(p,m);this.dependencies.updateReplacementDependencies(e,l,c);let h=this.deleteComponents({components:f,componentChanges:r,sourceOfUpdate:i,updatesNeeded:l});if(h.success===!1)throw Error("Couldn't delete components on composite update");for(let T of h.parentsOfDeleted)a.add(T.componentName),l.componentsTouched.push(...this.componentAndRenderedDescendants(T));let y={};for(let T in h.deletedComponents){let v=h.deletedComponents[T].parentName;y[v]===void 0&&(y[v]=[]),y[v].push(T)}let b={changeType:"deletedReplacements",composite:e,topLevel:!0,firstIndex:p,numberDeleted:m,deletedNamesByParent:y,deletedComponents:h.deletedComponents};r.push(b),Object.assign(s,h.deletedComponents);let g=this._components[e.parentName];l.componentsTouched.push(...this.componentAndRenderedDescendants(g))}else{let p=n.length,m=this.deleteComponents({components:n,deleteUpstreamDependencies:!1,componentChanges:r,sourceOfUpdate:i,updatesNeeded:l,compositesBeingExpanded:c});if(m.success===!1)throw Error("Couldn't delete components prescribed by composite");for(let y of m.parentsOfDeleted)a.add(y.componentName),l.componentsTouched.push(...this.componentAndRenderedDescendants(y));let f={};for(let y in m.deletedComponents){let g=m.deletedComponents[y].parentName;f[g]===void 0&&(f[g]=[]),f[g].push(y)}let h={changeType:"deletedReplacements",composite:e,numberDeleted:p,deletedNamesByParent:f,deletedComponents:m.deletedComponents};r.push(h),Object.assign(s,m.deletedComponents),Object.assign(o,m.addedComponents)}return d}processChildChangesAndRecurseToShadows({component:t,updatesNeeded:e,compositesBeingExpanded:n}){let r=this._components[t.parentName];if(this.processNewDefiningChildren({parent:r,updatesNeeded:e,compositesBeingExpanded:n}),e.componentsTouched.push(...this.componentAndRenderedDescendants(r)),t.shadowedBy)for(let i of t.shadowedBy)this.processChildChangesAndRecurseToShadows({component:i,updatesNeeded:e,compositesBeingExpanded:n})}createShadowedReplacements({replacementsToShadow:t,componentToShadow:e,parentToShadow:n,updatesNeeded:r,compositesBeingExpanded:i,currentShadowedBy:a,assignNamesOffset:s,componentChanges:o,sourceOfUpdate:l,parentsOfDeleted:c,deletedComponents:d,addedComponents:p}){let m=rr(e);if(!a[e.componentName]||!m.every(y=>a[e.componentName].includes(y)))throw Error(`circular reference involving ${e.componentName}`);i.push(e.componentName);let f={};for(let y of e.shadowedBy){if(i.includes(y.componentName))throw Error(`circular dependence involving ${y.componentName}`);if(y.shadowedBy&&(a[y.componentName]=rr(y)),y.isExpanded){let b=t.map(x=>x.serialize({forCopy:!0}));if(b=ke({serializedComponents:b,componentName:y.shadows.compositeName}),y.constructor.assignNamesToReplacements){let x=y.constructor.originalNamesAreConsistent&&y.doenetAttributes.newNamespace;b=U({assignNames:y.doenetAttributes.assignNames,indOffset:s,serializedComponents:b,parentName:y.componentName,parentCreatesNewNamespace:y.doenetAttributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:x}).serializedComponents}else{let x=y.doenetAttributes.newNamespace;b=U({indOffset:s,serializedComponents:b,parentName:y.componentName,parentCreatesNewNamespace:y.doenetAttributes.newNamespace,componentInfoObjects:this.componentInfoObjects,originalNamesAreConsistent:x}).serializedComponents}let g,T=this._components[y.componentName];this.parameterStack.push(T.sharedParameters,!1);let N;y.doenetAttributes.newNamespace?N=y.componentName+"/":N=en(y.componentName);let v=this.createIsolatedComponentsSub({serializedComponents:b,ancestors:y.ancestors,updatesNeeded:r,compositesBeingExpanded:i,createNameContext:y.componentName+"|replacements",namespaceForUnamed:N,componentsReplacementOf:y});this.parameterStack.pop(),g=v.components;let C;if(n){if(n.shadowedBy){for(let x of n.shadowedBy)if(x.shadows.compositeName===y.shadows.compositeName){C=x;break}}C||console.error(`could not find shadowing parent of ${n.componentName}`)}if(f[y.componentName]={newComponents:g,parent:C},y.shadowedBy){let x=this.createShadowedReplacements({replacementsToShadow:g,componentToShadow:y,parentToShadow:C,updatesNeeded:r,compositesBeingExpanded:i,currentShadowedBy:a,assignNamesOffset:s,componentChanges:o,sourceOfUpdate:l,parentsOfDeleted:c,deletedComponents:d,addedComponents:p});Object.assign(f,x)}}}let h=i.indexOf(e.componentName);if(h===-1)throw Error(`Something is wrong as we lost track that we were expanding ${component.componentName}`);return i.splice(h,1),f}adjustReplacementsToWithhold({component:t,change:e,componentChanges:n,updatesNeeded:r,compositesBeingExpanded:i}){let a=[],s=e.replacementsToWithhold,o;if(t.replacementsToWithhold!==void 0?o=s-t.replacementsToWithhold:o=s,o<0){a.push(t.componentName);let l=t.replacements.length-s,c=t.replacements.length-s+o,d=t.replacements.slice(c,l),p={changeType:"addedReplacements",composite:t,topLevel:!0,newReplacements:d,firstIndex:c,numberDeleted:0};n.push(p)}else if(o>0){a.push(t.componentName);let l=t.replacements.length-s,c=l+o,d=t.replacements.slice(l,c),p={};for(let f of d){let h=f.parentName;p[h]===void 0&&(p[h]=[]),p[h].push(f.componentName)}let m={changeType:"deletedReplacements",composite:t,topLevel:!0,firstIndex:l,numberDeleted:o,deletedNamesByParent:p,deletedComponents:d};n.push(m)}if(t.replacementsToWithhold=s,this.dependencies.updateReplacementDependencies(t,r,i),t.shadowedBy)for(let l of t.shadowedBy){let c=this.adjustReplacementsToWithhold({component:l,change:e,componentChanges:n,updatesNeeded:r,compositesBeingExpanded:i});a.push(...c)}return a}get standardComponentClasses(){return new Proxy(this._standardComponentClasses,K)}set standardComponentClasses(t){return null}get allComponentClasses(){return new Proxy(this._allComponentClasses,K)}set allComponentClasses(t){return null}isInheritedComponentType({inheritedComponentType:t,baseComponentType:e}){return t=t.toLowerCase(),e=e.toLowerCase(),t===e?!0:this.allComponentClasses[e].isPrototypeOf(this.allComponentClasses[t])}isCompositeComponent({componentType:t,includeNonStandard:e=!0}){let n=this.allComponentClasses[t];return n?this.isInheritedComponentType({inheritedComponentType:t,baseComponentType:"_composite"})&&(e||!n.treatAsComponentForRecursiveReplacements):!1}get componentTypesCreatingVariants(){return new Proxy(this._componentTypesCreatingVariants,K)}set componentTypesCreatingVariants(t){return null}get componentTypeWithPotentialVariants(){return new Proxy(this._componentTypeWithPotentialVariants,K)}set componentTypeWithPotentialVariants(t){return null}get allPossibleProperties(){return new Proxy(this._allPossibleProperties,K)}set allPossibleProperties(t){return null}createAllPossibleProperties(){let t=new Set([]);for(let e in this.allComponentClasses){let r=this.allComponentClasses[e].createPropertiesObject({standardComponentClasses:this.standardComponentClasses});for(let i in r)i.toLowerCase()in this.standardComponentClasses&&t.add(i)}return[...t]}get components(){return new Proxy(this._components,K)}set components(t){return null}requestAction({componentName:t,actionName:e,args:n}){let r=this.components[t];if(r&&r.actions){let i=r.actions[e];if(i)return i(n)}console.warn(`Cannot run action ${e} on component ${t}`)}requestUpdate({updateInstructions:t,transient:e=!1,event:n}){if(this.flags.readOnly){let l={};for(let c of t){let d=l[c.componentName];d||(d=l[c.componentName]={}),c.sourceInformation&&Object.assign(d,c.sourceInformation)}return this.updateRendererInstructions({componentNames:t.map(c=>c.componentName),sourceOfUpdate:{sourceInformation:l}}),this.finishUpdate(),{success:!1}}let r={componentsTouched:[],compositesToExpand:new Set([]),compositesToUpdateReplacements:[],componentsToUpdateDependencies:[],unresolvedDependencies:{},unresolvedByDependent:{},deletedStateVariables:{},deletedComponents:{},recreatedComponents:{},itemScoreChanges:new Set,parentsToUpdateDescendants:new Set},i={},a={},s={};for(let l of t){if(l.componentName){let c=a[l.componentName];c||(c=a[l.componentName]={}),l.sourceInformation&&Object.assign(c,l.sourceInformation)}l.updateType==="updateValue"?this.requestComponentChanges({instruction:l,workspace:s,updatesNeeded:r,newStateVariableValues:i}):l.updateType==="addComponents"?console.log("add component"):l.updateType==="deleteComponents"?console.log("delete component"):l.updateType==="executeUpdate"&&this.executeUpdateStateVariables({newStateVariableValues:i,updatesNeeded:r,preliminary:!0})}this.externalFunctions.localStateChanged&&this.externalFunctions.localStateChanged({newStateVariableValues:i,contentId:this.contentId,sourceOfUpdate:{sourceInformation:a},transient:e});let o=Infinity;for(;o>0;){let l=this.executeUpdateStateVariables({newStateVariableValues:i,updatesNeeded:r,sourceOfUpdate:{sourceInformation:a,local:!0}});if(!(l.nFailures&&l.nFailures<o))break;o=l.nFailures}if(r.itemScoreChanges.size>0){n&&(n.context||(n.context={}),n.context.itemCreditAchieved||(n.context.itemCreditAchieved={}),n.context.documentCreditAchieved=this.document.stateValues.creditAchieved);for(let l of r.itemScoreChanges)this.externalFunctions.submitResponse&&this.externalFunctions.submitResponse({itemNumber:l,itemCreditAchieved:this.document.stateValues.itemCreditAchieved[l],callBack:this.submitResponseCallBack}),n&&(n.context.itemCreditAchieved[Number(l)+1]=this.document.stateValues.itemCreditAchieved[l])}return this.document.stateValues.itemCreditAchieved,n&&this.requestRecordEvent(n),{success:!0}}requestRecordEvent(t){this.externalFunctions.recordEvent&&(t.timestamp=new Date().toISOString().slice(0,19).replace("T"," "),t.result||(t.result={}),t.context||(t.context={}),this.externalFunctions.recordEvent(t))}executeUpdateStateVariables({newStateVariableValues:t,updatesNeeded:e,sourceOfUpdate:n,preliminary:r=!1}){let i={},a=[];for(let l in t){let c=this._components[l];if(c){let d=this.changedStateVariables[l];d||(d=this.changedStateVariables[l]={});for(let p in t[l]){let m=c.state[p];if(m)if(m.isArray){d[p]||(d[p]=new Set);for(let f in t[l][p])f!=="mergeObject"&&d[p].add(f)}else d[p]=!0}}}e===void 0&&(e={componentsTouched:Object.keys(t),compositesToExpand:new Set([]),compositesToUpdateReplacements:[],componentsToUpdateDependencies:[],unresolvedDependencies:{},unresolvedByDependent:{},deletedStateVariables:{},deletedComponents:{},recreatedComponents:{},itemScoreChanges:new Set,parentsToUpdateDescendants:new Set});let s=Object.assign({},this.unsatisfiedChildLogic),o=this.processNewStateVariableValues(t,e);if(Object.assign(i,o),this.replacementChangesFromCompositesToUpdate({updatesNeeded:e,compositesBeingExpanded:a}),Object.keys(e.unresolvedDependencies).length>0&&(e.unresolvedMessage="",this.resolveAllDependencies(e,a)),this.dependencies.updateDependencies(e,a),Object.keys(e.unresolvedDependencies).length>0)throw console.log("have some unresolved"),console.log(e.unresolvedDependencies),console.log(e.unresolvedByDependent),Error("Have unresolved dependencies after executing update state variables.  How should we handle this?");if(Object.keys(this.unsatisfiedChildLogic).length>0){let l="",c=!1;for(let d in this.unsatisfiedChildLogic)l+=`Invalid children for ${d}: ${this.unsatisfiedChildLogic[d].message} `,d in s||(c=!0);c&&(console.error("Have unresolved child logic after execute update state variables"),console.error(l))}if(r)return i;if(e.componentsTouched=[...new Set(e.componentsTouched)],this.updateRendererInstructions({componentNames:e.componentsTouched,sourceOfUpdate:n,recreatedComponents:e.recreatedComponents}),this.finishUpdate(),Object.keys(this.unsatisfiedChildLogic).length>0){let l="";for(let c in this.unsatisfiedChildLogic)l+=`Invalid children for ${c}: ${this.unsatisfiedChildLogic[c].message} `;console.warn(l)}return console.log("**** Components after updateValue"),console.log(this._components),i}replacementChangesFromCompositesToUpdate({updatesNeeded:t,compositesBeingExpanded:e}){let n=[...new Set(t.compositesToUpdateReplacements)];t.compositesToUpdateReplacements=[];let r=[],i=0,a=[];for(;n.length>0;){for(let s of n){let o=this._components[s];if(o instanceof this.allComponentClasses._composite&&o.isExpanded)if(o.state.readyToExpand.isResolved){let l=this.updateCompositeReplacements({component:o,componentChanges:a,updatesNeeded:t,compositesBeingExpanded:e});for(let c in l.addedComponents){this.changedStateVariables[c]={};for(let d in this._components[c].state){let p=this._components[c].state[d];p.isArray?this.changedStateVariables[c][d]=new Set(p.getAllArrayKeys(p.arraySize)):p.isArrayEntry||(this.changedStateVariables[c][d]=!0)}}}else r.push(s)}if(n=[...new Set(t.compositesToUpdateReplacements)],t.compositesToUpdateReplacements=[],i++,i>100)throw Error("Seem to have an infinite loop while calculating replacement changes")}return t.compositesToUpdateReplacements=r,{componentChanges:a}}processNewStateVariableValues(t,e){let n=0,r=this.getStateVariableValue;for(let i in t){let a=this._components[i];if(a===void 0){console.warn(`can't update state variables of component ${i}, as it doesn't exist.`),n+=1;continue}let s=t[i];for(let o in s){let l=a.state[o];if(l===void 0){console.warn(`can't update state variable ${o} of component ${i}, as it doesn't exist.`),n+=1;continue}if(l.value,l._previousValue=l.value,l.isArray){let c=[];if(Array.isArray(s[o]))throw Error(`do we still want to support setting entire array in inverse direction? ${o}, ${i}`);for(let d in s[o]){if(d==="mergeObject")continue;if(!(l.essential||l.essentialByArrayKey[d])){console.warn(`can't update arrayKey ${d}  of state variable ${o} of component ${i}, as it is not an essential state variable.`),n+=1;continue}n+=l.setArrayValue({value:s[o][d],arrayKey:d,arraySize:l.arraySize}).nFailures;let m=l.varNamesIncludingArrayKeys[d];m&&c.push(...m)}for(let d of c){let p=a.state[d];Object.getOwnPropertyDescriptor(p,"value").get||p.immutable||(p._previousValue=p.value,delete p.value,Object.defineProperty(p,"value",{get:()=>r({component:a,stateVariable:d}),configurable:!0})),this.markUpstreamDependentsStale({component:a,varName:d,updatesNeeded:e}),this.dependencies.recordActualChangeInUpstreamDependencies({component:a,varName:d})}}else{if(!l.essential){console.warn(`can't update state variable ${o} of component ${i}, as it is not an essential state variable.`),n+=1;continue}l.set?l.value=l.set(s[o]):l.value=s[o],delete l.usedDefault}this.markUpstreamDependentsStale({component:a,varName:o,updatesNeeded:e}),this.dependencies.recordActualChangeInUpstreamDependencies({component:a,varName:o})}}return{nFailures:n}}requestComponentChanges({instruction:t,initialChange:e=!0,workspace:n,updatesNeeded:r,newStateVariableValues:i}){let a=this._components[t.componentName],s=this.substituteAliases({stateVariables:[t.stateVariable],componentClass:a.constructor})[0];n[t.componentName]===void 0&&(n[t.componentName]={});let o=n[t.componentName],l=this.getStateVariableDefinitionArguments({component:a,stateVariable:s});l.componentInfoObjects=this.componentInfoObjects,l.initialChange=e,l.stateValues=a.stateValues,l.overrideFixed=t.overrideFixed,l.shadowedVariable=t.shadowedVariable;let c=a.state[s],d=s;if(c.isArrayEntry){let y=c.arrayStateVariable;d=y,c.entireArrayAtOnce&&(l.arrayKeys=c.arrayKeys);let b={};if(l.arrayKeys.length===1){if("value"in t)b[l.arrayKeys[0]]=t.value;else if("valueOfStateVariable"in t){let g=this.substituteAliases({stateVariables:[t.valueOfStateVariable],componentClass:a.constructor})[0],T=a.state[g];if(T)b[l.arrayKeys[0]]=T.value;else throw Error(`Invalid instruction to change ${t.stateVariable} of ${t.componentName}, value of state variable ${t.valueOfStateVariable} not found.`)}}else for(let[g,T]of l.arrayKeys.entries())b[T]=t.value[g];l.desiredStateVariableValues={[y]:b}}else if("value"in t)l.desiredStateVariableValues={[s]:t.value};else if("valueOfStateVariable"in t){let y=this.substituteAliases({stateVariables:[t.valueOfStateVariable],componentClass:a.constructor})[0],b=a.state[y];if(b)l.desiredStateVariableValues={[s]:b.value};else throw Error(`Invalid instruction to change ${t.stateVariable} of ${t.componentName}, value of state variable ${t.valueOfStateVariable} not found.`)}let p=o[d];if(p===void 0&&(p=o[d]={}),c.additionalStateVariablesDefined)for(let y of c.additionalStateVariablesDefined){let b=y;a.state[y].isArray&&(b=c.arrayStateVariable);let T=o[b];T&&(Object.assign(p,T),o[b]=p)}if(l.workspace=p,t.additionalStateVariableValues)for(let y in t.additionalStateVariableValues){if(!c.additionalStateVariablesDefined.includes(y)){console.warn(`Can't invert ${y} at the same time as ${s}, as not an additional state variable defined`);continue}l.desiredStateVariableValues[y]=t.additionalStateVariableValues[y]}if(r.componentsTouched.push(a.componentName),!c.inverseDefinition){console.warn(`Cannot change state variable ${s} of ${a.componentName} as it doesn't have an inverse definition`);return}if(a.stateValues.fixed&&!t.overrideFixed){console.log(`Changing ${s} of ${a.componentName} did not succeed because fixed is true.`);return}if(!(e||a.stateValues.modifyIndirectly!==!1)){console.log(`Changing ${s} of ${a.componentName} did not succeed because modifyIndirectly is false.`);return}let m=c.inverseDefinition(l);if(!m.success){console.log(`Changing ${s} of ${a.componentName} did not succeed.`);return}let f=[],h;for(let y of m.instructions){let b=!1;if(y.setDependency){let g=y.setDependency,T=this.dependencies.downstreamDependencies[a.componentName][s][g];if(["stateVariable","parentStateVariable"].includes(T.dependencyType)&&T.downstreamComponentNames.length===1){let N=T.downstreamComponentNames[0],v=T.mappedDownstreamVariableNamesByComponent[0][0],C=this._components[N].state[v];if(C.isArrayEntry||C.isArray){let x=C.isArrayEntry?C.arrayStateVariable:v;if(h&&!(h.componentName===N&&h.stateVariable===x&&h.shadowedVariable===y.shadowedVariable&&h.treatAsInitialChange===y.treatAsInitialChange)&&(f.push(h),h=void 0),!y.additionalDependencyValues)if(b=!0,h||(h={combinedArray:!0,componentName:N,stateVariable:x,shadowedVariable:y.shadowedVariable,treatAsInitialChange:y.treatAsInitialChange,desiredValue:{}}),C.isArrayEntry){let V=C.arrayKeys;if(V.length===1)h.desiredValue[V[0]]=y.desiredValue;else for(let[w,D]of V.entries())h.desiredValue[D]=y.desiredValue[w]}else Object.assign(h.desiredValue,y.desiredValue)}}}b||(h&&(f.push(h),h=void 0),f.push(y))}h&&(f.push(h),h=void 0);for(let y of f)if(y.setStateVariable){if(!("value"in y))throw Error(`Invalid inverse definition of ${s} of ${a.componentName}: setStateVariable must specify a value`);i[a.componentName]||(i[a.componentName]={}),a.state[y.setStateVariable].isArray?(i[a.componentName][y.setStateVariable]||(i[a.componentName][y.setStateVariable]={mergeObject:!0}),Object.assign(i[a.componentName][y.setStateVariable],y.value)):i[a.componentName][y.setStateVariable]=y.value}else if(y.setDependency){let b=y.setDependency,g=this.dependencies.downstreamDependencies[a.componentName][s][b];if(g.dependencyType==="child"){let T=g.downstreamComponentNames[y.childIndex];if(!T)throw Error(`Invalid inverse definition of ${s} of ${a.componentName}: ${b} child of index ${y.childIndex} does not exist.`);let N=g.mappedDownstreamVariableNamesByComponent[y.childIndex][y.variableIndex];if(!N)throw Error(`Invalid inverse definition of ${s} of ${a.componentName}: ${b} variable of index ${y.variableIndex} does not exist.`);let v={componentName:T,stateVariable:N,value:y.desiredValue,overrideFixed:t.overrideFixed,arrayKey:y.arrayKey};this.requestComponentChanges({instruction:v,initialChange:y.treatAsInitialChange===!0,workspace:n,updatesNeeded:r,newStateVariableValues:i})}else if(["stateVariable","parentStateVariable"].includes(g.dependencyType)&&g.downstreamComponentNames.length===1){let T=g.downstreamComponentNames[0],N=g.mappedDownstreamVariableNamesByComponent[0][0],v={componentName:T,stateVariable:N,value:y.desiredValue,overrideFixed:t.overrideFixed,shadowedVariable:y.shadowedVariable};if(y.additionalDependencyValues){let C=this.components[T].state[N];for(let x in y.additionalDependencyValues){let V=this.dependencies.downstreamDependencies[a.componentName][s][x];if(!(["stateVariable","parentStateVariable"].includes(V.dependencyType)&&V.downstreamComponentNames.length===1)){console.warn(`Can't simultaneously set additional dependency value ${x} if it isn't a state variable`);continue}let w=V.mappedDownstreamVariableNamesByComponent[0][0];if(V.downstreamComponentNames[0]!==T||!C.additionalStateVariablesDefined.includes(w)){console.warn(`Can't simultaneously set additional dependency value ${x} if it doesn't correspond to additional state variable defined of ${b}'s state variable`);continue}v.additionalStateVariableValues||(v.additionalStateVariableValues={}),v.additionalStateVariableValues[w]=y.additionalDependencyValues[x]}}this.requestComponentChanges({instruction:v,initialChange:y.treatAsInitialChange===!0,workspace:n,updatesNeeded:r,newStateVariableValues:i})}else throw Error(`unimplemented dependency type ${g.dependencyType} in requestComponentChanges`)}else if(y.combinedArray){let b={componentName:y.componentName,stateVariable:y.stateVariable,value:y.desiredValue,overrideFixed:t.overrideFixed,shadowedVariable:y.shadowedVariable};this.requestComponentChanges({instruction:b,initialChange:y.treatAsInitialChange===!0,workspace:n,updatesNeeded:r,newStateVariableValues:i})}else if(y.deferSettingDependency){let b=y.deferSettingDependency,g=this.dependencies.downstreamDependencies[a.componentName][s][b];if(g.dependencyType==="child"){let T=g.downstreamComponentNames[y.childIndex];if(!T)throw Error(`Invalid for deferSettingDependency in inverse definition of ${s} of ${a.componentName}: ${b} child of index ${y.childIndex} does not exist.`);let N=g.mappedDownstreamVariableNamesByComponent[y.childIndex][y.variableIndex];if(!N)throw Error(`Invalid for deferSettingDependency in inverse definition of ${s} of ${a.componentName}: ${b} variable of index ${y.variableIndex} does not exist..`);let v=this._components[T];if(v.componentType!=="string")throw Error("deferStateVariableDependency is implemented just when dependency is a string.");Object.getOwnPropertyDescriptor(v.state[N],"value").get||(v.state[N]._previousValue=v.state[N].value),delete v.state[N].value;let C=()=>this.getDeferredStateVariable({component:v,stateVariable:N,upstreamComponent:a,upstreamStateVariable:s,dependencyValues:y.dependencyValues,inverseDefinition:y.inverseDefinition});Object.defineProperty(v.state[N],"value",{get:C,configurable:!0}),v.state[N].deferred=!0}else throw Error(`unimplemented dependency type ${g.dependencyType} in requestComponentChanges`)}else throw console.log(y),Error(`Unrecognized instruction in inverse definition of ${s} of ${a.componentName}`)}submitResponseCallBack(t){console.log("submit response callback"),console.log(t)}getDeferredStateVariable({component:t,stateVariable:e,upstreamComponent:n,upstreamStateVariable:r,dependencyValues:i,inverseDefinition:a}){console.log("get deffered state variable"),console.log(t.componentName,n.componentName),console.log(r);let s=a({dependencyValues:i,stateValues:n.stateValues});if(!s.success){console.warn(`Inverse definition for deferring state variable failed. component: ${t.componentName}, stateVariable: ${e}, upstreamComponent: ${n.componentName}, upstreamStateVariable: ${r}`);return}for(let o of s.instructions)if(o.setDependency){let l=o.setDependency,c=this.dependencies.downstreamDependencies[n.componentName][r][l];if(c.dependencyType==="child"){let d=c.downstreamComponentNames[o.childIndex];if(!d)throw Error(`Invalid inverse definition of ${e} of ${t.componentName}: ${l} child of index ${o.childIndex} does not exist.`);let p=c.mappedDownstreamVariableNamesByComponent[o.childIndex][o.variableIndex];if(!p)throw Error(`Invalid inverse definition of ${e} of ${t.componentName}: ${l} variable of index ${o.variableIndex} does not exist..`);let m=this._components[d];delete m.state[p].value,delete m.state[p].deferred,m.state[p].value=o.desiredValue}else throw Error(`unimplemented dependency type ${c.dependencyType} in deferred inverse definition`)}else throw Error(`Unrecognized instruction deferred inverse definition of ${e} of ${t.componentName}`);if(Object.getOwnPropertyDescriptor(t.state[e],"value").get)throw Error(`deferred inverse definition of ${e} of ${t.componentName} didn't return value of variable`);return t.state[e].value}calculateScoredItemNumberOfContainer(t){let n=[...this._components[t].ancestors.slice(0,-1).reverse().map(a=>a.componentName),t],r,i;for(let[a,s]of this.document.stateValues.scoredDescendants.entries()){for(let o of n)if(s.componentName===o){r=o,i=a+1;break}if(r!==void 0)break}return r===void 0&&(r=this.document.componentName,i=this.document.stateValues.scoredDescendants.length),{scoredItemNumber:i,scoredComponent:r}}get doenetState(){return this._renderComponents}set doenetState(t){return null}get scoredItemWeights(){return this.document.stateValues.scoredDescendants.map(t=>t.stateValues.weight)}requestAnimationFrame(t,e){if(!this.preventMoreAnimations){let n=++this.lastAnimationID;if(e){let r=window.setTimeout(i=>this._requestAnimationFrame(t,n),e);return this.animationIDs[n]={timeoutID:r},n}else return this.animationIDs[n]={},this._requestAnimationFrame(t,n)}}_requestAnimationFrame(t,e){let n=window.requestAnimationFrame(t),r=this.animationIDs[e];return delete r.timeoutID,r.animationFrameID=n,e}cancelAnimationFrame(t){let e=this.animationIDs[t],n=e.timeoutID;n!==void 0&&window.clearTimeout(n);let r=e.animationFrameID;r!==void 0&&window.cancelAnimationFrame(r),delete this.animationIDs[t]}componentWillUnmount(){this.preventMoreAnimations=!0;for(let t in this.animationIDs)this.coreFunctions.cancelAnimationFrame(t);this.animationIDs={}}},QA=Al;function Ti({value:u,propertySpecification:t,property:e}){if(t.valueTransformations&&u in t.valueTransformations&&(u=t.valueTransformations[u]),t.toLowerCase&&(u=u.toLowerCase()),t.trim&&(u=u.trim()),t.validValues){if(!t.validValues.includes(u)){let n=t.validValues[0];console.warn(`Invalid value ${u} for property ${e}, using value ${n}`),u=n}}else t.clamp&&(u<t.clamp[0]?u=t.clamp[0]:u>t.clamp[1]?u=t.clamp[1]:Number.isFinite(u)||(u=e.default));return u}function rr(u){let t=[];if(u.shadowedBy)for(let e of u.shadowedBy){t.push(e.componentName);let n=rr(e);t.push(...n)}if(u.replacementOf){let e=rr(u.replacementOf);t.push(...e)}return t}export{QA as default};
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
/** @license React v16.13.1
 * react-is.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
